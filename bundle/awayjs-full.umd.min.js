(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports):typeof define==="function"&&define.amd?define(["exports"],e):e(t.AwayjsFull=t.AwayjsFull||{})})(this,function(t){"use strict";function e(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var i=function(){function t(t,e,i){if(t===void 0){t=""}if(e===void 0){e=0}if(i===void 0){i=""}this._errorID=0;this._messsage="";this._name="";this._messsage=t;this._name=name;this._errorID=e}Object.defineProperty(t.prototype,"message",{get:function(){return this._messsage},set:function(t){this._messsage=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"errorID",{get:function(){return this._errorID},enumerable:true,configurable:true});return t}();var r=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i=0}return t.call(this,e||"An abstract method was called! Either an instance of an abstract export class was created, or an abstract method was not overridden by the subclass.",i)||this}return i}(i);var n=function(){function t(t){this.type=undefined;this.target=undefined;this.type=t}t.prototype.clone=function(){return new t(this.type)};return t}();var s=function(t){e(i,t);function i(e,i,r){if(r===void 0){r=null}var n=t.call(this,e)||this;n._asset=i;n._prevName=r||n._asset.name;return n}Object.defineProperty(i.prototype,"asset",{get:function(){return this._asset},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"prevName",{get:function(){return this._prevName},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._asset,this._prevName)};return i}(n);s.INVALIDATE="invalidate";s.DISPOSE="dispose";s.CLEAR="clear";s.RENAME="rename";s.ENTER_FRAME="enterFrame";s.EXIT_FRAME="exitFrame";s.ASSET_CONFLICT_RESOLVED="assetConflictResolved";s.ASSET_COMPLETE="assetComplete";s.TEXTURE_SIZE_ERROR="textureSizeError";var a=function(){function t(t){if(t===void 0){t=null}this.listenerObjects=new Array;this.target=t||this}t.prototype.addEventListener=function(t,e){var i=this.listenerObjects[t];if(i===undefined)i=this.listenerObjects[t]=new o;i.addEventListener(e)};t.prototype.removeEventListener=function(t,e){var i=this.listenerObjects[t];if(i){i.removeEventListener(e);if(i.numListeners==0)delete this.listenerObjects[t]}};t.prototype.dispatchEvent=function(t){var e=this.listenerObjects[t.type];if(e){t.target=this.target;e.dispatchEvent(t)}};t.prototype.hasEventListener=function(t,e){if(this.listenerObjects[t]===undefined)return false;if(e!=null)return this.listenerObjects[t].getEventListenerIndex(e)!==-1;return this.listenerObjects[t].numListeners>0};return t}();var o=function(){function t(){this.index=0;this.listeners=new Array;this.numListeners=0}t.prototype.addEventListener=function(t){if(this.getEventListenerIndex(t)!==-1)return;this.listeners.push(t);this.numListeners++};t.prototype.removeEventListener=function(t){var e=this.getEventListenerIndex(t);if(e===-1)return;this.listeners.splice(e,1);if(e<=this.index)this.index--;this.numListeners--};t.prototype.dispatchEvent=function(t){var e=this.numListeners;for(this.index=0;this.index<e&&this.index<this.numListeners;this.index++)this.listeners[this.index](t)};t.prototype.getEventListenerIndex=function(t){for(var e=0;e<this.numListeners;e++)if(t==this.listeners[e])return e;return-1};return t}();var h=function(t){e(i,t);function i(e){if(e===void 0){e=null}var r=t.call(this)||this;r._id=i.ID_COUNT++;if(e==null)e="null";r._name=e;r._originalName=e;r.updateFullPath();return r}Object.defineProperty(i.prototype,"assetType",{get:function(){throw new r},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"originalName",{get:function(){return this._originalName},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"name",{get:function(){return this._name},set:function(t){var e;e=this._name;this._name=t;if(this._name==null)this._name="null";this.updateFullPath();this.dispatchEvent(new s(s.RENAME,this,e))},enumerable:true,configurable:true});i.prototype.invalidate=function(){this.dispatchEvent(new s(s.INVALIDATE,this))};i.prototype.dispose=function(){this.dispatchEvent(new s(s.DISPOSE,this))};i.prototype.clear=function(){this.dispatchEvent(new s(s.CLEAR,this))};Object.defineProperty(i.prototype,"assetNamespace",{get:function(){return this._namespace},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"assetFullPath",{get:function(){return this._full_path},enumerable:true,configurable:true});i.prototype.assetPathEquals=function(t,e){return this._name==t&&(!e||this._namespace==e)};i.prototype.isAsset=function(t){return this.assetType==t.assetType};i.prototype.resetAssetPath=function(t,e,r){if(e===void 0){e=null}if(r===void 0){r=true}this._name=t?t:"null";this._namespace=e?e:i.DEFAULT_NAMESPACE;if(r)this._originalName=this._name;this.updateFullPath()};i.prototype.updateFullPath=function(){this._full_path=[this._namespace,this._name]};return i}(a);h.ID_COUNT=0;h.DEFAULT_NAMESPACE="default";var u=function(t){e(i,t);function i(e,i){if(e===void 0){e=0}if(i===void 0){i=0}var r=t.call(this)||this;r._count=0;r._stride=0;r._newStride=0;r._viewVOs=new Array;r._stride=r._newStride=e;r._count=i;r._buffer=new ArrayBuffer(r._stride*r._count);r._bufferView=new Uint8Array(r._buffer,0,r._buffer.byteLength);return r}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"stride",{get:function(){if(this._lengthDirty)this._updateLength();return this._stride},set:function(t){if(this._newStride==t)return;this._newStride=t;this.resize()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"count",{get:function(){return this._count},set:function(t){if(this._count==t)return;this._count=t;this.resize()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"buffer",{get:function(){if(this._lengthDirty)this._updateLength();this._contentDirty=false;return this._buffer},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"bufferView",{get:function(){if(this._lengthDirty)this._updateLength();this._contentDirty=false;return this._bufferView},set:function(t){this._bufferView=t;this._buffer=this._bufferView.buffer},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"length",{get:function(){return this._count*this.stride},enumerable:true,configurable:true});i.prototype.invalidate=function(){if(this._contentDirty)return;t.prototype.invalidate.call(this);this._contentDirty=true};i.prototype.resize=function(){if(this._lengthDirty)return;this.clear();this._lengthDirty=true;if(!this._newStride){this._buffer=null;this._bufferView=null}};i.prototype.clone=function(){var t=new i(this._stride,this._count);t.bufferView.set(this.bufferView);var e=this._viewVOs.length;for(var r=0;r<e;r++)this._viewVOs[r].view._internalClone(t);return t};i.prototype.getView=function(t){if(t<this._viewVOs.length)return this._viewVOs[t].view;return null};i.prototype._setAttributes=function(t,e,i){if(i===void 0){i=0}var r=e instanceof Uint8Array?e:new Uint8Array(e.buffer);var n=this._viewVOs[t];var s=n.length;var a=n.offset;var o=r.length/s;if(this.count<o+i)this.count=o+i;if(this._lengthDirty)this._updateLength();if(this._viewVOs.length==1){this._bufferView.set(r)}else{for(var h=0;h<o;h++)this._bufferView.set(r.subarray(h*s,(h+1)*s),(h+i)*this._stride+a)}this.invalidate()};i.prototype._addView=function(t){var e=new l(t);var i=this._viewVOs.length;e.offset=i?this._viewVOs[i-1].offset+this._viewVOs[i-1].length:0;this._viewVOs.push(e);if(this._newStride<e.offset+e.length){this._newStride=e.offset+e.length;this.resize()}t._index=i};i.prototype._removeView=function(t){var e=t._index;var i=this._viewVOs.splice(e,1)[0];var r=this._viewVOs.length;i.dispose();for(var n=e;n<r;n++){i=this._viewVOs[n];i.offset=n?this._viewVOs[n-1].offset+this._viewVOs[n-1].length:0;i.view._index=n}this._newStride=i.offset+i.length;this.resize()};i.prototype._getOffset=function(t){return this._viewVOs[t].offset};i.prototype._updateLength=function(){this._lengthDirty=false;var t;var e;var i=this._viewVOs.length;var r=this._newStride*this._count;if(!this._buffer||this._buffer.byteLength!=r){var n=new ArrayBuffer(r);var s=new Uint8Array(n,0,n.byteLength);var a;var o;var h;var u;if(this._stride!=this._newStride){for(t=0;t<i;t++){a=this._viewVOs[t];o=a.length;h=a.offset;u=a.oldOffset;for(e=0;e<this._count;e++)if(u!=null)s.set(new Uint8Array(this._buffer,e*this._stride+u,o),e*this._newStride+h);a.oldOffset=a.offset}this._stride=this._newStride}else{s.set(new Uint8Array(this._buffer,0,Math.min(r,this._buffer.byteLength)))}this._buffer=n;this._bufferView=s}};return i}(h);u.assetType="[assets AttributesBuffer]";var l=function(){function t(t){this.view=t;this.length=t.size*t.dimensions}t.prototype.dispose=function(){this.view=null};t.prototype.clone=function(){return new t(this.view)};return t}();var p=function(t){e(i,t);function i(e,i,r,n){if(r===void 0){r=0}if(n===void 0){n=false}var s=t.call(this)||this;s._arrayClass=e;s._size=e.BYTES_PER_ELEMENT;s._dimensions=i;s._attributesBuffer=r instanceof u?r:new u(s._dimensions*s._size,r);s._attributesBuffer._addView(s);s._unsigned=n;return s}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"attributesBuffer",{get:function(){return this._attributesBuffer},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"size",{get:function(){return this._size},set:function(t){if(this._size==t)return;this._size=t;this._attributesBuffer._removeView(this);this._attributesBuffer._addView(this)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"dimensions",{get:function(){return this._dimensions},set:function(t){if(this._dimensions==t)return;this._dimensions=t;this._attributesBuffer._removeView(this);this._attributesBuffer._addView(this)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"unsigned",{get:function(){return this._unsigned},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"count",{get:function(){return this._attributesBuffer.count},set:function(t){this._attributesBuffer.count=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"offset",{get:function(){return this._attributesBuffer._getOffset(this._index)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"length",{get:function(){return this._attributesBuffer.count*this._dimensions},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"stride",{get:function(){return this._attributesBuffer.stride/this._size},enumerable:true,configurable:true});i.prototype.set=function(t,e){if(e===void 0){e=0}this._attributesBuffer._setAttributes(this._index,t instanceof Array?new this._arrayClass(t):t,e)};i.prototype.get=function(t,e){if(e===void 0){e=0}return new this._arrayClass(this._attributesBuffer.buffer,e*this._attributesBuffer.stride+this.offset,t*this.stride-this.offset/this.size)};i.prototype._internalClone=function(t){return this._cloneCache=new i(this._arrayClass,this._dimensions,t,this._unsigned)};i.prototype.clone=function(t){if(t===void 0){t=null}if(t)this._internalClone(t);if(!this._cloneCache)this._attributesBuffer.clone();var e=this._cloneCache;this._cloneCache=null;return e};i.prototype.invalidate=function(){t.prototype.invalidate.call(this);this._attributesBuffer.invalidate()};i.prototype.dispose=function(){if(!this._attributesBuffer)return;this._attributesBuffer._removeView(this);this._attributesBuffer=null};return i}(h);p.assetType="[attributes AttributesView]";var c=function(t){e(i,t);function i(e,i){if(i===void 0){i=true}return t.call(this,i?Uint8Array:Int8Array,4,e,i)||this}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.set=function(e,i){if(i===void 0){i=0}t.prototype.set.call(this,e,i)};i.prototype.get=function(e,i){if(i===void 0){i=0}return t.prototype.get.call(this,e,i)};i.prototype._internalClone=function(t){return this._cloneCache=new i(t,this._arrayClass==Uint8Array)};i.prototype.clone=function(e){if(e===void 0){e=null}return t.prototype.clone.call(this,e)};return i}(p);c.assetType="[attributes Byte4Attributes]";var _=function(t){e(i,t);function i(e){return t.call(this,Float32Array,1,e)||this}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.set=function(e,i){if(i===void 0){i=0}t.prototype.set.call(this,e,i)};i.prototype.get=function(e,i){if(i===void 0){i=0}return t.prototype.get.call(this,e,i)};i.prototype._internalClone=function(t){return this._cloneCache=new i(t)};i.prototype.clone=function(e){if(e===void 0){e=null}return t.prototype.clone.call(this,e)};return i}(p);_.assetType="[attributes Float1Attributes]";var f=function(t){e(i,t);function i(e){return t.call(this,Float32Array,2,e)||this}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.set=function(e,i){if(i===void 0){i=0}t.prototype.set.call(this,e,i)};i.prototype.get=function(e,i){if(i===void 0){i=0}return t.prototype.get.call(this,e,i)};i.prototype._internalClone=function(t){return this._cloneCache=new i(t)};i.prototype.clone=function(e){if(e===void 0){e=null}return t.prototype.clone.call(this,e)};return i}(p);f.assetType="[attributes Float2Attributes]";var d=function(t){e(i,t);function i(e){return t.call(this,Float32Array,3,e)||this}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.set=function(e,i){if(i===void 0){i=0}t.prototype.set.call(this,e,i)};i.prototype.get=function(e,i){if(i===void 0){i=0}return t.prototype.get.call(this,e,i)};i.prototype._internalClone=function(t){return this._cloneCache=new i(t)};i.prototype.clone=function(e){if(e===void 0){e=null}return t.prototype.clone.call(this,e)};return i}(p);d.assetType="[attributes Float3Attributes]";var g=function(t){e(i,t);function i(e){return t.call(this,Float32Array,4,e)||this}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.set=function(e,i){if(i===void 0){i=0}t.prototype.set.call(this,e,i)};i.prototype.get=function(e,i){if(i===void 0){i=0}return t.prototype.get.call(this,e,i)};i.prototype._internalClone=function(t){return this._cloneCache=new i(t)};i.prototype.clone=function(e){if(e===void 0){e=null}return t.prototype.clone.call(this,e)};return i}(p);g.assetType="[attributes Float4Attributes]";var m=function(t){e(i,t);function i(e,i){if(i===void 0){i=true}return t.call(this,i?Uint16Array:Int16Array,2,e,i)||this}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.set=function(e,i){if(i===void 0){i=0}t.prototype.set.call(this,e,i)};i.prototype.get=function(e,i){if(i===void 0){i=0}return t.prototype.get.call(this,e,i)};i.prototype._internalClone=function(t){return this._cloneCache=new i(t,this._arrayClass==Uint16Array)};i.prototype.clone=function(e){if(e===void 0){e=null}return t.prototype.clone.call(this,e)};return i}(p);m.assetType="[attributes Short2Attributes]";var y=function(t){e(i,t);function i(e,i){if(i===void 0){i=true}return t.call(this,i?Uint16Array:Int16Array,3,e,i)||this}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.set=function(e,i){if(i===void 0){i=0}t.prototype.set.call(this,e,i)};i.prototype.get=function(e,i){if(i===void 0){i=0}return t.prototype.get.call(this,e,i)};i.prototype._internalClone=function(t){return this._cloneCache=new i(t,this._arrayClass==Uint16Array)};i.prototype.clone=function(e){if(e===void 0){e=null}return t.prototype.clone.call(this,e)};return i}(p);y.assetType="[attributes Short3Attributes]";var v=function(){function t(){var t=this;this._isPlaying=false;this._isLooping=false;this._startTime=0;this._sourceOpenDelegate=function(e){return t._sourceOpen(e)};this._updateEndDelegate=function(e){return t._updateEnd(e)};this._audio=new Audio;this._audio.ontimeupdate=function(e){return t._onTimeUpdate(e)};this._updateSource()}Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._audio.currentTime-this._startTime},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){if(this._volume==t)return;this._volume=t;this._audio.volume=this._volume},enumerable:true,configurable:true});t.prototype.isPlaying=function(){return this._isPlaying};t.prototype.isLooping=function(){return this._isLooping};t.prototype.isDecoding=function(){return false};t.prototype.play=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=false}this._isPlaying=true;if(this._isLooping||this._isLooping!=i){this._isLooping=i;this._sourceDirty=true}if(this._sourceDirty)this._updateSource();this._buffer=t;this._offset=e;if(!this._isQueuing&&!this._isOpening)this._queueBuffer()};t.prototype.stop=function(){this._audio.pause();this._isPlaying=false;this._isLooping=false};t.prototype._sourceOpen=function(t){this._isOpening=false;if(this._mediaSource.activeSourceBuffers.length){console.log("ERR: double sourceopen event called");return}this._sourceBuffer=this._mediaSource.addSourceBuffer("audio/mpeg");this._sourceBuffer.addEventListener("updateend",this._updateEndDelegate);if(this._isPlaying)this._queueBuffer()};t.prototype._queueBuffer=function(){this._isQueuing=true;this._startTime=this._sourceBuffer.timestampOffset;this._sourceBuffer.appendBuffer(this._buffer)};t.prototype._updateEnd=function(t){this._isQueuing=false;if(this._isLooping)this._mediaSource.endOfStream();this._duration=this._sourceBuffer.timestampOffset-this._startTime;this._audio.currentTime=this._startTime+this._offset;this._audio.play()};t.prototype._onTimeUpdate=function(t){if(!this._isLooping&&this._duration<this._audio.currentTime-this._startTime+.1)this.stop()};t.prototype._updateSource=function(){if(this._mediaSource)this._disposeSource();this._isQueuing=false;this._isOpening=true;this._mediaSource=new MediaSource;this._mediaSource.addEventListener("sourceopen",this._sourceOpenDelegate);this._urlString=URL.createObjectURL(this._mediaSource);this._audio.src=this._urlString;this._audio.loop=this._isLooping;this._sourceDirty=false};t.prototype._disposeSource=function(){if(!this._isOpening){if(this._sourceBuffer.timestampOffset)this._sourceBuffer.remove(0,this._sourceBuffer.timestampOffset);this._sourceBuffer.removeEventListener("updateend",this._updateEndDelegate);this._mediaSource.removeSourceBuffer(this._sourceBuffer);delete this._sourceBuffer;this._sourceBuffer=null}this._mediaSource.removeEventListener("sourceopen",this._sourceOpenDelegate);URL.revokeObjectURL(this._urlString);delete this._mediaSource;this._mediaSource=null};return t}();v.maxChannels=4;v._channels=new Array;var x=function(){function t(){var e=this;this._isPlaying=false;this._isLooping=false;this._isDecoding=false;this._volume=1;this._startTime=0;this._audioCtx=t._audioCtx||(t._audioCtx=new(window["AudioContext"]||window["webkitAudioContext"]));this._gainNode=this._audioCtx.createGain();this._gainNode.gain.value=this._volume;this._gainNode.connect(this._audioCtx.destination);this._onEndedDelegate=function(t){return e._onEnded(t)}}Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._audioCtx.currentTime-this._startTime},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){if(this._volume==t)return;this._volume=t;this._gainNode.gain.value=this._volume},enumerable:true,configurable:true});t.prototype.isPlaying=function(){return this._isPlaying};t.prototype.isLooping=function(){return this._isLooping};t.prototype.isDecoding=function(){return this._isDecoding};t.prototype.play=function(e,i,r,n){var s=this;if(i===void 0){i=0}if(r===void 0){r=false}if(n===void 0){n=0}this._isPlaying=true;this._isLooping=r;this._currentTime=i;this._id=n;this._isDecoding=true;if(t._decodeCache[n])this._onDecodeComplete(t._decodeCache[n]);else if(!t._errorCache[n])this._audioCtx.decodeAudioData(e,function(t){return s._onDecodeComplete(t)},function(t){return s._onError(t)});else this.stop()};t.prototype.stop=function(){if(!this._isPlaying)return;this._isPlaying=false;this._isLooping=false;this._isDecoding=false;if(this._source)this._disposeSource()};t.prototype._onDecodeComplete=function(e){if(!this._isPlaying)return;this._isDecoding=false;t._decodeCache[this._id]=e;if(this._source)this._disposeSource();this._source=this._audioCtx.createBufferSource();this._source.loop=this._isLooping;this._source.connect(this._gainNode);this._source.buffer=e;this._duration=e.duration;this._startTime=this._audioCtx.currentTime-this._currentTime;this._source.onended=this._onEndedDelegate;try{this._source.start(this._audioCtx.currentTime,this._currentTime)}catch(i){console.log("Error starting audio: "+i);this._disposeSource()}};t.prototype._onError=function(e){console.log("Error with decoding audio data");t._errorCache[this._id]=true;this.stop()};t.prototype._onEnded=function(t){this.stop()};t.prototype._disposeSource=function(){this._source.stop(this._audioCtx.currentTime);this._source.onended=null;this._source.disconnect();delete this._source.buffer;delete this._source;this._source=null};return t}();x.maxChannels=64;x._channels=new Array;x._decodeCache=new Object;x._errorCache=new Object;var b=function(){function t(){}t.setExternalSoundInterface=function(e){if(e.startSound==null){console.log("Could not set the externalSoundInterface, because it does not provide a 'startSound' function");return}if(e.stopSound==null){console.log("Could not set the externalSoundInterface, because it does not provide a 'stopSound' function");return}t._externalSoundInterface=e};t.getExternalSoundInterface=function(){return t._externalSoundInterface};t.getChannel=function(t){var e=t>5e4?v:x;var i=0;while(e._channels[i]&&e._channels[i].isPlaying())i++;if(i==e.maxChannels){var r;var n=e._channels.length;for(var s=0;s<n;s++){r=e._channels[s];if(!r.isLooping()&&!r.isDecoding()){e._channels.push(e._channels.splice(s,1)[0]);r.stop();return r}}return null}return e._channels[i]||(e._channels[i]=new e)};return t}();b._externalSoundInterface=null;var w=function(t){e(i,t);function i(e){var i=t.call(this)||this;i._volume=1;i._buffer=e;return i}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(t){if(this._volume==t)return;this._volume=t;if(this._audioChannel)this._audioChannel.volume=this._volume},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"currentTime",{get:function(){if(this._audioChannel)return this._audioChannel.currentTime;return 0},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"duration",{get:function(){if(this._audioChannel)return this._audioChannel.duration;return 0},enumerable:true,configurable:true});i.prototype.dispose=function(){this.stop()};i.prototype.play=function(t,e){if(e===void 0){e=false}this._audioChannel=b.getChannel(this._buffer.byteLength);if(this._audioChannel){this._audioChannel.volume=this._volume;this._audioChannel.play(this._buffer,t,e,this.id)}};i.prototype.stop=function(){if(this._audioChannel)this._audioChannel.stop();delete this._audioChannel;this._audioChannel=null};i.prototype.clone=function(){var t=new i(this._buffer);t.name=this.name;return t};return i}(h);w.assetType="[asset WaveAudio]";var D=function(){function t(){}t.float32ColorToARGB=function(t){var e=(t&4278190080)>>>24;var i=(t&16711680)>>>16;var r=(t&65280)>>>8;var n=t&255;var s=[e,i,r,n];return s};t.ARGBtoFloat32=function(t,e,i,r){return t<<24|e<<16|i<<8|r};t.componentToHex=function(t){var e=t.toString(16);return e.length==1?"0"+e:e};t.RGBToHexString=function(e){return"#"+t.componentToHex(e[1])+t.componentToHex(e[2])+t.componentToHex(e[3])};t.ARGBToHexString=function(e){return"#"+t.componentToHex(e[0])+t.componentToHex(e[1])+t.componentToHex(e[2])+t.componentToHex(e[3])};return t}();var C=function(){function t(t,e,i,r,n,s,a,o){if(t===void 0){t=1}if(e===void 0){e=1}if(i===void 0){i=1}if(r===void 0){r=1}if(n===void 0){n=0}if(s===void 0){s=0}if(a===void 0){a=0}if(o===void 0){o=0}if(t instanceof Float32Array){this._rawData=t}else{this._rawData=new Float32Array(8);this.redMultiplier=Number(t);this.greenMultiplier=e;this.blueMultiplier=i;this.alphaMultiplier=r;this.redOffset=n;this.greenOffset=s;this.blueOffset=a;this.alphaOffset=o}}Object.defineProperty(t.prototype,"alphaMultiplier",{get:function(){return this._rawData[3]},set:function(t){this._rawData[3]=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"alphaOffset",{get:function(){return this._rawData[7]*255},set:function(t){this._rawData[7]=t/255},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"blueMultiplier",{get:function(){return this._rawData[2]},set:function(t){this._rawData[2]=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"blueOffset",{get:function(){return this._rawData[6]*255},set:function(t){this._rawData[6]=t/255},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"greenMultiplier",{get:function(){return this._rawData[1]},set:function(t){this._rawData[1]=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"greenOffset",{get:function(){return this._rawData[5]*255},set:function(t){this._rawData[5]=t/255},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"redMultiplier",{get:function(){return this._rawData[0]},set:function(t){this._rawData[0]=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"redOffset",{get:function(){return this._rawData[4]*255},set:function(t){this._rawData[4]=t/255},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"color",{get:function(){return this._rawData[0]<<16|this._rawData[1]<<8|this._rawData[2]},set:function(t){var e=D.float32ColorToARGB(t);this._rawData[4]=e[1];this._rawData[5]=e[2];this._rawData[6]=e[3];this._rawData[0]=0;this._rawData[1]=0;this._rawData[2]=0},enumerable:true,configurable:true});t.prototype.copyRawDataFrom=function(t){var e=this._rawData;e[0]=e[0];e[1]=e[1];e[2]=e[2];e[3]=e[3];e[4]=e[4];e[5]=e[5];e[6]=e[6];e[7]=e[7]};t.prototype.clear=function(){this._rawData[0]=1;this._rawData[1]=1;this._rawData[2]=1;this._rawData[3]=1;this._rawData[4]=0;this._rawData[5]=0;this._rawData[6]=0;this._rawData[7]=0};t.prototype.clone=function(){var e=new t;e.copyFrom(this);return e};t.prototype.copyFrom=function(t){var e=t._rawData,i=this._rawData;i[0]=e[0];i[1]=e[1];i[2]=e[2];i[3]=e[3];i[4]=e[4];i[5]=e[5];i[6]=e[6];i[7]=e[7]};t.prototype.copyTo=function(t){t.copyFrom(this)};t.prototype.prepend=function(t){this._rawData[4]+=t._rawData[4]*this._rawData[0];this._rawData[5]+=t._rawData[5]*this._rawData[1];this._rawData[6]+=t._rawData[6]*this._rawData[2];this._rawData[7]+=t._rawData[7]*this._rawData[3];this.redMultiplier*=t.redMultiplier;this.greenMultiplier*=t.greenMultiplier;this.blueMultiplier*=t.blueMultiplier;this.alphaMultiplier*=t.alphaMultiplier};t.prototype._isRenderable=function(){return this._rawData[3]!=0||this._rawData[7]>0};return t}();var A=function(){function t(t,e,i,r){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=1}this.x=t;this.y=e;this.z=i;this.w=r}Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:true,configurable:true});t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)};t.angleBetween=function(t,e){return Math.acos(t.dotProduct(e)/(t.length*e.length))};t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)};t.combine=function(e,i,r,n){return new t(e.x*r+i.x*n,e.y*r+i.y*n,e.z*r+i.z*n)};t.prototype.copyFrom=function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w};t.prototype.crossProduct=function(e,i){if(i===void 0){i=null}if(i==null)i=new t;i.x=this.y*e.z-this.z*e.y;i.y=this.z*e.x-this.x*e.z;i.z=this.x*e.y-this.y*e.x;return i};t.prototype.decrementBy=function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z};t.distance=function(t,e){var i=t.x-e.x;var r=t.y-e.y;var n=t.z-e.z;return Math.sqrt(i*i+r*r+n*n)};t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z};t.prototype.equals=function(t,e){if(e===void 0){e=false}return this.x==t.x&&this.y==t.y&&this.z==t.z&&(!e||this.w==t.w)};t.prototype.incrementBy=function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z};t.prototype.nearEquals=function(t,e,i){if(i===void 0){i=true}return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e&&(!i||Math.abs(this.w-t.w)<e)};t.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};t.prototype.normalize=function(t){if(t===void 0){t=1}if(this.length!=0){var e=t/this.length;this.x*=e;this.y*=e;this.z*=e;return}};t.prototype.project=function(){this.x/=this.w;this.y/=this.w;this.z/=this.w};t.prototype.scaleBy=function(t){this.x*=t;this.y*=t;this.z*=t};t.prototype.setTo=function(t,e,i){this.x=t;this.y=e;this.z=i};t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)};t.prototype.toString=function(){return"[Vector3D] (x:"+this.x+" ,y:"+this.y+", z"+this.z+", w:"+this.w+")"};return t}();A.X_AXIS=new A(1,0,0);A.Y_AXIS=new A(0,1,0);A.Z_AXIS=new A(0,0,1);var T=function(){function t(t,e,i,r,n,s){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}if(n===void 0){n=0}if(s===void 0){s=0}this.x=t;this.y=e;this.z=i;this.width=r;this.height=n;this.depth=s}Object.defineProperty(t.prototype,"back",{get:function(){return this.z+this.depth},set:function(t){this.depth=t-this.z},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"bottomRightBack",{get:function(){if(this._bottomRightBack==null)this._bottomRightBack=new A;this._bottomRightBack.x=this.x+this.width;this._bottomRightBack.y=this.y+this.height;this._bottomRightBack.z=this.z+this.depth;return this._bottomRightBack},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"front",{get:function(){return this.z},set:function(t){this.depth+=this.z-t;this.z=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"left",{get:function(){return this.x},set:function(t){this.width+=this.x-t;this.x=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"size",{get:function(){if(this._size==null)this._size=new A;this._size.x=this.width;this._size.y=this.height;this._size.z=this.depth;return this._size},enumerable:true,configurable:true
});Object.defineProperty(t.prototype,"top",{get:function(){return this.y},set:function(t){this.height+=this.y-t;this.y=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"topLeftFront",{get:function(){if(this._topLeftFront==null)this._topLeftFront=new A;this._topLeftFront.x=this.x;this._topLeftFront.y=this.y;this._topLeftFront.z=this.z;return this._topLeftFront},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.width,this.height,this.depth)};t.prototype.contains=function(t,e,i){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e&&this.z<=i&&this.z+this.depth>=i};t.prototype.containsPoint=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y&&this.z<=t.z&&this.z+this.depth>=t.z};t.prototype.containsBox=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height&&this.z<=t.z&&this.z+this.depth>=t.z+t.depth};t.prototype.copyFrom=function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.width=t.width;this.height=t.height;this.depth=t.depth};t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z&&this.width==t.width&&this.height==t.height&&this.depth==t.depth};t.prototype.inflate=function(t,e,i){this.x-=t/2;this.y-=e/2;this.z-=i/2;this.width+=t/2;this.height+=e/2;this.depth+=i/2};t.prototype.inflatePoint=function(t){this.x-=t.x/2;this.y-=t.y/2;this.z-=t.z/2;this.width+=t.x/2;this.height+=t.y/2;this.depth+=t.z/2};t.prototype.intersection=function(e){if(this.intersects(e)){var i=new t;if(this.x>e.x){i.x=this.x;i.width=e.x-this.x+e.width;if(i.width>this.width)i.width=this.width}else{i.x=e.x;i.width=this.x-e.x+this.width;if(i.width>e.width)i.width=e.width}if(this.y>e.y){i.y=this.y;i.height=e.y-this.y+e.height;if(i.height>this.height)i.height=this.height}else{i.y=e.y;i.height=this.y-e.y+this.height;if(i.height>e.height)i.height=e.height}if(this.z>e.z){i.z=this.z;i.depth=e.z-this.z+e.depth;if(i.depth>this.depth)i.depth=this.depth}else{i.z=e.z;i.depth=this.z-e.z+this.depth;if(i.depth>e.depth)i.depth=e.depth}return i}return new t};t.prototype.intersects=function(t){return this.x+this.width>t.x&&this.x<t.x+t.width&&this.y+this.height>t.y&&this.y<t.y+t.height&&this.z+this.depth>t.z&&this.z<t.z+t.depth};t.prototype.rayIntersection=function(t,e,i){if(this.containsPoint(t))return 0;var r=this.width/2;var n=this.height/2;var s=this.depth/2;var a=this.x+r;var o=this.y+n;var h=this.z+s;var u=t.x-a;var l=t.y-o;var p=t.z-h;var c=e.x;var _=e.y;var f=e.z;var d;var g;var m;var y;var v;if(c<0){y=(r-u)/c;if(y>0){g=l+y*_;m=p+y*f;if(g>-n&&g<n&&m>-s&&m<s){i.x=1;i.y=0;i.z=0;v=true}}}if(!v&&c>0){y=(-r-u)/c;if(y>0){g=l+y*_;m=p+y*f;if(g>-n&&g<n&&m>-s&&m<s){i.x=-1;i.y=0;i.z=0;v=true}}}if(!v&&_<0){y=(n-l)/_;if(y>0){d=u+y*c;m=p+y*f;if(d>-r&&d<r&&m>-s&&m<s){i.x=0;i.y=1;i.z=0;v=true}}}if(!v&&_>0){y=(-n-l)/_;if(y>0){d=u+y*c;m=p+y*f;if(d>-r&&d<r&&m>-s&&m<s){i.x=0;i.y=-1;i.z=0;v=true}}}if(!v&&f<0){y=(s-p)/f;if(y>0){d=u+y*c;g=l+y*_;if(g>-n&&g<n&&d>-r&&d<r){i.x=0;i.y=0;i.z=1;v=true}}}if(!v&&f>0){y=(-s-p)/f;if(y>0){d=u+y*c;g=l+y*_;if(g>-n&&g<n&&d>-r&&d<r){i.x=0;i.y=0;i.z=-1;v=true}}}return v?y:-1};t.prototype.closestPointToPoint=function(t,e){if(e===void 0){e=null}var i;if(e==null)e=new A;i=t.x;if(i<this.x)i=this.x;if(i>this.x+this.width)i=this.x+this.width;e.x=i;i=t.y;if(i<this.y+this.height)i=this.y+this.height;if(i>this.y)i=this.y;e.y=i;i=t.z;if(i<this.z)i=this.z;if(i>this.z+this.depth)i=this.z+this.depth;e.z=i;return e};t.prototype.isEmpty=function(){return this.x==0&&this.y==0&&this.z==0&&this.width==0&&this.height==0&&this.depth==0};t.prototype.offset=function(t,e,i){this.x+=t;this.y+=e;this.z+=i};t.prototype.offsetPosition=function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z};t.prototype.setEmpty=function(){this.x=0;this.y=0;this.z=0;this.width=0;this.height=0;this.depth=0};t.prototype.setBoundIdentity=function(){this.x=Number.MAX_VALUE/2;this.y=Number.MAX_VALUE/2;this.z=Number.MAX_VALUE/2;this.width=-Number.MAX_VALUE;this.height=-Number.MAX_VALUE;this.depth=-Number.MAX_VALUE};t.prototype.setTo=function(t,e,i,r,n,s){this.x=t;this.y=e;this.z=i;this.width=r;this.height=n;this.depth=s};t.prototype.toString=function(){return"[Box] (x="+this.x+", y="+this.y+", z="+this.z+", width="+this.width+", height="+this.height+", depth="+this.depth+")"};t.prototype.union=function(e,i){if(i===void 0){i=null}var r;var n;var s;if(i==null)i=new t;if(this.x<e.x){r=e.x-this.x+e.width;i.x=this.x;i.width=r<this.width?this.width:r}else{r=this.x-e.x+this.width;i.x=e.x;i.width=r<e.width?e.width:r}if(this.y<e.y){n=e.y-this.y+e.height;i.y=this.y;i.height=n<this.height?this.height:n}else{n=this.y-e.y+this.height;i.y=e.y;i.height=n<e.height?e.height:n}if(this.z<e.z){s=e.z-this.z+e.depth;i.z=this.z;i.depth=s<this.depth?this.depth:s}else{s=this.z-e.z+this.depth;i.z=e.z;i.depth=s<e.depth?e.depth:s}return i};return t}();var P=function(){function t(){}return t}();P.RADIANS_TO_DEGREES=180/Math.PI;P.DEGREES_TO_RADIANS=Math.PI/180;var S=function(){function t(){}return t}();S.AXIS_ANGLE="axisAngle";S.EULER_ANGLES="eulerAngles";S.QUATERNION="quaternion";var E=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i=0}return t.call(this,e||"ArgumentError",i)||this}return i}(i);var M=function(){function t(t){if(t===void 0){t=null}this._position=new A;this._positionDirty=true;if(t!=null){this._rawData=t}else{this._rawData=new Float32Array(16);this.identity()}}t.getAxisRotationMatrix=function(e,i,r,n,s){if(s===void 0){s=null}if(s==null)s=new t;var a=s._rawData;var o=n*P.DEGREES_TO_RADIANS;var h=Math.cos(o);var u=Math.sin(o);var l=1-h;var p,c;a[0]=h+e*e*l;a[5]=h+i*i*l;a[10]=h+r*r*l;p=e*i*l;c=r*u;a[1]=p+c;a[4]=p-c;p=e*r*l;c=i*u;a[8]=p+c;a[2]=p-c;p=i*r*l;c=e*u;a[9]=p-c;a[6]=p+c;a[3]=0;a[7]=0;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;s.invalidatePosition();return s};t.getPointAtMatrix=function(e,i,r,n){if(n===void 0){n=null}var s;var a;var o;if(n==null)n=new t;var h=n._rawData;s=i.clone();s.normalize();a=r.clone();a.normalize();o=a.crossProduct(s);o.normalize();if(o.length<.05){o.x=a.y;o.y=a.x;o.z=0;o.normalize()}a=s.crossProduct(o);h[0]=o.x;h[1]=o.y;h[2]=o.z;h[3]=0;h[4]=a.x;h[5]=a.y;h[6]=a.z;h[7]=0;h[8]=s.x;h[9]=s.y;h[10]=s.z;h[11]=0;h[12]=o.dotProduct(e);h[13]=a.dotProduct(e);h[14]=s.dotProduct(e);h[15]=1;n.invalidatePosition();return n};t.getQuaternionMatrix=function(e,i){if(i===void 0){i=null}if(i==null)i=new t;var r=i._rawData;var n=e.x;var s=e.y;var a=e.z;var o=e.w;var h=n*n;var u=n*s;var l=n*a;var p=n*o;var c=s*s;var _=s*a;var f=s*o;var d=a*a;var g=a*o;r[0]=1-2*(c+d);r[1]=2*(u+g);r[2]=2*(l-f);r[4]=2*(u-g);r[5]=1-2*(h+d);r[6]=2*(_+p);r[8]=2*(l+f);r[9]=2*(_-p);r[10]=1-2*(h+c);r[3]=0;r[7]=0;r[11]=0;r[12]=0;r[13]=0;r[14]=0;r[15]=1;i.invalidatePosition();return i};t.compare=function(t,e){var i=t._rawData;var r=e._rawData;for(var n=0;n<16;++n)if(i[n]!=r[n])return false;return true};Object.defineProperty(t.prototype,"determinant",{get:function(){return(this._rawData[0]*this._rawData[5]-this._rawData[4]*this._rawData[1])*(this._rawData[10]*this._rawData[15]-this._rawData[14]*this._rawData[11])-(this._rawData[0]*this._rawData[9]-this._rawData[8]*this._rawData[1])*(this._rawData[6]*this._rawData[15]-this._rawData[14]*this._rawData[7])+(this._rawData[0]*this._rawData[13]-this._rawData[12]*this._rawData[1])*(this._rawData[6]*this._rawData[11]-this._rawData[10]*this._rawData[7])+(this._rawData[4]*this._rawData[9]-this._rawData[8]*this._rawData[5])*(this._rawData[2]*this._rawData[15]-this._rawData[14]*this._rawData[3])-(this._rawData[4]*this._rawData[13]-this._rawData[12]*this._rawData[5])*(this._rawData[2]*this._rawData[11]-this._rawData[10]*this._rawData[3])+(this._rawData[8]*this._rawData[13]-this._rawData[12]*this._rawData[9])*(this._rawData[2]*this._rawData[7]-this._rawData[6]*this._rawData[3])},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"position",{get:function(){if(this._positionDirty){this._positionDirty=false;this._position.x=this._rawData[12];this._position.y=this._rawData[13];this._position.z=this._rawData[14]}return this._position},enumerable:true,configurable:true});t.prototype.append=function(t){var e=t._rawData;var i=this._rawData[0];var r=this._rawData[1];var n=this._rawData[2];var s=this._rawData[3];var a=this._rawData[4];var o=this._rawData[5];var h=this._rawData[6];var u=this._rawData[7];var l=this._rawData[8];var p=this._rawData[9];var c=this._rawData[10];var _=this._rawData[11];var f=this._rawData[12];var d=this._rawData[13];var g=this._rawData[14];var m=this._rawData[15];var y=e[0];var v=e[1];var x=e[2];var b=e[3];var w=e[4];var D=e[5];var C=e[6];var A=e[7];var T=e[8];var P=e[9];var S=e[10];var E=e[11];var M=e[12];var O=e[13];var I=e[14];var R=e[15];this._rawData[0]=i*y+r*w+n*T+s*M;this._rawData[1]=i*v+r*D+n*P+s*O;this._rawData[2]=i*x+r*C+n*S+s*I;this._rawData[3]=i*b+r*A+n*E+s*R;this._rawData[4]=a*y+o*w+h*T+u*M;this._rawData[5]=a*v+o*D+h*P+u*O;this._rawData[6]=a*x+o*C+h*S+u*I;this._rawData[7]=a*b+o*A+h*E+u*R;this._rawData[8]=l*y+p*w+c*T+_*M;this._rawData[9]=l*v+p*D+c*P+_*O;this._rawData[10]=l*x+p*C+c*S+_*I;this._rawData[11]=l*b+p*A+c*E+_*R;this._rawData[12]=f*y+d*w+g*T+m*M;this._rawData[13]=f*v+d*D+g*P+m*O;this._rawData[14]=f*x+d*C+g*S+m*I;this._rawData[15]=f*b+d*A+g*E+m*R;this._positionDirty=true};t.prototype.appendRotation=function(e,i){this.append(t.getAxisRotationMatrix(i.x,i.y,i.z,e,t._tempMatrix))};t.prototype.appendSkew=function(e,i,r){if(e==0&&i==0&&r==0)return;var n=t._tempMatrix._rawData;n[0]=1;n[1]=0;n[2]=0;n[3]=0;n[4]=e;n[5]=1;n[6]=0;n[7]=0;n[8]=i;n[9]=r;n[10]=1;n[11]=0;n[12]=0;n[13]=0;n[14]=0;n[15]=1;this.append(t._tempMatrix)};t.prototype.appendScale=function(e,i,r){if(e==1&&i==1&&r==1)return;var n=t._tempMatrix._rawData;n[0]=e;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=i;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=r;n[11]=0;n[12]=0;n[13]=0;n[14]=0;n[15]=1;this.append(t._tempMatrix)};t.prototype.appendTranslation=function(t,e,i){this._rawData[12]+=t;this._rawData[13]+=e;this._rawData[14]+=i;this._positionDirty=true};t.prototype.clone=function(){var e=new t;e.copyFrom(this);return e};t.prototype.copyColumnFrom=function(t,e){if(t<0||t>3)throw new E("ArgumentError, Column "+t+" out of bounds [0, ..., 3]");t*=4;this._rawData[t]=e.x;this._rawData[t+1]=e.y;this._rawData[t+2]=e.z;this._rawData[t+3]=e.w;this._positionDirty=true};t.prototype.copyColumnTo=function(t,e,i){if(i===void 0){i=false}if(t<0||t>3)throw new E("ArgumentError, Column "+t+" out of bounds [0, ..., 3]");t*=4;var r=this._rawData;if(i){e.x=-r[t];e.y=-r[t+1];e.z=-r[t+2];e.w=-r[t+3]}else{e.x=r[t];e.y=r[t+1];e.z=r[t+2];e.w=r[t+3]}};t.prototype.copyFrom=function(t,e){if(e===void 0){e=false}var i=t._rawData,r=this._rawData;r[0]=i[0];r[5]=i[5];r[10]=i[10];r[15]=i[15];if(e){r[1]=i[4];r[2]=i[8];r[3]=i[12];r[4]=i[1];r[6]=i[9];r[7]=i[13];r[8]=i[2];r[9]=i[6];r[11]=i[14];r[12]=i[3];r[13]=i[7];r[14]=i[11]}else{r[1]=i[1];r[2]=i[2];r[3]=i[3];r[4]=i[4];r[6]=i[6];r[7]=i[7];r[8]=i[8];r[9]=i[9];r[11]=i[11];r[12]=i[12];r[13]=i[13];r[14]=i[14]}this._positionDirty=true};t.prototype.copyTo=function(t,e){if(e===void 0){e=false}t.copyFrom(this,e)};t.prototype.copyRawDataFrom=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=false}var r=this._rawData;r[0]=t[e+0];r[5]=t[e+5];r[10]=t[e+10];r[15]=t[e+15];if(i){r[e+1]=t[4];r[e+2]=t[8];r[e+3]=t[12];r[e+4]=t[1];r[e+6]=t[9];r[e+7]=t[13];r[e+8]=t[2];r[e+9]=t[6];r[e+11]=t[14];r[e+12]=t[3];r[e+13]=t[7];r[e+14]=t[11]}else{r[1]=t[e+1];r[2]=t[e+2];r[3]=t[e+3];r[4]=t[e+4];r[6]=t[e+6];r[7]=t[e+7];r[8]=t[e+8];r[9]=t[e+9];r[11]=t[e+11];r[12]=t[e+12];r[13]=t[e+13];r[14]=t[e+14]}this._positionDirty=true};t.prototype.copyRawDataTo=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=false}var r=this._rawData;t[e]=r[0];t[e+5]=r[5];t[e+10]=r[10];t[e+15]=r[15];if(i){t[e+1]=r[4];t[e+2]=r[8];t[e+3]=r[12];t[e+4]=r[1];t[e+6]=r[9];t[e+7]=r[13];t[e+8]=r[2];t[e+9]=r[6];t[e+11]=r[14];t[e+12]=r[3];t[e+13]=r[7];t[e+14]=r[11]}else{t[e+1]=r[1];t[e+2]=r[2];t[e+3]=r[3];t[e+4]=r[4];t[e+6]=r[6];t[e+7]=r[7];t[e+8]=r[8];t[e+9]=r[9];t[e+11]=r[11];t[e+12]=r[12];t[e+13]=r[13];t[e+14]=r[14]}};t.prototype.copyRowFrom=function(t,e){if(t<0||t>3)throw new E("ArgumentError, Row "+t+" out of bounds [0, ..., 3]");this._rawData[t]=e.x;this._rawData[t+4]=e.y;this._rawData[t+8]=e.z;this._rawData[t+12]=e.w;this._positionDirty=true};t.prototype.copyRowTo=function(t,e,i){if(i===void 0){i=false}if(t<0||t>3)throw new E("ArgumentError, Row "+t+" out of bounds [0, ..., 3]");var r=this._rawData;if(i){e.x=-r[t];e.y=-r[t+4];e.z=-r[t+8];e.w=-r[t+12]}else{e.x=r[t];e.y=r[t+4];e.z=r[t+8];e.w=r[t+12]}};t.prototype.decompose=function(t){if(t===void 0){t="eulerAngles"}var e;if(this._components==null)this._components=[new A,new A,new A,new A];var i=new A(this._rawData[0],this._rawData[1],this._rawData[2]);var r=new A(this._rawData[4],this._rawData[5],this._rawData[6]);var n=new A(this._rawData[8],this._rawData[9],this._rawData[10]);var s=this._components[3];var a=this._components[2];s.x=i.length;i.scaleBy(1/s.x);a.x=i.dotProduct(r);r=A.combine(r,i,1,-a.x);s.y=r.length;r.scaleBy(1/s.y);a.x/=s.y;a.y=i.dotProduct(n);n=A.combine(n,i,1,-a.y);a.z=r.dotProduct(n);n=A.combine(n,r,1,-a.z);s.z=n.length;n.scaleBy(1/s.z);a.y/=s.z;a.z/=s.z;if(i.dotProduct(r.crossProduct(n))<0){s.z=-s.z;n.x=-n.x;n.y=-n.y;n.z=-n.z}var o=this._components[1];switch(t){case S.AXIS_ANGLE:o.w=Math.acos((i.x+r.y+n.z-1)/2);var h=Math.sqrt((r.z-n.y)*(r.z-n.y)+(n.x-i.z)*(n.x-i.z)+(i.y-r.x)*(i.y-r.x));o.x=(r.z-n.y)/h;o.y=(n.x-i.z)/h;o.z=(i.y-r.x)/h;break;case S.QUATERNION:var u=i.x+r.y+n.z;if(u>0){o.w=Math.sqrt(1+u)/2;o.x=(r.z-n.y)/(4*o.w);o.y=(n.x-i.z)/(4*o.w);o.z=(i.y-r.x)/(4*o.w)}else if(i.x>r.y&&i.x>n.z){o.x=Math.sqrt(1+i.x-r.y-n.z)/2;o.w=(r.z-n.y)/(4*o.x);o.y=(i.y+r.x)/(4*o.x);o.z=(n.x+i.z)/(4*o.x)}else if(r.y>n.z){o.y=Math.sqrt(1+r.y-i.x-n.z)/2;o.x=(i.y+r.x)/(4*o.y);o.w=(n.x-i.z)/(4*o.y);o.z=(r.z+n.y)/(4*o.y)}else{o.z=Math.sqrt(1+n.z-i.x-r.y)/2;o.x=(n.x+i.z)/(4*o.z);o.y=(r.z+n.y)/(4*o.z);o.w=(i.y-r.x)/(4*o.z)}break;case S.EULER_ANGLES:o.y=Math.asin(-i.z);if(i.z!=1&&i.z!=-1){o.x=Math.atan2(r.z,n.z);o.z=Math.atan2(i.y,i.x)}else{o.z=0;o.x=Math.atan2(r.x,r.y)}break}this._components[0].copyFrom(this.position);return this._components};t.prototype.deltaTransformVector=function(t,e){if(e===void 0){e=null}var i=t.x;var r=t.y;var n=t.z;if(!e)e=new A;e.x=i*this._rawData[0]+r*this._rawData[4]+n*this._rawData[8];e.y=i*this._rawData[1]+r*this._rawData[5]+n*this._rawData[9];e.z=i*this._rawData[2]+r*this._rawData[6]+n*this._rawData[10];e.w=i*this._rawData[3]+r*this._rawData[7]+n*this._rawData[11];return e};t.prototype.deltaTransformVectors=function(t,e){var i=this._rawData;var r=i[0];var n=i[1];var s=i[2];var a=i[3];var o=i[4];var h=i[5];var u=i[6];var l=i[7];var p=i[8];var c=i[9];var _=i[10];var f=i[11];var d=0;var g=t.length;for(var m=0;m<g;m+=3){var y=t[m];var v=t[m+1];var x=t[m+2];e[d++]=r*y+o*v+p*x;e[d++]=n*y+h*v+c*x;e[d++]=s*y+u*v+_*x}};t.prototype.identity=function(){this._rawData[0]=1;this._rawData[1]=0;this._rawData[2]=0;this._rawData[3]=0;this._rawData[4]=0;this._rawData[5]=1;this._rawData[6]=0;this._rawData[7]=0;this._rawData[8]=0;this._rawData[9]=0;this._rawData[10]=1;this._rawData[11]=0;this._rawData[12]=0;this._rawData[13]=0;this._rawData[14]=0;this._rawData[15]=1;this._positionDirty=true};t.prototype.invert=function(){var t=this.determinant;var e=Math.abs(t)>1e-11;if(e){t=1/t;var i=this._rawData[0];var r=this._rawData[1];var n=this._rawData[2];var s=this._rawData[3];var a=this._rawData[4];var o=this._rawData[5];var h=this._rawData[6];var u=this._rawData[7];var l=this._rawData[8];var p=this._rawData[9];var c=this._rawData[10];var _=this._rawData[11];var f=this._rawData[12];var d=this._rawData[13];var g=this._rawData[14];var m=this._rawData[15];this._rawData[0]=t*(o*(c*m-g*_)-p*(h*m-g*u)+d*(h*_-c*u));this._rawData[1]=-t*(r*(c*m-g*_)-p*(n*m-g*s)+d*(n*_-c*s));this._rawData[2]=t*(r*(h*m-g*u)-o*(n*m-g*s)+d*(n*u-h*s));this._rawData[3]=-t*(r*(h*_-c*u)-o*(n*_-c*s)+p*(n*u-h*s));this._rawData[4]=-t*(a*(c*m-g*_)-l*(h*m-g*u)+f*(h*_-c*u));this._rawData[5]=t*(i*(c*m-g*_)-l*(n*m-g*s)+f*(n*_-c*s));this._rawData[6]=-t*(i*(h*m-g*u)-a*(n*m-g*s)+f*(n*u-h*s));this._rawData[7]=t*(i*(h*_-c*u)-a*(n*_-c*s)+l*(n*u-h*s));this._rawData[8]=t*(a*(p*m-d*_)-l*(o*m-d*u)+f*(o*_-p*u));this._rawData[9]=-t*(i*(p*m-d*_)-l*(r*m-d*s)+f*(r*_-p*s));this._rawData[10]=t*(i*(o*m-d*u)-a*(r*m-d*s)+f*(r*u-o*s));this._rawData[11]=-t*(i*(o*_-p*u)-a*(r*_-p*s)+l*(r*u-o*s));this._rawData[12]=-t*(a*(p*g-d*c)-l*(o*g-d*h)+f*(o*c-p*h));this._rawData[13]=t*(i*(p*g-d*c)-l*(r*g-d*n)+f*(r*c-p*n));this._rawData[14]=-t*(i*(o*g-d*h)-a*(r*g-d*n)+f*(r*h-o*n));this._rawData[15]=t*(i*(o*c-p*h)-a*(r*c-p*n)+l*(r*h-o*n))}this._positionDirty=true;return e};t.prototype.isIdentity=function(){if(this._rawData[0]==1&&this._rawData[1]==0&&this._rawData[2]==0&&this._rawData[3]==0&&this._rawData[4]==0&&this._rawData[5]==1&&this._rawData[6]==0&&this._rawData[7]==0&&this._rawData[8]==0&&this._rawData[9]==0&&this._rawData[10]==1&&this._rawData[11]==0&&this._rawData[12]==0&&this._rawData[13]==0&&this._rawData[14]==0&&this._rawData[15]==1)return true;return false};t.prototype.prepend=function(t){var e=t._rawData[0];var i=t._rawData[1];var r=t._rawData[2];var n=t._rawData[3];var s=t._rawData[4];var a=t._rawData[5];var o=t._rawData[6];var h=t._rawData[7];var u=t._rawData[8];var l=t._rawData[9];var p=t._rawData[10];var c=t._rawData[11];var _=t._rawData[12];var f=t._rawData[13];var d=t._rawData[14];var g=t._rawData[15];var m=this._rawData[0];var y=this._rawData[1];var v=this._rawData[2];var x=this._rawData[3];var b=this._rawData[4];var w=this._rawData[5];var D=this._rawData[6];var C=this._rawData[7];var A=this._rawData[8];var T=this._rawData[9];var P=this._rawData[10];var S=this._rawData[11];var E=this._rawData[12];var M=this._rawData[13];var O=this._rawData[14];var I=this._rawData[15];this._rawData[0]=e*m+i*b+r*A+n*E;this._rawData[1]=e*y+i*w+r*T+n*M;this._rawData[2]=e*v+i*D+r*P+n*O;this._rawData[3]=e*x+i*C+r*S+n*I;this._rawData[4]=s*m+a*b+o*A+h*E;this._rawData[5]=s*y+a*w+o*T+h*M;this._rawData[6]=s*v+a*D+o*P+h*O;this._rawData[7]=s*x+a*C+o*S+h*I;this._rawData[8]=u*m+l*b+p*A+c*E;this._rawData[9]=u*y+l*w+p*T+c*M;this._rawData[10]=u*v+l*D+p*P+c*O;this._rawData[11]=u*x+l*C+p*S+c*I;this._rawData[12]=_*m+f*b+d*A+g*E;this._rawData[13]=_*y+f*w+d*T+g*M;this._rawData[14]=_*v+f*D+d*P+g*O;this._rawData[15]=_*x+f*C+d*S+g*I;this._positionDirty=true};t.prototype.prependRotation=function(e,i){this.prepend(t.getAxisRotationMatrix(i.x,i.y,i.z,e,t._tempMatrix))};t.prototype.prependScale=function(e,i,r){if(e==1&&i==1&&r==1)return;var n=t._tempMatrix._rawData;n[0]=e;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=i;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=r;n[11]=0;n[12]=0;n[13]=0;n[14]=0;n[15]=1;this.prepend(t._tempMatrix)};t.prototype.prependTranslation=function(e,i,r){var n=t._tempMatrix._rawData;n[0]=1;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=1;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=1;n[11]=0;n[12]=e;n[13]=i;n[14]=r;n[15]=1;this.prepend(t._tempMatrix)};t.prototype.recompose=function(e){var i=e[0]||this.position;this.identity();var r=e[3];if(r&&(r.x!=1||r.y!=1||r.z!=1))this.appendScale(r.x,r.y,r.z);var n=e[2];if(n&&(n.x!=0||n.y!=0||n.z!=0))this.appendSkew(n.x,n.y,n.z);var s;var a;var o=t._tempMatrix._rawData;o[12]=0;o[13]=0;o[14]=0;o[15]=0;var h=e[1];if(h){var u=-h.x;if(u!=0){s=Math.sin(u);a=Math.cos(u);o[0]=1;o[1]=0;o[2]=0;o[3]=0;o[4]=0;o[5]=a;o[6]=-s;o[7]=0;o[8]=0;o[9]=s;o[10]=a;o[11]=0;this.append(t._tempMatrix)}u=-h.y;if(u!=0){s=Math.sin(u);a=Math.cos(u);o[0]=a;o[1]=0;o[2]=s;o[3]=0;o[4]=0;o[5]=1;o[6]=0;o[7]=0;o[8]=-s;o[9]=0;o[10]=a;o[11]=0;this.append(t._tempMatrix)}u=-h.z;if(u!=0){s=Math.sin(u);a=Math.cos(u);o[0]=a;o[1]=-s;o[2]=0;o[3]=0;o[4]=s;o[5]=a;o[6]=0;o[7]=0;o[8]=0;o[9]=0;o[10]=1;o[11]=0;this.append(t._tempMatrix)}}this._rawData[12]=i.x;this._rawData[13]=i.y;this._rawData[14]=i.z;if(e[0])this._positionDirty=true;this._rawData[15]=1;return true};t.prototype.reflect=function(t){var e=t.a,i=t.b,r=t.c,n=t.d;var s=-2*e*i;var a=-2*e*r;var o=-2*i*r;var h=this._rawData;h[0]=1-2*e*e;h[4]=s;h[8]=a;h[12]=-2*e*n;h[1]=s;h[5]=1-2*i*i;h[9]=o;h[13]=-2*i*n;h[2]=a;h[6]=o;h[10]=1-2*r*r;h[14]=-2*r*n;h[3]=0;h[7]=0;h[11]=0;h[15]=1;this._positionDirty=true};t.prototype.transformBox=function(t,e){if(e===void 0){e=null}if(t==null)throw new E("ArgumentError, box cannot be null");var i,r,n;var s,a,o;s=t.width+(i=t.x);a=t.height+(r=t.y);o=t.depth+(n=t.z);if(!e)e=new T;e.width=s*this._rawData[0]+a*this._rawData[4]+o*this._rawData[8]+this._rawData[12]-(e.x=i*this._rawData[0]+r*this._rawData[4]+n*this._rawData[8]+this._rawData[12]);e.height=s*this._rawData[1]+a*this._rawData[5]+o*this._rawData[9]+this._rawData[13]-(e.y=i*this._rawData[1]+r*this._rawData[5]+n*this._rawData[9]+this._rawData[13]);e.depth=s*this._rawData[2]+a*this._rawData[6]+o*this._rawData[10]+this._rawData[14]-(e.z=i*this._rawData[2]+r*this._rawData[6]+n*this._rawData[10]+this._rawData[14]);return e};t.prototype.transformVector=function(t,e){if(e===void 0){e=null}if(t==null)throw new E("ArgumentError, vector cannot be null");var i=t.x;var r=t.y;var n=t.z;var s=t.w;if(!e)e=new A;e.x=i*this._rawData[0]+r*this._rawData[4]+n*this._rawData[8]+s*this._rawData[12];e.y=i*this._rawData[1]+r*this._rawData[5]+n*this._rawData[9]+s*this._rawData[13];e.z=i*this._rawData[2]+r*this._rawData[6]+n*this._rawData[10]+s*this._rawData[14];e.w=i*this._rawData[3]+r*this._rawData[7]+n*this._rawData[11]+s*this._rawData[15];return e};t.prototype.transformVectors=function(t,e){var i=0;var r=0,n=0,s=0;while(i+3<=t.length){r=t[i];n=t[i+1];s=t[i+2];e[i]=r*this._rawData[0]+n*this._rawData[4]+s*this._rawData[8]+this._rawData[12];e[i+1]=r*this._rawData[1]+n*this._rawData[5]+s*this._rawData[9]+this._rawData[13];e[i+2]=r*this._rawData[2]+n*this._rawData[6]+s*this._rawData[10]+this._rawData[14];i+=3}};t.prototype.transpose=function(){var e=t._tempMatrix._rawData;this.copyRawDataTo(e,0,true);this._rawData[1]=e[1];this._rawData[2]=e[2];this._rawData[3]=e[3];this._rawData[4]=e[4];this._rawData[6]=e[6];this._rawData[7]=e[7];this._rawData[8]=e[8];this._rawData[9]=e[9];this._rawData[11]=e[11];this._rawData[12]=e[12];this._rawData[13]=e[13];this._rawData[14]=e[14];this._positionDirty=true};t.prototype.invalidatePosition=function(){this._positionDirty=true};t.prototype.toFixed=function(t){var e=Math.pow(10,t);return"matrix3d("+Math.round(this._rawData[0]*e)/e+","+Math.round(this._rawData[1]*e)/e+","+Math.round(this._rawData[2]*e)/e+","+Math.round(this._rawData[3]*e)/e+","+Math.round(this._rawData[4]*e)/e+","+Math.round(this._rawData[5]*e)/e+","+Math.round(this._rawData[6]*e)/e+","+Math.round(this._rawData[7]*e)/e+","+Math.round(this._rawData[8]*e)/e+","+Math.round(this._rawData[9]*e)/e+","+Math.round(this._rawData[10]*e)/e+","+Math.round(this._rawData[11]*e)/e+","+Math.round(this._rawData[12]*e)/e+","+Math.round(this._rawData[13]*e)/e+","+Math.round(this._rawData[14]*e)/e+","+Math.round(this._rawData[15]*e)/e+")"};t.prototype.toString=function(){return"matrix3d("+Math.round(this._rawData[0]*1e3)/1e3+","+Math.round(this._rawData[1]*1e3)/1e3+","+Math.round(this._rawData[2]*1e3)/1e3+","+Math.round(this._rawData[3]*1e3)/1e3+","+Math.round(this._rawData[4]*1e3)/1e3+","+Math.round(this._rawData[5]*1e3)/1e3+","+Math.round(this._rawData[6]*1e3)/1e3+","+Math.round(this._rawData[7]*1e3)/1e3+","+Math.round(this._rawData[8]*1e3)/1e3+","+Math.round(this._rawData[9]*1e3)/1e3+","+Math.round(this._rawData[10]*1e3)/1e3+","+Math.round(this._rawData[11]*1e3)/1e3+","+Math.round(this._rawData[12]*1e3)/1e3+","+Math.round(this._rawData[13]*1e3)/1e3+","+Math.round(this._rawData[14]*1e3)/1e3+","+Math.round(this._rawData[15]*1e3)/1e3+")"};return t}();M.CALCULATION_MATRIX=new M;M._tempMatrix=new M;var O=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._transform=i;return r}Object.defineProperty(i.prototype,"transform",{get:function(){return this._transform},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._transform)};return i}(n);O.INVALIDATE_MATRIX3D="invalidateMatrix3D";O.INVALIDATE_CONCATENATED_MATRIX3D="invalidateConcatenatedMatrix3D";O.UPDATE_CONCATENATED_MATRIX3D="updateConcatenatedMatrix3D";O.INVALIDATE_COLOR_TRANSFORM="invalidateColorTransform";var I=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i=null}var r=t.call(this)||this;r._inverseConcatenatedMatrix3D=new M;r._rotation=new A;r._skew=new A;r._scale=new A(1,1,1);r._rawData=e||new Float32Array(24);r._matrix3D=new M(new Float32Array(r._rawData.buffer,0,16));r._colorTransform=new C(new Float32Array(r._rawData.buffer,64,8));r._concatenatedMatrix3D=i||r._matrix3D;if(e==null){r._matrix3D.identity();r._colorTransform.clear()}r._components=new Array(4);r._components[1]=r._rotation;r._components[2]=r._skew;r._components[3]=r._scale;r.invalidateComponents();return r}Object.defineProperty(i.prototype,"backVector",{get:function(){if(!this._backVector)this._backVector=new A;this._matrix3D.copyColumnTo(2,this._backVector,true);return this._backVector},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(t){var e=t._rawData,i=this._matrix3D._rawData;i[0]=e[0];i[1]=e[1];i[2]=e[2];i[3]=e[3];i[4]=e[4];i[5]=e[5];i[6]=e[6];i[7]=e[7];this.invalidateColorTransform()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"concatenatedMatrix3D",{get:function(){if(this._concatenatedMatrix3DDirty){this._concatenatedMatrix3DDirty=false;this.dispatchEvent(this._updateConcatenatedMatrix3D||(this._updateConcatenatedMatrix3D=new O(O.UPDATE_CONCATENATED_MATRIX3D,this)))}return this._concatenatedMatrix3D},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"inverseConcatenatedMatrix3D",{get:function(){if(this._inverseConcatenatedMatrix3DDirty){this._inverseConcatenatedMatrix3DDirty=false;this._inverseConcatenatedMatrix3D.copyFrom(this.concatenatedMatrix3D);this._inverseConcatenatedMatrix3D.invert()}return this._inverseConcatenatedMatrix3D},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"downVector",{get:function(){if(!this._downVector)this._downVector=new A;this._matrix3D.copyColumnTo(1,this._downVector,true);return this._downVector},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"forwardVector",{get:function(){if(!this._forwardVector)this._forwardVector=new A;this._matrix3D.copyColumnTo(2,this._forwardVector);return this._forwardVector},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"leftVector",{get:function(){if(!this._leftVector)this._leftVector=new A;this._matrix3D.copyColumnTo(0,this._backVector,true);return this._leftVector},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"matrix3D",{get:function(){if(this._matrix3DDirty)this.updateMatrix3D();return this._matrix3D},set:function(t){var e=t._rawData,i=this._matrix3D._rawData;i[0]=e[0];i[1]=e[1];i[2]=e[2];i[3]=e[3];i[4]=e[4];i[5]=e[5];i[6]=e[6];i[7]=e[7];i[8]=e[8];i[9]=e[9];i[10]=e[10];i[11]=e[11];i[12]=e[12];i[13]=e[13];i[14]=e[14];i[15]=e[15];this.invalidateComponents();this.invalidateConcatenatedMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"pixelBounds",{get:function(){return this._pixelBounds},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"position",{get:function(){return this._matrix3D.position},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"rightVector",{get:function(){if(!this._rightVector)this._rightVector=new A;this._matrix3D.copyColumnTo(0,this._rightVector);return this._rightVector},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"rotation",{get:function(){if(this._componentsDirty)this._updateComponents();return this._rotation},enumerable:true,configurable:true});i.prototype.rotateTo=function(t,e,i){if(this._componentsDirty)this._updateComponents();this._rotation.x=t;this._rotation.y=e;this._rotation.z=i;this.invalidateMatrix3D()};Object.defineProperty(i.prototype,"scale",{get:function(){if(this._componentsDirty)this._updateComponents();return this._scale},enumerable:true,configurable:true});i.prototype.scaleTo=function(t,e,i){if(this._componentsDirty)this._updateComponents();this._scale.x=t;this._scale.y=e;this._scale.z=i;this.invalidateMatrix3D()};Object.defineProperty(i.prototype,"skew",{get:function(){if(this._componentsDirty)this._updateComponents();return this._skew},enumerable:true,configurable:true});i.prototype.skewTo=function(t,e,i){if(this._componentsDirty)this._updateComponents();this._skew.x=t;this._skew.y=e;this._skew.z=i;this.invalidateMatrix3D()};Object.defineProperty(i.prototype,"upVector",{get:function(){if(!this._upVector)this._upVector=new A;this._matrix3D.copyColumnTo(1,this._upVector);return this._upVector},enumerable:true,configurable:true});i.prototype.copyRawDataTo=function(t){if(this._matrix3DDirty)this.updateMatrix3D();var e=t._rawData;var i=this._rawData;e[0]=i[0];e[1]=i[1];e[2]=i[2];e[3]=i[3];e[4]=i[4];e[5]=i[5];e[6]=i[6];e[7]=i[7];e[8]=i[8];e[9]=i[9];e[10]=i[10];e[11]=i[11];e[12]=i[12];e[13]=i[13];e[14]=i[14];e[15]=i[15];e[16]=i[16];e[17]=i[17];e[18]=i[18];e[19]=i[19];e[20]=i[20];e[21]=i[21];e[22]=i[22];e[23]=i[23];this.invalidateComponents();this.invalidateColorTransform()};i.prototype.clone=function(){var t=new i;this.copyRawDataTo(t);return t};i.prototype.dispose=function(){};i.prototype.moveForward=function(t){this.translateLocal(A.Z_AXIS,t)};i.prototype.moveBackward=function(t){this.translateLocal(A.Z_AXIS,-t)};i.prototype.moveLeft=function(t){this.translateLocal(A.X_AXIS,-t)};i.prototype.moveRight=function(t){this.translateLocal(A.X_AXIS,t)};i.prototype.moveUp=function(t){this.translateLocal(A.Y_AXIS,t)};i.prototype.moveDown=function(t){this.translateLocal(A.Y_AXIS,-t)};i.prototype.moveTo=function(t,e,i){this._matrix3D._rawData[12]=t;this._matrix3D._rawData[13]=e;this._matrix3D._rawData[14]=i;this.invalidatePosition()};i.prototype.pitch=function(t){this.rotate(A.X_AXIS,t)};i.prototype.roll=function(t){this.rotate(A.Z_AXIS,t)};i.prototype.yaw=function(t){this.rotate(A.Y_AXIS,t)};i.prototype.rotate=function(t,e){this.matrix3D.prependRotation(e,t);this.invalidateComponents()};i.prototype.translate=function(t,e){var i=t.x,r=t.y,n=t.z;var s=e/Math.sqrt(i*i+r*r+n*n);this.matrix3D.appendTranslation(i*s,r*s,n*s);this.invalidatePosition()};i.prototype.translateLocal=function(t,e){var i=t.x,r=t.y,n=t.z;var s=e/Math.sqrt(i*i+r*r+n*n);this.matrix3D.prependTranslation(i*s,r*s,n*s);this.invalidatePosition()};i.prototype.clearMatrix3D=function(){this._matrix3D.identity();this.invalidateComponents()};i.prototype.clearColorTransform=function(){if(!this._colorTransform)return;this._colorTransform.clear();this.invalidateColorTransform()};i.prototype.invalidateMatrix3D=function(){this._matrix3DDirty=true;this.dispatchEvent(this._invalidateMatrix3D||(this._invalidateMatrix3D=new O(O.INVALIDATE_MATRIX3D,this)))};i.prototype.invalidateComponents=function(){this.invalidatePosition();this._componentsDirty=true};i.prototype.invalidateConcatenatedMatrix3D=function(){this._concatenatedMatrix3DDirty=true;this._inverseConcatenatedMatrix3DDirty=true;this.dispatchEvent(this._invalidateConcatenatedMatrix3D||(this._invalidateConcatenatedMatrix3D=new O(O.INVALIDATE_CONCATENATED_MATRIX3D,this)))};i.prototype.invalidatePosition=function(){this._matrix3D.invalidatePosition();this.dispatchEvent(this._invalidateMatrix3D||(this._invalidateMatrix3D=new O(O.INVALIDATE_MATRIX3D,this)))};i.prototype.invalidateColorTransform=function(){this.dispatchEvent(this._invalidateColorTransform||(this._invalidateColorTransform=new O(O.INVALIDATE_COLOR_TRANSFORM,this)))};i.prototype.updateMatrix3D=function(){this._matrix3D.recompose(this._components);this._matrix3DDirty=false};i.prototype._updateComponents=function(){var t=this._matrix3D.decompose();var e;e=t[1];this._rotation.x=e.x;this._rotation.y=e.y;this._rotation.z=e.z;e=t[2];this._skew.x=e.x;

this._skew.y=e.y;this._skew.z=e.z;e=t[3];this._scale.x=e.x;this._scale.y=e.y;this._scale.z=e.z;this._componentsDirty=false};return i}(a);var R=function(t){e(i,t);function i(e,i){if(e===void 0){e="DocumentError"}if(i===void 0){i=0}return t.call(this,e,i)||this}return i}(i);R.DOCUMENT_DOES_NOT_EXIST="documentDoesNotExist";var L=function(t){e(i,t);function i(e,i){if(e===void 0){e=""}if(i===void 0){i=0}return t.call(this,"PartialImplementationError - this function is in development. Required Dependency: "+e,i)||this}return i}(i);var N=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i=0}return t.call(this,e||"RangeError",i)||this}return i}(i);var F=function(t){e(i,t);function i(e,i,r,n){if(i===void 0){i=null}if(r===void 0){r=null}if(n===void 0){n=null}var s=t.call(this,e)||this;s._url=i;s._content=r;s._assets=n;return s}Object.defineProperty(i.prototype,"content",{get:function(){return this._content},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"url",{get:function(){return this._url},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"assets",{get:function(){return this._assets},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._url,this._content,this._assets)};return i}(n);F.LOAD_COMPLETE="loadComplete";var B=function(t){e(i,t);function i(e,i){if(i===void 0){i=""}var r=t.call(this,e)||this;r._message=i;return r}Object.defineProperty(i.prototype,"message",{get:function(){return this._message},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._message)};return i}(n);B.PARSE_COMPLETE="parseComplete";B.PARSE_ERROR="parseError";B.READY_FOR_DEPENDENCIES="readyForDependencies";var V=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._projection=i;return r}Object.defineProperty(i.prototype,"projection",{get:function(){return this._projection},enumerable:true,configurable:true});return i}(n);V.MATRIX_CHANGED="matrixChanged";var U=function(t){e(i,t);function i(e){return t.call(this,e)||this}return i}(n);U.TIMER="timer";U.TIMER_COMPLETE="timerComplete";var k=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._urlLoader=i;return r}Object.defineProperty(i.prototype,"urlLoader",{get:function(){return this._urlLoader},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._urlLoader)};return i}(n);k.HTTP_STATUS="httpStatus";k.LOAD_ERROR="loadError";k.LOAD_PROGRESS="loadProgress";k.LOAD_START="loadStart";k.LOAD_COMPLETE="loadComplete";var z=function(){function t(t,e){if(t===void 0){t=0}if(e===void 0){e=0}this.x=t;this.y=e}Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:true,configurable:true});t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)};t.prototype.clone=function(){return new t(this.x,this.y)};t.prototype.copyFrom=function(t){};t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y};t.prototype.normalize=function(t){if(t===void 0){t=1}if(this.length!=0){var e=t/this.length;this.x*=e;this.y*=e;return}throw"Cannot divide by zero length."};t.prototype.offset=function(t,e){this.x+=t;this.y+=e};t.prototype.setTo=function(t,e){this.x=t;this.y=e};t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)};t.prototype.toString=function(){return"[Point] (x="+this.x+", y="+this.y+")"};t.distance=function(t,e){var i=e.x-t.x;var r=e.y-t.y;return Math.sqrt(i*i+r*r)};t.interpolate=function(e,i,r){return new t(i.x+(e.x-i.x)*r,i.y+(e.y-i.y)*r)};t.polar=function(e,i){return new t(e*Math.cos(i),e*Math.sin(i))};return t}();var j=function(){function t(t,e,i,r,n,s){if(t===void 0){t=1}if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=1}if(n===void 0){n=0}if(s===void 0){s=0}this.rawData=new Float32Array(6);if(t instanceof Float32Array){this.copyRawDataFrom(t)}else{this.a=Number(t);this.b=e;this.c=i;this.d=r;this.tx=n;this.ty=s}}Object.defineProperty(t.prototype,"a",{get:function(){return this.rawData[0]},set:function(t){this.rawData[0]=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"b",{get:function(){return this.rawData[2]},set:function(t){this.rawData[2]=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"c",{get:function(){return this.rawData[1]},set:function(t){this.rawData[1]=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"d",{get:function(){return this.rawData[3]},set:function(t){this.rawData[3]=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"tx",{get:function(){return this.rawData[4]},set:function(t){this.rawData[4]=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"ty",{get:function(){return this.rawData[5]},set:function(t){this.rawData[5]=t},enumerable:true,configurable:true});t.prototype.copyRawDataFrom=function(t,e){if(e===void 0){e=0}for(var i=0;i<6;i++)this.rawData[i]=t[i+e]};t.prototype.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)};t.prototype.concat=function(t){var e=this.a*t.a+this.b*t.c;this.b=this.a*t.b+this.b*t.d;this.a=e;var i=this.c*t.a+this.d*t.c;this.d=this.c*t.b+this.d*t.d;this.c=i;var r=this.tx*t.a+this.ty*t.c+t.tx;this.ty=this.tx*t.b+this.ty*t.d+t.ty;this.tx=r};t.prototype.copyColumnFrom=function(t,e){if(t>2){throw"Column "+t+" out of bounds (2)"}else if(t==0){this.a=e.x;this.c=e.y}else if(t==1){this.b=e.x;this.d=e.y}else{this.tx=e.x;this.ty=e.y}};t.prototype.copyColumnTo=function(t,e){if(t>2){throw new E("ArgumentError, Column "+t+" out of bounds [0, ..., 2]")}else if(t==0){e.x=this.a;e.y=this.c;e.z=0}else if(t==1){e.x=this.b;e.y=this.d;e.z=0}else{e.x=this.tx;e.y=this.ty;e.z=1}};t.prototype.copyFrom=function(t){this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d;this.tx=t.tx;this.ty=t.ty};t.prototype.copyRowFrom=function(t,e){if(t>2){throw new E("ArgumentError, Row "+t+" out of bounds [0, ..., 2]")}else if(t==0){this.a=e.x;this.c=e.y}else if(t==1){this.b=e.x;this.d=e.y}else{this.tx=e.x;this.ty=e.y}};t.prototype.copyRowTo=function(t,e){if(t>2){throw new E("ArgumentError, Row "+t+" out of bounds [0, ..., 2]")}else if(t==0){e.x=this.a;e.y=this.b;e.z=this.tx}else if(t==1){e.x=this.c;e.y=this.d;e.z=this.ty}else{e.setTo(0,0,1)}};t.prototype.createBox=function(t,e,i,r,n){if(i===void 0){i=0}if(r===void 0){r=0}if(n===void 0){n=0}this.a=t;this.d=e;this.b=i;this.tx=r;this.ty=n};t.prototype.createGradientBox=function(t,e,i,r,n){if(i===void 0){i=0}if(r===void 0){r=0}if(n===void 0){n=0}this.a=t/1638.4;this.d=e/1638.4;if(i!=0){var s=Math.cos(i);var a=Math.sin(i);this.b=a*this.d;this.c=-a*this.a;this.a*=s;this.d*=s}else{this.b=this.c=0}this.tx=r+t/2;this.ty=n+e/2};t.prototype.deltaTransformPoint=function(t){return new z(t.x*this.a+t.y*this.c,t.x*this.b+t.y*this.d)};t.prototype.identity=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0};t.prototype.invert=function(){var t=this.a*this.d-this.b*this.c;if(t==0){this.a=this.b=this.c=this.d=0;this.tx=-this.tx;this.ty=-this.ty}else{t=1/t;var e=this.d*t;this.d=this.a*t;this.a=e;this.b*=-t;this.c*=-t;var i=-this.a*this.tx-this.c*this.ty;this.ty=-this.b*this.tx-this.d*this.ty;this.tx=i}};t.prototype.multiply=function(e){var i=new t;i.a=this.a*e.a+this.b*e.c;i.b=this.a*e.b+this.b*e.d;i.c=this.c*e.a+this.d*e.c;i.d=this.c*e.b+this.d*e.d;i.tx=this.tx*e.a+this.ty*e.c+e.tx;i.ty=this.tx*e.b+this.ty*e.d+e.ty;return i};t.prototype.rotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var r=this.a*e-this.b*i;this.b=this.a*i+this.b*e;this.a=r;var n=this.c*e-this.d*i;this.d=this.c*i+this.d*e;this.c=n;var s=this.tx*e-this.ty*i;this.ty=this.tx*i+this.ty*e;this.tx=s};t.prototype.scale=function(t,e){this.a*=t;this.b*=e;this.c*=t;this.d*=e;this.tx*=t;this.ty*=e};t.prototype.setTo=function(t,e,i,r,n,s){this.a=t;this.b=e;this.c=i;this.d=r;this.tx=n;this.ty=s};t.prototype.toString=function(){return"[Matrix] (a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"};t.prototype.transformPoint=function(t){return new z(t.x*this.a+t.y*this.c+this.tx,t.x*this.b+t.y*this.d+this.ty)};t.prototype.translate=function(t,e){this.tx+=t;this.ty+=e};return t}();var G=function(){function t(){}return t}();G.BACK=0;G.FRONT=1;G.IN=0;G.OUT=1;G.INTERSECT=2;var H=function(){function t(e,i,r,n){if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}if(n===void 0){n=0}this.a=e;this.b=i;this.c=r;this.d=n;if(e==0&&i==0){this._iAlignment=t.ALIGN_XY_AXIS}else if(i==0&&r==0){this._iAlignment=t.ALIGN_YZ_AXIS}else if(e==0&&r==0){this._iAlignment=t.ALIGN_XZ_AXIS}else{this._iAlignment=t.ALIGN_ANY}}t.prototype.fromPoints=function(e,i,r){var n=i.x-e.x;var s=i.y-e.y;var a=i.z-e.z;var o=r.x-e.x;var h=r.y-e.y;var u=r.z-e.z;this.a=s*u-a*h;this.b=a*o-n*u;this.c=n*h-s*o;this.d=this.a*e.x+this.b*e.y+this.c*e.z;if(this.a==0&&this.b==0){this._iAlignment=t.ALIGN_XY_AXIS}else if(this.b==0&&this.c==0){this._iAlignment=t.ALIGN_YZ_AXIS}else if(this.a==0&&this.c==0){this._iAlignment=t.ALIGN_XZ_AXIS}else{this._iAlignment=t.ALIGN_ANY}};t.prototype.fromNormalAndPoint=function(e,i){this.a=e.x;this.b=e.y;this.c=e.z;this.d=this.a*i.x+this.b*i.y+this.c*i.z;if(this.a==0&&this.b==0){this._iAlignment=t.ALIGN_XY_AXIS}else if(this.b==0&&this.c==0){this._iAlignment=t.ALIGN_YZ_AXIS}else if(this.a==0&&this.c==0){this._iAlignment=t.ALIGN_XZ_AXIS}else{this._iAlignment=t.ALIGN_ANY}};t.prototype.normalize=function(){var t=1/Math.sqrt(this.a*this.a+this.b*this.b+this.c*this.c);this.a*=t;this.b*=t;this.c*=t;this.d*=t;return this};t.prototype.distance=function(e){if(this._iAlignment==t.ALIGN_YZ_AXIS){return this.a*e.x-this.d}else if(this._iAlignment==t.ALIGN_XZ_AXIS){return this.b*e.y-this.d}else if(this._iAlignment==t.ALIGN_XY_AXIS){return this.c*e.z-this.d}else{return this.a*e.x+this.b*e.y+this.c*e.z-this.d}};t.prototype.classifyPoint=function(e,i){if(i===void 0){i=.01}if(this.d!=this.d)return G.FRONT;var r;if(this._iAlignment==t.ALIGN_YZ_AXIS)r=this.a*e.x-this.d;else if(this._iAlignment==t.ALIGN_XZ_AXIS)r=this.b*e.y-this.d;else if(this._iAlignment==t.ALIGN_XY_AXIS)r=this.c*e.z-this.d;else r=this.a*e.x+this.b*e.y+this.c*e.z-this.d;if(r<-i)return G.BACK;else if(r>i)return G.FRONT;else return G.INTERSECT};t.prototype.toString=function(){return"Plane3D [a:"+this.a+", b:"+this.b+", c:"+this.c+", d:"+this.d+"]"};return t}();H.ALIGN_ANY=0;H.ALIGN_XY_AXIS=1;H.ALIGN_YZ_AXIS=2;H.ALIGN_XZ_AXIS=3;var X=function(){function t(){}t.initDistributions=function(){this._distributions=new Array;this._distributions[0]=new Array(.3082841,.4320919);this._distributions[1]=new Array(.3082841,.4320919,-.2274942,-.6640266);this._distributions[2]=new Array(.8742689,.0009265686,-.6864116,-.5536607,-.2325206,.7678371);this._distributions[3]=new Array(.3913446,-.7084417,-.7511101,-.5935929,-.2323436,.5320091,.8435315,.5035911);this._distributions[4]=new Array(.2122471,-.5771395,-.8543506,-.1763534,.5189021,.8323698,-.3616908,.5865368,.9523004,-.04948437);this._distributions[5]=new Array(.5791035,.3496495,.2959551,-.6006749,-.2419119,-.06879545,-.7403072,.6110353,-.04555973,.8059174,-.5275017,-.737129);this._distributions[6]=new Array(.06941478,.8519508,-.7441907,.2426432,.6439992,-.2405252,-.1007523,-.2327587,-.6427067,-.7248485,.8050759,.5492936,.3573822,-.8824506);this._distributions[7]=new Array(.8509863,.4452587,-.09507271,.2073005,.1706571,-.6434793,.8029777,-.2718274,-.4401725,.8196304,.2715359,.8598521,-.8121575,-.006447683,-.6486837,-.7237598);this._distributions[8]=new Array(.6951686,-.2680728,-.04933243,.3710589,.6592212,.3661054,-.01579228,-.6909603,-.3275101,-.1756866,.3811549,.9218544,-.216032,.9755028,-.7065172,.3355389,-.6579109,-.6798355);this._distributions[9]=new Array(.6181276,-.09790418,-.2537868,-.5570995,-.1964931,.3459414,.3474613,-.8885581,.5135743,.5753114,-.9549091,.1480672,-.8711916,-.4293123,-.6928071,.6190156,-.13369,.8892705,.0548224,-.1246777);this._distributions[10]=new Array(.4853027,-.5080479,-.1331675,-.506597,.139575,.01316885,.803486,-.07568797,.5240274,.4883182,-.4334005,.1207938,-.7794577,-.3985141,.1576432,-.9861221,-.3712867,.6959021,.1517378,.9847429,-.9762396,.1661073);this._distributions[11]=new Array(-.2790166,-.01252619,.3389016,.3921154,.2408341,-.313211,-.8151779,-.3898362,-.6347761,.3486495,.09471484,-.7722448,-.1385674,.6364574,.2456331,.9295807,-.3864306,-.8247881,.6111673,-.7164014,.8287669,.05466961,.837706,.5415626);this._distributions[12]=new Array(.056417,.3185693,-.8245888,.1882799,.8575996,.1136829,.1070375,.875332,.4076743,-.06000621,-.4311306,.7239349,.2677574,-.538472,-.08486642,-.2083647,-.888989,-.3906443,-.4768958,-.6664082,.09334993,-.9861541,.808736,-.455949,.5889823,.7660807);this._distributions[13]=new Array(-.2681346,-.3955857,-.1315102,-.8852947,-.5143692,.09551838,.4344836,-.546945,-.8620899,-.3813288,.1650431,.02034803,-.1543657,.3842218,-.828457,.5376903,-.6145,-.7818927,-.2639062,.8784655,.1912684,.9720125,.3135219,.5224229,.7850655,.4592297,.7465045,-.1368916);this._distributions[14]=new Array(.4241029,.695281,.150511,-.02304107,-.2482675,.9120338,.8057325,.2622084,-.2445909,.2765962,.8588713,-.1772072,.3117845,-.4385471,-.3923851,-.3298936,-.1751254,-.7405846,.6926506,-.684163,-.9304563,-.3254691,-.8533293,.1523024,.2510415,-.917345,-.6239773,-.7105472,-.6104624,.6041355);this._distributions[15]=new Array(.5844554,.06651045,.1343258,.6756578,.3799674,-.6301104,.5590436,.7940555,.09574714,.02262517,.8697868,.393301,.003945862,-.421735,.9043913,-.2432393,-.4844007,.7190998,-.3201078,.2972371,-.3852352,-.6341155,-.5413069,-.09223081,-.8468984,-.5126905,.004156174,-.8633173,-.9681889,-.03305046,-.846509,.4414353);this._distributions[16]=new Array(.4506488,.657668,.4621297,.07441051,-.2782125,.6201044,.9750003,.09110117,.1019436,.2986514,.03457398,.9631706,.542098,-.5505635,.8675668,.4938077,-.5414361,.2655292,-.7941836,.6003053,-.09847672,-.1001604,-.9316511,-.08572888,.07286467,-.611899,-.5232627,-.4082253,-.5481608,-.827938,-.1551939,-.9621193,.9220031,-.3315949);this._distributions[17]=new Array(.197908,-.4697656,-.4474689,-.3428435,.8529873,-.2228634,.6022478,-.5469642,.2545276,-.931133,-.1507547,-.7855865,-.07606658,.1011628,.3046715,.2785755,.4698432,-.1064076,.6831254,.4152522,.1374381,.8363233,-.2166121,.6682042,.5511393,.7996449,-.4278994,.28836,-.8875198,.2181732,-.8772842,-.2818254,-.7000262,.5762185,-.6062385,-.7439126);this._distributions[18]=new Array(.6645703,-.05678739,.5720971,.4533803,-.07660709,.08802763,.5163431,-.4426552,.1163455,-.3404382,-.4004807,-.5046007,.2932099,-.8201418,-.5322125,.03834766,-.1490209,-.8817304,-.8000439,-.3509448,.5260983,.8421043,.1197811,.6963812,.9498612,.3122156,-.9285746,.02120355,-.6670724,.7217396,.9155889,-.3510147,-.271941,.4727852,.318879,.1634057,-.2686755,.9253026);this._distributions[19]=new Array(.5064292,.422527,.8935515,-.06610427,.1199719,.175568,.403388,-.2003276,.1657927,.8154403,.9301245,.2929218,-.1644068,.6201534,.7113559,-.6589743,-.3364046,-.1799502,.02109996,-.392765,-.382213,.3219992,-.9201946,.1207967,-.726185,.4291916,-.7443482,-.2480059,-.5147594,.7418784,.1935272,-.7406143,-.3643523,-.5559214,-.7147766,-.6326278,-.2524151,-.9096627,.5161405,.7908453);this._distributions[20]=new Array(.7921003,-.3032096,.5992879,-.009052323,.2538549,-.1872749,.7053444,.3677175,.5417761,-.8170255,.9749611,.1210478,.1969143,-.6117041,-.1824499,-.4634196,-.1181338,-.8668742,-.3050112,-.1352596,-.4409327,-.7082354,-.03225285,.1171548,.3113096,.3250439,-.8166144,-.463995,-.01014475,.4715334,-.6868284,.05091889,-.4011163,.2717285,-.06756835,.8307694,-.7938535,.4352129,-.4663842,.7165329,.559729,.8093995);this._distributions[21]=new Array(.07832243,.426151,-.3856795,.5799953,.01970797,.06706189,.4822682,.3014512,-.1532982,.87485,-.4959527,.07888043,.260601,-.2304784,.4996209,.7167382,.585986,-.04265174,-.7679967,.5509416,-.9041753,.1802134,-.8407655,-.4442826,-.2058258,-.2636995,-.4984115,-.5928579,.2926032,-.7886473,-.06933882,-.621177,.578115,-.4813387,.8981777,-.3291056,.1942733,.9255584,.8084362,.5066984,.9920095,.03103104,-.2403206,-.9389018);this._distributions[22]=new Array(-.5691095,.1014316,-.7788262,.384012,-.8253665,-.1645582,-.1830993,.002997211,-.2555013,-.4177977,-.6640869,-.4794711,-.2351242,.5850121,.02436554,.2825883,.006061143,-.8200245,.1618791,-.3063331,-.3765897,-.7249815,.6092919,-.6769328,-.5956934,.6957655,.5383642,.4522677,-.1489165,.9125596,.4167473,.1335986,.1898309,.5874342,.2288171,.9624356,.7540846,-.07672304,.8986252,.2788797,.3555991,-.9262139,.8454325,-.4027667,.4945236,-.2935512);this._distributions[23]=new Array(-.4481403,-.3758374,-.8877251,.08739938,.05015831,-.1339983,-.4070427,-.8534173,.1019274,-.5503222,-.445998,.1997541,-.8686263,-.2788867,-.7695944,-.6033704,-.05515742,-.885711,-.7714347,.5790485,.3466263,-.8799297,.4487582,-.5321087,-.2461368,.6053771,-.05568117,.2457351,-.4668669,.8523816,.8103387,-.4255538,.4054182,-.175663,-.2802011,-.08920153,.2665959,.382935,.555679,.1621837,.105246,.8420411,.6921161,.6902903,.880946,.2483067,.9699264,-.1021767);this._distributions[24]=new Array(-.1703323,-.3119385,.2916039,-.2988263,-.008472982,-.9277695,-.7730271,-.3277904,.3440474,-.6815342,-.2910278,.03461745,-.6764899,-.657078,-.3505501,-.7311988,-.03478927,.3258755,-.6048835,.159423,.2035525,.02212214,.5116573,.2226856,.6664805,-.2500189,.7147882,-.6609634,.03030632,-.5763278,-.2516585,.6116219,-.9434413,-.0116792,.9061816,.2491155,.182867,.6076167,.286593,.9485695,-.5992439,.6970096,-.2082874,.9416641,.9880044,-.1541709,-.9122881,.331555,.7324886,.6725098);this._distributions[25]=new Array(.3869598,-.04974834,.7168844,-.0693711,-.07166742,.1725325,.4599592,.3232779,.5872094,-.4198674,.2442266,-.625667,.1254557,.4500048,-.2290154,-.1803567,.890583,.3373493,.1256081,.7853789,-.2676466,.5305805,-.7063224,.252168,-.3989835,.1189921,.09617215,-.2451447,.6302541,.6085876,.9380925,-.3234899,.5086241,-.8573482,.03576187,-.9876697,-.0876712,-.6365195,-.5276513,.823456,-.6935764,-.2240411,-.5212318,-.5383121,-.2116208,.9639363,-.9840096,.02743555,-.3991577,-.8994547,-.7830126,.614068);this._distributions[26]=new Array(-.8366601,.4464895,-.5917366,-.02073906,-.9845258,.1635625,-.3097973,.4379579,-.5478154,.7173221,-.1685888,.9261969,.01503595,.6046097,.4452421,.5449086,.0315687,.1944619,.3753404,.8688548,.4143643,.1396648,.8711032,.4304703,.7328773,.1461501,.6374492,-.3521495,.145613,-.1341466,.9040975,-.135123,-.7839059,-.5450199,-.516019,-.3320859,-.206158,-.4431106,-.9703014,-.2368356,-.2473119,-.0864351,.2130725,-.4604077,-.003726701,-.7122303,-.4072131,-.6833169,.1632999,-.9776646,.4686888,-.680495,-.2293511,-.9509777);this._distributions[27]=new Array(.107311,-.1311369,-.4194764,-.3148777,.6171439,-.2745973,.2796618,.1937153,-.09106886,.4180236,.6044006,.05577846,.02927299,-.6738263,-.2580845,.1179939,-.09023564,-.3830024,.3570953,-.5000587,.81591,-.5518309,.9300217,-.1257987,.4904627,-.8381903,-.3163182,-.8632009,.1137595,-.9875998,.8390043,.3538185,.2149114,.4993694,.5191584,.3833552,.5002763,.7061465,-.2567276,.9068756,-.5197366,.3467845,.03668867,.9734009,-.5347553,.66747,-.9028882,.1023768,-.8967977,.412834,-.5821944,.0426479,-.8032165,-.2397038,-.5597343,-.6358021);this._distributions[28]=new Array(-.6562496,-.1781036,-.9301494,.1185208,-.3861143,-.4153562,-.1560799,-.1099607,-.5587025,.395218,-.5322112,-.699701,-.5008639,.08726846,-.970524,-.1963461,-.813577,-.5185111,-.1644458,.298,-.3216791,.639982,.3315373,.3339162,.2383235,-.00105722,.1137828,.5450742,-.01899921,.8798413,.2849685,.8255596,.6974412,.2123175,.7588523,.5470437,.5102502,-.1687844,.5853448,.8033476,.2590716,-.5262504,.5607718,-.6342825,.8666443,-.1491841,.8341052,-.4935003,-.1568441,-.6634066,.2512113,-.8769391,-.2559827,-.9572457,-.01928852,-.3966542,-.750667,.6409678);this._distributions[29]=new Array(.3454786,-.04837726,.2649553,.2406852,.5599093,-.3839145,-.1111814,-.05502108,.7586042,-.05818377,.2519488,-.4665135,-.1264972,.2602723,-.08766216,-.3671907,.6428129,.3999204,-.6105871,-.1246869,-.4589451,-.7646643,-.03021116,-.7899352,-.6036922,-.4293956,-.2481938,.6534185,.102798,.6784465,-.6392644,.4821358,-.6789002,.1779133,-.9140783,-.1989647,-.9262617,.3381507,.4794891,-.8093274,.3959447,.668478,.9602883,.2272305,-.123672,.9210883,.2375148,.9523395,-.52898,.7973378,-.382433,.1228794,.695015,.6948439,.7530277,-.6458191,.8777987,-.3272956,.2318525,-.962768);this._distributions[30]=new Array(.4518921,-.1146195,.4720805,-.4238748,.3655423,.1806341,.1589939,-.23568,.7673324,-.5149941,.01163658,.09045836,.7010971,.1245747,.7518286,-.1855433,.4960719,.4601022,.2566979,-.6308268,-.0654714,-.5126389,-.1823319,-.1343282,-.1464312,.4883236,-.3858738,.203523,.1484799,.4432284,-.477109,-.116241,.2719092,.7208626,.9104174,.3578536,-.5956199,.7662588,-.6996251,.3678654,-.2514512,.9251933,.1275825,-.9478135,-.204608,-.8611552,.4264838,-.877443,.9854161,.05521112,.5912951,.7997434,.1140349,.982093,-.9324368,-.2094094,-.42436,-.6441524,-.6722705,-.3554261,-.7844236,.08587621);this._distributions[31]=new Array(-.4206714,-.5613642,-.8733016,-.3373051,-.1046226,-.2902999,-.1318562,-.8434365,.1145093,-.5962623,-.4965627,-.1873259,-.5011808,-.8546229,-.7165636,-.5743566,.1090901,.2017643,.3404809,-.220455,-.1989015,.2372122,-.4538706,.0979171,.4514146,-.572846,.2314168,-.8514503,-.4247236,.5650803,-.943347,.04514639,-.1309718,.5221877,-.7004157,.4561877,.6306441,.04448673,.4301621,.5766876,.1078042,.7245752,.3875354,.2794483,.702876,-.2924213,.7360667,-.6210318,.7486517,.6531103,.4898235,.8591025,.6549174,.3854057,-.2596106,.7916998,.9251194,-.05296265,-.5620695,.820877,-.01228026,.9937211,.9612103,.2628758)};t.getDistribution=function(t){if(!this._distributions)this.initDistributions();if(t<2||t>32)return null;return this._distributions[t-1]};return t}();var W=function(){function t(t,e,i,r){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=1}this.x=0;this.y=0;this.z=0;this.w=1;this.x=t;this.y=e;this.z=i;this.w=r}Object.defineProperty(t.prototype,"magnitude",{get:function(){return Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:true,configurable:true});t.prototype.multiply=function(t,e){var i=t.w,r=t.x,n=t.y,s=t.z;var a=e.w,o=e.x,h=e.y,u=e.z;this.w=i*a-r*o-n*h-s*u;this.x=i*o+r*a+n*u-s*h;this.y=i*h-r*u+n*a+s*o;this.z=i*u+r*h-n*o+s*a};t.prototype.multiplyVector=function(e,i){if(i===void 0){i=null}if(i===null){i=new t}var r=e.x;var n=e.y;var s=e.z;i.w=-this.x*r-this.y*n-this.z*s;i.x=this.w*r+this.y*s-this.z*n;i.y=this.w*n-this.x*s+this.z*r;i.z=this.w*s+this.x*n-this.y*r;return i};t.prototype.fromAxisAngle=function(t,e){var i=Math.sin(e/2);var r=Math.cos(e/2);this.x=t.x*i;this.y=t.y*i;this.z=t.z*i;this.w=r;this.normalize()};t.prototype.slerp=function(t,e,i){var r=t.w,n=t.x,s=t.y,a=t.z;var o=e.w,h=e.x,u=e.y,l=e.z;var p=r*o+n*h+s*u+a*l;if(p<0){p=-p;o=-o;h=-h;u=-u;l=-l}if(p<.95){var c=Math.acos(p);var _=1/Math.sin(c);var f=Math.sin(c*(1-i))*_;var d=Math.sin(c*i)*_;this.w=r*f+o*d;this.x=n*f+h*d;this.y=s*f+u*d;this.z=a*f+l*d}else{this.w=r+i*(o-r);this.x=n+i*(h-n);this.y=s+i*(u-s);this.z=a+i*(l-a);var g=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=g;this.x*=g;this.y*=g;this.z*=g}};t.prototype.lerp=function(t,e,i){var r=t.w,n=t.x,s=t.y,a=t.z;var o=e.w,h=e.x,u=e.y,l=e.z;var p;if(r*o+n*h+s*u+a*l<0){o=-o;h=-h;u=-u;l=-l}this.w=r+i*(o-r);this.x=n+i*(h-n);this.y=s+i*(u-s);this.z=a+i*(l-a);p=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=p;this.x*=p;this.y*=p;this.z*=p};t.prototype.fromEulerAngles=function(t,e,i){var r=t*.5,n=e*.5,s=i*.5;var a=Math.cos(r),o=Math.sin(r);var h=Math.cos(n),u=Math.sin(n);var l=Math.cos(s),p=Math.sin(s);this.w=a*h*l+o*u*p;this.x=o*h*l-a*u*p;this.y=a*u*l+o*h*p;this.z=a*h*p-o*u*l};t.prototype.toEulerAngles=function(t){if(t===void 0){t=null}if(t===null){t=new A}t.x=Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y));t.y=Math.asin(2*(this.w*this.y-this.z*this.x));t.z=Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z));return t};t.prototype.normalize=function(t){if(t===void 0){t=1}var e=t/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);this.x*=e;this.y*=e;this.z*=e;this.w*=e};t.prototype.toString=function(){return"{x:"+this.x+" y:"+this.y+" z:"+this.z+" w:"+this.w+"}"};t.prototype.toMatrix3D=function(t){if(t===void 0){t=null}var e=2*this.x*this.y,i=2*this.x*this.z,r=2*this.x*this.w;var n=2*this.y*this.z,s=2*this.y*this.w,a=2*this.z*this.w;var o=this.x*this.x,h=this.y*this.y,u=this.z*this.z,l=this.w*this.w;if(!t)t=new M;var p=t._rawData;p[0]=o-h-u+l;p[4]=e-a;p[8]=i+s;p[12]=0;p[1]=e+a;p[5]=-o+h-u+l;p[9]=n-r;p[13]=0;p[2]=i-s;p[6]=n+r;p[10]=-o-h+u+l;p[14]=0;p[3]=0;p[7]=0;p[11]=0;p[15]=1;return t};t.prototype.fromMatrix=function(t){var e=t.decompose(S.QUATERNION)[1];this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w};t.prototype.toRawData=function(t,e){if(e===void 0){e=false}var i=2*this.x*this.y,r=2*this.x*this.z,n=2*this.x*this.w;var s=2*this.y*this.z,a=2*this.y*this.w,o=2*this.z*this.w;var h=this.x*this.x,u=this.y*this.y,l=this.z*this.z,p=this.w*this.w;t[0]=h-u-l+p;t[1]=i-o;t[2]=r+a;t[4]=i+o;t[5]=-h+u-l+p;t[6]=s-n;t[8]=r-a;t[9]=s+n;t[10]=-h-u+l+p;t[3]=t[7]=t[11]=0;if(!e){t[12]=t[13]=t[14]=0;t[15]=1}};t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)};t.prototype.rotatePoint=function(t,e){if(e===void 0){e=null}var i,r,n,s;var a=t.x,o=t.y,h=t.z;if(e===null){e=new A}s=-this.x*a-this.y*o-this.z*h;i=this.w*a+this.y*h-this.z*o;r=this.w*o-this.x*h+this.z*a;n=this.w*h+this.x*o-this.y*a;e.x=-s*this.x+i*this.w-r*this.z+n*this.y;e.y=-s*this.y+i*this.z+r*this.w-n*this.x;e.z=-s*this.z-i*this.y+r*this.x+n*this.w;return e};t.prototype.copyFrom=function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w};return t}();var Y=function(){function t(t,e,i,r){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}this.x=t;this.y=e;this.width=i;this.height=r}Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"bottomRight",{get:function(){if(this._bottomRight==null)this._bottomRight=new z;this._bottomRight.x=this.x+this.width;this._bottomRight.y=this.y+this.height;return this._bottomRight},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"size",{get:function(){if(this._size==null)this._size=new z;this._size.x=this.width;this._size.y=this.height;return this._size},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"topLeft",{get:function(){if(this._topLeft==null)this._topLeft=new z;this._topLeft.x=this.x;this._topLeft.y=this.y;return this._topLeft},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)};t.prototype.contains=function(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e};t.prototype.containsPoint=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y};t.prototype.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height};t.prototype.copyFrom=function(t){};t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y&&this.width==t.width&&this.height==t.height};t.prototype.inflate=function(t,e){this.x-=t/2;this.y-=e/2;this.width+=t/2;this.height+=e/2};t.prototype.inflatePoint=function(t){this.x-=t.x/2;this.y-=t.y/2;this.width+=t.x/2;this.height+=t.y/2};t.prototype.intersection=function(e){if(this.intersects(e)){var i=new t;if(this.x>e.x){i.x=this.x;i.width=e.x-this.x+e.width;if(i.width>this.width)i.width=this.width}else{i.x=e.x;i.width=this.x-e.x+this.width;if(i.width>e.width)i.width=e.width}if(this.y>e.y){i.y=this.y;i.height=e.y-this.y+e.height;if(i.height>this.height)i.height=this.height}else{i.y=e.y;i.height=this.y-e.y+this.height;if(i.height>e.height)i.height=e.height}return i}return new t};t.prototype.intersects=function(t){return this.x+this.width>t.x&&this.x<t.x+t.width&&this.y+this.height>t.y&&this.y<t.y+t.height};t.prototype.isEmpty=function(){return this.x==0&&this.y==0&&this.width==0&&this.height==0};t.prototype.offset=function(t,e){this.x+=t;this.y+=e};t.prototype.offsetPoint=function(t){this.x+=t.x;this.y+=t.y};t.prototype.setEmpty=function(){this.x=0;this.y=0;this.width=0;this.height=0};t.prototype.setTo=function(t,e,i,r){this.x=t;this.y=e;this.width=i;this.height=r};t.prototype.toString=function(){return"[Rectangle] (x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"};t.prototype.union=function(e){var i=new t;if(this.x<e.x){i.x=this.x;i.width=e.x-this.x+e.width;if(i.width<this.width)i.width=this.width}else{i.x=e.x;i.width=this.x-e.x+this.width;if(i.width<e.width)i.width=e.width}if(this.y<e.y){i.y=this.y;i.height=e.y-this.y+e.height;if(i.height<this.height)i.height=this.height}else{i.y=e.y;i.height=this.y-e.y+this.height;if(i.height<e.height)i.height=e.height}return i};return t}();var q=function(){function t(t,e,i,r){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}this.x=t;this.y=e;this.z=i;this.radius=r}t.prototype.rayIntersection=function(t,e,i){if(this.containsPoint(t))return 0;var r=t.x-this.x,n=t.y-this.y,s=t.z-this.z;var a=e.x,o=e.y,h=e.z;var u;var l=a*a+o*o+h*h;var p=2*(r*a+n*o+s*h);var c=r*r+n*n+s*s-this.radius*this.radius;var _=p*p-4*l*c;if(_>=0){var f=Math.sqrt(_);u=(-p-f)/(2*l);if(u>=0){i.x=r+u*a;i.y=n+u*o;i.z=s+u*h;i.normalize();return u}}return-1};t.prototype.containsPoint=function(t){var e=t.x-this.x;var i=t.y-this.y;var r=t.z-this.z;var n=Math.sqrt(e*e+i*i+r*r);return n<=this.radius};t.prototype.toString=function(){return"Sphere [x:"+this.x+", y:"+this.y+", z:"+this.z+", radius:"+this.radius+"]"};return t}();var K=function(t){e(i,t);function i(e,i){var r=t.call(this)||this;r._invalid=true;r._asset=e;r._pool=i;r._onClearDelegate=function(t){return r.onClear(t)};r._onInvalidateDelegate=function(t){return r.onInvalidate(t)};r._asset.addEventListener(s.CLEAR,r._onClearDelegate);r._asset.addEventListener(s.INVALIDATE,r._onInvalidateDelegate);return r}i.prototype.onClear=function(t){this._asset.removeEventListener(s.CLEAR,this._onClearDelegate);this._asset.removeEventListener(s.INVALIDATE,this._onInvalidateDelegate);this._pool.clearAbstraction(this._asset);this._pool=null;this._asset=null};i.prototype.onInvalidate=function(t){this._invalid=true};return i}(a);var Z=function(){function t(t,e,i,r){this._assets=t;this.filter(e,i,r)}Object.defineProperty(t.prototype,"currentAsset",{get:function(){return this._idx<this._filtered.length?this._filtered[this._idx]:null},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numAssets",{get:function(){return this._filtered.length},enumerable:true,configurable:true});t.prototype.next=function(){var t=null;if(this._idx<this._filtered.length)t=this._filtered[this._idx];this._idx++;return t};t.prototype.reset=function(){this._idx=0};t.prototype.setIndex=function(t){this._idx=t};t.prototype.filter=function(t,e,i){if(t||e){var r;var n;r=0;this._filtered=new Array;var s=this._assets.length;for(var a=0;a<s;a++){n=this._assets[a];if(t&&n.assetType!=t)continue;if(e&&n.assetNamespace!=e)continue;if(i!=null&&!i(n))continue;this._filtered[r++]=n}}else{this._filtered=this._assets}};return t}();var Q=function(){function t(e,i){if(e===void 0){e=true}if(i===void 0){i=null}this._includeDependencies=e;this._dependencyBaseUrl=i||"";this._embeddedDataByUrl={};this._remappedUrls={};this._materialMode=t.UNDEFINED;this._externalAssetMode=t.PRELOADED}Object.defineProperty(t.prototype,"includeDependencies",{
get:function(){return this._includeDependencies},set:function(t){this._includeDependencies=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"materialMode",{get:function(){return this._materialMode},set:function(t){this._materialMode=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"externalAssetMode",{get:function(){return this._externalAssetMode},set:function(t){this._externalAssetMode=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dependencyBaseUrl",{get:function(){return this._dependencyBaseUrl},set:function(t){this._dependencyBaseUrl=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"overrideAbsolutePaths",{get:function(){return this._overrideAbsPath},set:function(t){this._overrideAbsPath=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"overrideFullURLs",{get:function(){return this._overrideFullUrls},set:function(t){this._overrideFullUrls=t},enumerable:true,configurable:true});t.prototype.mapUrl=function(t,e){this._remappedUrls[t]=e};t.prototype.mapUrlToData=function(t,e){this._embeddedDataByUrl[t]=e};t.prototype._iHasDataForUrl=function(t){return this._embeddedDataByUrl.hasOwnProperty(t)};t.prototype._iGetDataForUrl=function(t){return this._embeddedDataByUrl[t]};t.prototype._iHasMappingForUrl=function(t){return this._remappedUrls.hasOwnProperty(t)};t.prototype._iGetRemappedUrl=function(t){return this._remappedUrls[t]};return t}();Q.UNDEFINED=0;Q.SINGLEPASS_MATERIALS=1;Q.MULTIPASS_MATERIALS=2;Q.ON_DEMAND="onDemand";Q.PRELOADED="preloaded";var J=function(){function t(){}return t}();J.TEXT="text";J.VARIABLES="variables";J.BLOB="blob";J.ARRAY_BUFFER="arraybuffer";J.BINARY="binary";var $=function(){function t(){}return t}();$.POST="POST";$.GET="GET";var tt=function(){function t(t){if(t===void 0){t=null}this._variables=new Object;if(t!==null)this.decode(t)}t.prototype.decode=function(t){t=t.split("+").join(" ");var e,i=/[?&]?([^=]+)=([^&]*)/g;while(e=i.exec(t))this._variables[decodeURIComponent(e[1])]=decodeURIComponent(e[2])};t.prototype.toString=function(){return""};Object.defineProperty(t.prototype,"variables",{get:function(){return this._variables},set:function(t){this._variables=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"formData",{get:function(){var t=new FormData;for(var e in this._variables)t.append(e,this._variables[e]);return t},enumerable:true,configurable:true});return t}();var et=function(t){e(i,t);function i(){var e=t.call(this)||this;e._bytesLoaded=0;e._bytesTotal=0;e._dataFormat=J.TEXT;e._loadError=false;return e}Object.defineProperty(i.prototype,"url",{get:function(){return this._request?this._request.url:""},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"data",{get:function(){return this._data},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"dataFormat",{get:function(){return this._dataFormat},set:function(t){this._dataFormat=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"bytesLoaded",{get:function(){return this._bytesLoaded},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"bytesTotal",{get:function(){return this._bytesTotal},enumerable:true,configurable:true});i.prototype.load=function(t){this._request=t;this.initXHR();if(t.method===$.POST)this.postRequest(t);else this.getRequest(t)};i.prototype.isSupported=function(){return window!=null};i.prototype.close=function(){this._XHR.abort();this.disposeXHR()};i.prototype.dispose=function(){if(this._XHR)this._XHR.abort();this.disposeXHR()};i.prototype.setResponseType=function(t,e){switch(e){case J.ARRAY_BUFFER:case J.BLOB:case J.TEXT:t.responseType=e;break;case J.VARIABLES:t.responseType=J.TEXT;break;case J.BINARY:t.responseType="";break;default:}};i.prototype.getRequest=function(t){try{this._XHR.open(t.method,t.url,t.async);this.setResponseType(this._XHR,this._dataFormat);this._XHR.send()}catch(e){this.handleXmlHttpRequestException(e)}};i.prototype.postRequest=function(t){this._loadError=false;this._XHR.open(t.method,t.url,t.async);if(t.data!=null){if(t.data instanceof tt){var e=t.data;try{this._XHR.responseType="text";this._XHR.send(e.formData)}catch(i){this.handleXmlHttpRequestException(i)}}else{this.setResponseType(this._XHR,this._dataFormat);if(t.data)this._XHR.send(t.data);else this._XHR.send()}}else{this._XHR.send()}};i.prototype.handleXmlHttpRequestException=function(t){switch(t.code){case 101:break}};i.prototype.initXHR=function(){var t=this;if(!this._XHR){this._XHR=new XMLHttpRequest;this._XHR.onloadstart=function(e){return t.onLoadStart(e)};this._XHR.onprogress=function(e){return t.onProgress(e)};this._XHR.onabort=function(e){return t.onAbort(e)};this._XHR.onerror=function(e){return t.onLoadError(e)};this._XHR.onload=function(e){return t.onLoadComplete(e)};this._XHR.ontimeout=function(e){return t.onTimeOut(e)};this._XHR.onloadend=function(e){return t.onLoadEnd(e)};this._XHR.onreadystatechange=function(e){return t.onReadyStateChange(e)}}};i.prototype.disposeXHR=function(){if(this._XHR!==null){this._XHR.onloadstart=null;this._XHR.onprogress=null;this._XHR.onabort=null;this._XHR.onerror=null;this._XHR.onload=null;this._XHR.ontimeout=null;this._XHR.onloadend=null;this._XHR=null}};i.prototype.decodeURLVariables=function(t){var e=new Object;t=t.split("+").join(" ");var i,r=/[?&]?([^=]+)=([^&]*)/g;while(i=r.exec(t))e[decodeURIComponent(i[1])]=decodeURIComponent(i[2]);return e};i.prototype.onReadyStateChange=function(t){if(this._XHR.readyState==4){this._status=this._XHR.status;if(this._status==404){this._loadError=true;this.dispatchEvent(this._loadErrorEvent||(this._loadErrorEvent=new k(k.LOAD_ERROR,this)))}this.dispatchEvent(this._statusEvent||(this._statusEvent=new k(k.HTTP_STATUS,this)))}};i.prototype.onLoadEnd=function(t){if(this._loadError===true)return};i.prototype.onTimeOut=function(t){};i.prototype.onAbort=function(t){};i.prototype.onProgress=function(t){this._bytesTotal=t.total;this._bytesLoaded=t.loaded;this.dispatchEvent(this._progressEvent||(this._progressEvent=new k(k.LOAD_PROGRESS,this)))};i.prototype.onLoadStart=function(t){this.dispatchEvent(this._loadStartEvent||(this._loadStartEvent=new k(k.LOAD_START,this)))};i.prototype.onLoadComplete=function(t){if(this._loadError===true)return;switch(this._dataFormat){case J.TEXT:this._data=this._XHR.responseText;break;case J.VARIABLES:this._data=this.decodeURLVariables(this._XHR.responseText);break;case J.BLOB:case J.ARRAY_BUFFER:case J.BINARY:this._data=this._XHR.response;break;default:this._data=this._XHR.responseText;break}this.dispatchEvent(this._loadCompleteEvent||(this._loadCompleteEvent=new k(k.LOAD_COMPLETE,this)))};i.prototype.onLoadError=function(t){this._loadError=true;this.dispatchEvent(this._loadErrorEvent||(this._loadErrorEvent=new k(k.LOAD_ERROR,this)))};return i}(a);var it=function(){function t(t,e,i,r,n,s,a,o){if(s===void 0){s=false}if(a===void 0){a=false}if(o===void 0){o=0}this._id=t;this._sub_id=o;this._request=e;this._data=i;this._parser=r;this._parentParser=n;this._retrieveAsRawData=s;this._suppressAssetEvents=a;this._assets=new Array;this._dependencies=new Array}Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"sub_id",{get:function(){return this._sub_id},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"request",{get:function(){return this._request},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"parser",{get:function(){return this._parser},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"parentParser",{get:function(){return this._parentParser},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"retrieveAsRawData",{get:function(){return this._retrieveAsRawData},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"suppresAssetEvents",{get:function(){return this._suppressAssetEvents},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"assets",{get:function(){return this._assets},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dependencies",{get:function(){return this._dependencies},enumerable:true,configurable:true});t.prototype._iSetData=function(t){this._data=t};t.prototype._iSetParser=function(t){this._parser=t};t.prototype.resolve=function(){if(this._parentParser)this._parentParser._iResolveDependency(this)};t.prototype.resolveFailure=function(){if(this._parentParser)this._parentParser._iResolveDependencyFailure(this)};t.prototype.resolveName=function(t){if(this._parentParser)return this._parentParser._iResolveDependencyName(this,t);return t.name};return t}();var rt=function(t){e(i,t);function i(e){if(e===void 0){e=0}var i=t.call(this)||this;i._materialMode=e;i._stack=new Array;i._errorHandlers=new Array;i._parseErrorHandlers=new Array;i._onReadyForDependenciesDelegate=function(t){return i.onReadyForDependencies(t)};i._onParseCompleteDelegate=function(t){return i.onParseComplete(t)};i._onParseErrorDelegate=function(t){return i.onParseError(t)};i._onLoadCompleteDelegate=function(t){return i.onLoadComplete(t)};i._onLoadErrorDelegate=function(t){return i.onLoadError(t)};i._onTextureSizeErrorDelegate=function(t){return i.onTextureSizeError(t)};i._onAssetCompleteDelegate=function(t){return i.onAssetComplete(t)};return i}i.enableParser=function(t){if(i._parsers.indexOf(t)<0)i._parsers.push(t)};i.enableParsers=function(t){for(var e=0;e<t.length;e++)i.enableParser(t[e])};Object.defineProperty(i.prototype,"baseDependency",{get:function(){return this._baseDependency},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"loaderInfo",{get:function(){return this._loaderInfo},enumerable:true,configurable:true});i.prototype.load=function(t,e,i,r){if(e===void 0){e=null}if(i===void 0){i=null}if(r===void 0){r=null}this._uri=t.url=t.url.replace(/\\/g,"/");this._context=e;this._namespace=i;this._baseDependency=new it("",t,null,r,null);this.retrieveDependency(this._baseDependency)};i.prototype.loadData=function(t,e,i,r,n){if(i===void 0){i=null}if(r===void 0){r=null}if(n===void 0){n=null}this._uri=e;this._context=i;this._namespace=r;this._baseDependency=new it(e,null,t,n,null);this.retrieveDependency(this._baseDependency)};i.prototype.retrieveNext=function(t){if(t===void 0){t=null}if(this._currentDependency.dependencies.length){var e=this._currentDependency.dependencies.pop();this._stack.push(this._currentDependency);this.retrieveDependency(e)}else if(this._currentDependency.parser&&this._currentDependency.parser.parsingPaused){this._currentDependency.parser._iResumeParsing();this._stack.pop()}else if(this._stack.length){var i=this._currentDependency;this._currentDependency=this._stack.pop();if(i._iSuccess)i.resolve();this.retrieveNext(t)}else{this.dispatchEvent(new F(F.LOAD_COMPLETE,this._uri,this._baseDependency.parser.content,this._baseDependency.assets))}};i.prototype.retrieveDependency=function(t){var e;if(this._context&&this._context.materialMode!=0)this._materialMode=this._context.materialMode;this._currentDependency=t;t._iLoader=new et;this.addEventListeners(t._iLoader);e=t.data;if(this._context&&t.request){if(this._context._iHasDataForUrl(t.request.url)){e=this._context._iGetDataForUrl(t.request.url)}else if(this._context.externalAssetMode==Q.ON_DEMAND&&(this.getSuffix(t.request.url)=="jpg"||this.getSuffix(t.request.url)=="png")){e=t.request;if(!t.parser)t._iSetParser(this.getParserFromSuffix(t.request.url))}}if(e){if(e.constructor===Function)e=new e;t._iSetData(e);if(t.retrieveAsRawData){t.resolve();this.retrieveNext()}else{this.parseDependency(t)}}else{t.request.url=this.resolveDependencyUrl(t);if(t.retrieveAsRawData){t._iLoader.dataFormat=J.BINARY}else{if(!t.parser)t._iSetParser(this.getParserFromSuffix(t.request.url));if(t.parser){t._iLoader.dataFormat=t.parser.dataFormat}else{t._iLoader.dataFormat=J.BINARY}}t._iLoader.load(t.request)}};i.prototype.joinUrl=function(t,e){if(e.charAt(0)=="/"||e.charAt(0)=="\\")e=e.substr(1);if(e.charAt(0)==".")e=e.substr(2);if(t.length==0)return e;if(t.charAt(t.length-1)=="/"||t.charAt(t.length-1)=="\\")t=t.substr(0,t.length-1);return t.concat("/",e)};i.prototype.resolveDependencyUrl=function(t){var e;var i;var r=t.request.url;if(this._context&&this._context._iHasMappingForUrl(r))return this._context._iGetRemappedUrl(r);if(r==this._uri)return r;e=new RegExp("/^[a-zA-Z]{3,4}:///");if(r.charAt(0)=="/"){if(this._context&&this._context.overrideAbsolutePaths)return this.joinUrl(this._context.dependencyBaseUrl,r);else return r}else if(e.test(r)){if(this._context&&this._context.overrideFullURLs){var n=r.replace(e,"");return this.joinUrl(this._context.dependencyBaseUrl,n)}}if(this._context&&this._context.dependencyBaseUrl){i=this._context.dependencyBaseUrl;return this.joinUrl(i,r)}else{i=this._uri.substring(0,this._uri.lastIndexOf("/")+1);return this.joinUrl(i,r)}};i.prototype.retrieveParserDependencies=function(){if(!this._currentDependency)return;var t=this._currentDependency.parser.dependencies;var e,i=t.length;for(e=0;e<i;e++)this._currentDependency.dependencies[e]=t[e];t.length=0;this._stack.push(this._currentDependency);this.retrieveNext()};i.prototype.resolveParserDependencies=function(){this._currentDependency._iSuccess=true;if(this._currentDependency.parser&&this._currentDependency.parser.dependencies.length&&(!this._context||this._context.includeDependencies))this.retrieveParserDependencies();else this.retrieveNext()};i.prototype.onLoadError=function(t){var e;var i=this._currentDependency!=this._baseDependency;var r=t.urlLoader;this.removeEventListeners(r);if(this.hasEventListener(k.LOAD_ERROR)){this.dispatchEvent(t);e=true}else{var n,s=this._errorHandlers.length;for(n=0;n<s;n++)if(!e)e=this._errorHandlers[n](t)}if(e){if(i){this._currentDependency.resolveFailure();this.retrieveNext()}else{this.dispose();return}}else{throw new Error}};i.prototype.onParseError=function(t){var e;var i=this._currentDependency!=this._baseDependency;var r=t.target;this.removeEventListeners(r);if(this.hasEventListener(B.PARSE_ERROR)){this.dispatchEvent(t);e=true}else{var n,s=this._parseErrorHandlers.length;for(n=0;n<s;n++)if(!e)e=this._parseErrorHandlers[n](t)}if(e){this.retrieveNext()}else{throw new Error(t.message)}};i.prototype.onAssetComplete=function(t){if(this._currentDependency)this._currentDependency.assets.push(t.asset);t.asset.resetAssetPath(t.asset.name,this._namespace);if(!this._currentDependency.suppresAssetEvents)this.dispatchEvent(t)};i.prototype.onReadyForDependencies=function(t){var e=t.target;if(this._context&&!this._context.includeDependencies)e._iResumeParsing();else this.retrieveParserDependencies()};i.prototype.onLoadComplete=function(t){var e=t.urlLoader;this.removeEventListeners(e);this._currentDependency._iSetData(e.data);if(this._currentDependency.retrieveAsRawData){this.resolveParserDependencies()}else{this.parseDependency(this._currentDependency)}};i.prototype.onParseComplete=function(t){var e=t.target;this.resolveParserDependencies();e.removeEventListener(B.READY_FOR_DEPENDENCIES,this._onReadyForDependenciesDelegate);e.removeEventListener(B.PARSE_COMPLETE,this._onParseCompleteDelegate);e.removeEventListener(B.PARSE_ERROR,this._onParseErrorDelegate);e.removeEventListener(s.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate);e.removeEventListener(s.ASSET_COMPLETE,this._onAssetCompleteDelegate)};i.prototype.onTextureSizeError=function(t){t.asset.name=this._currentDependency.resolveName(t.asset);this.dispatchEvent(t)};i.prototype.addEventListeners=function(t){t.addEventListener(k.LOAD_COMPLETE,this._onLoadCompleteDelegate);t.addEventListener(k.LOAD_ERROR,this._onLoadErrorDelegate)};i.prototype.removeEventListeners=function(t){t.removeEventListener(k.LOAD_COMPLETE,this._onLoadCompleteDelegate);t.removeEventListener(k.LOAD_ERROR,this._onLoadErrorDelegate)};i.prototype.stop=function(){this.dispose()};i.prototype.dispose=function(){this._errorHandlers=null;this._parseErrorHandlers=null;this._context=null;this._stack=null;if(this._currentDependency&&this._currentDependency._iLoader)this.removeEventListeners(this._currentDependency._iLoader);this._currentDependency=null};i.prototype._iAddParseErrorHandler=function(t){if(this._parseErrorHandlers.indexOf(t)<0)this._parseErrorHandlers.push(t)};i.prototype._iAddErrorHandler=function(t){if(this._errorHandlers.indexOf(t)<0)this._errorHandlers.push(t)};i.prototype.getParserFromData=function(t){var e=i._parsers.length;for(var r=e-1;r>=0;r--)if(i._parsers[r].supportsData(t))return new i._parsers[r];return null};i.prototype.parseDependency=function(t){var e=t.parser;if(!e)t._iSetParser(e=this.getParserFromData(t.data));if(e){e.addEventListener(B.READY_FOR_DEPENDENCIES,this._onReadyForDependenciesDelegate);e.addEventListener(B.PARSE_COMPLETE,this._onParseCompleteDelegate);e.addEventListener(B.PARSE_ERROR,this._onParseErrorDelegate);e.addEventListener(s.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate);e.addEventListener(s.ASSET_COMPLETE,this._onAssetCompleteDelegate);if(t.request&&t.request.url)e._iFileName=t.request.url;e.materialMode=this._materialMode;e.parseAsync(t.data)}else{var i;var r="No parser defined. To enable all parsers for auto-detection, use Parsers.enableAllBundled()";var n=new B(B.PARSE_ERROR,r);if(this.hasEventListener(B.PARSE_ERROR)){this.dispatchEvent(n);i=true}else{var a,o=this._parseErrorHandlers.length;for(a=0;a<o;a++)if(!i)i=this._parseErrorHandlers[a](n)}if(i){this.retrieveNext()}else{throw new Error(r)}}};i.prototype.getParserFromSuffix=function(t){var e=this.getSuffix(t);var r=i._parsers.length;for(var n=r-1;n>=0;n--){var s=i._parsers[n];if(s.supportsType(e))return new s}return null};i.prototype.getSuffix=function(t){var e=t.indexOf("?")>0?t.split("?")[0]:t;return e.substr(e.lastIndexOf(".")+1).toLowerCase()};return i}(a);rt._parsers=new Array;var nt=function(){function t(){}return t}();nt.FAVOR_OLD="favorOld";nt.FAVOR_NEW="favorNew";var st=function(){function t(){}t.prototype.resolveConflict=function(t,e,i,n){throw new r};t.prototype.create=function(){throw new r};t.prototype._pUpdateNames=function(t,e,i,r,n,a){var o;var h;var u;h=a===nt.FAVOR_NEW?r:i;u=a===nt.FAVOR_NEW?i:r;o=u.name;n[h.name]=h;n[e]=u;u.resetAssetPath(e,t,false);u.dispatchEvent(new s(s.ASSET_CONFLICT_RESOLVED,u,o))};return t}();var at=function(t){e(r,t);function r(){return t.call(this)||this}r.prototype.resolveConflict=function(t,e,r,n){throw new i("Asset name collision while AssetLibrary.namingStrategy set to AssetLibrary.THROW_ERROR. Asset path: "+t.assetFullPath)};r.prototype.create=function(){return new r};return r}(st);var ot=function(t){e(i,t);function i(){return t.call(this)||this}i.prototype.resolveConflict=function(t,e,i,r){return};i.prototype.create=function(){return new i};return i}(st);var ht=function(t){e(i,t);function i(e){if(e===void 0){e="."}var i=t.call(this)||this;i._separator=e;i._next_suffix={};return i}i.prototype.resolveConflict=function(t,e,i,r){var n;var s;var a;var o;n=t.name;if(n.indexOf(this._separator)>=0){a=n.substring(0,n.lastIndexOf(this._separator));o=parseInt(n.substring(a.length-1));if(isNaN(o)){a=n;o=0}}else{a=n;o=0}if(o==0&&this._next_suffix.hasOwnProperty(a)){o=this._next_suffix[a]}do{o++;s=a.concat(this._separator,o.toString())}while(i.hasOwnProperty(s));this._next_suffix[a]=o;this._pUpdateNames(e.assetNamespace,s,e,t,i,r)};i.prototype.create=function(){return new i(this._separator)};return i}(st);var ut=function(){function t(t){}return t}();ut.APPEND_NUM_SUFFIX=new ht;ut.IGNORE=new ot;ut.THROW_ERROR=new at;var lt=function(t){e(r,t);function r(){var e=t.call(this)||this;e._loaderSessionsGarbage=new Array;e._assets=new Array;e._assetDictionary=new Object;e._loaderSessions=new Array;e.conflictStrategy=ut.IGNORE.create();e.conflictPrecedence=nt.FAVOR_NEW;e._onAssetRenameDelegate=function(t){return e.onAssetRename(t)};e._onAssetConflictResolvedDelegate=function(t){return e.onAssetConflictResolved(t)};e._onResourceCompleteDelegate=function(t){return e.onResourceComplete(t)};e._onTextureSizeErrorDelegate=function(t){return e.onTextureSizeError(t)};e._onAssetCompleteDelegate=function(t){return e.onAssetComplete(t)};e._onLoadErrorDelegate=function(t){return e.onLoadError(t)};e._onParseErrorDelegate=function(t){return e.onParseError(t)};return e}r.getInstance=function(t){if(t===void 0){t="default"}if(!t)t="default";if(!r._iInstances.hasOwnProperty(t))r._iInstances[t]=new r;return r._iInstances[t]};r.prototype.enableParser=function(t){rt.enableParser(t)};r.prototype.enableParsers=function(t){rt.enableParsers(t)};Object.defineProperty(r.prototype,"conflictStrategy",{get:function(){return this._strategy},set:function(t){if(!t)throw new i("namingStrategy must not be null. To ignore naming, use AssetLibrary.IGNORE");this._strategy=t.create()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"conflictPrecedence",{get:function(){return this._strategyPreference},set:function(t){this._strategyPreference=t},enumerable:true,configurable:true});r.prototype.createIterator=function(t,e,i){if(t===void 0){t=null}if(e===void 0){e=null}if(i===void 0){i=null}return new Z(this._assets,t,e,i)};r.prototype.load=function(t,e,i,r){if(e===void 0){e=null}if(i===void 0){i=null}if(r===void 0){r=null}this.getLoader().load(t,e,i,r)};r.prototype.loadData=function(t,e,i,r){if(e===void 0){e=null}if(i===void 0){i=null}if(r===void 0){r=null}this.getLoader().loadData(t,"",e,i,r)};r.prototype.getLoader=function(){var t=new rt;this._loaderSessions.push(t);t.addEventListener(F.LOAD_COMPLETE,this._onResourceCompleteDelegate);t.addEventListener(s.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate);t.addEventListener(s.ASSET_COMPLETE,this._onAssetCompleteDelegate);t._iAddErrorHandler(this._onLoadErrorDelegate);t._iAddParseErrorHandler(this._onParseErrorDelegate);return t};r.prototype.disposeLoader=function(t){var e=this;var i=this._loaderSessions.indexOf(t);this._loaderSessions.splice(i,1);this._loaderSessionsGarbage.push(t);this._gcTimeoutIID=setTimeout(function(){e.loaderSessionGC()},100)};r.prototype.getAsset=function(t,e){if(e===void 0){e=null}if(this._assetDictDirty)this.rehashAssetDict();if(e==null)e=h.DEFAULT_NAMESPACE;if(!this._assetDictionary.hasOwnProperty(e))return null;return this._assetDictionary[e][t]};r.prototype.getAllAssets=function(){return this._assets};r.prototype.addAsset=function(t){var e;var i;if(this._assets.indexOf(t)>=0)return;i=this.getAsset(t.name,t.assetNamespace);e=t.assetNamespace||h.DEFAULT_NAMESPACE;if(i!=null)this._strategy.resolveConflict(t,i,this._assetDictionary[e],this._strategyPreference);this._assets.push(t);if(!this._assetDictionary.hasOwnProperty(e))this._assetDictionary[e]=new Object;this._assetDictionary[e][t.name]=t;t.addEventListener(s.RENAME,this._onAssetRenameDelegate);t.addEventListener(s.ASSET_CONFLICT_RESOLVED,this._onAssetConflictResolvedDelegate)};r.prototype.removeAsset=function(t,e){if(e===void 0){e=true}var i;this.removeAssetFromDict(t);t.removeEventListener(s.RENAME,this._onAssetRenameDelegate);t.removeEventListener(s.ASSET_CONFLICT_RESOLVED,this._onAssetConflictResolvedDelegate);i=this._assets.indexOf(t);if(i>=0)this._assets.splice(i,1);if(e)t.dispose()};r.prototype.removeAssetByName=function(t,e,i){if(e===void 0){e=null}if(i===void 0){i=true}var r=this.getAsset(t,e);if(r)this.removeAsset(r,i);return r};r.prototype.removeAllAssets=function(t){if(t===void 0){t=true}if(t){var e;var i=this._assets.length;for(var r=0;r<i;r++){e=this._assets[r];e.dispose()}}this._assets.length=0;this.rehashAssetDict()};r.prototype.removeNamespaceAssets=function(t,e){if(t===void 0){t=null}if(e===void 0){e=true}var i=0;var r;var n;n=this._assets.concat();this._assets.length=0;if(t==null)t=h.DEFAULT_NAMESPACE;var s=n.length;for(var a=0;a<s;a++){r=n[a];if(r.assetNamespace==t){if(e)r.dispose();this.removeAssetFromDict(r,false)}else{this._assets[i++]=r}}if(this._assetDictionary.hasOwnProperty(t))delete this._assetDictionary[t]};r.prototype.removeAssetFromDict=function(t,e){if(e===void 0){e=true}if(this._assetDictDirty)this.rehashAssetDict();if(this._assetDictionary.hasOwnProperty(t.assetNamespace)){if(this._assetDictionary[t.assetNamespace].hasOwnProperty(t.name))delete this._assetDictionary[t.assetNamespace][t.name];if(e){var i;var r=true;for(i in this._assetDictionary[t.assetNamespace]){r=false;break}if(r)delete this._assetDictionary[t.assetNamespace]}}};r.prototype.stopAllLoaders=function(){var t=this._loaderSessions.length;for(var e=0;e<t;e++)this.killloaderSession(this._loaderSessions[e]);this._loaderSessions=new Array};r.prototype.rehashAssetDict=function(){var t;this._assetDictionary={};var e=this._assets.length;for(var i=0;i<e;i++){t=this._assets[i];if(!this._assetDictionary.hasOwnProperty(t.assetNamespace))this._assetDictionary[t.assetNamespace]={};this._assetDictionary[t.assetNamespace][t.name]=t}this._assetDictDirty=false};r.prototype.onLoadError=function(t){if(this.hasEventListener(k.LOAD_ERROR)){this.dispatchEvent(t);return true}else{return false}};r.prototype.onParseError=function(t){if(this.hasEventListener(B.PARSE_ERROR)){this.dispatchEvent(t);return true}else{return false}};r.prototype.onAssetComplete=function(t){if(t.type==s.ASSET_COMPLETE)this.addAsset(t.asset);this.dispatchEvent(t)};r.prototype.onTextureSizeError=function(t){this.dispatchEvent(t)};r.prototype.onResourceComplete=function(t){var e=t.target;this.dispatchEvent(t);this.disposeLoader(e)};r.prototype.loaderSessionGC=function(){var t;while(this._loaderSessionsGarbage.length>0){t=this._loaderSessionsGarbage.pop();this.killloaderSession(t)}clearTimeout(this._gcTimeoutIID);this._gcTimeoutIID=null};r.prototype.killloaderSession=function(t){t.removeEventListener(F.LOAD_COMPLETE,this._onResourceCompleteDelegate);t.removeEventListener(s.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate);t.removeEventListener(s.ASSET_COMPLETE,this._onAssetCompleteDelegate);t.stop()};r.prototype.onAssetRename=function(t){var e=t.target;var i=this.getAsset(e.assetNamespace,e.name);if(i!=null){this._strategy.resolveConflict(e,i,this._assetDictionary[e.assetNamespace],this._strategyPreference)}else{var r=this._assetDictionary[t.asset.assetNamespace];if(r==null)return;r[t.prevName]=null;r[t.asset.name]=t.asset}};r.prototype.onAssetConflictResolved=function(t){this.dispatchEvent(t.clone())};return r}(a);lt._iInstances=new Object;var pt=function(){function t(){}t.getBundle=function(t){if(t===void 0){t="default"}return lt.getInstance(t)};t.enableParser=function(t){rt.enableParser(t)};t.enableParsers=function(t){rt.enableParsers(t)};Object.defineProperty(t,"conflictStrategy",{get:function(){return t.getBundle().conflictStrategy},set:function(e){t.getBundle().conflictStrategy=e},enumerable:true,configurable:true});Object.defineProperty(t,"conflictPrecedence",{get:function(){return t.getBundle().conflictPrecedence},set:function(e){t.getBundle().conflictPrecedence=e},enumerable:true,configurable:true});t.createIterator=function(e,i,r){if(e===void 0){e=null}if(i===void 0){i=null}if(r===void 0){r=null}return t.getBundle().createIterator(e,i,r)};t.load=function(e,i,r,n){if(i===void 0){i=null}if(r===void 0){r=null}if(n===void 0){n=null}t.getBundle().load(e,i,r,n)};t.loadData=function(e,i,r,n){if(i===void 0){i=null}if(r===void 0){r=null}if(n===void 0){n=null}t.getBundle().loadData(e,i,r,n)};t.stopLoad=function(){t.getBundle().stopAllLoaders()};t.getLoader=function(){return t.getBundle().getLoader()};t.getAsset=function(e,i){if(i===void 0){i=null}return t.getBundle().getAsset(e,i)};t.getAllAssets=function(){return t.getBundle().getAllAssets()};t.addEventListener=function(e,i){t.getBundle().addEventListener(e,i)};t.removeEventListener=function(e,i){t.getBundle().removeEventListener(e,i)};t.addAsset=function(e){t.getBundle().addAsset(e)};t.removeAsset=function(e,i){if(i===void 0){i=true}t.getBundle().removeAsset(e,i)};t.removeAssetByName=function(e,i,r){if(i===void 0){i=null}if(r===void 0){r=true}return t.getBundle().removeAssetByName(e,i,r)};t.removeAllAssets=function(e){if(e===void 0){e=true}t.getBundle().removeAllAssets(e)};t.removeNamespaceAssets=function(e,i){if(e===void 0){e=null}if(i===void 0){i=true}t.getBundle().removeNamespaceAssets(e,i)};return t}();var ct=function(){function t(){}t.createUID=function(){var e=new Array(36);var i=0;var r;var n;for(r=0;r<8;r++)e[i++]=t.ALPHA_CHAR_CODES[Math.floor(Math.random()*16)];for(r=0;r<3;r++){e[i++]=45;for(n=0;n<4;n++)e[i++]=t.ALPHA_CHAR_CODES[Math.floor(Math.random()*16)]}e[i++]=45;var s=(new Date).getTime();var a=("0000000"+s.toString(16).toUpperCase()).substr(-8);for(r=0;r<8;r++)e[i++]=a.charCodeAt(r);for(r=0;r<4;r++)e[i++]=t.ALPHA_CHAR_CODES[Math.floor(Math.random()*16)];return String.fromCharCode.apply(null,e)};return t}();ct.ALPHA_CHAR_CODES=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70];var _t=function(t){e(i,t);function i(){return t.apply(this,arguments)||this}Object.defineProperty(i.prototype,"bytes",{get:function(){return this._bytes},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"bytesLoaded",{get:function(){return this._bytesLoaded},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"bytesTotal",{get:function(){return this._bytesTotal},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"content",{get:function(){return this._content},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"contentType",{get:function(){return this._contentType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"loader",{get:function(){return this._loader},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"url",{get:function(){return this._url},enumerable:true,configurable:true});return i}(a);var ft=function(){function t(){}return t}();ft.ANONYMOUS="anonymous";ft.USE_CREDENTIALS="use-credentials";var dt=function(){function t(t){if(t===void 0){t=null}this.method=$.GET;this.async=true;this._url=t}Object.defineProperty(t.prototype,"url",{get:function(){return this._url},set:function(t){this._url=t},enumerable:true,configurable:true});t.prototype.dispose=function(){this.data=null;this._url=null};return t}();var gt=function(){function t(){this.position=0;this.length=0;this._mode=""}t.prototype.writeByte=function(t){throw"Virtual method"};t.prototype.readByte=function(){throw"Virtual method"};t.prototype.writeUnsignedByte=function(t){throw"Virtual method"};t.prototype.readUnsignedByte=function(){throw"Virtual method"};t.prototype.writeUnsignedShort=function(t){throw"Virtual method"};t.prototype.readUnsignedShort=function(){throw"Virtual method"};t.prototype.writeUnsignedInt=function(t){throw"Virtual method"};t.prototype.readUnsignedInt=function(){throw"Virtual method"};t.prototype.writeFloat=function(t){throw"Virtual method"};t.prototype.toFloatBits=function(t){throw"Virtual method"};t.prototype.readFloat=function(t){throw"Virtual method"};t.prototype.fromFloatBits=function(t){throw"Virtual method"};t.prototype.getBytesAvailable=function(){throw new r("ByteArrayBase, getBytesAvailable() not implemented ")};t.prototype.toString=function(){return"[ByteArray] ( "+this._mode+" ) position="+this.position+" length="+this.length};t.prototype.compareEqual=function(t,e){if(e==undefined||e>this.length-this.position)e=this.length-this.position;if(e>t.length-t.position)e=t.length-t.position;var i=e;var r=true;while(r&&e>=4){e-=4;if(this.readUnsignedInt()!=t.readUnsignedInt())r=false}while(r&&e>=1){e--;if(this.readUnsignedByte()!=t.readUnsignedByte())r=false}var n;this.position-=n-e;t.position-=n-e;return r};t.prototype.writeBase64String=function(t){for(var e=0;e<t.length;e++){var i=t.charAt(e)}};t.prototype.dumpToConsole=function(){var t=this.position;this.position=0;var e=8;function i(t,e){var i=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];

var r="";for(var n=0;n<e;n++){r=i[t>>(n<<2)&15]+r}return r}for(var r=0;r<this.length;r+=e){var n=i(r,4)+":";for(var s=0;s<e&&r+s<this.length;s++){n+=" "+i(this.readUnsignedByte(),2)}console.log(n)}this.position=t};t.prototype.readBase64String=function(e){if(e==undefined||e>this.length-this.position)e=this.length-this.position;if(!(e>0))return"";return t.internalGetBase64String(e,this.readUnsignedByte,this)};t.internalGetBase64String=function(e,i,r){var n="";var s,a,o,h,u,l,p;var c=t.Base64Key;while(e>=3){s=i.apply(r);a=i.apply(r);o=i.apply(r);h=s>>2;u=(s&3)<<4|a>>4;l=(a&15)<<2|o>>6;p=o&63;n+=c.charAt(h)+c.charAt(u)+c.charAt(l)+c.charAt(p);e-=3}if(e==2){s=i.apply(r);a=i.apply(r);h=s>>2;u=(s&3)<<4|a>>4;l=(a&15)<<2;n+=c.charAt(h)+c.charAt(u)+c.charAt(l)+"="}else if(e==1){s=i.apply(r);h=s>>2;u=(s&3)<<4;n+=c.charAt(h)+c.charAt(u)+"=="}return n};return t}();gt.Base64Key="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var mt=function(t){e(i,t);function i(e){if(e===void 0){e=4}var i=t.call(this)||this;i._mode="Typed array";i.maxlength=Math.max(e+255&~255,4);i.arraybytes=new ArrayBuffer(i.maxlength);i.unalignedarraybytestemp=new ArrayBuffer(16);return i}i.prototype.ensureWriteableSpace=function(t){this.ensureSpace(t+this.position)};i.prototype.setArrayBuffer=function(t){this.ensureSpace(t.byteLength);this.length=t.byteLength;var e=new Int8Array(t);var i=new Int8Array(this.arraybytes,0,this.length);i.set(e);this.position=0};i.prototype.writeArrayBuffer=function(t){this.ensureWriteableSpace(t.byteLength);var e=new Int8Array(t);var i=new Int8Array(this.arraybytes,this.length,t.byteLength);i.set(e);this.length+=t.byteLength;this.position=this.length};i.prototype.writeByteArray=function(t){this.ensureWriteableSpace(t.length);var e=new Int8Array(t.arraybytes,0,t.length);var i=new Int8Array(this.arraybytes,this.length,t.length);i.set(e);this.length+=t.length;this.position=this.length};i.prototype.getBytesAvailable=function(){return this.length-this.position};i.prototype.ensureSpace=function(t){if(t>this.maxlength){var e=t+255&~255;var i=new ArrayBuffer(e);var r=new Uint8Array(this.arraybytes,0,this.length);var n=new Uint8Array(i,0,this.length);n.set(r);this.arraybytes=i;this.maxlength=e}};i.prototype.writeByte=function(t){this.ensureWriteableSpace(1);var e=new Int8Array(this.arraybytes);e[this.position++]=~~t;if(this.position>this.length){this.length=this.position}};i.prototype.readByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Positon="+this.position+", Length="+this.length;var t=new Int8Array(this.arraybytes);return t[this.position++]};i.prototype.readBytes=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=0}if(i==null)i=t.length;t.ensureWriteableSpace(e+i);var r=new Int8Array(t.arraybytes);var n=new Int8Array(this.arraybytes);r.set(n.subarray(this.position,this.position+i),e);this.position+=i;if(i+e>t.length)t.length+=i+e-t.length};i.prototype.writeUnsignedByte=function(t){this.ensureWriteableSpace(1);var e=new Uint8Array(this.arraybytes);e[this.position++]=~~t&255;if(this.position>this.length)this.length=this.position};i.prototype.readUnsignedByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Positon="+this.position+", Length="+this.length;var t=new Uint8Array(this.arraybytes);return t[this.position++]};i.prototype.writeUnsignedShort=function(t){this.ensureWriteableSpace(2);if((this.position&1)==0){var e=new Uint16Array(this.arraybytes);e[this.position>>1]=~~t&65535}else{var e=new Uint16Array(this.unalignedarraybytestemp,0,1);e[0]=~~t&65535;var i=new Uint8Array(this.arraybytes,this.position,2);var r=new Uint8Array(this.unalignedarraybytestemp,0,2);i.set(r)}this.position+=2;if(this.position>this.length)this.length=this.position};i.prototype.readUTFBytes=function(t){var e="";var i=this.position+t;var r=new DataView(this.arraybytes);while(this.position<i){var n=r.getUint8(this.position++);if(n<128){if(n==0)break;e+=String.fromCharCode(n)}else if(n<224){e+=String.fromCharCode((n&63)<<6|r.getUint8(this.position++)&127)}else if(n<240){var s=r.getUint8(this.position++);e+=String.fromCharCode((n&31)<<12|(s&127)<<6|r.getUint8(this.position++)&127)}else{var s=r.getUint8(this.position++);var a=r.getUint8(this.position++);e+=String.fromCharCode((n&15)<<18|(s&127)<<12|a<<6&127|r.getUint8(this.position++)&127)}}return e};i.prototype.writeUTFBytes=function(t){var e=encodeURIComponent(t);var i=e.replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode(parseInt("0x"+e))});this.ensureWriteableSpace(4+i.length);this.writeInt(i.length);for(var r=0;r<i.length;r++){this.writeUnsignedByte(i.charCodeAt(r))}if(i.length%4){var n=i.length%4;for(var r=0;r<n;r++){this.writeUnsignedByte(0)}}return i.length};i.prototype.readInt=function(){var t=new DataView(this.arraybytes);var e=t.getInt32(this.position,true);this.position+=4;return e};i.prototype.readShort=function(){var t=new DataView(this.arraybytes);var e=t.getInt16(this.position,true);this.position+=2;return e};i.prototype.readDouble=function(){var t=new DataView(this.arraybytes);var e=t.getFloat64(this.position,true);this.position+=8;return e};i.prototype.readUnsignedShort=function(){if(this.position>this.length+2)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;if((this.position&1)==0){var t=new Uint16Array(this.arraybytes);var e=this.position>>1;this.position+=2;return t[e]}else{var t=new Uint16Array(this.unalignedarraybytestemp,0,1);var i=new Uint8Array(this.arraybytes,this.position,2);var r=new Uint8Array(this.unalignedarraybytestemp,0,2);r.set(i);this.position+=2;return t[0]}};i.prototype.writeUnsignedInt=function(t){this.ensureWriteableSpace(4);if((this.position&3)==0){var e=new Uint32Array(this.arraybytes);e[this.position>>2]=~~t&4294967295}else{var e=new Uint32Array(this.unalignedarraybytestemp,0,1);e[0]=~~t&4294967295;var i=new Uint8Array(this.arraybytes,this.position,4);var r=new Uint8Array(this.unalignedarraybytestemp,0,4);i.set(r)}this.position+=4;if(this.position>this.length)this.length=this.position};i.prototype.writeInt=function(t){this.ensureWriteableSpace(4);if((this.position&3)==0){var e=new Int32Array(this.arraybytes);e[this.position>>2]=~~t}else{var e=new Int32Array(this.unalignedarraybytestemp,0,1);e[0]=~~t;var i=new Uint8Array(this.arraybytes,this.position,4);var r=new Uint8Array(this.unalignedarraybytestemp,0,4);i.set(r)}this.position+=4;if(this.position>this.length)this.length=this.position};i.prototype.readUnsignedInt=function(){if(this.position>this.length+4)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;if((this.position&3)==0){var t=new Uint32Array(this.arraybytes);var e=this.position>>2;this.position+=4;return t[e]}else{var t=new Uint32Array(this.unalignedarraybytestemp,0,1);var i=new Uint8Array(this.arraybytes,this.position,4);var r=new Uint8Array(this.unalignedarraybytestemp,0,4);r.set(i);this.position+=4;return t[0]}};i.prototype.writeFloat=function(t){this.ensureWriteableSpace(4);if((this.position&3)==0){var e=new Float32Array(this.arraybytes);e[this.position>>2]=t}else{var e=new Float32Array(this.unalignedarraybytestemp,0,1);e[0]=t;var i=new Uint8Array(this.arraybytes,this.position,4);var r=new Uint8Array(this.unalignedarraybytestemp,0,4);i.set(r)}this.position+=4;if(this.position>this.length)this.length=this.position};i.prototype.readFloat=function(){if(this.position>this.length+4)throw"ByteArray out of bounds read. Positon="+this.position+", Length="+this.length;if((this.position&3)==0){var t=new Float32Array(this.arraybytes);var e=this.position>>2;this.position+=4;return t[e]}else{var t=new Float32Array(this.unalignedarraybytestemp,0,1);var i=new Uint8Array(this.arraybytes,this.position,4);var r=new Uint8Array(this.unalignedarraybytestemp,0,4);r.set(i);this.position+=4;return t[0]}};return i}(gt);var yt=function(){function t(){}t.arrayBufferToBase64=function(t,e){var i="";var r=new Uint8Array(t);var n=r.byteLength;for(var s=0;s<n;s++)i+=String.fromCharCode(r[s]);var a=window.btoa(i);return"data:"+e+";base64,"+a};t.arrayBufferToAudio=function(e,i){var r=t.arrayBufferToBase64(e,"audio/"+i);var n=new Audio;n.src=r;return n};t.arrayBufferToImage=function(e){var i=t.arrayBufferToBase64(e,"image/png");var r=new Image;r.src=i;return r};t.byteArrayToImage=function(e){var i=t.arrayBufferToBase64(e.arraybytes,"image/png");var r=new Image;r.src=i;return r};t.byteArrayToAudio=function(e,i){var r=t.arrayBufferToBase64(e.arraybytes,"audio/"+i);var n=new Audio;n.src=r;return n};t.blobToImage=function(t){var e=window["URL"]||window["webkitURL"];var i=e.createObjectURL(t);var r=new Image;r.src=i;return r};t.blobToAudio=function(t){var e=window["URL"]||window["webkitURL"];var i=e.createObjectURL(t);var r=new Audio;r.src=i;return r};t.toByteArray=function(t){var e=new mt;e.setArrayBuffer(t);return e};t.toString=function(t,e){if(e===void 0){e=0}if(typeof t==="string"){var i=t;if(i["substr"]!=null)return i.substr(0,i.length)}if(t instanceof mt){var r=t;r.position=0;return r.readUTFBytes(Math.min(r.getBytesAvailable(),e))}return null};return t}();var vt=function(t){e(r,t);function r(e,r){if(r===void 0){r=0}var n=t.call(this)||this;n._repeatCount=0;n._currentCount=0;n._running=false;n._delay=e;n._repeatCount=r;if(isNaN(e)||e<0)throw new i("Delay is negative or not a number");return n}Object.defineProperty(r.prototype,"currentCount",{get:function(){return this._currentCount},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"delay",{get:function(){return this._delay},set:function(t){this._delay=t;if(this._running){this.stop();this.start()}},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"repeatCount",{get:function(){return this._repeatCount},set:function(t){this._repeatCount=t},enumerable:true,configurable:true});r.prototype.reset=function(){if(this._running)this.stop();this._currentCount=0};Object.defineProperty(r.prototype,"running",{get:function(){return this._running},enumerable:true,configurable:true});r.prototype.start=function(){var t=this;this._running=true;clearInterval(this._iid);this._iid=setInterval(function(){return t.tick()},this._delay)};r.prototype.stop=function(){this._running=false;clearInterval(this._iid)};r.prototype.tick=function(){this._currentCount++;if(this._repeatCount>0&&this._currentCount>=this._repeatCount){this.stop();this.dispatchEvent(new U(U.TIMER));this.dispatchEvent(new U(U.TIMER_COMPLETE))}else{this.dispatchEvent(new U(U.TIMER))}};return r}(a);function xt(){return Date.now()}var bt=function(t){e(i,t);function i(e){var i=t.call(this)||this;i._materialMode=0;i._dataFormat=e;i._dependencies=new Array;i._pOnIntervalDelegate=function(t){return i._pOnInterval(t)};return i}i.supportsType=function(t){throw new r};Object.defineProperty(i.prototype,"content",{get:function(){return this._pContent},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"parsingFailure",{get:function(){return this._parsingFailure},set:function(t){this._parsingFailure=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"parsingPaused",{get:function(){return this._parsingPaused},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"parsingComplete",{get:function(){return this._parsingComplete},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"materialMode",{get:function(){return this._materialMode},set:function(t){this._materialMode=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"data",{get:function(){return this._data},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"dataFormat",{get:function(){return this._dataFormat},enumerable:true,configurable:true});i.prototype.parseAsync=function(t,e){if(e===void 0){e=30}this._data=t;this._pStartParsing(e)};Object.defineProperty(i.prototype,"dependencies",{get:function(){return this._dependencies},enumerable:true,configurable:true});i.prototype._iResolveDependency=function(t){throw new r};i.prototype._iResolveDependencyFailure=function(t){throw new r};i.prototype._iResolveDependencyName=function(t,e){return e.name};i.prototype._iResumeParsing=function(){this._parsingPaused=false;if(this._timer)this._timer.start();if(!this._isParsing)this._pOnInterval()};i.prototype._pFinalizeAsset=function(t,e){if(e===void 0){e=null}var i;var r;if(e!=null)t.name=e;if(!t.name)t.name=t.assetType;this.dispatchEvent(new s(s.ASSET_COMPLETE,t))};i.prototype._pProceedParsing=function(){throw new r};i.prototype._pDieWithError=function(t){if(t===void 0){t="Unknown parsing error"}if(this._timer){this._timer.removeEventListener(U.TIMER,this._pOnIntervalDelegate);this._timer.stop();this._timer=null}this.dispatchEvent(new B(B.PARSE_ERROR,t))};i.prototype._pAddDependency=function(t,e,i,r,n,s){if(i===void 0){i=false}if(r===void 0){r=null}if(n===void 0){n=false}if(s===void 0){s=0}var a=new it(t,e,r,null,this,i,n,s);this._dependencies.push(a);return a};i.prototype._pPauseAndRetrieveDependencies=function(){this._pPauseParsing();this.dispatchEvent(new B(B.READY_FOR_DEPENDENCIES))};i.prototype._pPauseParsing=function(){if(this._timer)this._timer.stop();this._parsingPaused=true};i.prototype._pHasTime=function(){return xt()-this._lastFrameTime<this._frameLimit};i.prototype._pOnInterval=function(t){if(t===void 0){t=null}this._lastFrameTime=xt();this._isParsing=true;if(this._pProceedParsing()&&!this._parsingFailure)this._pFinishParsing();this._isParsing=false};i.prototype._pStartParsing=function(t){this._frameLimit=t;this._timer=new vt(this._frameLimit,0);this._timer.addEventListener(U.TIMER,this._pOnIntervalDelegate);this._timer.start();this._pOnInterval()};i.prototype._pFinishParsing=function(){if(this._timer){this._timer.removeEventListener(U.TIMER,this._pOnIntervalDelegate);this._timer.stop()}this._timer=null;this._parsingComplete=true;this._isParsing=false;this.dispatchEvent(new B(B.PARSE_COMPLETE))};i.prototype._pGetTextData=function(){return yt.toString(this._data)};i.prototype._pGetByteData=function(){return yt.toByteArray(this._data)};i.prototype._pGetData=function(){return this._data};return i}(a);bt.PARSING_DONE=true;bt.MORE_TO_PARSE=false;var wt=function(){function t(){}return t}();wt.BINARY="binary";wt.PLAIN_TEXT="plainText";wt.IMAGE="image";var Dt=function(t){e(i,t);function i(){return t.call(this,J.BLOB)||this}i.supportsType=function(t){t=t.toLowerCase();return t=="wav"||t=="mp3"||t=="ogg"};i.supportsData=function(t){if(!(t instanceof mt))return false;var e=t;var r=i.parseFileType(e);return r?true:false};i.prototype._pStartParsing=function(e){delete this._pContent;this._pContent=null;t.prototype._pStartParsing.call(this,e)};i.prototype._pProceedParsing=function(){if(this.data instanceof mt){this._pContent=new w(this.data.arraybytes);this._pFinalizeAsset(this._pContent,this._iFileName)}else if(this.data instanceof ArrayBuffer){this._pContent=new w(this.data);this._pFinalizeAsset(this._pContent,this._iFileName)}return bt.PARSING_DONE};i.parseFileType=function(t){t.position=0;if((t.readUnsignedShort()&65504)==65504){return"mp3"}t.position=0;var e=t.readUnsignedByte();var i=t.readUnsignedByte();var r=t.readUnsignedByte();if(e===73&&i===68&&r===51||e===255&&i===251||e===255&&i===243&&r===130){return"mp3"}t.position=0;if(t.readUTFBytes(4)=="RIFF")return"wav";t.position=0;if(t.readUTFBytes(4)=="OggS")return"ogg";t.position=0;return null};return i}(bt);(function(t){t[t["LEFT_HANDED"]=0]="LEFT_HANDED";t[t["RIGHT_HANDED"]=1]="RIGHT_HANDED"})(t.CoordinateSystem||(t.CoordinateSystem={}));var Ct=function(i){e(n,i);function n(e){if(e===void 0){e=t.CoordinateSystem.LEFT_HANDED}var r=i.call(this)||this;r._viewMatrix3D=new M;r._inverseViewMatrix3D=new M;r._frustumMatrix3D=new M;r._viewRect=new Y;r._stageRect=new Y;r._near=20;r._far=3e3;r._frustumCorners=[];r._originX=.5;r._originY=.5;r._viewMatrix3DDirty=true;r._inverseViewMatrix3DDirty=true;r._frustumMatrix3DDirty=true;r._frustumPlanesDirty=true;r._coordinateSystem=e;r._onInvalidateConcatenatedMatrix3DDelegate=function(t){return r._onInvalidateConcatenatedMatrix3D(t)};return r}Object.defineProperty(n.prototype,"transform",{get:function(){return this._transform},set:function(t){if(this._transform==t)return;if(this._transform)this._transform.removeEventListener(O.INVALIDATE_CONCATENATED_MATRIX3D,this._onInvalidateConcatenatedMatrix3DDelegate);this._transform=t;if(this._transform)this._transform.addEventListener(O.INVALIDATE_CONCATENATED_MATRIX3D,this._onInvalidateConcatenatedMatrix3DDelegate);this._invalidateViewMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"coordinateSystem",{get:function(){return this._coordinateSystem},set:function(t){if(this._coordinateSystem==t)return;this._coordinateSystem=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"frustumCorners",{get:function(){return this._frustumCorners},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"frustumMatrix3D",{get:function(){if(this._frustumMatrix3DDirty)this._updateFrustumMatrix3D();return this._frustumMatrix3D},set:function(t){this._frustumMatrix3D=t;this._invalidateViewMatrix3D();this._invalidateProperties()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"near",{get:function(){if(this._propertiesDirty)this._updateProperties();return this._near},set:function(t){if(t==this._near)return;this._near=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"originX",{get:function(){if(this._propertiesDirty)this._updateProperties();return this._originX},set:function(t){if(this._originX==t)return;this._originX=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"originY",{get:function(){if(this._propertiesDirty)this._updateProperties();return this._originY},set:function(t){if(this._originY==t)return;this._originY=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"far",{get:function(){if(this._propertiesDirty)this._updateProperties();return this._far},set:function(t){if(t==this._far)return;this._far=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});n.prototype.project=function(t){var e=this.viewMatrix3D.transformVector(t);e.x=e.x/e.w;e.y=-e.y/e.w;e.z=e.w;e.w=1;return e};Object.defineProperty(n.prototype,"viewMatrix3D",{get:function(){if(this._viewMatrix3DDirty){this._viewMatrix3DDirty=false;if(this._transform){this._viewMatrix3D.copyFrom(this._transform.inverseConcatenatedMatrix3D);this._viewMatrix3D.append(this.frustumMatrix3D)}else{this._viewMatrix3D.copyFrom(this.frustumMatrix3D)}}return this._viewMatrix3D},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"inverseViewMatrix3D",{get:function(){if(this._inverseViewMatrix3DDirty){this._inverseViewMatrix3DDirty=false;this._inverseViewMatrix3D.copyFrom(this.viewMatrix3D);this._inverseViewMatrix3D.invert()}return this._inverseViewMatrix3D},enumerable:true,configurable:true});n.prototype.unproject=function(t,e,i){throw new r};n.prototype.clone=function(){throw new r};n.prototype._invalidateProperties=function(){this._propertiesDirty=true};n.prototype._invalidateViewMatrix3D=function(){this._viewMatrix3DDirty=true;this._inverseViewMatrix3DDirty=true;this._frustumPlanesDirty=true;this.dispatchEvent(new V(V.MATRIX_CHANGED,this))};n.prototype._invalidateFrustumMatrix3D=function(){if(this._propertiesDirty)this._updateProperties();this._frustumMatrix3DDirty=true;this._invalidateViewMatrix3D()};n.prototype.setViewRect=function(t,e,i,r){this._viewRect.x=t;this._viewRect.y=e;this._viewRect.width=i;this._viewRect.height=r;this._invalidateFrustumMatrix3D()};n.prototype.setStageRect=function(t,e,i,r){this._stageRect.x=t;this._stageRect.y=e;this._stageRect.width=i;this._stageRect.height=r;this._invalidateFrustumMatrix3D()};n.prototype._updateFrustumMatrix3D=function(){this._frustumMatrix3DDirty=false};n.prototype._updateProperties=function(){this._propertiesDirty=false};Object.defineProperty(n.prototype,"frustumPlanes",{get:function(){if(this._frustumPlanesDirty)this._updateFrustumPlanes();return this._frustumPlanes},enumerable:true,configurable:true});n.prototype._updateFrustumPlanes=function(){this._frustumPlanesDirty=false;if(!this._frustumPlanes){this._frustumPlanes=[];for(var t=0;t<6;++t)this._frustumPlanes[t]=new H}var e,i,r;var n,s,a,o;var h,u,l,p;var c,_,f,d;var g,m,y,v;var x;var b=this.viewMatrix3D._rawData;var w;n=b[0];s=b[4];a=b[8];o=b[12];h=b[1];u=b[5];l=b[9];p=b[13];c=b[2];_=b[6];f=b[10];d=b[14];g=b[3];m=b[7];y=b[11];v=b[15];x=this._frustumPlanes[0];e=g+n;i=m+s;r=y+a;w=1/Math.sqrt(e*e+i*i+r*r);x.a=e*w;x.b=i*w;x.c=r*w;x.d=-(v+o)*w;x=this._frustumPlanes[1];e=g-n;i=m-s;r=y-a;w=1/Math.sqrt(e*e+i*i+r*r);x.a=e*w;x.b=i*w;x.c=r*w;x.d=(o-v)*w;x=this._frustumPlanes[2];e=g+h;i=m+u;r=y+l;w=1/Math.sqrt(e*e+i*i+r*r);x.a=e*w;x.b=i*w;x.c=r*w;x.d=-(v+p)*w;x=this._frustumPlanes[3];e=g-h;i=m-u;r=y-l;w=1/Math.sqrt(e*e+i*i+r*r);x.a=e*w;x.b=i*w;x.c=r*w;x.d=(p-v)*w;x=this._frustumPlanes[4];e=c;i=_;r=f;w=1/Math.sqrt(e*e+i*i+r*r);x.a=e*w;x.b=i*w;x.c=r*w;x.d=-d*w;x=this._frustumPlanes[5];e=g-c;i=m-_;r=y-f;w=1/Math.sqrt(e*e+i*i+r*r);x.a=e*w;x.b=i*w;x.c=r*w;x.d=(d-v)*w};n.prototype._onInvalidateConcatenatedMatrix3D=function(t){this._invalidateViewMatrix3D()};return n}(a);var At=function(t){e(i,t);function i(e,i){var r=t.call(this)||this;r.baseProjection=e;r.plane=i;r._onProjectionMatrixChangedDelegate=function(t){return r.onProjectionMatrixChanged(t)};return r}Object.defineProperty(i.prototype,"frustumCorners",{get:function(){return this._baseProjection.frustumCorners},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"near",{get:function(){return this._baseProjection.near},set:function(t){this._baseProjection.near=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"far",{get:function(){return this._baseProjection.far},set:function(t){this._baseProjection.far=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"plane",{get:function(){return this._plane},set:function(t){this._plane=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"baseProjection",{set:function(t){if(this._baseProjection)this._baseProjection.removeEventListener(V.MATRIX_CHANGED,this._onProjectionMatrixChangedDelegate);this._baseProjection=t;if(this._baseProjection)this._baseProjection.addEventListener(V.MATRIX_CHANGED,this._onProjectionMatrixChangedDelegate);this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});i.prototype.onProjectionMatrixChanged=function(t){this._invalidateFrustumMatrix3D()};i.prototype._updateFrustumMatrix3D=function(){t.prototype._updateFrustumMatrix3D.call(this);this._frustumMatrix3D.copyFrom(this._baseProjection.frustumMatrix3D);var e=this._plane.a;var i=this._plane.b;var r=this._plane.c;var n=-this._plane.d+.05;var s=e>=0?1:-1;var a=i>=0?1:-1;var o=new A(s,a,1,1);var h=this._frustumMatrix3D.clone();h.invert();var u=h.transformVector(o);this._frustumMatrix3D.copyRowTo(3,o);var l=(u.x*o.x+u.y*o.y+u.z*o.z+u.w*o.w)/(e*u.x+i*u.y+r*u.z+n*u.w);this._frustumMatrix3D.copyRowFrom(2,new A(e*l,i*l,r*l,n*l))};return i}(Ct);var Tt=function(t){e(i,t);function i(e,i,r,n){var s=t.call(this)||this;s._minX=e;s._maxX=i;s._minY=r;s._maxY=n;return s}Object.defineProperty(i.prototype,"minX",{get:function(){return this._minX},set:function(t){this._minX=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"maxX",{get:function(){return this._maxX},set:function(t){this._maxX=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"minY",{get:function(){return this._minY},set:function(t){this._minY=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"maxY",{get:function(){return this._maxY},set:function(t){this._maxY=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});i.prototype.unproject=function(t,e,i){var r=new A(t,-e,i,1);r=this.inverseViewMatrix3D.transformVector(r);r.z=i;return r};i.prototype.clone=function(){var t=new i(this._minX,this._maxX,this._minY,this._maxY);t._near=this._near;t._far=this._far;return t};i.prototype._updateFrustumMatrix3D=function(){t.prototype._updateFrustumMatrix3D.call(this);var e=M.CALCULATION_MATRIX._rawData;var i=1/(this._maxX-this._minX);var r=1/(this._maxY-this._minY);var n=1/(this._far-this._near);e[0]=2*i;e[5]=2*r;e[10]=n;e[12]=-(this._maxX+this._minX)*i;e[13]=-(this._maxY+this._minY)*r;e[14]=-this._near*n;e[15]=1;e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=0;this._frustumMatrix3D.copyRawDataFrom(e);this._frustumCorners[0]=this._frustumCorners[9]=this._frustumCorners[12]=this._frustumCorners[21]=this._minX;this._frustumCorners[3]=this._frustumCorners[6]=this._frustumCorners[15]=this._frustumCorners[18]=this._maxX;this._frustumCorners[1]=this._frustumCorners[4]=this._frustumCorners[13]=this._frustumCorners[16]=this._minY;this._frustumCorners[7]=this._frustumCorners[10]=this._frustumCorners[19]=this._frustumCorners[22]=this._maxY;this._frustumCorners[2]=this._frustumCorners[5]=this._frustumCorners[8]=this._frustumCorners[11]=this._near;this._frustumCorners[14]=this._frustumCorners[17]=this._frustumCorners[20]=this._frustumCorners[23]=this._far};return i}(Ct);var Pt=function(t){e(i,t);function i(e){if(e===void 0){e=500}var i=t.call(this)||this;i._projectionHeight=e;return i}Object.defineProperty(i.prototype,"projectionHeight",{get:function(){return this._projectionHeight},set:function(t){if(t==this._projectionHeight)return;this._projectionHeight=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});i.prototype.unproject=function(t,e,i){var r=new A(t+this.viewMatrix3D._rawData[12],-e+this.viewMatrix3D._rawData[13],i,1);r=this.inverseViewMatrix3D.transformVector(r);r.z=i;return r};i.prototype.clone=function(){var t=new i;t._near=this._near;t._far=this._far;t.projectionHeight=this._projectionHeight;return t};i.prototype._updateFrustumMatrix3D=function(){t.prototype._updateFrustumMatrix3D.call(this);var e=M.CALCULATION_MATRIX._rawData;this._yMax=this._projectionHeight*.5;this._xMax=this._yMax*this._viewRect.width/this._viewRect.height;var i;var r;var n;var s;if(this._viewRect.x==0&&this._viewRect.y==0&&this._viewRect.width==this._stageRect.width&&this._viewRect.height==this._stageRect.height){i=-this._xMax;r=this._xMax;n=-this._yMax;s=this._yMax;e[0]=2/(this._projectionHeight*this._viewRect.width/this._viewRect.height);e[5]=2/this._projectionHeight;e[10]=1/(this._far-this._near);e[14]=this._near/(this._near-this._far);e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=0;e[15]=1}else{var a=this._xMax*(this._stageRect.width/this._viewRect.width);var o=this._yMax*(this._stageRect.height/this._viewRect.height);var h=this._xMax*(this._viewRect.x*2-this._stageRect.width)/this._viewRect.width+this._xMax;var u=-this._yMax*(this._viewRect.y*2-this._stageRect.height)/this._viewRect.height-this._yMax;i=h-a;r=h+a;n=u-o;s=u+o;e[0]=2*1/(r-i);e[5]=-2*1/(n-s);e[10]=1/(this._far-this._near);e[12]=(r+i)/(r-i);e[13]=(s+n)/(s-n);e[14]=this._near/(this.near-this.far);e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=0;e[15]=1}this._frustumCorners[0]=this._frustumCorners[9]=this._frustumCorners[12]=this._frustumCorners[21]=i;this._frustumCorners[3]=this._frustumCorners[6]=this._frustumCorners[15]=this._frustumCorners[18]=r;this._frustumCorners[1]=this._frustumCorners[4]=this._frustumCorners[13]=this._frustumCorners[16]=n;this._frustumCorners[7]=this._frustumCorners[10]=this._frustumCorners[19]=this._frustumCorners[22]=s;this._frustumCorners[2]=this._frustumCorners[5]=this._frustumCorners[8]=this._frustumCorners[11]=this._near;this._frustumCorners[14]=this._frustumCorners[17]=this._frustumCorners[20]=this._frustumCorners[23]=this._far;this._frustumMatrix3D.copyRawDataFrom(e)};return i}(Ct);var St=function(i){e(r,i);function r(e,r){if(e===void 0){e=60}if(r===void 0){r=t.CoordinateSystem.LEFT_HANDED}var n=i.call(this,r)||this;n._fieldOfView=60;n._focalLength=1e3;n._hFieldOfView=60;n._hFocalLength=1e3;n._preserveAspectRatio=true;n._preserveFocalLength=false;n.fieldOfView=e;return n}Object.defineProperty(r.prototype,"preserveAspectRatio",{get:function(){return this._preserveAspectRatio},set:function(t){if(this._preserveAspectRatio==t)return;this._preserveAspectRatio=t;if(this._preserveAspectRatio)this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"preserveFocalLength",{get:function(){return this._preserveFocalLength},set:function(t){if(this._preserveFocalLength==t)return;this._preserveFocalLength=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"fieldOfView",{get:function(){if(this._frustumMatrix3DDirty&&this._preserveFocalLength)this._updateFrustumMatrix3D();return this._fieldOfView},set:function(t){if(this._fieldOfView==t)return;this._fieldOfView=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"focalLength",{get:function(){if(this._frustumMatrix3DDirty&&!this._preserveFocalLength)this._updateFrustumMatrix3D();return this._focalLength},set:function(t){if(this._focalLength==t)return;this._focalLength=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"hFieldOfView",{get:function(){if(this._frustumMatrix3DDirty&&this._preserveFocalLength)this._updateFrustumMatrix3D();return this._hFieldOfView},set:function(t){if(this._hFieldOfView==t)return;this._hFieldOfView=t;this._hFocalLength=1/Math.tan(this._hFieldOfView*Math.PI/360);this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"hFocalLength",{get:function(){if(this._frustumMatrix3DDirty&&!this._preserveFocalLength)this._updateFrustumMatrix3D();return this._hFocalLength},set:function(t){if(this._hFocalLength==t)return;this._hFocalLength=t;this._invalidateFrustumMatrix3D()},enumerable:true,configurable:true});r.prototype.unproject=function(t,e,i){var r=new A(t*i,-e*i,(this._far+this._near)/(this._far-this._near)*i-2*this._far*this._near/(this._far-this._near),i);r=this.inverseViewMatrix3D.transformVector(r,r);r.w=1;return r};r.prototype.clone=function(){var t=new r(this._fieldOfView,this._coordinateSystem);t._hFieldOfView=this.hFieldOfView;t._preserveAspectRatio=this._preserveAspectRatio;t._preserveFocalLength=this._preserveFocalLength;t._near=this._near;t._far=this._far;t._coordinateSystem=this._coordinateSystem;return t};r.prototype._updateFrustumMatrix3D=function(){i.prototype._updateFrustumMatrix3D.call(this);var e=M.CALCULATION_MATRIX._rawData;if(this._preserveFocalLength){if(this._preserveAspectRatio)this._hFocalLength=this._focalLength;this._fieldOfView=Math.atan(.5*this._viewRect.height/this._focalLength)*360/Math.PI;this._hFieldOfView=Math.atan(.5*this._viewRect.width/this._hFocalLength)*360/Math.PI}else{this._focalLength=.5*this._viewRect.height/Math.tan(this._fieldOfView*Math.PI/360);if(this._preserveAspectRatio)this._hFocalLength=this._focalLength;else this._hFocalLength=.5*this._viewRect.width/Math.tan(this._hFieldOfView*Math.PI/360)}var r=(this._viewRect.x+this._originX*this._viewRect.width)/this._hFocalLength;var n=-(this._viewRect.y+this._originY*this._viewRect.height)/this._focalLength;var s=r-this._stageRect.width/this._hFocalLength;var a=n+this._stageRect.height/this._focalLength;e[0]=2/(r-s);e[5]=2/(a-n);e[8]=(r+s)/(r-s);e[9]=(a+n)/(a-n);e[10]=(this._far+this._near)/(this._far-this._near);e[11]=1;e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[12]=e[13]=e[15]=0;e[14]=-2*this._far*this._near/(this._far-this._near);if(this._coordinateSystem==t.CoordinateSystem.RIGHT_HANDED)e[5]=-e[5];this._frustumMatrix3D.copyRawDataFrom(e);this._frustumCorners[0]=this._frustumCorners[9]=this._near*s;

this._frustumCorners[3]=this._frustumCorners[6]=this._near*r;this._frustumCorners[1]=this._frustumCorners[4]=this._near*n;this._frustumCorners[7]=this._frustumCorners[10]=this._near*a;this._frustumCorners[12]=this._frustumCorners[21]=this._far*s;this._frustumCorners[15]=this._frustumCorners[18]=this._far*r;this._frustumCorners[13]=this._frustumCorners[16]=this._far*n;this._frustumCorners[19]=this._frustumCorners[22]=this._far*a;this._frustumCorners[2]=this._frustumCorners[5]=this._frustumCorners[8]=this._frustumCorners[11]=this._near;this._frustumCorners[14]=this._frustumCorners[17]=this._frustumCorners[20]=this._frustumCorners[23]=this._far};r.prototype._updateProperties=function(){i.prototype._updateProperties.call(this);var t=this._frustumMatrix3D._rawData;this._near=t[14]/(-1-t[10]);this._far=t[14]/(1-t[10]);this._originX=((t[8]+1)*this._stageRect.width/2-this._viewRect.x)/this._viewRect.width;this._originY=((1-t[9])*this._stageRect.height/2-this._viewRect.y)/this._viewRect.height};return r}(Ct);var Et=function(){function t(){}return t}();Et.A=65;Et.ALTERNATE=18;Et.AUDIO=16777239;Et.B=66;Et.BACK=16777238;Et.BACKQUOTE=192;Et.BACKSLASH=220;Et.BACKSPACE=8;Et.BLUE=16777219;Et.C=67;Et.CAPS_LOCK=20;Et.CHANNEL_DOWN=16777221;Et.CHANNEL_UP=16777221;Et.COMMA=188;Et.COMMAND=15;Et.CONTROL=17;Et.D=68;Et.DELETE=46;Et.DOWN=40;Et.DVR=16777241;Et.E=69;Et.END=35;Et.ENTER=13;Et.EQUAL=187;Et.ESCAPE=27;Et.EXIT=16777237;Et.F=70;Et.F1=112;Et.F10=121;Et.F11=122;Et.F12=123;Et.F13=124;Et.F14=125;Et.F15=126;Et.F2=113;Et.F3=114;Et.F4=115;Et.F5=116;Et.F6=117;Et.F7=118;Et.F8=119;Et.F9=120;Et.FAST_FORWARD=16777226;Et.G=71;Et.GREEN=16777217;Et.GUIDE=16777236;Et.H=72;Et.HELP=16777245;Et.HOME=36;Et.I=73;Et.INFO=16777235;Et.INPUT=16777243;Et.INSERT=45;Et.J=74;Et.K=75;Et.KEYNAME_BEGIN="Begin";Et.KEYNAME_BREAK="Break";Et.KEYNAME_CLEARDISPLAY="ClrDsp";Et.KEYNAME_CLEARLINE="ClrLn";Et.KEYNAME_DELETE="Delete";Et.KEYNAME_DELETECHAR="DelChr";Et.KEYNAME_DELETELINE="DelLn";Et.KEYNAME_DOWNARROW="Down";Et.KEYNAME_END="End";Et.KEYNAME_EXECUTE="Exec";Et.KEYNAME_F1="F1";Et.KEYNAME_F10="F10";Et.KEYNAME_F11="F11";Et.KEYNAME_F12="F12";Et.KEYNAME_F13="F13";Et.KEYNAME_F14="F14";Et.KEYNAME_F15="F15";Et.KEYNAME_F16="F16";Et.KEYNAME_F17="F17";Et.KEYNAME_F18="F18";Et.KEYNAME_F19="F19";Et.KEYNAME_F2="F2";Et.KEYNAME_F20="F20";Et.KEYNAME_F21="F21";Et.KEYNAME_F22="F22";Et.KEYNAME_F23="F23";Et.KEYNAME_F24="F24";Et.KEYNAME_F25="F25";Et.KEYNAME_F26="F26";Et.KEYNAME_F27="F27";Et.KEYNAME_F28="F28";Et.KEYNAME_F29="F29";Et.KEYNAME_F3="F3";Et.KEYNAME_F30="F30";Et.KEYNAME_F31="F31";Et.KEYNAME_F32="F32";Et.KEYNAME_F33="F33";Et.KEYNAME_F34="F34";Et.KEYNAME_F35="F35";Et.KEYNAME_F4="F4";Et.KEYNAME_F5="F5";Et.KEYNAME_F6="F6";Et.KEYNAME_F7="F7";Et.KEYNAME_F8="F8";Et.KEYNAME_F9="F9";Et.KEYNAME_FIND="Find";Et.KEYNAME_HELP="Help";Et.KEYNAME_HOME="Home";Et.KEYNAME_INSERT="Insert";Et.KEYNAME_INSERTCHAR="InsChr";Et.KEYNAME_INSERTLINE="LnsLn";Et.KEYNAME_LEFTARROW="Left";Et.KEYNAME_MENU="Menu";Et.KEYNAME_MODESWITCH="ModeSw";Et.KEYNAME_NEXT="Next";Et.KEYNAME_PAGEDOWN="PgDn";Et.KEYNAME_PAGEUP="PgUp";Et.KEYNAME_PAUSE="Pause";Et.KEYNAME_PREV="Prev";Et.KEYNAME_PRINT="Print";Et.KEYNAME_PRINTSCREEN="PrntScrn";Et.KEYNAME_REDO="Redo";Et.KEYNAME_RESET="Reset";Et.KEYNAME_RIGHTARROW="Right";Et.KEYNAME_SCROLLLOCK="ScrlLck";Et.KEYNAME_SELECT="Select";Et.KEYNAME_STOP="Stop";Et.KEYNAME_SYSREQ="SysReq";Et.KEYNAME_SYSTEM="Sys";Et.KEYNAME_UNDO="Undo";Et.KEYNAME_UPARROW="Up";Et.KEYNAME_USER="User";Et.L=76;Et.LAST=16777233;Et.LEFT=37;Et.LEFTBRACKET=219;Et.LIVE=16777232;Et.M=77;Et.MASTER_SHELL=16777246;Et.MENU=16777234;Et.MINUS=189;Et.N=78;Et.NEXT=16777230;Et.NUMBER_0=48;Et.NUMBER_1=49;Et.NUMBER_2=50;Et.NUMBER_3=51;Et.NUMBER_4=52;Et.NUMBER_5=53;Et.NUMBER_6=54;Et.NUMBER_7=55;Et.NUMBER_8=56;Et.NUMBER_9=57;Et.NUMPAD=21;Et.NUMPAD_0=96;Et.NUMPAD_1=97;Et.NUMPAD_2=98;Et.NUMPAD_3=99;Et.NUMPAD_4=100;Et.NUMPAD_5=101;Et.NUMPAD_6=102;Et.NUMPAD_7=103;Et.NUMPAD_8=104;Et.NUMPAD_9=105;Et.NUMPAD_ADD=107;Et.NUMPAD_DECIMAL=110;Et.NUMPAD_DIVIDE=111;Et.NUMPAD_ENTER=108;Et.NUMPAD_MULTIPLY=106;Et.NUMPAD_SUBTRACT=109;Et.O=79;Et.P=80;Et.PAGE_DOWN=34;Et.PAGE_UP=33;Et.PAUSE=16777224;Et.PERIOD=190;Et.PLAY=16777223;Et.PREVIOUS=16777231;Et.Q=81;Et.QUOTE=222;Et.R=82;Et.RECORD=16777222;Et.RED=16777216;Et.REWIND=16777227;Et.RIGHT=39;Et.RIGHTBRACKET=221;Et.S=83;Et.SEARCH=16777247;Et.SEMICOLON=186;Et.SETUP=16777244;Et.SHIFT=16;Et.SKIP_BACKWARD=16777229;Et.SKIP_FORWARD=16777228;Et.SLASH=191;Et.SPACE=32;Et.STOP=16777225;Et.SUBTITLE=16777240;Et.T=84;Et.TAB=9;Et.U=85;Et.UP=38;Et.V=86;Et.VOD=16777242;Et.W=87;Et.X=88;Et.Y=89;Et.YELLOW=16777218;Et.Z=90;var Mt=function(){function t(t){if(t===void 0){t=0}this._maxLength=-1;this.bytePosition=0;this.byteLength=-1;this._ensureSpace(t)}Object.defineProperty(t.prototype,"arrayBuffer",{get:function(){return this._arrayBuffer},set:function(t){this.bytePosition=0;this.byteLength=-1;this._maxLength=-1;this._ensureSpace(t.byteLength);this._int32Array.set(new Int32Array(t))},enumerable:true,configurable:true});t.prototype.readByte32Array=function(t,e){if(e===void 0){e=-1}if(e==-1)e=t.byteLength-t.bytePosition;t.writeInt32Array(this._int32Array.subarray(this.bytePosition/4,(this.bytePosition+e)/4));this.bytePosition+=e};t.prototype.writeByte32Array=function(t){t.bytePosition=0;t.readByte32Array(this,t.byteLength)};t.prototype.writeFloat32Array=function(t){this._ensureSpace(this.bytePosition+t.length*4);this._float32Array.set(t,this.bytePosition/4);this.bytePosition+=t.length*4};t.prototype.writeInt32Array=function(t){this._ensureSpace(this.bytePosition+t.length*4);this._uint32Array.set(t,this.bytePosition/4);this.bytePosition+=t.length*4};t.prototype.writeUint32Array=function(t){this._ensureSpace(this.bytePosition+t.length*4);this._uint32Array.set(t,this.bytePosition/4);this.bytePosition+=t.length*4};t.prototype.readFloat32Array=function(t){t.set(this._float32Array.subarray(this.bytePosition/4,this.bytePosition/4+t.length))};t.prototype.readInt32Array=function(t){t.set(this._int32Array.subarray(this.bytePosition/4,this.bytePosition/4+t.length))};t.prototype.readUint32Array=function(t){t.set(this._uint32Array.subarray(this.bytePosition/4,this.bytePosition/4+t.length))};t.prototype.getBytesAvailable=function(){return this.byteLength-this.bytePosition};t.prototype.readUTFBytes=function(t){var e="";var i=this.bytePosition+t;var r=new DataView(this._arrayBuffer);while(this.bytePosition<i){var n=r.getUint8(this.bytePosition++);if(n<128){if(n==0)break;e+=String.fromCharCode(n)}else if(n<224){e+=String.fromCharCode((n&63)<<6|r.getUint8(this.bytePosition++)&127)}else if(n<240){var s=r.getUint8(this.bytePosition++);e+=String.fromCharCode((n&31)<<12|(s&127)<<6|r.getUint8(this.bytePosition++)&127)}else{var s=r.getUint8(this.bytePosition++);var a=r.getUint8(this.bytePosition++);e+=String.fromCharCode((n&15)<<18|(s&127)<<12|a<<6&127|r.getUint8(this.bytePosition++)&127)}}return e};t.prototype.writeUTFBytes=function(t){var e=encodeURIComponent(t);var i=e.replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode(parseInt("0x"+e))});if(i.length%4){var r=4-i.length%4;for(var n=0;n<r;n++)i+=" "}this._ensureSpace(this.bytePosition+4+i.length);this.writeInt(i.length);for(var n=0;n<i.length;n+=4)this.writeUnsignedInt(i.charCodeAt(n+3)<<24|i.charCodeAt(n+2)<<16|i.charCodeAt(n+1)<<8|i.charCodeAt(n));return i.length};t.prototype.readInt=function(){if(this.bytePosition>this.byteLength+4)throw"ByteArray out of bounds read. Position="+this.bytePosition+", Length="+this.byteLength;var t=this.bytePosition>>2;this.bytePosition+=4;return this._int32Array[t]};t.prototype.writeUnsignedInt=function(t){this._ensureSpace(this.bytePosition+4);this._uint32Array[this.bytePosition>>2]=~~t&4294967295;this.bytePosition+=4};t.prototype.writeInt=function(t){this._ensureSpace(this.bytePosition+4);this._int32Array[this.bytePosition>>2]=~~t;this.bytePosition+=4};t.prototype.readUnsignedInt=function(){if(this.bytePosition>this.byteLength+4)throw"ByteArray out of bounds read. Position="+this.bytePosition+", Length="+this.byteLength;var t=this.bytePosition>>2;this.bytePosition+=4;return this._uint32Array[t]};t.prototype.writeFloat=function(t){this._ensureSpace(this.bytePosition+4);this._float32Array[this.bytePosition>>2]=t;this.bytePosition+=4};t.prototype.readFloat=function(){if(this.bytePosition>this.byteLength+4)throw"ByteArray out of bounds read. Positon="+this.bytePosition+", Length="+this.byteLength;var t=this.bytePosition>>2;this.bytePosition+=4;return this._float32Array[t]};t.prototype._ensureSpace=function(t){if(this.byteLength<t){this.byteLength=t;if(this._maxLength<t){this._maxLength=Math.max(t+255&~255,4);var e=new ArrayBuffer(this._maxLength);var i=new Int32Array(e);if(this._int32Array)i.set(this._int32Array);this._uint32Array=new Uint32Array(e);this._float32Array=new Float32Array(e);this._int32Array=i;this._arrayBuffer=e}}};return t}();var Ot=function(t){e(i,t);function i(){var e=t.call(this)||this;e._bytes=[];e._mode="Array";return e}i.prototype.writeByte=function(t){var e=~~t;this._bytes[this.position++]=e;if(this.position>this.length){this.length=this.position}};i.prototype.readByte=function(){if(this.position>=this.length){throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length}return this._bytes[this.position++]};i.prototype.writeUnsignedByte=function(t){var e=~~t;this._bytes[this.position++]=e&255;if(this.position>this.length){this.length=this.position}};i.prototype.readUnsignedByte=function(){if(this.position>=this.length){throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length}return this._bytes[this.position++]};i.prototype.writeUnsignedShort=function(t){var e=~~t;this._bytes[this.position++]=e&255;this._bytes[this.position++]=e>>8&255;if(this.position>this.length){this.length=this.position}};i.prototype.readUnsignedShort=function(){if(this.position+2>this.length)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;var t=this._bytes[this.position]|this._bytes[this.position+1]<<8;this.position+=2;return t};i.prototype.writeUnsignedInt=function(t){var e=~~t;this._bytes[this.position++]=e&255;this._bytes[this.position++]=e>>>8&255;this._bytes[this.position++]=e>>>16&255;this._bytes[this.position++]=e>>>24&255;if(this.position>this.length){this.length=this.position}};i.prototype.readUnsignedInt=function(){if(this.position+4>this.length){throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length}var t=this._bytes[this.position]|this._bytes[this.position+1]<<8|this._bytes[this.position+2]<<16|this._bytes[this.position+3]<<24;this.position+=4;return t>>>0};i.prototype.writeFloat=function(t){this.writeUnsignedInt(this.toFloatBits(Number(t)))};i.prototype.toFloatBits=function(t){if(t==0){return 0}var e=0;if(t<0){t=-t;e=1}else{e=0}var i=Math.log(t)/Math.log(2);i=Math.floor(i);t=t*Math.pow(2,23-i);var r=Math.floor(t)-8388608;i=i+127;return e<<31>>>0|i<<23|r};i.prototype.readFloat=function(t){return this.fromFloatBits(this.readUnsignedInt())};i.prototype.fromFloatBits=function(t){if(t==0){return 0}var e=t>>>23&255;var i=t&8388607|8388608;var r=Math.pow(2,e-127-23)*i;if(t>>>31!=0){r=-r}return r};return i}(gt);var It=function(){function t(){}t.setElementSize=function(t,e,i){if(!t)return;t.style.width=e+"px";t.style.height=i+"px";t["width"]=e;t["height"]=i};t.setElementWidth=function(t,e){if(!t)return;t.style.width=e+"px";t["width"]=e};t.setElementHeight=function(t,e){if(!t)return;t.style.height=e+"px";t["height"]=e};t.setElementX=function(t,e){if(!t)return;t.style.position="absolute";t.style.left=e+"px"};t.setElementY=function(t,e){if(!t)return;t.style.position="absolute";t.style.top=e+"px"};t.getElementVisibility=function(t){if(!t)return false;return t.style.visibility=="visible"};t.setElementVisibility=function(t,e){if(!t)return;if(e){t.style.visibility="visible"}else{t.style.visibility="hidden"}};t.setElementAlpha=function(t,e){if(t instanceof HTMLCanvasElement){var i=t.getContext("2d");i.globalAlpha=e}};t.setElementPosition=function(t,e,i,r){if(r===void 0){r=false}if(!t)return;if(r){t.style.position="absolute"}else{t.style.position="relative"}t.style.left=e+"px";t.style.top=i+"px"};return t}();var Rt=function(){function t(){}t.breakpoint=function(){t["break"]()};t.throwPIROnKeyWordOnly=function(e,i){if(i===void 0){i=true}if(!i)t.keyword=null;else t.keyword=e};t.throwPIR=function(e,i,r){t.logPIR("PartialImplementationError "+e,i,r);if(t.THROW_ERRORS){if(t.keyword){var n=e+i+r;if(n.indexOf(t.keyword)==-1)return}throw new L(e+"."+i+": "+r)}};t.logPIR=function(e,i,r){if(r===void 0){r=""}if(t.LOG_PI_ERRORS)console.log(e+"."+i+": "+r)};t.log=function(){var e=[];for(var i=0;i<arguments.length;i++){e[i]=arguments[i]}if(t.ENABLE_LOG)console.log(e)};return t}();Rt.THROW_ERRORS=true;Rt.ENABLE_LOG=true;Rt.LOG_PI_ERRORS=true;Rt.keyword=null;var Lt=function(){function t(){}return t}();Lt.SIMD=Boolean(typeof SIMD!=="undefined");var Nt=function(){function t(t,e){var i=this;this._active=false;this._argsArray=new Array;this._getTimer=xt;this.setCallback(t,e);this._rafUpdateFunction=function(){if(i._active)i._tick()};this._argsArray.push(this._dt)}t.prototype.setCallback=function(t,e){this._callback=t;this._callbackContext=e};t.prototype.start=function(){this._prevTime=this._getTimer();this._active=true;if(window){if(window.requestAnimationFrame){window.requestAnimationFrame(this._rafUpdateFunction)}else{if(window["mozRequestAnimationFrame"])window.requestAnimationFrame=window["mozRequestAnimationFrame"];else if(window["webkitRequestAnimationFrame"])window.requestAnimationFrame=window["webkitRequestAnimationFrame"];else if(window["oRequestAnimationFrame"])window.requestAnimationFrame=window["oRequestAnimationFrame"]}}};t.prototype.stop=function(){this._active=false};Object.defineProperty(t.prototype,"active",{get:function(){return this._active},enumerable:true,configurable:true});t.prototype._tick=function(){this._currentTime=this._getTimer();this._dt=this._currentTime-this._prevTime;this._argsArray[0]=this._dt;this._callback.apply(this._callbackContext,this._argsArray);window.requestAnimationFrame(this._rafUpdateFunction);this._prevTime=this._currentTime};return t}();var Ft=function(){function t(){}t.getChildrenWithTag=function(t,e){var i=document.createDocumentFragment();if(t){var r=t.childNodes.length;for(var n=0;n<r;n++){var s=t.childNodes[n];if(s!=null){if(s.nodeName==e){i.appendChild(s)}}}}return i.childNodes};t.filterListByParam=function(t,e,i){var r=document.createDocumentFragment();if(t){var n=t.length;for(var s=0;s<n;s++){var a=t[s];if(a!=null){if(a.attributes.getNamedItem(e).value==i){r.appendChild(a)}}}}return r.childNodes};t.strToXml=function(t){var e=new DOMParser;var i=e.parseFromString(t,"text/xml");return i};t.nodeToString=function(t){if(!t)return"";var e=(new XMLSerializer).serializeToString(t);return e};t.readAttributeValue=function(t,e){var i=t.attributes;if(i==undefined){return""}var r=i.getNamedItem(e);if(!r){return""}return r.value};t.writeAttributeValue=function(t,e,i){var r=document.createAttribute(e);r.value=i;r=t.attributes.setNamedItem(r);console.log("XmlUltils - writeAttributeValue() - name: "+r.name+", value: "+r.value)};t.hasAttribute=function(t,e){var i=t.attributes;if(i==undefined){return false}var r=i.getNamedItem(e);return r!=null};return t}();var Bt=function(){function t(){}return t}();var Vt=function(t){e(i,t);function i(){return t.call(this)||this}Object.defineProperty(i.prototype,"stateClass",{get:function(){return this._pStateClass},enumerable:true,configurable:true});i.prototype.dispose=function(){};Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});return i}(h);Vt.assetType="[asset AnimationNodeBase]";var Ut=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._renderable=i;return r}Object.defineProperty(i.prototype,"renderable",{get:function(){return this._renderable},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._renderable)};return i}(n);Ut.INVALIDATE_MATERIAL="invalidateMaterial";Ut.INVALIDATE_ELEMENTS="invalidateElements";var kt=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._style=i;return r}Object.defineProperty(i.prototype,"style",{get:function(){return this._style},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._style)};return i}(n);kt.INVALIDATE_PROPERTIES="invalidateProperties";var zt=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._shape=i;return r}Object.defineProperty(i.prototype,"shape",{get:function(){return this._shape},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._shape)};return i}(n);zt.ADD_MATERIAL="addMaterial";zt.REMOVE_MATERIAL="removeMaterial";var jt=function(t){e(i,t);function i(e,i,r,n,s){if(i===void 0){i=null}if(r===void 0){r=null}if(n===void 0){n=0}if(s===void 0){s=0}var a=t.call(this)||this;a._boxBoundsInvalid=true;a._sphereBoundsInvalid=true;a._onInvalidatePropertiesDelegate=function(t){return a._onInvalidateProperties(t)};a._onInvalidateVerticesDelegate=function(t){return a._onInvalidateVertices(t)};a._elements=e;a._material=i;a._style=r;if(a._style)a._style.addEventListener(kt.INVALIDATE_PROPERTIES,a._onInvalidatePropertiesDelegate);a.count=n;a.offset=s;return a}i.getShape=function(t,e,r,n,s){if(e===void 0){e=null}if(r===void 0){r=null}if(n===void 0){n=0}if(s===void 0){s=0}if(i._pool.length){var a=i._pool.pop();a.elements=t;a.material=e;a.style=r;a.count=n;a.offset=s;return a}return new i(t,e,r,n,s)};i.storeShape=function(t){t.elements=null;t.material=null;t.style=null;t.clear();i._pool.push(t)};Object.defineProperty(i.prototype,"elements",{get:function(){return this._elements},set:function(t){if(this._elements==t)return;this._elements=t;this.invalidateElements()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"material",{get:function(){return this._material},set:function(t){if(this._material==t)return;if(this._material)this.dispatchEvent(new zt(zt.REMOVE_MATERIAL,this));this._material=t;if(this._material)this.dispatchEvent(new zt(zt.ADD_MATERIAL,this));this.invalidateMaterial()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"style",{get:function(){return this._style},set:function(t){if(this._style==t)return;if(this._style)this._style.removeEventListener(kt.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate);this._style=t;if(this._style)this._style.addEventListener(kt.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate);this.invalidateMaterial()},enumerable:true,configurable:true});i.prototype.dispose=function(){t.prototype.dispose.call(this)};i.prototype.invalidate=function(){t.prototype.invalidate.call(this);this._boxBoundsInvalid=true;this._sphereBoundsInvalid=true};i.prototype.invalidateElements=function(){this.dispatchEvent(new Ut(Ut.INVALIDATE_ELEMENTS,this));this._boxBoundsInvalid=true;this._sphereBoundsInvalid=true};i.prototype.invalidateMaterial=function(){this.dispatchEvent(new Ut(Ut.INVALIDATE_MATERIAL,this))};i.prototype._onInvalidateProperties=function(t){this.invalidateMaterial()};i.prototype._onInvalidateVertices=function(t){if(t.attributesView!=t.target.positions)return;this.invalidate();this.dispatchEvent(t)};i.prototype.applyTransformation=function(t){this._elements.applyTransformation(t,this.count,this.offset)};i.prototype.hitTestPoint=function(t,e,i){var r;if(!(r=this.getBoxBounds()).contains(t,e,i))return false;return this._elements.hitTestPoint(t,e,i,r,this.count,this.offset)};i.prototype.scale=function(t){this._elements.scale(t,this.count,this.offset)};i.prototype.scaleUV=function(t,e){if(t===void 0){t=1}if(e===void 0){e=1}this._elements.scaleUV(t,e,this.count,this.offset)};i.prototype.getBoxBounds=function(){if(this._boxBoundsInvalid){this._boxBoundsInvalid=false;this._boxBounds=this._elements.getBoxBounds(this._boxBounds||(this._boxBounds=new T),this.count,this.offset)}return this._boxBounds};i.prototype.getSphereBounds=function(t,e){if(e===void 0){e=null}return this._elements.getSphereBounds(t,e,this.count,this.offset)};return i}(h);jt._pool=new Array;jt.assetType="[asset Shape]";var Gt=function(t){e(i,t);function i(){var e=t.call(this)||this;e._samplers=new Object;e._images=new Object;e._color=16777215;return e}Object.defineProperty(i.prototype,"sampler",{get:function(){return this._sampler},set:function(t){if(this._sampler==t)return;this._sampler=t;this._invalidateProperties()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"image",{get:function(){return this._image},set:function(t){if(this._image==t)return;this._image=t;this._invalidateProperties()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"uvMatrix",{get:function(){return this._uvMatrix},set:function(t){if(this._uvMatrix==t)return;this._uvMatrix=t;this._invalidateProperties()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){if(this._color==t)return;this._color=t;this._invalidateProperties()},enumerable:true,configurable:true});i.prototype.getImageAt=function(t,e){if(e===void 0){e=0}return(this._images[t.id]?this._images[t.id][e]:null)||this._image};i.prototype.getSamplerAt=function(t,e){if(e===void 0){e=0}return(this._samplers[t.id]?this._samplers[t.id][e]:null)||this._sampler};i.prototype.addImageAt=function(t,e,i){if(i===void 0){i=0}if(!this._images[e.id])this._images[e.id]=new Array;this._images[e.id][i]=t};i.prototype.addSamplerAt=function(t,e,i){if(i===void 0){i=0}if(!this._samplers[e.id])this._samplers[e.id]=new Array;this._samplers[e.id][i]=t;this._invalidateProperties()};i.prototype.removeImageAt=function(t,e){if(e===void 0){e=0}if(!this._images[t.id])return;this._images[t.id][e]=null;this._invalidateProperties()};i.prototype.removeSamplerAt=function(t,e){if(e===void 0){e=0}if(!this._samplers[t.id])return;this._samplers[t.id][e]=null;this._invalidateProperties()};i.prototype._invalidateProperties=function(){this.dispatchEvent(new kt(kt.INVALIDATE_PROPERTIES,this))};return i}(a);var Ht=function(t){e(i,t);function i(){var e=t.call(this)||this;var r;for(r=0;r<i.entityNames.length;r++)if(!e[i.entityNames[r]])e[i.entityNames[r]]=e.applyEntity;for(r=0;r<i.renderableNames.length;r++)if(!e[i.renderableNames[r]])e[i.renderableNames[r]]=e.applyRenderable;return e}i.addEntityName=function(t){i.entityNames.push(t);return t};i.addRenderableName=function(t){i.renderableNames.push(t);return t};i.prototype.enterNode=function(t){return true};i.prototype.dispose=function(){};i.prototype.applyEntity=function(t){};i.prototype.applyRenderable=function(t){};return i}(a);Ht.entityNames=new Array;Ht.renderableNames=new Array;var Xt=function(){function t(){}return t}();Xt.ROUND=1;Xt.NONE=0;Xt.SQUARE=2;var Wt=function(){function t(){}return t}();Wt.BOTH=1;Wt.STROKE=0;Wt.FILL=2;var Yt=function(){function t(){}return t}();Yt.LINEAR="linear";Yt.RADIAL="radial";var qt=function(){function t(){}t.isClockWiseXY=function(t,e,i,r,n,s){var a=(t-i)*(s-r)-(e-r)*(n-i);if(a<0)return false;return true};t.getSign=function(t,e,i,r,n,s){return(t-n)*(r-s)-(e-s)*(i-n)};t.pointInTri=function(e,i,r,n,s,a,o,h){var u=t.getSign(e,i,o,h,r,n)>0;var l=t.getSign(r,n,o,h,s,a)>0;var p=t.getSign(s,a,o,h,e,i)>0;return u==l&&l==p};t.getControlXForCurveX=function(t,e,i){return e};t.getControlYForCurveY=function(t,e,i){return e};t.drawPoint=function(e,i,r){t.addTriangle(e-2,i-2,e+2,i-2,e+2,i+2,0,r);t.addTriangle(e-2,i-2,e-2,i+2,e+2,i+2,0,r)};t.addTriangle=function(t,e,i,r,n,s,a,o){var h=o.length;if(a==0){o[h++]=t;o[h++]=e;o[h++]=4.5736980577097704e-41;o[h++]=i;o[h++]=r;o[h++]=4.5736980577097704e-41;o[h++]=n;o[h++]=s;o[h++]=4.5736980577097704e-41}else if(a<0){o[h++]=t;o[h++]=e;o[h++]=1.1708844992641982e-38;o[h++]=i;o[h++]=r;o[h++]=2.2778106537599901e-41;o[h++]=n;o[h++]=s;o[h++]=1.7796490496925177e-43}else if(a>0){o[h++]=t;o[h++]=e;o[h++]=1.1708846393940446e-38;o[h++]=i;o[h++]=r;o[h++]=2.2779507836064226e-41;o[h++]=n;o[h++]=s;o[h++]=1.793662034335766e-43}};t.createCap=function(e,i,r,n,s,a,o,h,u){if(a==Xt.ROUND){var l=e+o*(s.x*h);var p=i+o*(s.y*h);l=l*2-r.x/2-n.x/2;p=p*2-r.y/2-n.y/2;t.addTriangle(r.x,r.y,l,p,n.x,n.y,-1,u)}else if(a==Xt.SQUARE){var l=r.x+o*(s.x*h);var p=r.y+o*(s.y*h);var c=n.x+o*(s.x*h);var _=n.y+o*(s.y*h);t.addTriangle(c,_,l,p,r.x,r.y,0,u);t.addTriangle(c,_,r.x,r.y,n.x,n.y,0,u)}};t.getLineFormularData=function(t,e){var i=e.x-t.x;var r=e.y-t.y;var n=new z;if(i!=0&&r!=0)n.x=r/i;n.y=-(n.x*t.x-t.y);return n};t.getQuadricBezierPosition=function(t,e,i,r){var n=1-t;return n*n*e+2*n*t*i+t*t*r};t.subdivideCurve=function(e,i,r,n,s,a,o,h,u,l,p,c,_,f){var d=Math.atan2(n-i,r-e)*P.RADIANS_TO_DEGREES;var g=Math.atan2(a-n,s-r)*P.RADIANS_TO_DEGREES;var m=g-d;if(m>180){m-=360}if(m<-180){m+=360}if(Math.abs(m)>=150){_.push(e,i,r,n,s,a);f.push(o,h,u,l,p,c);return}var y=false;var v=false;if(m<0){y=t.getSign(e,i,u,l,s,a)>0;v=t.getSign(e,i,r,n,s,a)>0;y=((i-a)*(r-e)+(s-e)*(n-i))*((i-a)*(u-e)+(s-e)*(l-i))<0}else{y=t.getSign(o,h,u,l,p,c)>0;v=t.getSign(o,h,r,n,p,c)>0;y=((h-a)*(r-o)+(p-o)*(n-h))*((h-c)*(u-o)+(p-o)*(l-h))<0}if(y){_.push(e,i,r,n,s,a);f.push(o,h,u,l,p,c);return}var x=e+(r-e)*.5;var b=i+(n-i)*.5;var w=r+(s-r)*.5;var D=n+(a-n)*.5;var C=x+(w-x)*.5;var A=b+(D-b)*.5;var T=o+(u-o)*.5;var S=h+(l-h)*.5;var E=u+(p-u)*.5;var M=l+(c-l)*.5;var O=T+(E-T)*.5;var I=S+(M-S)*.5;t.subdivideCurve(e,i,x,b,C,A,o,h,T,S,O,I,_,f);t.subdivideCurve(C,A,w,D,s,a,O,I,E,M,p,c,_,f)};return t}();var Kt=function(){function t(){this.cells=new Array;this.lastCollisionIndex=-1}return t}();var Zt=function(){function t(){}t.generateFaceNormals=function(t,e,i,r,n){if(n===void 0){n=0}var s=t.get(r,n);var a=e.get(e.count);if(i==null)i=new g(r+n);else if(i.count<r+n)i.count=r+n;var o=t.stride;var h=e.dimensions;var u=e.stride;var l=i.get(r,n);var p=r*o;var c=0;var _=0;var f;var d,m,y;var v,x,b;var w,D,C;var A,T,P;var S,E,M;var O,I,R;var L;if(h==3){for(c=0;c<p;c+=o){f=s[c]*u;d=a[f];v=a[f+1];w=a[f+2];f=s[c+1]*u;m=a[f];x=a[f+1];D=a[f+2];f=s[c+2]*u;y=a[f];b=a[f+1];C=a[f+2];A=y-d;T=b-v;P=C-w;S=m-d;E=x-v;M=D-w;O=P*E-T*M;I=A*M-P*S;R=T*S-A*E;L=Math.sqrt(O*O+I*I+R*R);l[_++]=O;l[_++]=I;l[_++]=R;l[_++]=L}}else if(h==2){for(c=0;c<p;c+=o){l[_++]=0;l[_++]=0;l[_++]=1;l[_++]=1}}return i};t.generateNormals=function(t,e,i,r){var n=t.get(t.count);var s=e.get(e.count);if(i==null)i=new d(r);var a=t.dimensions;var o=i.stride;var h=i.get(i.count);var u;var l=i.count*o;for(u=0;u<l;u+=o){h[u]=0;h[u+1]=0;h[u+2]=0}l=t.count*a;var p;var c=0;var _=1;var f=2;for(u=0;u<l;u+=a){p=n[u]*o;h[p]+=s[c];h[p+1]+=s[_];h[p+2]+=s[f];p=n[u+1]*o;h[p]+=s[c];h[p+1]+=s[_];h[p+2]+=s[f];p=n[u+2]*o;h[p]+=s[c];h[p+1]+=s[_];h[p+2]+=s[f];c+=4;_+=4;f+=4}l=i.count*o;var g;var m;var y;var v;for(u=0;u<l;u+=o){g=h[u];m=h[u+1];y=h[u+2];v=1/Math.sqrt(g*g+m*m+y*y);h[u]=g*v;h[u+1]=m*v;h[u+2]=y*v}return i};t.generateFaceTangents=function(t,e,i,r,n,s,a){if(s===void 0){s=0}if(a===void 0){a=false}var o=t.get(n,s);var h=e.get(e.count);var u=i.get(i.count);if(r==null)r=new g(n+s);else if(r.count<n+s)r.count=n+s;var l=t.dimensions;var p=e.dimensions;var c=e.stride;var _=i.stride;var f=r.get(n,s);var d=0;var m;var y;var v;var x;var b;var w;var D;var C;var A;var T,P,S;var E,M,O;var I,R,L;var N,F,B;var V=n*l;for(d=0;d<V;d+=l){m=o[d];y=o[d+1];v=o[d+2];x=u[m*_+1];D=u[y*_+1]-x;C=u[v*_+1]-x;x=m*c;b=y*c;w=v*c;T=h[x];E=h[b]-T;I=h[w]-T;N=C*E-D*I;P=h[x+1];M=h[b+1]-P;R=h[w+1]-P;F=C*M-D*R;if(p==3){S=h[x+2];O=h[b+2]-S;L=h[w+2]-S;B=C*O-D*L}else{B=0}A=1/Math.sqrt(N*N+F*F+B*B);f[d]=A*N;f[d+1]=A*F;f[d+2]=A*B}return r};t.generateTangents=function(t,e,i,r,n){var s=t.get(t.count);var a=e.get(e.count);var o=i.get(i.count);if(r==null)r=new d(n);var h=t.dimensions;var u=r.stride;var l=r.get(r.count);var p;var c=r.count*u;for(p=0;p<c;p+=u){l[p]=0;l[p+1]=0;l[p+2]=0}var _;var f;var g=0;var m=1;var y=2;var v=3;c=t.count*h;for(p=0;p<c;p+=h){_=o[v];f=s[p]*u;l[f++]+=a[g]*_;l[f++]+=a[m]*_;l[f]+=a[y]*_;f=s[p+1]*u;l[f++]+=a[g]*_;l[f++]+=a[m]*_;l[f]+=a[y]*_;f=s[p+2]*u;l[f++]+=a[g]*_;l[f++]+=a[m]*_;l[f]+=a[y]*_;g+=3;m+=3;y+=3;v+=4}var x;var b;var w;var D;for(p=0;p<c;p+=u){x=l[p];b=l[p+1];w=l[p+2];D=1/Math.sqrt(x*x+b*b+w*w);l[p]=x*D;l[p+1]=b*D;l[p+2]=w*D}return r};t.generateColors=function(t,e,i,r,n){if(n===void 0){n=0}if(e==null)e=new c(i);if(e.count<r+n)e.count=r+n;var s=e.get(r,n);var a=e.stride;var o=e.count*a;for(var h=0;h<o;h+=a){s[h]=255;s[h+1]=255;s[h+2]=255;s[h+3]=255}return e};t.scale=function(t,e,i,r,n,s){if(s===void 0){s=0}if(r.count<n+s)r.count=n+s;var a=new Float32Array([t,e,i]);var o=r.get(n,s);var h=r.stride;var u=r.dimensions;var l;var p;var c=n*h;for(l=0;l<c;l+=h)for(p=0;p<u;p++)o[l+p]*=a[p];r.invalidate()};t.applyTransformation=function(t,e,i,r,n,s){if(s===void 0){s=0}var a=e.get(n,s);var o=e.stride;var h;var u;if(i){h=i.get(n,s);u=i.stride}var l;var p;if(r){l=r.get(n,s);p=r.stride}var c;var _;var f;var d=new A;var g;if(i||r){g=t.clone();g.invert();g.transpose()}var m=0;var y=0;var v=0;for(c=0;c<n;++c){_=m+1;f=m+2;d.x=a[m];d.y=a[_];d.z=a[f];d=t.transformVector(d);a[m]=d.x;a[_]=d.y;a[f]=d.z;m+=o;if(h){_=y+1;f=y+2;d.x=h[y];d.y=h[_];d.z=h[f];d=g.deltaTransformVector(d);d.normalize();h[y]=d.x;h[_]=d.y;h[f]=d.z;y+=u}if(l){_=v+1;f=v+2;d.x=l[v];d.y=l[_];d.z=l[f];d=g.deltaTransformVector(d);d.normalize();l[v]=d.x;l[_]=d.y;l[f]=d.z;v+=p}}e.invalidate();if(i)i.invalidate();if(r)r.invalidate()};t.getSubIndices=function(e,i,r,n){if(n===void 0){n=0}var s=e.attributesBuffer;var a=e.length;r.length=0;if(a<t.LIMIT_INDICES&&i<t.LIMIT_VERTS)return s;var o;var h=e.get(e.count,n);var l=new Array;var p=t._indexSwap;p.length=a;for(o=0;o<a;o++)p[o]=-1;var c;var _;var f=0;var d=n*e.dimensions;o=0;while(o<a+d&&o+1<t.LIMIT_INDICES&&f+1<t.LIMIT_VERTS){c=h[o];if(p[c]>=0){_=p[c]}else{_=f++;p[c]=_;r[_]=c}l[o++]=_}s=new u(e.size*e.dimensions,l.length/e.dimensions);e=e.clone(s);e.set(l);return s};t.getSubVertices=function(t,e){if(!e.length)return t;var i=t.stride;var r=t.bufferView;var n=new Uint8Array(e.length*i);var s;var a;var o=0;var h=0;var l=e.length;for(o=0;o<l;o++){s=o*i;a=e[o]*i;for(h=0;h<i;h++)n[s+h]=r[a+h]}t=new u(i,l);t.bufferView=n;return t};t.hitTestTriangleElements=function(t,e,i,r,n,s,a){if(a===void 0){a=0}var o=n.positions;var h=n.getCustomAtributes("curves");var u=o.stride;var l=h?h.stride:null;var p=o.get(s,a);var c=h?h.get(s,a):null;var _;var f;if(n.indices){_=n.indices.get(s,a);p=o.get(o.count);c=h?h.get(h.count):null;f=s*n.indices.dimensions}else{p=o.get(s,a);c=h?h.get(s,a):null;f=s}var d;var g;var m;var y;var v;var x;var b;var w;var D;var C=n.hitTestCache[a]||(n.hitTestCache[a]=new Kt);var A=C.lastCollisionIndex;if(A!=-1&&A<f){t:{if(_){d=_[A+2];g=_[A+1];m=_[A]}else{d=A+2;g=A+1;m=A}y=p[d*u];v=p[d*u+1];x=p[g*u];b=p[g*u+1];w=p[m*u];D=p[m*u+1];var T=y-t;var P=v-e;var S=b-v;var E=-(x-y);var M=T*S+P*E;if(M>0)break t;T=x-t;P=b-e;S=D-b;E=-(w-x);M=T*S+P*E;if(M>0)break t;T=w-t;P=D-e;S=v-D;E=-(y-w);M=T*S+P*E;if(M>0)break t;if(c){if(c[d*l+2]!=-128){var O=x-y;var I=b-v;var R=w-y;var L=D-v;var N=t-y;var F=e-v;var B=O*L-R*I;var V=(N*L-R*F)/B;var U=(O*F-N*I)/B;var k=.5*V+U;var z=U;var j=k*k-z;var G=c[d*l];if(j>0&&G==-128){break t}else if(j<0&&G==127){break t}}}return true}}if(f>150){var H=C.cells;var X=H.length?C.divisions:C.divisions=Math.min(Math.ceil(Math.sqrt(f)),32);var W=X/r.width;var Y=X/r.height;var q=r.x;var K=r.y;if(!H.length){H.length=X*X;for(var Z=0;Z<f;Z+=3){if(_){d=_[Z+2];g=_[Z+1];m=_[Z]}else{d=Z+2;g=Z+1;m=Z+0}y=p[d*u];v=p[d*u+1];x=p[g*u];b=p[g*u+1];w=p[m*u];D=p[m*u+1];var Q=Math.floor((Math.min(y,x,w)-q)*W);var J=Math.floor((Math.min(v,b,D)-K)*Y);var $=Math.floor((Math.max(y,x,w)-q)*W);var tt=Math.floor((Math.max(v,b,D)-K)*Y);for(var et=Q;et<=$;et++){for(var it=J;it<=tt;it++){var A=et+it*X;var rt=H[A]||(H[A]=new Array);rt.push(d,g,m)}}}}var nt=Math.floor((t-q)*W);var st=Math.floor((e-K)*Y);if(nt<0||nt>X||st<0||st>X)return false;

var rt=H[nt+st*X];if(rt==null)return false;var at=rt.length;for(var Z=0;Z<at;Z+=3){m=rt[Z+2];if(m==A)continue;g=rt[Z+1];d=rt[Z];y=p[d*u];v=p[d*u+1];x=p[g*u];b=p[g*u+1];w=p[m*u];D=p[m*u+1];var T=y-t;var P=v-e;var S=b-v;var E=-(x-y);var M=T*S+P*E;if(M>0)continue;T=x-t;P=b-e;S=D-b;E=-(w-x);M=T*S+P*E;if(M>0)continue;T=w-t;P=D-e;S=v-D;E=-(y-w);M=T*S+P*E;if(M>0)continue;if(c){if(c[d*l+2]!=-128){var O=x-y;var I=b-v;var R=w-y;var L=D-v;var N=t-y;var F=e-v;var B=O*L-R*I;var V=(N*L-R*F)/B;var U=(O*F-N*I)/B;var k=.5*V+U;var z=U;var j=k*k-z;var G=c[d*l];if(j>0&&G==-128)continue;else if(j<0&&G==127)continue}}C.lastCollisionIndex=m;return true}C.lastCollisionIndex=-1;return false}for(var Z=0;Z<f;Z+=3){if(_){m=_[Z]}else{m=Z}if(m==A)continue;if(_){d=_[Z+2];g=_[Z+1]}else{d=Z+2;g=Z+1}y=p[d*u];v=p[d*u+1];x=p[g*u];b=p[g*u+1];w=p[m*u];D=p[m*u+1];var T=y-t;var P=v-e;var S=b-v;var E=-(x-y);var M=T*S+P*E;if(M>0)continue;T=x-t;P=b-e;S=D-b;E=-(w-x);M=T*S+P*E;if(M>0)continue;T=w-t;P=D-e;S=v-D;E=-(y-w);M=T*S+P*E;if(M>0)continue;if(c){if(c[d*l+2]!=-128){var O=x-y;var I=b-v;var R=w-y;var L=D-v;var N=t-y;var F=e-v;var B=O*L-R*I;var V=(N*L-R*F)/B;var U=(O*F-N*I)/B;var k=.5*V+U;var z=U;var j=k*k-z;var G=c[d*l];if(j>0&&G==-128){continue}else if(j<0&&G==127){continue}}}C.lastCollisionIndex=Z;return true}C.lastCollisionIndex=-1;return false};t.getTriangleGraphicsBoxBounds=function(t,e,i,r,n){if(n===void 0){n=0}var s;var a=t.dimensions;var o=t.stride;var h;var u=0,l=0,p=0;var c=0,_=0,f=0;var d;var g;if(e){g=r*e.dimensions;d=e.get(r,n);s=t.get(t.count)}else{g=r;s=t.get(r,n)}var m;for(var y=0;y<g;y++){m=d?d[y]*o:y*o;if(y==0){c=u=s[m];_=l=s[m+1];f=p=a==3?s[m+2]:0}else{h=s[m];if(h<u)u=h;else if(h>c)c=h;h=s[m+1];if(h<l)l=h;else if(h>_)_=h;if(a==3){h=s[m+2];if(h<p)p=h;else if(h>f)f=h}}}if(i==null)i=new T;i.x=u;i.y=l;i.z=p;i.right=c;i.bottom=_;i.back=f;return i};t.getTriangleGraphicsSphereBounds=function(t,e,i,r,n){if(n===void 0){n=0}var s=t.get(r,n);var a=t.dimensions;var o=t.stride;var h=0;var u;var l=r*o;var p;var c;var _;for(var f=0;f<l;f+=o){p=s[f]-e.x;c=s[f+1]-e.y;_=a==3?s[f+2]-e.z:-e.z;u=p*p+c*c+_*_;if(h<u)h=u}if(i==null)i=new q;i.x=e.x;i.y=e.y;i.z=e.z;i.radius=Math.sqrt(h);return i};return t}();Zt.tempFloat32x4=new Float32Array(4);Zt.LIMIT_VERTS=65535;Zt.LIMIT_INDICES=16777215;Zt._indexSwap=new Array;var Qt=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._attributesView=i;return r}Object.defineProperty(i.prototype,"attributesView",{get:function(){return this._attributesView},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._attributesView)};return i}(n);Qt.INVALIDATE_INDICES="invalidateIndices";Qt.CLEAR_INDICES="clearIndices";Qt.INVALIDATE_VERTICES="invalidateVertices";Qt.CLEAR_VERTICES="clearVertices";var Jt=function(t){e(i,t);function i(e){if(e===void 0){e=null}var i=t.call(this)||this;i._customAttributesNames=new Array;i._customAttributes=new Object;i._numElements=0;i._numVertices=0;i._verticesDirty=new Object;i._invalidateVertices=new Object;i._concatenatedBuffer=e;return i}Object.defineProperty(i.prototype,"traverseName",{get:function(){throw new r},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"concatenatedBuffer",{get:function(){return this._concatenatedBuffer},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"indices",{get:function(){return this._indices},enumerable:true,configurable:true});i.prototype.getCustomAtributesNames=function(){return this._customAttributesNames};i.prototype.getCustomAtributes=function(t){return this._customAttributes[t]};Object.defineProperty(i.prototype,"numElements",{get:function(){return this._numElements},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});i.prototype.copyTo=function(t){if(this.indices)t.setIndices(this.indices.clone());for(var e in this._customAttributes)t.setCustomAttributes(e,this.getCustomAtributes(e).clone())};i.prototype.dispose=function(){t.prototype.dispose.call(this);if(this._indices){this._indices.dispose();this._indices=null}for(var e in this._customAttributes){this._customAttributes[e].dispose();delete this._customAttributes}};i.prototype.setIndices=function(t,e){if(e===void 0){e=0}if(t instanceof y){if(this._indices)this.clearIndices();this._indices=t}else if(t){if(!this._indices)this._indices=new y;this._indices.set(t,e)}else if(this._indices){this._indices.dispose();this._indices=null;this.clearIndices()}if(this._indices){this._numElements=this._indices.count;this.invalidateIndices()}else{this._numElements=0}};i.prototype.setCustomAttributes=function(t,e,i){if(i===void 0){i=0}if(e==this._customAttributes[t])return;if(e instanceof p){this.clearVertices(this._customAttributes[t]);this._customAttributes[t]=e}else if(e){if(!this._customAttributes[t])this._customAttributes[t]=new d(this._concatenatedBuffer);this._customAttributes[t].set(e,i)}else if(this._customAttributes[t]){this.clearVertices(this._customAttributes[t]);this._customAttributesNames.splice(this._customAttributesNames.indexOf(t),1);delete this._customAttributes[t];return}this.invalidateVertices(this._customAttributes[t]);this._verticesDirty[this._customAttributes[t].id]=false;if(this._customAttributesNames.indexOf(t)==-1)this._customAttributesNames.push(t)};i.prototype.clone=function(){throw new r};i.prototype.applyTransformation=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=0}throw new r};i.prototype.scale=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=0}throw new r};i.prototype.scaleUV=function(t,e,i,n){if(t===void 0){t=1}if(e===void 0){e=1}if(i===void 0){i=0}if(n===void 0){n=0}throw new r};i.prototype.getBoxBounds=function(t,e,i){if(t===void 0){t=null}if(e===void 0){e=0}if(i===void 0){i=0}throw new r};i.prototype.getSphereBounds=function(t,e,i,n){if(e===void 0){e=null}if(i===void 0){i=0}if(n===void 0){n=0}throw new r};i.prototype.hitTestPoint=function(t,e,i,n,s,a){if(s===void 0){s=0}if(a===void 0){a=0}throw new r};i.prototype.invalidateIndices=function(){if(!this._invalidateIndices)this._invalidateIndices=new Qt(Qt.INVALIDATE_INDICES,this._indices);this.dispatchEvent(this._invalidateIndices)};i.prototype.clearIndices=function(){this.dispatchEvent(new Qt(Qt.CLEAR_INDICES,this._indices))};i.prototype.invalidateVertices=function(t){if(!t||this._verticesDirty[t.id])return;this._verticesDirty[t.id]=true;if(!this._invalidateVertices[t.id])this._invalidateVertices[t.id]=new Qt(Qt.INVALIDATE_VERTICES,t);this.dispatchEvent(this._invalidateVertices[t.id])};i.prototype.clearVertices=function(t){if(!t)return;t.dispose();this.dispatchEvent(new Qt(Qt.CLEAR_VERTICES,t));this._verticesDirty[t.id]=null;this._invalidateVertices[t.id]=null};return i}(h);var $t=function(t){e(i,t);function i(){var e=t.apply(this,arguments)||this;e._faceNormalsDirty=true;e._faceTangentsDirty=true;e._autoDeriveNormals=true;e._autoDeriveTangents=true;e.hitTestCache=new Object;return e}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"traverseName",{get:function(){return i.traverseName},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"useCondensedIndices",{get:function(){return this._useCondensedIndices},set:function(t){if(this._useCondensedIndices==t)return;this._useCondensedIndices=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"jointsPerVertex",{get:function(){return this._jointsPerVertex},set:function(t){if(this._jointsPerVertex==t)return;this._jointsPerVertex=t;if(this._jointIndices)this._jointIndices.dimensions=this._jointsPerVertex;if(this._jointWeights)this._jointWeights.dimensions=this._jointsPerVertex},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"autoDeriveNormals",{get:function(){return this._autoDeriveNormals},set:function(t){if(this._autoDeriveNormals==t)return;this._autoDeriveNormals=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"autoDeriveTangents",{get:function(){return this._autoDeriveTangents},set:function(t){if(this._autoDeriveTangents==t)return;this._autoDeriveTangents=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"positions",{get:function(){if(!this._positions)this.setPositions(new d(this._concatenatedBuffer));return this._positions},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"normals",{get:function(){if(!this._normals||this._verticesDirty[this._normals.id])this.setNormals(this._normals);return this._normals},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"tangents",{get:function(){if(!this._tangents||this._verticesDirty[this._tangents.id])this.setTangents(this._tangents);return this._tangents},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"faceNormals",{get:function(){if(this._faceNormalsDirty)this.updateFaceNormals();return this._faceNormals},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"faceTangents",{get:function(){if(this._faceTangentsDirty)this.updateFaceTangents();return this._faceTangents},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"uvs",{get:function(){return this._uvs},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"jointIndices",{get:function(){return this._jointIndices},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"jointWeights",{get:function(){return this._jointWeights},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"condensedIndexLookUp",{get:function(){return this._condensedIndexLookUp},enumerable:true,configurable:true});i.prototype.getBoxBounds=function(t,e,i){if(t===void 0){t=null}if(e===void 0){e=0}if(i===void 0){i=0}return Zt.getTriangleGraphicsBoxBounds(this.positions,this.indices,t,e||this._numElements||this._numVertices,i)};i.prototype.getSphereBounds=function(t,e,i,r){if(e===void 0){e=null}if(i===void 0){i=0}if(r===void 0){r=0}return Zt.getTriangleGraphicsSphereBounds(this.positions,t,e,i||this._numVertices,r)};i.prototype.hitTestPoint=function(t,e,i,r,n,s,a,o){if(n===void 0){n=0}if(s===void 0){s=0}if(a===void 0){a=0}if(o===void 0){o=0}return Zt.hitTestTriangleElements(t,e,0,r,this,n||this._numElements||this._numVertices,s)};i.prototype.setPositions=function(t,e){if(e===void 0){e=0}if(t==this._positions)return;if(t instanceof p){this.clearVertices(this._positions);this._positions=t}else if(t){if(!this._positions)this._positions=new d(this._concatenatedBuffer);this._positions.set(t,e)}else{this.clearVertices(this._positions);this._positions=new d(this._concatenatedBuffer)}this._numVertices=this._positions.count;if(this._autoDeriveNormals)this.invalidateVertices(this._normals);if(this._autoDeriveTangents)this.invalidateVertices(this._tangents);this.invalidateVertices(this._positions);this._verticesDirty[this._positions.id]=false};i.prototype.setNormals=function(t,e){if(e===void 0){e=0}if(!this._autoDeriveNormals){if(t==this._normals)return;if(t instanceof d){this.clearVertices(this._normals);this._normals=t}else if(t){if(!this._normals)this._normals=new d(this._concatenatedBuffer);this._normals.set(t,e)}else if(this._normals){this.clearVertices(this._normals);this._normals=null;return}}else{this._normals=Zt.generateNormals(this.indices,this.faceNormals,this._normals,this._concatenatedBuffer)}this.invalidateVertices(this._normals);this._verticesDirty[this._normals.id]=false};i.prototype.setTangents=function(t,e){if(e===void 0){e=0}if(!this._autoDeriveTangents){if(t==this._tangents)return;if(t instanceof d){this.clearVertices(this._tangents);this._tangents=t}else if(t){if(!this._tangents)this._tangents=new d(this._concatenatedBuffer);this._tangents.set(t,e)}else if(this._tangents){this.clearVertices(this._tangents);this._tangents=null;return}}else{this._tangents=Zt.generateTangents(this.indices,this.faceTangents,this.faceNormals,this._tangents,this._concatenatedBuffer)}this.invalidateVertices(this._tangents);this._verticesDirty[this._tangents.id]=false};i.prototype.setUVs=function(t,e){if(e===void 0){e=0}if(t==this._uvs)return;if(t instanceof p){this.clearVertices(this._uvs);this._uvs=t}else if(t){if(!this._uvs)this._uvs=new f(this._concatenatedBuffer);this._uvs.set(t,e)}else if(this._uvs){this.clearVertices(this._uvs);this._uvs=null;return}this.invalidateVertices(this._uvs);this._verticesDirty[this._uvs.id]=false};i.prototype.setJointIndices=function(t,e){if(e===void 0){e=0}if(t==this._jointIndices)return;if(t instanceof p){this.clearVertices(this._jointIndices);this._jointIndices=t}else if(t){if(!this._jointIndices)this._jointIndices=new p(Float32Array,this._jointsPerVertex,this._concatenatedBuffer);if(this._useCondensedIndices){var i=0;var r;var n=0;var s=new Object;this._condensedIndexLookUp=new Array;while(i<t.length){r=t[i];if(s[r]==undefined){s[r]=n;this._condensedIndexLookUp[n++]=r}t[i++]=s[r]}}this._jointIndices.set(t,e)}else if(this._jointIndices){this.clearVertices(this._jointIndices);this._jointIndices=null;return}this.invalidateVertices(this._jointIndices);this._verticesDirty[this._jointIndices.id]=false};i.prototype.setJointWeights=function(t,e){if(e===void 0){e=0}if(t==this._jointWeights)return;if(t instanceof p){this.clearVertices(this._jointWeights);this._jointWeights=t}else if(t){if(!this._jointWeights)this._jointWeights=new p(Float32Array,this._jointsPerVertex,this._concatenatedBuffer);this._jointWeights.set(t,e)}else if(this._jointWeights){this.clearVertices(this._jointWeights);this._jointWeights=null;return}this.invalidateVertices(this._jointWeights);this._verticesDirty[this._jointWeights.id]=false};i.prototype.dispose=function(){t.prototype.dispose.call(this);if(this._positions){this._positions.dispose();this._positions=null}if(this._normals){this._normals.dispose();this._normals=null}if(this._tangents){this._tangents.dispose();this._tangents=null}if(this._uvs){this._uvs.dispose();this._uvs=null}if(this._jointIndices){this._jointIndices.dispose();this._jointIndices=null}if(this._jointWeights){this._jointWeights.dispose();this._jointWeights=null}if(this._faceNormals){this._faceNormals.dispose();this._faceNormals=null}if(this._faceTangents){this._faceTangents.dispose();this._faceTangents=null}};i.prototype.setIndices=function(e,i){if(i===void 0){i=0}t.prototype.setIndices.call(this,e,i);this._faceNormalsDirty=true;this._faceTangentsDirty=true;if(this._autoDeriveNormals)this.invalidateVertices(this._normals);if(this._autoDeriveTangents)this.invalidateVertices(this._tangents)};i.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e);var i=this._autoDeriveNormals;var r=this._autoDeriveTangents;e.autoDeriveNormals=this._autoDeriveNormals=false;e.autoDeriveTangents=this._autoDeriveTangents=false;e.setPositions(this.positions.clone());if(this.normals)e.setNormals(this.normals.clone());if(this.tangents)e.setTangents(this.tangents.clone());if(this.uvs)e.setUVs(this.uvs.clone());e.jointsPerVertex=this._jointsPerVertex;if(this.jointIndices)e.setJointIndices(this.jointIndices.clone());if(this.jointWeights)e.setJointWeights(this.jointWeights.clone());e.autoDeriveNormals=this._autoDeriveNormals=i;e.autoDeriveTangents=this._autoDeriveTangents=r};i.prototype.clone=function(){var t=new i(this._concatenatedBuffer?this._concatenatedBuffer.clone():null);this.copyTo(t);return t};i.prototype.scaleUV=function(t,e,i,r){if(t===void 0){t=1}if(e===void 0){e=1}if(i===void 0){i=0}if(r===void 0){r=0}if(this.uvs)Zt.scale(t,e,0,this.uvs,i||this._numVertices,r)};i.prototype.scale=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=0}Zt.scale(t,t,t,this.positions,e||this._numVertices,i)};i.prototype.applyTransformation=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=0}Zt.applyTransformation(t,this.positions,this.normals,this.tangents,e||this._numVertices,i)};i.prototype.updateFaceTangents=function(){this._faceTangents=Zt.generateFaceTangents(this.indices,this.positions,this.uvs||this.positions,this._faceTangents,this.numElements);this._faceTangentsDirty=false};i.prototype.updateFaceNormals=function(){this._faceNormals=Zt.generateFaceNormals(this.indices,this.positions,this._faceNormals,this.numElements);this._faceNormalsDirty=false};return i}(Jt);$t.traverseName=Ht.addRenderableName("applyTriangleShape");$t.assetType="[asset TriangleElements]";var te=function(){function t(){}return t}();te.NO_OP=0;te.MOVE_TO=1;te.LINE_TO=2;te.CURVE_TO=3;te.BUILD_JOINT=13;te.BUILD_ROUND_JOINT=14;te.WIDE_LINE_TO=4;te.WIDE_MOVE_TO=5;te.CUBIC_CURVE=6;var ee=function(t){e(i,t);function i(e){if(e===void 0){e=null}var i=t.call(this,e)||this;i._positions=new p(Float32Array,6,e);return i}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"traverseName",{get:function(){return i.traverseName},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"positions",{get:function(){return this._positions},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"thickness",{get:function(){return this._thickness},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"colors",{get:function(){if(!this._colors)this.setColors(this._colors);return this._colors},enumerable:true,configurable:true});i.prototype.getBoxBounds=function(t){if(t===void 0){t=null}return t};i.prototype.getSphereBounds=function(t,e){if(e===void 0){e=null}return e};i.prototype.setPositions=function(t,e){if(e===void 0){e=0}if(t instanceof p){this.clearVertices(this._positions);this._positions=t}else if(t){var i=0;var r=0;var n=0;var s=new Float32Array(t.length*4);var a=new Uint16Array(t.length);while(i<t.length){if(n/6&1){s[n]=t[i+3];s[n+1]=t[i+4];s[n+2]=t[i+5];s[n+3]=t[i];s[n+4]=t[i+1];s[n+5]=t[i+2]}else{s[n]=t[i];s[n+1]=t[i+1];s[n+2]=t[i+2];s[n+3]=t[i+3];s[n+4]=t[i+4];s[n+5]=t[i+5]}n+=6;if(++r==4){var o=n/6-4;a.set([o,o+1,o+2,o+3,o+2,o+1],i);r=0;i+=6}}this._positions.set(s,e*4);this.setIndices(a,e)}else{this.clearVertices(this._positions);this._positions=new p(Float32Array,6,this._concatenatedBuffer)}this._numVertices=this._positions.count;this.invalidateVertices(this._positions);this._verticesDirty[this._positions.id]=false};i.prototype.setThickness=function(t,e){if(e===void 0){e=0}if(t instanceof _){this._thickness=t}else if(t){if(!this._thickness)this._thickness=new _(this._concatenatedBuffer);var i=0;var r=0;var n=0;var s=new Float32Array(t.length*4);while(i<t.length){s[n]=Math.floor(.5*n+.5)&1?-t[i]:t[i];if(++r==4){r=0;i++}n++}this._thickness.set(s,e*4)}else if(this._thickness){this._thickness.dispose();this._thickness=null}this.invalidateVertices(this._thickness);this._verticesDirty[this._thickness.id]=false};i.prototype.setColors=function(t,e){if(e===void 0){e=0}if(t){if(t==this._colors)return;if(t instanceof c){this.clearVertices(this._colors);this._colors=t}else{if(!this._colors)this._colors=new c(this._concatenatedBuffer);var i=0;var r=0;var n=0;var s=new Uint8Array(t.length*4);while(i<t.length){if(n/4&1){s[n]=t[i+4];s[n+1]=t[i+5];s[n+2]=t[i+6];s[n+3]=t[i+7]}else{s[n]=t[i];s[n+1]=t[i+1];s[n+2]=t[i+2];s[n+3]=t[i+3]}if(++r==4){r=0;i+=8}n+=4}this._colors.set(s,e*4)}}else{this._colors=Zt.generateColors(this.indices,this._colors,this._concatenatedBuffer,this._numVertices)}this.invalidateVertices(this._colors);this._verticesDirty[this._colors.id]=false};i.prototype.dispose=function(){t.prototype.dispose.call(this);this._positions.dispose();this._positions=null;this._thickness.dispose();this._thickness=null;this._colors.dispose();this._colors=null};i.prototype.clone=function(){var t=new i(this._concatenatedBuffer?this._concatenatedBuffer.clone():null);t.setIndices(this.indices.clone());t.setPositions(this._positions.clone());t.setThickness(this._thickness.clone());t.setColors(this._colors.clone());return t};return i}(Jt);ee.traverseName=Ht.addRenderableName("applyLineShape");ee.assetType="[asset LineElements]";var ie=function(t){e(i,t);function i(e,i){if(e===void 0){e=false}if(i===void 0){i=false}var r=t.call(this)||this;r._smooth=e;r._mipmap=i;return r}Object.defineProperty(i.prototype,"smooth",{get:function(){return this._smooth},set:function(t){if(this._smooth==t)return;this._smooth=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"mipmap",{get:function(){return this._mipmap},set:function(t){if(this._mipmap==t)return;this._mipmap=t},enumerable:true,configurable:true});return i}(h);var re=function(t){e(i,t);function i(e,i,r){if(e===void 0){e=false}if(i===void 0){i=false}if(r===void 0){r=false}var n=t.call(this,i,r)||this;n._repeat=e;n._updateRect();return n}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"repeat",{get:function(){return this._repeat},set:function(t){if(this._repeat==t)return;this._repeat=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"imageRect",{get:function(){return this._imageRect},set:function(t){if(this._imageRect==t)return;this._imageRect=t;this._updateRect()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"frameRect",{get:function(){return this._frameRect},set:function(t){if(this._frameRect==t)return;this._frameRect=t;this._updateRect()},enumerable:true,configurable:true});i.prototype._updateRect=function(){};return i}(ie);re.assetType="[asset Sampler2D]";var ne=function(t){e(i,t);function i(){var e=t.call(this)||this;e._pFormat="bgra";return e}Object.defineProperty(i.prototype,"format",{get:function(){return this._pFormat},enumerable:true,configurable:true});return i}(h);var se=function(){function t(){}t.imageToBitmapImage2D=function(t,e){if(e===void 0){e=true}var i=new pe(t.width,t.height,true,null,e);i.draw(t);return i};t.isImage2DValid=function(e){if(e==null)return true;return t.isDimensionValid(e.width,e.powerOfTwo)&&t.isDimensionValid(e.height,e.powerOfTwo)};t.isHTMLImageElementValid=function(e){if(e==null)return true;return t.isDimensionValid(e.width)&&t.isDimensionValid(e.height)};t.isDimensionValid=function(e,i){if(i===void 0){i=true}return e>=1&&e<=t.MAX_SIZE&&(!i||t.isPowerOfTwo(e))};t.isPowerOfTwo=function(t){return t?(t&-t)==t:false};t.getBestPowerOf2=function(e){var i=1;while(i<e)i<<=1;if(i>t.MAX_SIZE)i=t.MAX_SIZE;return i};return t}();se.MAX_SIZE=8192;var ae=function(t){e(i,t);function i(e,i,r){if(r===void 0){r=true}var n=t.call(this)||this;n._powerOfTwo=true;n._rect=new Y(0,0,e,i);n._powerOfTwo=r;n._testDimensions();return n}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"height",{get:function(){return this._rect.height},set:function(t){if(this._rect.height==t)return;this._setSize(this._rect.width,t)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"rect",{get:function(){return this._rect},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"width",{get:function(){return this._rect.width},set:function(t){if(this._rect.width==t)return;this._setSize(t,this._rect.height)},enumerable:true,configurable:true});i.prototype._setSize=function(t,e){if(this._rect.width!=t||this._rect.height!=e)this.clear();this._rect.width=t;this._rect.height=e;this._testDimensions()};i.prototype._testDimensions=function(){if(this._powerOfTwo&&(!se.isDimensionValid(this._rect.width)||!se.isDimensionValid(this._rect.height)))throw new Error("Invalid dimension: Width and height must be power of 2 and cannot exceed 2048")};Object.defineProperty(i.prototype,"powerOfTwo",{get:function(){return this._powerOfTwo},set:function(t){if(this._powerOfTwo==t)return;this._powerOfTwo=t;this._testDimensions()},enumerable:true,configurable:true});i.prototype.getImageData=function(){throw new r};return i}(ne);ae.assetType="[image Image2D]";var oe=function(){function t(){}t._fillRect=function(t,e,i,r){if(i==0&&r){t.clearRect(e.x,e.y,e.width,e.height)}else{var n=D.float32ColorToARGB(i);if(r)t.fillStyle="rgba("+n[1]+","+n[2]+","+n[3]+","+n[0]/255+")";else t.fillStyle="rgba("+n[1]+","+n[2]+","+n[3]+",1)";t.fillRect(e.x,e.y,e.width,e.height)}};t._copyPixels=function(t,e,i,r){t.drawImage(e,i.x,i.y,i.width,i.height,r.x,r.y,r.width,r.height)};t._draw=function(t,e,i,r,n,s,a){t.save();if(i!=null)t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty);if(e instanceof Uint8Array){if(s!=null){var o=t.getImageData(0,0,s.width,s.height);o.data=e;t.putImageData(o,0,0)}else{console.log("  no rect")}}else{if(s!=null)t.drawImage(e,s.x,s.y,s.width,s.height);else t.drawImage(e,0,0)}t.restore()};return t}();var he=function(){function t(t){this.point=new z;this.point2=new z;this.cpuCanvas=t}t.prototype.restore=function(){this.matrix=null};t.prototype.setTransform=function(t,e,i,r,n,s){this.matrix=new j(t,e,i,r,n,s)};t.prototype.save=function(){};t.prototype.arc=function(t,e,i,r,n,s){};t.prototype.measureText=function(t){return undefined};t.prototype.isPointInPath=function(t,e,i){return undefined};t.prototype.quadraticCurveTo=function(t,e,i,r){};t.prototype.putImageData=function(t,e,i,r,n,s,a){};t.prototype.rotate=function(t){};t.prototype.fillText=function(t,e,i,r){};t.prototype.translate=function(t,e){};t.prototype.scale=function(t,e){};t.prototype.createRadialGradient=function(t,e,i,r,n,s){return undefined};t.prototype.ellipse=function(t,e,i,r,n,s,a,o){};t.prototype.lineTo=function(t,e){};t.prototype.getLineDash=function(){return undefined};t.prototype.fill=function(t){};t.prototype.createImageData=function(t,e){return undefined};t.prototype.createPattern=function(t,e){return undefined};t.prototype.closePath=function(){};t.prototype.rect=function(t,e,i,r){};t.prototype.clip=function(t){};t.prototype.clearRect=function(t,e,i,r){var n=this.cpuCanvas.getImageData();for(var s=t;s<t+i;s++){for(var a=e;a<e+r;a++){var o=(s+a*n.width)*4;n.data[o]=0;n.data[o+1]=0;n.data[o+2]=0;n.data[o+3]=0}}};t.prototype.moveTo=function(t,e){};t.prototype.getImageData=function(t,e,i,r){return this.cpuCanvas.getImageData()};t.prototype.applyPixel32=function(t,e,i,r){e=Math.floor(e);i=Math.floor(i);if(e<0||e>=t.width||i>=t.height||i<0)return;var n=(e+i*t.width)*4;t.data[n]=r[0];t.data[n+1]=r[1];t.data[n+2]=r[2];t.data[n+3]=r[3];t.data[n]=t.data[n]&255;t.data[n+1]=t.data[n+1]&255;t.data[n+2]=t.data[n+2]&255;t.data[n+3]=t.data[n+3]&255};t.prototype.copyPixel32=function(t,e,i,r,n,s){e=Math.floor(e);i=Math.floor(i);n=Math.floor(n);s=Math.floor(s);if(e<0||e>=t.width||i>=t.height||i<0)return;if(n<0||n>=r.width||s>=r.height||s<0)return;var a=(e+i*t.width)*4;var o=(n+s*r.width)*4;t.data[a]=r.data[o];t.data[a+1]=r.data[o+1];t.data[a+2]=r.data[o+2];t.data[a+3]=r.data[o+3]};t.prototype.fillRect=function(t,e,i,r){if(this.fillStyle){if(this.parsedFillStyle!=this.fillStyle){var n=this.fillStyle.substring(5,this.fillStyle.lastIndexOf(")")).split(",");this.parsedA=parseFloat(n[3])*255;this.parsedR=parseInt(n[0]);this.parsedG=parseInt(n[1]);this.parsedB=parseInt(n[2]);this.parsedFillStyle=this.fillStyle}var s=this.cpuCanvas.getImageData();for(var a=t;a<t+i;a++){for(var o=e;o<e+r;o++){var h=(a+o*s.width)*4;s.data[h]=this.parsedR;s.data[h+1]=this.parsedG;s.data[h+2]=this.parsedB;s.data[h+3]=this.parsedA}}}};t.prototype.bezierCurveTo=function(t,e,i,r,n,s){};t.prototype.drawImage=function(t,e,i,r,n,s,a,o,h){var u=t;if(t.constructor.toString().indexOf("BitmapImage2D")>-1){var l=u;l.lock();this.drawBitmap(l,e,i,r,n,s,a,o,h);l.unlock()}else if(t.constructor.toString().indexOf("HTMLImage")>-1){var p=t;var c=document.createElement("canvas");c.width=p.width;c.height=p.height;var _=c.getContext("2d");_.drawImage(p,0,0);var f=_.getImageData(0,0,p.width,p.height);var d=new pe(p.width,p.height,true,0,false);d.getImageData().data=f.data;var g=d;this.drawImage(g,e,i,r,n,s,a,o,h)}else if(t.constructor.toString().indexOf("CPUCanvas")>-1){var m=u;this.drawBitmap(m,e,i,r,n,s,a,o,h)}};t.prototype.drawBitmap=function(e,i,r,n,s,a,o,h,u){if(!n||n==0){n=e.width;s=e.height}if(!a||a==0){a=0;o=0}if(!h||h==0||this.matrix){h=n;u=s}var l=e.getImageData();var p=this.cpuCanvas.getImageData();if(this.matrix||(h!=n||u!=s)){var c=this.matrix;if(!c){c=new j;c.scale(h/n,u/s)}var _=Math.sqrt(c.a*c.a+c.b*c.b);var f=Math.sqrt(c.c*c.c+c.d*c.d);h=n*_;u=s*f;c.tx+=a;c.ty+=o;a=Math.floor(c.tx);o=Math.floor(c.ty);c.invert();if(_>=1||f>=1){var d=new z;for(var g=a;g<a+h;g++){for(var m=o;m<o+u;m++){d.x=g;d.y=m;d=c.transformPoint(d);var y=t.sampleBilinear(d.x,d.y,l);this.applyPixel32(p,g,m,y)}}}else{var v=this.point;var x=this.point2;for(var g=a;g<a+h;g++){for(var m=o;m<o+u;m++){v.x=g;v.y=m;v=c.transformPoint(v);x.x=g+1;x.y=m+1;x=c.transformPoint(x);var y=t.sampleBox(v.x+i,v.y+r,x.x+i,x.y+r,l);this.applyPixel32(p,g,m,y)}}}c.invert()}else{for(var g=a;g<a+h;g++){for(var m=o;m<o+u;m++){var y=t.sample(g-a+i,m-o+r,l);this.applyPixel32(p,g,m,y)}}}};t.prototype.transform=function(t,e,i,r,n,s){};t.prototype.stroke=function(){};t.prototype.strokeRect=function(t,e,i,r){};t.prototype.setLineDash=function(t){};t.prototype.strokeText=function(t,e,i,r){};t.prototype.beginPath=function(){};t.prototype.arcTo=function(t,e,i,r,n){};t.prototype.createLinearGradient=function(t,e,i,r){return undefined};t.sampleBilinear=function(e,i,r,n,s){if(n===void 0){n=1}if(s===void 0){s=1}var a=t.sample(e,i,r);var o=t.sample(e+n,i,r);var h=t.sample(e,i+s,r);var u=t.sample(e+n,i+s,r);var l=e;l=l-Math.floor(l);var p=t.interpolateColor(a,o,l);var c=t.interpolateColor(h,u,l);var _=i;_=_-Math.floor(_);return t.interpolateColor(p,c,_)};t.sample=function(t,e,i){t=Math.floor(t);e=Math.floor(e);var r=[0,0,0,0];if(t<0||t>=i.width||e<0||e>=i.height){return r}var n=(t+e*i.width)*4;r[0]=i.data[n];r[1]=i.data[n+1];r[2]=i.data[n+2];r[3]=i.data[n+3];return r};t.sampleBox=function(e,i,r,n,s){var a=0;var o=[0,0,0,0];var h;var u;var l;var p;var c=Math.floor(i);var _=Math.ceil(n);c=Math.max(Math.min(c,s.height-1),0);_=Math.max(Math.min(_,s.height-1),0);for(u=c;u<_;u++){p=1;if(u<i){p=p*(1-(i-u))}if(u>n){p=p*(1-(u-n))}var f=Math.floor(e);var d=Math.ceil(r);f=Math.max(Math.min(f,s.width-1),0);d=Math.max(Math.min(d,s.width-1),0);for(h=f;h<d;h++){l=p;var g=t.sample(h,u,s);if(h<e){l=l*(1-(e-h))}if(h>r){l=l*(1-(h-r))}o[0]+=g[0]*l;o[1]+=g[1]*l;o[2]+=g[2]*l;o[3]+=g[3]*l;a=a+l}}o[0]/=a;o[1]/=a;o[2]/=a;o[3]/=a;o[0]=o[0]&255;o[1]=o[1]&255;o[2]=o[2]&255;o[3]=o[3]&255;return o};t.interpolateColor=function(t,e,i){var r=[];r[0]=t[0]+(e[0]-t[0])*i;r[1]=t[1]+(e[1]-t[1])*i;r[2]=t[2]+(e[2]-t[2])*i;r[3]=t[3]+(e[3]-t[3])*i;return r};return t}();var ue=function(){function t(t,e){this.width=t;this.height=e;this.data=new Uint8Array(t*e*4)}return t}();var le=function(){function t(){this.width=1;this.height=1;this.reset()}t.prototype.getContext=function(t){var e=[];for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}return new he(this)};t.prototype.reset=function(){if(!this.imageData){this.imageData=new ue(this.width,this.height)}else{this.imageData.width=this.width;this.imageData.height=this.height;if(this.imageData.data){this.imageData.data=null}this.imageData.data=new Uint8Array(this.width*this.height*4)}for(var t=0;t<this.width*this.height*4;t+=4){this.imageData.data[t]=255;this.imageData.data[t+1]=255;this.imageData.data[t+2]=255;this.imageData.data[t+3]=255}};t.prototype.getImageData=function(){if(this.imageData.width!=this.width||this.imageData.height!=this.height){this.reset()}return this.imageData};return t}();var pe=function(t){e(i,t);function i(e,i,r,n,s){if(r===void 0){r=true}if(n===void 0){n=null}if(s===void 0){s=true}var a=t.call(this,e,i,s)||this;a._locked=false;a._transparent=r;if(typeof document!=="undefined"){a._imageCanvas=document.createElement("canvas")}else{a._imageCanvas=new le}a._imageCanvas.width=e;a._imageCanvas.height=i;a._context=a._imageCanvas.getContext("2d");if(n!=null)a.fillRect(a._rect,n);return a}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"transparent",{
get:function(){return this._transparent},set:function(t){this._transparent=t},enumerable:true,configurable:true});i.prototype.invalidate=function(){if(!this._imageDataDirty){this._imageDataDirty=true;t.prototype.invalidate.call(this)}};i.prototype.clone=function(){var t=new i(this.width,this.height,this.transparent,null,this.powerOfTwo);t.draw(this);return t};i.prototype.colorTransform=function(t,e){if(!this._imageData)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);var i=this._imageData.data;var r,n,s;for(r=0;r<t.width;++r){for(n=0;n<t.height;++n){s=(r+t.x+(n+t.y)*this.width)*4;i[s]=i[s]*e.redMultiplier+e.redOffset;i[s+1]=i[s+1]*e.greenMultiplier+e.greenOffset;i[s+2]=i[s+2]*e.blueMultiplier+e.blueOffset;i[s+3]=i[s+3]*e.alphaMultiplier+e.alphaOffset}}if(!this._locked)this._context.putImageData(this._imageData,0,0);this.invalidate()};i.prototype.copyChannel=function(t,e,i,r,n){var s=t.getImageData();if(!this._imageData)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);var a=t.getImageData().data;var o=this._imageData.data;var h=Math.round(Math.log(r)/Math.log(2));var u=Math.round(Math.log(n)/Math.log(2));var l,p,c,_;for(l=0;l<e.width;++l){for(p=0;p<e.height;++p){c=(l+e.x+(p+e.y)*t.width)*4;_=(l+i.x+(p+i.y)*this.width)*4;o[_+u]=a[c+h]}}if(!this._locked)this._context.putImageData(this._imageData,0,0);this.invalidate()};i.prototype.copyPixels=function(t,e,r){if(t instanceof i)t=t.getCanvas();if(this._locked&&this._imageData)this._context.putImageData(this._imageData,0,0);oe._copyPixels(this._context,t,e,r);this._imageData=null;this.invalidate()};i.prototype.dispose=function(){t.prototype.dispose.call(this);this._context=null;this._imageCanvas=null;this._imageData=null;this._rect=null;this._transparent=null;this._locked=null};i.prototype.draw=function(t,e,r,n,s,a){if(t instanceof i&&t.getCanvas())t=t.getCanvas();if(this._locked&&this._imageData)this._context.putImageData(this._imageData,0,0);oe._draw(this._context,t,e,r,n,s,a);this._imageData=null;this.invalidate()};i.prototype.fillRect=function(t,e){if(this._locked&&this._imageData)this._context.putImageData(this._imageData,0,0);oe._fillRect(this._context,t,e,this._transparent);this._imageData=null;this.invalidate()};i.prototype.getPixel=function(t,e){var i;var r;var n;var s;if(!this._locked){var a=this._context.getImageData(t,e,1,1);i=a.data[0];r=a.data[1];n=a.data[2];s=a.data[3]}else{if(!this._imageData)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);var o=(t+e*this._imageData.width)*4;i=this._imageData.data[o+0];r=this._imageData.data[o+1];n=this._imageData.data[o+2];s=this._imageData.data[o+3]}if(!s)return 0;return i<<16|r<<8|n};i.prototype.getPixel32=function(t,e){var i;var r;var n;var s;if(!this._locked){var a=this._context.getImageData(t,e,1,1);i=a.data[0];r=a.data[1];n=a.data[2];s=a.data[3]}else{if(!this._imageData)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);var o=(t+e*this._imageData.width)*4;i=this._imageData.data[o+0];r=this._imageData.data[o+1];n=this._imageData.data[o+2];s=this._imageData.data[o+3]}return s<<24|i<<16|r<<8|n};i.prototype.getPixelData=function(t,e,i){if(!this._imageData)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);var r=(t+e*this._imageData.width)*4;i[0]=this._imageData.data[r+0];i[1]=this._imageData.data[r+1];i[2]=this._imageData.data[r+2];i[3]=this._imageData.data[r+3]};i.prototype.setPixelData=function(t,e,i){if(!this._imageData)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);var r=(t+e*this._imageData.width)*4;this._imageData.data[r+0]=i[0];this._imageData.data[r+1]=i[1];this._imageData.data[r+2]=i[2];this._imageData.data[r+3]=this._transparent?i[3]:255;this.invalidate()};i.prototype.lock=function(){if(this._locked)return;this._locked=true};i.prototype.setArray=function(t,e){if(!this._imageData)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);var i,r,n,s;for(i=0;i<t.width;++i){for(r=0;r<t.height;++r){s=D.float32ColorToARGB(e[i+r*t.width]);n=(i+t.x+(r+t.y)*this._imageData.width)*4;this._imageData.data[n+0]=s[1];this._imageData.data[n+1]=s[2];this._imageData.data[n+2]=s[3];this._imageData.data[n+3]=this._transparent?s[0]:255}}if(!this._locked)this._context.putImageData(this._imageData,0,0);this.invalidate()};i.prototype.setPixel=function(t,e,i){var r=D.float32ColorToARGB(i);if(!this._imageData)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);var n=(t+e*this._imageData.width)*4;this._imageData.data[n+0]=r[1];this._imageData.data[n+1]=r[2];this._imageData.data[n+2]=r[3];this._imageData.data[n+3]=255;if(!this._locked)this._context.putImageData(this._imageData,0,0);this.invalidate()};i.prototype.setPixel32=function(t,e,i){var r=D.float32ColorToARGB(i);if(!this._imageData)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);var n=(t+e*this._imageData.width)*4;this._imageData.data[n+0]=r[1];this._imageData.data[n+1]=r[2];this._imageData.data[n+2]=r[3];this._imageData.data[n+3]=this._transparent?r[0]:255;if(!this._locked)this._context.putImageData(this._imageData,0,0);this.invalidate()};i.prototype.setPixels=function(t,e){if(!this._imageData)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);var i;var r=this._rect.width;var n=t.width;for(i=0;i<t.height;++i)this._imageData.data.set(e.subarray(i*n*4,(i+1)*n*4),(t.x+(i+t.y)*r)*4);if(!this._locked)this._context.putImageData(this._imageData,0,0);this.invalidate()};i.prototype.unlock=function(){if(!this._locked)return;this._locked=false;if(this._imageData)this._context.putImageData(this._imageData,0,0)};i.prototype.getImageData=function(){if(!this._imageData)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height);return this._imageData};i.prototype.getCanvas=function(){return this._imageCanvas};i.prototype._setSize=function(e,i){if(this._locked)this._context.putImageData(this._imageData,0,0);if(this._imageCanvas){this._imageCanvas.width=e;this._imageCanvas.height=i}t.prototype._setSize.call(this,e,i);if(this._locked)this._imageData=this._context.getImageData(0,0,this._rect.width,this._rect.height)};return i}(ae);pe.assetType="[image BitmapImage2D]";var ce=function(t){e(i,t);function i(e){var i=t.call(this)||this;i._size=e;i._testDimensions();return i}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"size",{get:function(){return this._size},set:function(t){if(this._size==t)return;this._setSize(this._size)},enumerable:true,configurable:true});i.prototype.getImageData=function(t){throw new r};i.prototype._setSize=function(t){if(this._size!=t)this.clear();this._size=t;this._testDimensions()};i.prototype._testDimensions=function(){if(!se.isDimensionValid(this._size))throw new Error("Invalid dimension: Width and height must be power of 2 and cannot exceed 2048")};return i}(ne);ce.assetType="[image ImageCube]";var _e=function(t){e(i,t);function i(e,i,r){if(i===void 0){i=true}if(r===void 0){r=null}var n=t.call(this,e)||this;n._imageCanvas=new Array(6);n._context=new Array(6);n._imageData=new Array(6);n._locked=false;n._transparent=i;for(var s=0;s<6;s++){if(typeof document!=="undefined"){n._imageCanvas[s]=document.createElement("canvas")}else{n._imageCanvas[s]=new le}n._imageCanvas[s].width=e;n._imageCanvas[s].height=e;n._context[s]=n._imageCanvas[s].getContext("2d");if(r!=null)n.fillRect(s,new Y(0,0,e,e),r)}return n}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"transparent",{get:function(){return this._transparent},set:function(t){this._transparent=t},enumerable:true,configurable:true});i.prototype.clone=function(){var t=new i(this._size,this.transparent);for(var e=0;e<6;e++){t.draw(e,this.getCanvas(e))}return t};i.prototype.colorTransform=function(t,e,i){if(!this._locked)this._imageData[t]=this._context[t].getImageData(0,0,this._size,this._size);var r=this._imageData[t].data;var n,s,a;for(n=0;n<e.width;++n){for(s=0;s<e.height;++s){a=(n+e.x+(s+e.y)*this._size)*4;r[a]=r[a]*i.redMultiplier+i.redOffset;r[a+1]=r[a+1]*i.greenMultiplier+i.greenOffset;r[a+2]=r[a+2]*i.blueMultiplier+i.blueOffset;r[a+3]=r[a+3]*i.alphaMultiplier+i.alphaOffset}}if(!this._locked){this._context[t].putImageData(this._imageData[t],0,0);this._imageData[t]=null}this.invalidate()};i.prototype.copyChannel=function(t,e,i,r,n,s){var a=e.getImageData();if(!this._locked)this._imageData[t]=this._context[t].getImageData(0,0,this._size,this._size);var o=e.getImageData().data;var h=this._imageData[t].data;var u=Math.round(Math.log(n)/Math.log(2));var l=Math.round(Math.log(s)/Math.log(2));var p,c,_,f;for(p=0;p<i.width;++p){for(c=0;c<i.height;++c){_=(p+i.x+(c+i.y)*e.width)*4;f=(p+r.x+(c+r.y)*this._size)*4;h[f+l]=o[_+u]}}if(!this._locked){this._context[t].putImageData(this._imageData[t],0,0);this._imageData[t]=null}this.invalidate()};i.prototype.copyPixels=function(t,e,i,r){if(e instanceof pe)e=e.getCanvas();if(this._locked){this._context[t].putImageData(this._imageData[t],0,0);oe._copyPixels(this._context[t],e,i,r);this._imageData[t]=this._context[t].getImageData(0,0,this._size,this._size)}else{oe._copyPixels(this._context[t],e,i,r)}this.invalidate()};i.prototype.dispose=function(){t.prototype.dispose.call(this);for(var e=0;e<6;e++){this._context[e]=null;this._imageCanvas[e]=null;this._imageData[e]=null}this._transparent=null;this._locked=null};i.prototype.draw=function(t,e,i,r,n,s,a){if(e instanceof pe)e=e.getCanvas();if(this._locked){this._context[t].putImageData(this._imageData[t],0,0);oe._draw(this._context[t],e,i,r,n,s,a);this._imageData[t]=this._context[t].getImageData(0,0,this._size,this._size)}else{oe._draw(this._context[t],e,i,r,n,s,a)}this.invalidate()};i.prototype.fillRect=function(t,e,i){if(this._locked){if(this._imageData[t])this._context[t].putImageData(this._imageData[t],0,0);oe._fillRect(this._context[t],e,i,this._transparent);if(this._imageData[t])this._imageData[t]=this._context[t].getImageData(0,0,this._size,this._size)}else{oe._fillRect(this._context[t],e,i,this._transparent)}this.invalidate()};i.prototype.getPixel=function(t,e,i){var r;var n;var s;var a;if(!this._locked){var o=this._context[t].getImageData(e,i,1,1);r=o.data[0];n=o.data[1];s=o.data[2];a=o.data[3]}else{var h=(e+i*this._size)*4;r=this._imageData[t].data[h+0];n=this._imageData[t].data[h+1];s=this._imageData[t].data[h+2];a=this._imageData[t].data[h+3]}if(!a)return 0;return r<<16|n<<8|s};i.prototype.getPixel32=function(t,e,i){var r;var n;var s;var a;if(!this._locked){var o=this._context[t].getImageData(e,i,1,1);r=o.data[0];n=o.data[1];s=o.data[2];a=o.data[3]}else{var h=(e+i*this._size)*4;r=this._imageData[t].data[h+0];n=this._imageData[t].data[h+1];s=this._imageData[t].data[h+2];a=this._imageData[t].data[h+3]}return a<<24|r<<16|n<<8|s};i.prototype.lock=function(){if(this._locked)return;this._locked=true;for(var t=0;t<6;t++)this._imageData[t]=this._context[t].getImageData(0,0,this._size,this._size)};i.prototype.setArray=function(t,e,i){if(!this._locked)this._imageData[t]=this._context[t].getImageData(0,0,this._size,this._size);var r,n,s,a;for(r=0;r<e.width;++r){for(n=0;n<e.height;++n){a=D.float32ColorToARGB(i[r+n*e.width]);s=(r+e.x+(n+e.y)*this._size)*4;this._imageData[t].data[s+0]=a[1];this._imageData[t].data[s+1]=a[2];this._imageData[t].data[s+2]=a[3];this._imageData[t].data[s+3]=a[0]}}if(!this._locked){this._context[t].putImageData(this._imageData[t],0,0);this._imageData[t]=null}this.invalidate()};i.prototype.setPixel=function(t,e,i,r){var n=D.float32ColorToARGB(r);if(!this._locked)this._imageData[t]=this._context[t].getImageData(0,0,this._size,this._size);var s=(e+i*this._size)*4;this._imageData[t].data[s+0]=n[1];this._imageData[t].data[s+1]=n[2];this._imageData[t].data[s+2]=n[3];this._imageData[t].data[s+3]=255;if(!this._locked){this._context[t].putImageData(this._imageData[t],0,0);this._imageData=null}this.invalidate()};i.prototype.setPixel32=function(t,e,i,r){var n=D.float32ColorToARGB(r);if(!this._locked)this._imageData[t]=this._context[t].getImageData(0,0,this._size,this._size);var s=(e+i*this._size)*4;this._imageData[t].data[s+0]=n[1];this._imageData[t].data[s+1]=n[2];this._imageData[t].data[s+2]=n[3];this._imageData[t].data[s+3]=n[0];if(!this._locked){this._context[t].putImageData(this._imageData[t],0,0);this._imageData[t]=null}this.invalidate()};i.prototype.setPixels=function(t,e,i){if(!this._locked)this._imageData[t]=this._context[t].getImageData(0,0,this._size,this._size);i.position=0;var r,n,s;for(r=0;r<e.width;++r){for(n=0;n<e.height;++n){s=(r+e.x+(n+e.y)*this._size)*4;this._imageData[t].data[s+0]=i.readUnsignedInt();this._imageData[t].data[s+1]=i.readUnsignedInt();this._imageData[t].data[s+2]=i.readUnsignedInt();this._imageData[t].data[s+3]=i.readUnsignedInt()}}if(!this._locked){this._context[t].putImageData(this._imageData[t],0,0);this._imageData[t]=null}this.invalidate()};i.prototype.unlock=function(){if(!this._locked)return;this._locked=false;for(var t=0;t<6;t++){this._context[t].putImageData(this._imageData[t],0,0);this._imageData[t]=null}};i.prototype.getImageData=function(t){if(!this._locked)return this._context[t].getImageData(0,0,this._size,this._size);return this._imageData[t]};i.prototype.getCanvas=function(t){return this._imageCanvas[t]};i.prototype._setSize=function(e){t.prototype._setSize.call(this,e);for(var i=0;i<6;i++){if(this._locked)this._context[i].putImageData(this._imageData[i],0,0);this._imageCanvas[i].width=e;this._imageCanvas[i].height=e;if(this._locked)this._imageData[i]=this._context[i].getImageData(0,0,this._size,this._size)}};return i}(ce);_e.assetType="[image BitmapImageCube]";_e.posX=0;_e.negX=1;_e.posY=2;_e.negY=3;_e.posZ=4;_e.negZ=5;var fe=function(){function t(){}return t}();fe.ADD="add";fe.ALPHA="alpha";fe.DARKEN="darken";fe.DIFFERENCE="difference";fe.ERASE="erase";fe.HARDLIGHT="hardlight";fe.INVERT="invert";fe.LAYER="layer";fe.LIGHTEN="lighten";fe.MULTIPLY="multiply";fe.NORMAL="normal";fe.OVERLAY="overlay";fe.SCREEN="screen";fe.SHADER="shader";fe.SUBTRACT="subtract";var de=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._material=i;return r}Object.defineProperty(i.prototype,"material",{get:function(){return this._material},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._material)};return i}(n);de.INVALIDATE_TEXTURE="invalidateTexture";de.INVALIDATE_ANIMATION="invalidateAnimation";de.INVALIDATE_PASSES="invalidatePasses";var ge=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i=1}var r=t.call(this)||this;r._textures=new Array;r._pUseColorTransform=false;r._alphaBlending=false;r._alpha=1;r._pAlphaThreshold=0;r._pAnimateUVs=false;r._style=new Gt;r._iBaseScreenPassIndex=0;r._bothSides=false;r._owners=new Array;r._pBlendMode=fe.NORMAL;r._imageRect=false;r._curves=false;r._onInvalidatePropertiesDelegate=function(t){return r._onInvalidateProperties(t)};r._style.addEventListener(kt.INVALIDATE_PROPERTIES,r._onInvalidatePropertiesDelegate);if(e instanceof ne)r._style.image=e;else if(e)r._style.color=Number(e);r.alpha=i;r._onTextureInvalidateDelegate=function(t){return r.onTextureInvalidate(t)};r.alphaPremultiplied=false;return r}Object.defineProperty(i.prototype,"alpha",{get:function(){return this._alpha},set:function(t){if(t>1)t=1;else if(t<0)t=0;if(this._alpha==t)return;this._alpha=t;if(this._colorTransform==null)this._colorTransform=new C;this._colorTransform.alphaMultiplier=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(t){this._colorTransform=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"alphaBlending",{get:function(){return this._alphaBlending},set:function(t){if(this._alphaBlending==t)return;this._alphaBlending=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animationSet",{get:function(){return this._animationSet},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"curves",{get:function(){return this._curves},set:function(t){if(this._curves==t)return;this._curves=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"imageRect",{get:function(){return this._imageRect},set:function(t){if(this._imageRect==t)return;this._imageRect=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"style",{get:function(){return this._style},set:function(t){if(this._style==t)return;if(this._style)this._style.removeEventListener(kt.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate);this._style=t;if(this._style)this._style.addEventListener(kt.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate);this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animateUVs",{get:function(){return this._pAnimateUVs},set:function(t){if(this._pAnimateUVs==t)return;this._pAnimateUVs=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"useColorTransform",{get:function(){return this._pUseColorTransform},set:function(t){if(this._pUseColorTransform==t)return;this._pUseColorTransform=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"bothSides",{get:function(){return this._bothSides},set:function(t){if(this._bothSides=t)return;this._bothSides=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._pBlendMode},set:function(t){if(this._pBlendMode==t)return;this._pBlendMode=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"alphaPremultiplied",{get:function(){return this._alphaPremultiplied},set:function(t){if(this._alphaPremultiplied==t)return;this._alphaPremultiplied=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"alphaThreshold",{get:function(){return this._pAlphaThreshold},set:function(t){if(t<0)t=0;else if(t>1)t=1;if(this._pAlphaThreshold==t)return;this._pAlphaThreshold=t;this.invalidatePasses()},enumerable:true,configurable:true});i.prototype.iAddOwner=function(t){this._owners.push(t);var e;var i=t.animator;if(i)e=i.animationSet;if(t.animator){if(this._animationSet&&e!=this._animationSet){throw new Error("A Material instance cannot be shared across material owners with different animation sets")}else{if(this._animationSet!=e){this._animationSet=e;this.invalidateAnimation()}}}};i.prototype.iRemoveOwner=function(t){this._owners.splice(this._owners.indexOf(t),1);if(this._owners.length==0){this._animationSet=null;this.invalidateAnimation()}};Object.defineProperty(i.prototype,"iOwners",{get:function(){return this._owners},enumerable:true,configurable:true});i.prototype.getNumTextures=function(){return this._textures.length};i.prototype.getTextureAt=function(t){return this._textures[t]};i.prototype.invalidatePasses=function(){this.dispatchEvent(new de(de.INVALIDATE_PASSES,this))};i.prototype.invalidateAnimation=function(){this.dispatchEvent(new de(de.INVALIDATE_ANIMATION,this))};i.prototype.invalidateMaterials=function(){var t=this._owners.length;for(var e=0;e<t;e++)this._owners[e].invalidateMaterial()};i.prototype.invalidateTexture=function(){this.dispatchEvent(new de(de.INVALIDATE_TEXTURE,this))};i.prototype.addTextureAt=function(t,e){var i=this._textures.indexOf(t);if(i==e)return;else if(i!=-1)this._textures.splice(i,1);this._textures.splice(e,0,t);t.addEventListener(s.INVALIDATE,this._onTextureInvalidateDelegate);this.onTextureInvalidate()};i.prototype.addTexture=function(t){if(this._textures.indexOf(t)!=-1)return;this._textures.push(t);t.addEventListener(s.INVALIDATE,this._onTextureInvalidateDelegate);this.onTextureInvalidate()};i.prototype.removeTexture=function(t){this._textures.splice(this._textures.indexOf(t),1);t.removeEventListener(s.INVALIDATE,this._onTextureInvalidateDelegate);this.onTextureInvalidate()};i.prototype.onTextureInvalidate=function(t){if(t===void 0){t=null}this.invalidatePasses();this.invalidateMaterials()};i.prototype._onInvalidateProperties=function(t){this.invalidatePasses()};return i}(h);var me=function(){function t(){}return t}();me.NORMAL="normal";me.LINEAR_GRADIENT="linearGradient";me.RADIAL_GRADIENT="radialGradient";var ye=function(t){e(i,t);function i(){var e=t.call(this)||this;e._numImages=0;e._images=new Array;e._samplers=new Array;return e}i.prototype.getNumImages=function(){return this._numImages};i.prototype.setNumImages=function(t){if(this._numImages==t)return;this._numImages=t;this._images.length=t;this._samplers.length=t;this.invalidate()};i.prototype.getImageAt=function(t){return this._images[t]};i.prototype.setImageAt=function(t,e){this._images[e]=t;this.invalidate()};i.prototype.getSamplerAt=function(t){return this._samplers[t]};i.prototype.setSamplerAt=function(t,e){this._samplers[e]=t;this.invalidate()};return i}(h);var ve=function(t){e(r,t);function r(e){if(e===void 0){e=null}var i=t.call(this)||this;i.setNumImages(1);i.image2D=e;i._mappingMode=me.NORMAL;return i}Object.defineProperty(r.prototype,"assetType",{get:function(){return r.assetType},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"mappingMode",{get:function(){return this._mappingMode},set:function(t){if(this._mappingMode==t)return;this._mappingMode=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"sampler2D",{get:function(){return this._samplers[0]},set:function(t){if(this._samplers[0]==t)return;this.setSamplerAt(t,0)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"image2D",{get:function(){return this._images[0]},set:function(t){if(this._images[0]==t)return;if(!se.isImage2DValid(t))throw new i("Invalid image2DData: Width and height must be power of 2 and cannot exceed 2048");this.setImageAt(t,0)},enumerable:true,configurable:true});return r}(ye);ve.assetType="[texture Single2DTexture]";var xe=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i=1}var r=t.call(this,e,i)||this;r._preserveAlpha=false;if(e instanceof ae)r.texture=new ve;return r}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(t){if(this._preserveAlpha==t)return;this._preserveAlpha=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.removeTexture(this._texture);this._texture=t;if(this._texture)this.addTexture(this._texture);this.invalidateTexture()},enumerable:true,configurable:true});return i}(ge);xe.assetType="[materials BasicMaterial]";var be=function(t){e(i,t);function i(e){if(e===void 0){e=null}var i=t.call(this)||this;i.setNumImages(1);i.imageCube=e;return i}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"samplerCube",{get:function(){return this._samplers[0]},set:function(t){if(this._samplers[0]==t)return;this.setSamplerAt(t,0)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"imageCube",{get:function(){return this._images[0]},set:function(t){if(this._images[0]==t)return;this.setImageAt(t,0)},enumerable:true,configurable:true});return i}(ye);be.assetType="[texture SingleCubeTexture]";var we=function(){function t(){}t.getDefaultMaterial=function(e){if(e===void 0){e=null}if(e!=null&&e.isAsset(jt)&&e.elements.isAsset(ee)){if(!t._defaultColorMaterial)t.createDefaultColorMaterial();return t._defaultColorMaterial}if(e!=null&&e.assetType=="[asset Skybox]"){if(!t._defaultCubeTextureMaterial)t.createDefaultCubeTextureMaterial();return t._defaultCubeTextureMaterial}if(!t._defaultTextureMaterial)t.createDefaultTextureMaterial();return t._defaultTextureMaterial};t.getDefaultTexture=function(e){if(e===void 0){e=null}if(e!=null&&e.assetType=="[asset Skybox]"){if(!t._defaultCubeTexture)t.createDefaultCubeTexture();return t._defaultCubeTexture}if(!t._defaultTexture)t.createDefaultTexture();return t._defaultTexture};t.getDefaultImage2D=function(){if(!t._defaultBitmapImage2D)t.createDefaultImage2D();return t._defaultBitmapImage2D};t.getDefaultImageCube=function(){if(!t._defaultBitmapImageCube)t.createDefaultImageCube();return t._defaultBitmapImageCube};t.getDefaultSampler=function(){if(!t._defaultSampler2D)t.createDefaultSampler2D();return t._defaultSampler2D};t.createDefaultTexture=function(){t._defaultTexture=new ve;t._defaultTexture.name="defaultTexture"};t.createDefaultCubeTexture=function(){t._defaultCubeTexture=new be;t._defaultCubeTexture.name="defaultCubeTexture"};t.createDefaultImageCube=function(){if(!t._defaultBitmapImage2D)t.createDefaultImage2D();var e=new _e(t._defaultBitmapImage2D.width);for(var i=0;i<6;i++)e.draw(i,t._defaultBitmapImage2D);t._defaultBitmapImageCube=e};t.createDefaultImage2D=function(){var e=new pe(8,8,false,0);var i,r;for(i=0;i<8;i++)for(r=0;r<8;r++)if(r&1^i&1)e.setPixel(i,r,16777215);t._defaultBitmapImage2D=e};t.createDefaultTextureMaterial=function(){if(!t._defaultTexture)t.createDefaultTexture();t._defaultTextureMaterial=new xe;t._defaultTextureMaterial.texture=t._defaultTexture;t._defaultTextureMaterial.name="defaultTextureMaterial"};t.createDefaultCubeTextureMaterial=function(){if(!t._defaultCubeTexture)t.createDefaultCubeTexture();t._defaultCubeTextureMaterial=new xe;t._defaultCubeTextureMaterial.texture=t._defaultCubeTexture;t._defaultCubeTextureMaterial.name="defaultCubeTextureMaterial"};t.createDefaultColorMaterial=function(){t._defaultColorMaterial=new xe(16777215);t._defaultColorMaterial.name="defaultColorMaterial"};t.createDefaultSampler2D=function(){t._defaultSampler2D=new re};return t}();var De=function(){function t(){}t.draw_pathes=function(t){var e=t.queued_fill_pathes.length;var i=0;for(i=0;i<e;i++){var r=t.queued_fill_pathes[i];var n=r.commands;var s=r.data;var a;var o;var h=0;var u=0;var l=0;var c=0;var _=0;var g=[[]];var m=[];var y=0;var v=new z;var x=new z;var b=new z;for(u=0;u<n.length;u++){g.push([]);l=0;c=0;a=n[u];o=s[u];_=0;var w=0;var D=0;var C=0;var A=0;var T=0;var S=new z;if(o[0]!=o[o.length-2]||o[1]!=o[o.length-1]){o[o.length]==o[0];o[o.length]==o[1]}v.x=o[0];v.y=o[1];if(a[1]==te.LINE_TO){x.x=o[2]-v.x;x.y=o[3]-v.y}else if(a[1]==te.CURVE_TO){x.x=o[4]-v.x;x.y=o[5]-v.y}c=2;x.normalize();T=Math.atan2(x.y,x.x)*P.RADIANS_TO_DEGREES;for(h=1;h<a.length;h++){b=new z(o[c++],o[c++]);if(a[h]==te.MOVE_TO){console.log("ERROR ! ONLY THE FIRST COMMAND FOR A CONTOUR IS ALLOWED TO BE A 'MOVE_TO' COMMAND")}else if(a[h]==te.CURVE_TO){b=new z(o[c++],o[c++])}S.x=b.x-v.x;S.y=b.y-v.y;S.normalize();w=Math.atan2(S.y,S.x)*P.RADIANS_TO_DEGREES;A=w-T;if(A>180){A-=360}if(A<-180){A+=360}_+=A;T=w;v.x=b.x;v.y=b.y}v.x=o[0];v.y=o[1];c=2;g[g.length-1][l++]=v.x;g[g.length-1][l++]=v.y;for(h=1;h<a.length;h++){switch(a[h]){case te.MOVE_TO:console.log("ERROR ! ONLY THE FIRST COMMAND FOR A CONTOUR IS ALLOWED TO BE A 'MOVE_TO' COMMAND");break;case te.LINE_TO:v.x=o[c++];v.y=o[c++];g[g.length-1][l++]=v.x;g[g.length-1][l++]=v.y;break;case te.CURVE_TO:var E=o[c++];var M=o[c++];var O=o[c++];var I=o[c++];S.x=E-v.x;S.y=M-v.y;S.normalize();D=Math.atan2(S.y,S.x)*P.RADIANS_TO_DEGREES;S.x=O-v.x;S.y=I-v.y;S.normalize();C=Math.atan2(S.y,S.x)*P.RADIANS_TO_DEGREES;var R=C-D;if(R>180){R-=360}if(R<-180){R+=360}if(R==0&&R==180&&R==-180){v.x=O;v.y=I;g[g.length-1][l++]=v.x;g[g.length-1][l++]=v.y;break}var L=-1;if(_<0){if(R>0){L=1;g[g.length-1][l++]=E;g[g.length-1][l++]=M}g[g.length-1][l++]=O;g[g.length-1][l++]=I}else{if(R<0){L=1;g[g.length-1][l++]=E;g[g.length-1][l++]=M}g[g.length-1][l++]=O;g[g.length-1][l++]=I}if(qt.isClockWiseXY(O,I,E,M,v.x,v.y)){m[y++]=O;m[y++]=I;m[y++]=L;m[y++]=1;m[y++]=1;m[y++]=1;m[y++]=0;m[y++]=E;m[y++]=M;m[y++]=L;m[y++]=.5;m[y++]=0;m[y++]=1;m[y++]=0;m[y++]=v.x;m[y++]=v.y;m[y++]=L;m[y++]=0;m[y++]=0;m[y++]=1;m[y++]=0}else{m[y++]=v.x;m[y++]=v.y;m[y++]=L;m[y++]=1;m[y++]=1;m[y++]=1;m[y++]=0;m[y++]=E;m[y++]=M;m[y++]=L;m[y++]=.5;m[y++]=0;m[y++]=1;m[y++]=0;m[y++]=O;m[y++]=I;m[y++]=L;m[y++]=0;m[y++]=0;m[y++]=1;m[y++]=0}v.x=O;v.y=I;break;case te.CUBIC_CURVE:break}}}var N=[];var F=[];var B=[];var V=[];for(u=0;u<g.length;u++){var U=g[u];var k=new Float32Array(U);if(qt._tess_obj==null){console.log("No libtess2 tesselator available.\nMake it available using Graphics._tess_obj=new TESS();");return}qt._tess_obj.addContour(k,2,8,U.length/2)}qt._tess_obj.tesselate(0,0,3,2,null);N=qt._tess_obj.getVertices();V=qt._tess_obj.getElements();var j=N.length/2;var G=V.length/3;for(h=0;h<j;++h)F.push(new z(N[h*2],N[h*2+1]));for(h=0;h<G;++h){var H=V[h*3];var X=V[h*3+1];var W=V[h*3+2];m[y++]=F[W].x;m[y++]=F[W].y;m[y++]=1;m[y++]=2;m[y++]=0;m[y++]=1;m[y++]=0;m[y++]=F[X].x;m[y++]=F[X].y;m[y++]=1;m[y++]=2;m[y++]=0;m[y++]=1;m[y++]=0;m[y++]=F[H].x;m[y++]=F[H].y;m[y++]=1;m[y++]=2;m[y++]=0;m[y++]=1;m[y++]=0}var Y=new p(Float32Array,7);Y.set(m);var q=Y.attributesBuffer;Y.dispose();var K=new $t(q);K.setPositions(new f(q));K.setCustomAttributes("curves",new d(q));K.setUVs(new f(q));var Z=we.getDefaultMaterial();Z.bothSides=true;Z.useColorTransform=true;Z.curves=true;var Q=t.addShape(jt.getShape(K,Z))}t.queued_fill_pathes.length=0};return t}();var Ce=function(){function t(){}return t}();Ce.BEVEL=2;Ce.MITER=0;Ce.ROUND=1;var Ae=function(){function t(){}t.draw_pathes=function(t,e){var i=t.length;var r;var n;var s;var a;var o;var h;var u=0;var l=0;var p=0;var c=0;var _=0;var f=new z;var d=new z;var g=new z;var m=new z;var y=new z;var v=new z;var x=new z;var b=new z;var w=new z;var D=new z;var C=new z;var A=new z;var T=new z;var S=new z;var E=false;var M=new z;var O=0;for(O=0;O<i;O++){a=t[O];r=a.commands;n=a.data;s=a.stroke();for(l=0;l<r.length;l++){o=r[l];h=n[l];p=0;c=0;var I=0;var R=0;var L=0;var N=new z;E=true;if(h[0]!=h[h.length-2]||h[1]!=h[h.length-1])E=false;else{M.x=h[h.length-2]-h[h.length-4];M.y=h[h.length-1]-h[h.length-3];M.normalize();L=Math.atan2(M.y,M.x)*P.RADIANS_TO_DEGREES}c=0;f.x=h[c++];f.y=h[c++];var F=[];var B=[];var V=0;var U=0;var k=new z;var j=new z;var G=new z;var H=new z;var X=new z;k.x=-1*M.y;k.y=M.x;for(u=1;u<o.length;u++){if(o[u]==te.MOVE_TO){console.log("ERROR ! ONLY THE FIRST COMMAND FOR A CONTOUR IS ALLOWED TO BE A 'MOVE_TO' COMMAND");continue}g=new z(h[c++],h[c++]);if(o[u]==te.CURVE_TO){G=new z(h[c++],h[c++])}N.x=g.x-f.x;N.y=g.y-f.y;N.normalize();I=Math.atan2(N.y,N.x)*P.RADIANS_TO_DEGREES;R=I-L;if(R>180){R-=360}if(R<-180){R+=360}L=I;A.x=-1*N.y;A.y=N.x;H=new z(f.x+A.x*s.half_thickness,f.y+A.y*s.half_thickness);j=new z(f.x-A.x*s.half_thickness,f.y-A.y*s.half_thickness);var W=false;if(u==1&&!E){W=true}else{if(R==0||R==180){if(u!=1&&o[u]==te.LINE_TO&&F[F.length-1]==te.LINE_TO){W=false}else{W=true}}if(Math.abs(R)==180){W=true}else if(R!=0){W=true;var Y=180-R;if(R<0){Y=-180-R}Y=Y*-.5*P.DEGREES_TO_RADIANS;var q=s.half_thickness/Math.sin(Y);T.x=N.x*Math.cos(Y)+N.y*Math.sin(Y);T.y=N.y*Math.cos(Y)-N.x*Math.sin(Y);T.normalize();var K=new z(f.x-T.x*q,f.y-T.y*q);var Z=new z(f.x+T.x*q,f.y+T.y*q);if(R>0){H=K;var Q=new z(f.x-A.x*s.half_thickness,f.y-A.y*s.half_thickness);var J=new z(f.x-k.x*s.half_thickness,f.y-k.y*s.half_thickness);j=Q}else{j=Z;var $=new z(f.x+A.x*s.half_thickness,f.y+A.y*s.half_thickness);var tt=new z(f.x+k.x*s.half_thickness,f.y+k.y*s.half_thickness);H=$}var et=true;if(s.jointstyle==Ce.MITER){var it=Math.sqrt(q*q-s.half_thickness*s.half_thickness)/s.half_thickness;if(it<=s.miter_limit){et=false;H=K;j=Z}else{if(R>0){Q.x=Q.x-N.x*(s.miter_limit*s.half_thickness);

Q.y=Q.y-N.y*(s.miter_limit*s.half_thickness);S.x=k.y*-1;S.y=k.x;J.x=J.x-S.x*(s.miter_limit*s.half_thickness);J.y=J.y-S.y*(s.miter_limit*s.half_thickness)}else{$.x=$.x-N.x*(s.miter_limit*s.half_thickness);$.y=$.y-N.y*(s.miter_limit*s.half_thickness);S.x=k.y*-1;S.y=k.x;tt.x=tt.x-S.x*(s.miter_limit*s.half_thickness);tt.y=tt.y-S.y*(s.miter_limit*s.half_thickness)}}}if(et){F[V++]=s.jointstyle!=Ce.ROUND?te.BUILD_JOINT:te.BUILD_ROUND_JOINT;if(R>0){B[U++]=K;B[U++]=J;B[U++]=Q}else{B[U++]=tt;B[U++]=Z;B[U++]=$}if(s.jointstyle==Ce.ROUND){B[U++]=new z(f.x-T.x*Math.abs(q),f.y-T.y*Math.abs(q));if(R>0){B[U++]=J;B[U++]=Q}else{B[U++]=tt;B[U++]=$}}}}}k.x=A.x;k.y=A.y;if(W){if(o[u]==te.LINE_TO){F[V++]=te.LINE_TO;B[U++]=H;B[U++]=j}else if(o[u]==te.CURVE_TO){N.x=G.x-g.x;N.y=G.y-g.y;N.normalize();I=Math.atan2(N.y,N.x)*P.RADIANS_TO_DEGREES;R=I-L;L=I;A.x=-1*N.y;A.y=N.x;if(R!=0&&R!=180){F[V++]=te.CURVE_TO;B[U++]=H;B[U++]=j;B[U++]=new z(f.x,f.y);B[U++]=new z(g.x,g.y);B[U++]=G}else{F[V++]=te.LINE_TO;B[U++]=H;B[U++]=j}k.x=A.x;k.y=A.y;f=G}}if(o[u]==te.LINE_TO){f=g}if(u==o.length-1){if(!E){F[V++]=te.NO_OP;B[U++]=new z(f.x+A.x*s.half_thickness,f.y+A.y*s.half_thickness);B[U++]=new z(f.x-A.x*s.half_thickness,f.y-A.y*s.half_thickness)}else{F[V++]=te.NO_OP;B[U++]=B[0];B[U++]=B[1]}}}V=0;U=0;for(u=0;u<F.length;u++){if(F[u]==te.LINE_TO){U+=2}else if(F[u]==te.CURVE_TO){y=B[U++];m=B[U++];d=B[U++];X=B[U++];g=B[U++];C=B[U];D=B[U+1];N.x=X.x-d.x;N.y=X.y-d.y;S.x=X.x-d.x;S.y=X.y-d.y;var rt=S.length;N.normalize();T.x=g.x-X.x;T.y=g.y-X.y;var nt=T.length;T.normalize();var st=.5-(nt-rt)/rt*.5;if(rt>nt){st=.5+(rt-nt)/nt*.5}var at=Math.atan2(N.y,N.x)*P.RADIANS_TO_DEGREES;var ot=Math.atan2(T.y,T.x)*P.RADIANS_TO_DEGREES;R=ot-at;if(R>180)R-=360;if(R<-180)R+=360;var ht=qt.getQuadricBezierPosition(.5,d.x,X.x,g.x);var ut=qt.getQuadricBezierPosition(.5,d.y,X.y,g.y);var lt=qt.getQuadricBezierPosition(.501,d.x,X.x,g.x);var pt=qt.getQuadricBezierPosition(.501,d.y,X.y,g.y);S.x=-1*(ut-pt);S.y=ht-lt;S.normalize();x.x=ht-S.x*s.half_thickness;x.y=ut-S.y*s.half_thickness;v.x=ht+S.x*s.half_thickness;v.y=ut+S.y*s.half_thickness;x.x=x.x*2-y.x/2-C.x/2;x.y=x.y*2-y.y/2-C.y/2;v.x=v.x*2-m.x/2-D.x/2;v.y=v.y*2-m.y/2-D.y/2;var ct=[];var _t=[];qt.subdivideCurve(y.x,y.y,x.x,x.y,C.x,C.y,m.x,m.y,v.x,v.y,D.x,D.y,ct,_t);if(R>0){for(var ft=0;ft<ct.length/6;ft++){qt.addTriangle(ct[ft*6],ct[ft*6+1],ct[ft*6+2],ct[ft*6+3],ct[ft*6+4],ct[ft*6+5],-128,e);qt.addTriangle(_t[ft*6],_t[ft*6+1],ct[ft*6],ct[ft*6+1],ct[ft*6+2],ct[ft*6+3],0,e);qt.addTriangle(_t[ft*6],_t[ft*6+1],_t[ft*6+4],_t[ft*6+5],ct[ft*6+2],ct[ft*6+3],0,e);qt.addTriangle(_t[ft*6+4],_t[ft*6+5],ct[ft*6+2],ct[ft*6+3],ct[ft*6+4],ct[ft*6+5],0,e);qt.addTriangle(_t[ft*6],_t[ft*6+1],_t[ft*6+2],_t[ft*6+3],_t[ft*6+4],_t[ft*6+5],127,e)}}else{for(var ft=0;ft<ct.length/6;ft++){qt.addTriangle(ct[ft*6],ct[ft*6+1],ct[ft*6+2],ct[ft*6+3],ct[ft*6+4],ct[ft*6+5],127,e);qt.addTriangle(ct[ft*6],ct[ft*6+1],_t[ft*6],_t[ft*6+1],_t[ft*6+2],_t[ft*6+3],0,e);qt.addTriangle(ct[ft*6],ct[ft*6+1],ct[ft*6+4],ct[ft*6+5],_t[ft*6+2],_t[ft*6+3],0,e);qt.addTriangle(ct[ft*6+4],ct[ft*6+5],_t[ft*6+2],_t[ft*6+3],_t[ft*6+4],_t[ft*6+5],0,e);qt.addTriangle(_t[ft*6],_t[ft*6+1],_t[ft*6+2],_t[ft*6+3],_t[ft*6+4],_t[ft*6+5],-128,e)}}}else if(F[u]>=te.BUILD_JOINT){U+=3;if(F[u]==te.BUILD_ROUND_JOINT){D=B[U++];y=B[U++];m=B[U++];qt.addTriangle(y.x,y.y,D.x,D.y,m.x,m.y,-1,e)}}}V=0;U=0;for(u=0;u<F.length;u++){if(F[u]==te.LINE_TO){y=B[U++];m=B[U++];C=B[U];D=B[U+1];qt.addTriangle(y.x,y.y,m.x,m.y,C.x,C.y,0,e);qt.addTriangle(m.x,m.y,D.x,D.y,C.x,C.y,0,e)}else if(F[u]==te.CURVE_TO){U+=5}else if(F[u]>=te.BUILD_JOINT){C=B[U++];y=B[U++];m=B[U++];qt.addTriangle(y.x,y.y,m.x,m.y,C.x,C.y,0,e);if(F[u]==te.BUILD_ROUND_JOINT){U+=3}}}if(!E){M.x=h[2]-h[0];M.y=h[3]-h[1];M.normalize();qt.createCap(h[0],h[1],B[0],B[1],M,s.capstyle,-128,s.half_thickness,e);M.x=h[h.length-2]-h[h.length-4];M.y=h[h.length-1]-h[h.length-3];M.normalize();qt.createCap(h[h.length-2],h[h.length-1],B[B.length-2],B[B.length-1],M,s.capstyle,127,s.half_thickness,e)}}}};return t}();var Te=function(){function t(t,e){if(t===void 0){t=16777215}if(e===void 0){e=1}this._color=t;this._alpha=e}Object.defineProperty(t.prototype,"data_type",{get:function(){return t.data_type},enumerable:true,configurable:true});return t}();Te.data_type="[graphicsdata FillStyle]";var Pe=function(){function t(t,e,i,r,n,s){if(t===void 0){t=16777215}if(e===void 0){e=1}if(i===void 0){i=10}if(r===void 0){r=Ce.ROUND}if(n===void 0){n=Xt.SQUARE}if(s===void 0){s=10}this._color=t;this._alpha=e;this._thickness=i;this._jointstyle=r;this._capstyle=n;this._miter_limit=s}Object.defineProperty(t.prototype,"data_type",{get:function(){return t.data_type},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"half_thickness",{get:function(){return this._thickness/2},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"jointstyle",{get:function(){return this._jointstyle},set:function(t){this._jointstyle=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"miter_limit",{get:function(){return this._miter_limit},set:function(t){this._miter_limit=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"capstyle",{get:function(){return this._capstyle},set:function(t){this._capstyle=t},enumerable:true,configurable:true});return t}();Pe.data_type="[graphicsdata StrokeStyle]";var Se=function(){function t(){}return t}();Se.EVEN_ODD="evenOdd";Se.NON_ZERO="nonZero";var Ee=function(){function t(t,e,i){if(t===void 0){t=null}if(e===void 0){e=null}if(i===void 0){i=Se.EVEN_ODD}this._data=[];this._commands=[];this._style=null;if(t!=null&&e!=null){this._data[0]=e;this._commands[0]=t}else{this._data[0]=[];this._commands[0]=[]}this._startPoint=new z;this._cur_point=new z;this._winding_rule=i;this._winding_directions=[]}Object.defineProperty(t.prototype,"data_type",{get:function(){return t.data_type},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"style",{get:function(){return this._style},set:function(t){this._style=t},enumerable:true,configurable:true});t.prototype.fill=function(){if(this._style==null)return null;if(this._style.data_type==Te.data_type)return this._style;return null};t.prototype.stroke=function(){if(this._style==null)return null;if(this._style.data_type==Pe.data_type)return this._style;return null};Object.defineProperty(t.prototype,"commands",{get:function(){return this._commands},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:true,configurable:true});t.prototype.curveTo=function(t,e,i,r){if(t==i&&e==r){this.lineTo(t,e);this.moveTo(i,r);return}if(this._cur_point.x==i&&this._cur_point.y==r&&(this._cur_point.x!=t||this._cur_point.y!=e)){this.lineTo(t,e);this.moveTo(i,r);return}if((this._cur_point.x!=i||this._cur_point.y!=r)&&(this._cur_point.x==t&&this._cur_point.y==e)){this.lineTo(i,r);return}if(this._cur_point.x==i&&this._cur_point.y==r&&(this._cur_point.x==t&&this._cur_point.y==e)){console.log("curveTo command not added because startpoint and endpoint are the same.");this.lineTo(i,r);return}if(this._commands[this._commands.length-1].length==0){this._commands[this._commands.length-1].push(te.MOVE_TO);this._data[this._data.length-1].push(this._cur_point.x);this._data[this._data.length-1].push(this._cur_point.y)}this._commands[this._commands.length-1].push(te.CURVE_TO);this._data[this._data.length-1].push(t);this._data[this._data.length-1].push(e);this._data[this._data.length-1].push(i);this._data[this._data.length-1].push(r);this._cur_point.x=i;this._cur_point.y=r};t.prototype.cubicCurveTo=function(t,e,i,r,n,s){console.log("cubicCurveTo not yet fully supported.");if(this._cur_point.x==n&&this._cur_point.y==s){console.log("curveTo command not added because startpoint and endpoint are the same.");return}if(this._commands[this._commands.length-1].length==0){this._commands[this._commands.length-1].push(te.MOVE_TO);this._data[this._data.length-1].push(this._cur_point.x);this._data[this._data.length-1].push(this._cur_point.y)}this._commands[this._commands.length-1].push(te.CURVE_TO);this._data[this._data.length-1].push(t);this._data[this._data.length-1].push(e);this._data[this._data.length-1].push(n);this._data[this._data.length-1].push(s);this._cur_point.x=n;this._cur_point.y=s};t.prototype.lineTo=function(t,e){if(this._cur_point.x==t&&this._cur_point.y==e){console.log("lineTo command not added because startpoint and endpoint are the same.");return}if(this._commands[this._commands.length-1].length==0){this._commands[this._commands.length-1].push(te.MOVE_TO);this._data[this._data.length-1].push(this._cur_point.x);this._data[this._data.length-1].push(this._cur_point.y)}this._commands[this._commands.length-1].push(te.LINE_TO);this._data[this._data.length-1].push(t);this._data[this._data.length-1].push(e);this._cur_point.x=t;this._cur_point.y=e};t.prototype.moveTo=function(t,e){if(this._cur_point.x==t&&this._cur_point.y==e){console.log("moveTo command not added because startpoint and endpoint are the same.");return}if(this._commands[this._commands.length-1].length>0){this._commands.push([te.MOVE_TO]);this._data.push([t,e])}this._startPoint.x=t;this._startPoint.y=e;this._cur_point.x=t;this._cur_point.y=e};t.prototype.wideLineTo=function(t,e){};t.prototype.wideMoveTo=function(t,e){};return t}();Ee.data_type="[graphicsdata path]";var Me=function(){function t(){}return t}();Me.LINEAR_RGB="linearRGB";Me.RGB="rgb";var Oe=function(){function t(){}return t}();Oe.HORIZONTAL="horizontal";Oe.NONE="none";Oe.NORMAL="normal";Oe.VERTICAL="vertical";var Ie=function(){function t(){}return t}();Ie.ALWAYS="always";Ie.AUTO="auto";Ie.NEVER="never";var Re=function(){function t(){}return t}();Re.PAD="pad";Re.REFLECT="reflect";Re.REPEAT="repeat";var Le=function(){function t(){}return t}();Le.NEGATIVE="negative";Le.NONE="none";Le.POSITIVE="positive";var Ne=function(){function t(){}return t}();Ne.TRIANGLE="triangle";Ne.LINE="line";var Fe=function(){function t(){}return t}();Fe.ALPHA=8;Fe.BLUE=4;Fe.GREEN=2;Fe.RED=1;var Be=function(t){e(i,t);function i(e){var i=t.call(this,8,8,true)||this;i._urlRequest=e;return i}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"urlRequest",{get:function(){return this._urlRequest},set:function(t){this._urlRequest=t},enumerable:true,configurable:true});i.prototype.clone=function(){var t=new i(this._urlRequest);return t};return i}(ae);Be.assetType="[image ExternalImage2D]";var Ve=function(t){e(i,t);function i(e,i){if(e===void 0){e=false}if(i===void 0){i=false}return t.call(this,e,i)||this}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});return i}(ie);Ve.assetType="[asset SamplerCube]";var Ue=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i=null}var r=t.call(this,1,1)||this;r._specularSource=e;r._glossSource=i;r._output=new pe(1,1,false,16777215);r._testSize();return r}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"specularSource",{get:function(){return this._specularSource},set:function(t){if(this._specularSource==t)return;this._specularSource=t;this.invalidate();this._testSize()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"glossSource",{get:function(){return this._glossSource},set:function(t){if(this._glossSource==t)return;this._glossSource=t;this.invalidate();this._testSize()},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this._specularSource,this._glossSource)};i.prototype.dispose=function(){t.prototype.dispose.call(this);this._rect=null;this._output.dispose()};i.prototype.getImageData=function(){var t=new z;this._output.fillRect(this._rect,16777215);if(this._glossSource)this._output.copyChannel(this._glossSource,this._rect,t,Fe.GREEN,Fe.GREEN);if(this._specularSource)this._output.copyChannel(this._specularSource,this._rect,t,Fe.RED,Fe.RED);return this._output.getImageData()};i.prototype.getCanvas=function(){return this._output.getCanvas()};i.prototype._setSize=function(e,i){t.prototype._setSize.call(this,e,i);this._output._setSize(e,i)};i.prototype._testSize=function(){var t,e;if(this._specularSource){t=this._specularSource.width;e=this._specularSource.height}else if(this._glossSource){t=this._glossSource.width;e=this._glossSource.height}else{t=1;e=1}if(t!=this._output.width&&e!=this._output.height){this._output.dispose();this._output=new pe(t,e,false,16777215)}this._setSize(t,e)};return i}(ae);Ue.assetType="[asset SpecularImage2D]";var ke=function(t){e(i,t);function i(){return t.call(this,J.BLOB)||this}i.supportsType=function(t){t=t.toLowerCase();return t=="jpg"||t=="jpeg"||t=="png"||t=="gif"};i.supportsData=function(t){if(t instanceof HTMLImageElement)return true;if(!(t instanceof mt))return false;var e=t;e.position=0;if(e.readUnsignedShort()==55551)return true;e.position=0;if(e.readShort()==16973)return true;e.position=1;if(e.readUTFBytes(3)=="PNG")return true;e.position=0;if(e.readUTFBytes(3)=="GIF"&&e.readShort()==14393&&e.readByte()==97)return true;e.position=0;if(e.readUTFBytes(3)=="ATF")return true;return false};i.prototype._pProceedParsing=function(){var t=this;var e;var i=false;if(this._loadingImage){return bt.MORE_TO_PARSE}else if(this._htmlImageElement){e=se.imageToBitmapImage2D(this._htmlImageElement,false);this._pFinalizeAsset(e,this._iFileName)}else if(this.data instanceof HTMLImageElement){var r=this.data;e=se.imageToBitmapImage2D(r,false);this._pFinalizeAsset(e,this._iFileName)}else if(this.data instanceof mt){var n=this.data;n.position=0;this._htmlImageElement=yt.byteArrayToImage(this.data);if(!this._htmlImageElement.complete){this._htmlImageElement.onload=function(e){return t.onLoadComplete(e)};this._loadingImage=true;return bt.MORE_TO_PARSE}e=se.imageToBitmapImage2D(this._htmlImageElement,false);this._pFinalizeAsset(e,this._iFileName)}else if(this.data instanceof ArrayBuffer){this._htmlImageElement=yt.arrayBufferToImage(this.data);e=se.imageToBitmapImage2D(this._htmlImageElement,false);this._pFinalizeAsset(e,this._iFileName)}else if(this.data instanceof Blob){this._htmlImageElement=yt.blobToImage(this.data);this._htmlImageElement.onload=function(e){return t.onLoadComplete(e)};this._loadingImage=true;return bt.MORE_TO_PARSE}else if(this.data instanceof dt){e=new Be(this.data);this._pFinalizeAsset(e,this._iFileName)}if(i){}this._pContent=e;return bt.PARSING_DONE};i.prototype.onLoadComplete=function(t){this._loadingImage=false};return i}(bt);var ze=function(t){e(i,t);function i(){return t.call(this,J.TEXT)||this}i.supportsType=function(t){t=t.toLowerCase();return t=="cube"};i.supportsData=function(t){try{var e=JSON.parse(t);if(e)return true;return false}catch(i){return false}};i.prototype._iResolveDependency=function(t){};i.prototype._iResolveDependencyFailure=function(t){};i.prototype._pProceedParsing=function(){if(this._imgDependencyDictionary!=null){var t=new _e(this._getBitmapImage2D(i.posX).width);t.draw(_e.posX,this._getBitmapImage2D(i.posX));t.draw(_e.negX,this._getBitmapImage2D(i.negX));t.draw(_e.posY,this._getBitmapImage2D(i.posY));t.draw(_e.negY,this._getBitmapImage2D(i.negY));t.draw(_e.posZ,this._getBitmapImage2D(i.posZ));t.draw(_e.negZ,this._getBitmapImage2D(i.negZ));this._imgDependencyDictionary=null;t.name=this._iFileName;this._pFinalizeAsset(t,this._iFileName);return bt.PARSING_DONE}try{var e=JSON.parse(this.data);var r=e.data;var n;if(r.length!=6)this._pDieWithError("ImageCubeParser: Error - cube texture should have exactly 6 images");if(e){this._imgDependencyDictionary=new Object;for(var s=0;s<r.length;s++){n=r[s];this._imgDependencyDictionary[n.id]=this._pAddDependency(n.id,new dt(n.image.toString()))}if(!this._validateCubeData()){this._pDieWithError("ImageCubeParser: JSON data error - cubes require id of:   \n"+i.posX+", "+i.negX+",  \n"+i.posY+", "+i.negY+",  \n"+i.posZ+", "+i.negZ);return bt.PARSING_DONE}this._pPauseAndRetrieveDependencies();return bt.MORE_TO_PARSE}}catch(a){this._pDieWithError("CubeTexturePaser Error parsing JSON")}return bt.PARSING_DONE};i.prototype._validateCubeData=function(){return this._imgDependencyDictionary[i.posX]!=null&&this._imgDependencyDictionary[i.negX]!=null&&this._imgDependencyDictionary[i.posY]!=null&&this._imgDependencyDictionary[i.negY]!=null&&this._imgDependencyDictionary[i.posZ]!=null&&this._imgDependencyDictionary[i.negZ]!=null};i.prototype._getBitmapImage2D=function(t){var e=this._imgDependencyDictionary[t];if(e)return e.assets[0];return null};return i}(bt);ze.posX="posX";ze.negX="negX";ze.posY="posY";ze.negY="negY";ze.posZ="posZ";ze.negZ="negZ";var je=function(t){e(i,t);function i(){var e=t.call(this,J.TEXT)||this;e._parseState=0;return e}i.supportsType=function(t){t=t.toLowerCase();return t=="xml"};i.supportsData=function(t){try{var e=yt.toString(t);if(e.indexOf("TextureAtlas")!=-1||e.indexOf("textureatlas")!=-1)return true;return false}catch(i){return false}};i.prototype._iResolveDependency=function(t){if(t.assets.length){this._imageData=t.assets[0];this._pFinalizeAsset(this._imageData);this._parseState=Ge.PARSE_SUBTEXTURES}else{this._parseState=Ge.PARSE_COMPLETE}};i.prototype._iResolveDependencyFailure=function(t){this._parseState=Ge.PARSE_COMPLETE};i.prototype._pProceedParsing=function(){var t;switch(this._parseState){case Ge.PARSE_XML:try{this._doc=Ft.getChildrenWithTag(Ft.strToXml(this._pGetTextData()),"TextureAtlas")[0];this._imagePath=Ft.readAttributeValue(this._doc,"imagePath");this._subTextureNodes=Ft.getChildrenWithTag(this._doc,"SubTexture");this._parseState=Ge.PARSE_IMAGE}catch(e){return bt.PARSING_DONE}break;case Ge.PARSE_IMAGE:if(this._imagePath){this._pAddDependency(this._imagePath,new dt(this._imagePath));this._pPauseAndRetrieveDependencies()}else{return bt.PARSING_DONE}break;case Ge.PARSE_SUBTEXTURES:var i;var r;var n;var s;var a;var o;var h=this._subTextureNodes.length;for(var u=0;u<h;u++){r=this._subTextureNodes[u];i=new re;n=Ft.readAttributeValue(r,"x");s=Ft.readAttributeValue(r,"y");a=Ft.readAttributeValue(r,"width");o=Ft.readAttributeValue(r,"height");if(n||s||a||o)i.imageRect=new Y(parseInt(n)/this._imageData.width,parseInt(s)/this._imageData.height,parseInt(a)/this._imageData.width,parseInt(o)/this._imageData.height);n=Ft.readAttributeValue(r,"frameX");s=Ft.readAttributeValue(r,"frameY");a=Ft.readAttributeValue(r,"frameWidth");o=Ft.readAttributeValue(r,"frameHeight");if(n||s||a||o)i.frameRect=new Y(parseInt(n),parseInt(s),parseInt(a),parseInt(o));this._pFinalizeAsset(i,Ft.readAttributeValue(r,"name"))}this._parseState=Ge.PARSE_COMPLETE;break;case Ge.PARSE_COMPLETE:return bt.PARSING_DONE}return bt.MORE_TO_PARSE};return i}(bt);var Ge=function(){function t(){}return t}();Ge.PARSE_XML=0;Ge.PARSE_IMAGE=1;Ge.PARSE_SUBTEXTURES=2;Ge.PARSE_COMPLETE=3;var He=function(){function t(t){this.entity=t}return t}();var Xe=function(){function t(){}t._generateMipMaps=function(e,i,r){if(r===void 0){r=false}var n=e.width;var s=e.height;var a=0;var o;t._rect.width=n;t._rect.height=s;while(n>=1||s>=1){o=i[a]=t._getMipmapHolder(i[a],t._rect.width,t._rect.height);if(r)o.fillRect(t._rect,0);t._matrix.a=t._rect.width/e.width;t._matrix.d=t._rect.height/e.height;if(typeof document!=="undefined"){o.draw(e,t._matrix)}else{if(e.constructor.toString().indexOf("BitmapImage2D")>-1){var h=e;h.lock();o.lock();this.downsampleImage(h.getImageData(),o.getImageData());o.unlock();h.unlock()}else if(e.constructor.toString().indexOf("CPUCanvas")>-1){this.downsampleImage(e.getImageData(),o.getImageData())}else{this.downsampleImage(e,o.getImageData())}}n>>=1;s>>=1;t._rect.width=n>1?n:1;t._rect.height=s>1?s:1;a++}};t._getMipmapHolder=function(e,i,r){if(e){if(e.width==i&&e.height==r)return e;t._freeMipMapHolder(e)}if(!t._mipMaps[i]){t._mipMaps[i]=[];t._mipMapUses[i]=[]}if(!t._mipMaps[i][r]){e=t._mipMaps[i][r]=new pe(i,r,true);t._mipMapUses[i][r]=1}else{t._mipMapUses[i][r]=t._mipMapUses[i][r]+1;e=t._mipMaps[i][r]}return e};t._freeMipMapHolder=function(e){var i=e.width;var r=e.height;if(--t._mipMapUses[i][r]==0){t._mipMaps[i][r].dispose();t._mipMaps[i][r]=null}};t.downsampleImage=function(t,e){var i=new Ye;var r=new We(i,t.width,e.width,4);var n=new We(i,t.height,e.height,4);var s=[];var a=0;var o=0;var h=0;var u=0;var l=0;var p=0;var c=0;var _=0;var f=0;var d;var g;var m=0;var y=0;var v=0;for(var x=0;x<t.height;x++){h=r.len;a=h/t.width;o=1/a;u=r.width;l=r.windowSize;for(m=0;m<h;m++){d=(.5+m)*o;g=Math.floor(d-u);p=0;c=0;_=0;f=0;for(var y=0;y<l;++y){v=(x*t.width+(g+y))*4;var b=t.data[v];var w=t.data[v+1];var D=t.data[v+2];var C=t.data[v+3];var A=r.valueAt(m,y);p+=A*b;c+=A*w;_+=A*D;f+=A*C}v=(x*e.width+m)*4;s[v]=p;s[v+1]=c;s[v+2]=_;s[v+3]=f}}for(var T=0;T<e.width;T++){h=n.len;a=h/t.height;o=1/a;u=n.width;l=n.windowSize;for(m=0;m<h;m++){d=(.5+m)*o;g=Math.floor(d-u);p=0;c=0;_=0;f=0;for(y=0;y<l;++y){v=((y+g)*e.width+T)*4;var b=s[v];var w=s[v+1];var D=s[v+2];var C=s[v+3];var A=n.valueAt(m,y);p+=A*b;c+=A*w;_+=A*D;f+=A*C}v=(m*e.width+T)*4;e.data[v]=p;e.data[v+1]=c;e.data[v+2]=_;e.data[v+3]=f}}return e};return t}();Xe._mipMaps=[];Xe._mipMapUses=[];Xe._matrix=new j;Xe._rect=new Y;var We=function(){function t(t,e,i,r){var n=i/e;var s=1/n;if(n>1){r=1;n=1}this.len=i;this.width=t.width*s;this.windowSize=Math.ceil(this.width*2);this.data=[];for(var a=0;a<this.len;a++){var o=(.5+a)*s;var h=Math.floor(o-this.width);var u=0;for(var l=0;l<this.windowSize;l++){var p=t.sampleBox(h+l-o,n,r);this.data[a*this.windowSize+l]=p;u+=p}for(var l=0;l<this.windowSize;l++){this.data[a*this.windowSize+l]/=u}}}t.prototype.valueAt=function(t,e){return this.data[t*this.windowSize+e]};return t}();var Ye=function(){function t(){}Object.defineProperty(t.prototype,"width",{get:function(){return.5},enumerable:true,configurable:true});t.prototype.sampleBox=function(t,e,i){var r=0;var n=1/i;for(var s=0;s<i;s++){var a=(t+(s+.5)*n)*e;var o=this.evaluate(a);r+=o}return r*n};t.prototype.evaluate=function(t){if(Math.abs(t)<=this.width)return 1;else return 0};return t}();var qe=function(t){e(i,t);function i(e){if(e===void 0){e=null}var i=t.call(this)||this;i._boxBoundsInvalid=true;i._sphereBoundsInvalid=true;i._shapes=[];i._current_position=new z;i._entity=e;i._current_position=new z;i._queued_fill_pathes=[];i._queued_stroke_pathes=[];i._active_fill_path=null;i._active_stroke_path=null;i._onInvalidatePropertiesDelegate=function(t){return i._onInvalidateProperties(t)};i._onInvalidateVerticesDelegate=function(t){return i._onInvalidateVertices(t)};i._onAddMaterialDelegate=function(t){return i._onAddMaterial(t)};i._onRemoveMaterialDelegate=function(t){return i._onRemoveMaterial(t)};return i}i.getGraphics=function(t){if(i._pool.length){var e=i._pool.pop();e._entity=t;return e}return new i(t)};i.storeGraphics=function(t){t.clear();i._pool.push(t)};Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"count",{get:function(){return this._shapes.length},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animator",{get:function(){return this._animator},set:function(t){if(this._animator)this._animator.removeOwner(this._entity);this._animator=t;if(this._animator)this._animator.addOwner(this._entity);if(this._material){this._material.iRemoveOwner(this._entity);this._material.iAddOwner(this._entity)}var e;var i=this._shapes.length;for(var r=0;r<i;++r){e=this._shapes[r];if(e.material&&e.material!=this._material){e.material.iRemoveOwner(this._entity);e.material.iAddOwner(this._entity)}e.invalidateElements()}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"style",{get:function(){return this._style},set:function(t){if(this._style==t)return;if(this._style)this._style.removeEventListener(kt.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate);this._style=t;if(this._style)this._style.addEventListener(kt.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate);this.invalidateMaterials()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"queued_stroke_pathes",{get:function(){return this._queued_stroke_pathes},set:function(t){this._queued_stroke_pathes=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"queued_fill_pathes",{get:function(){return this._queued_fill_pathes},set:function(t){this._queued_fill_pathes=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"material",{get:function(){return this._material},set:function(t){if(t==this._material)return;if(this._material&&!this._isShapeMaterial(this._material))this._material.iRemoveOwner(this._entity);this._material=t;if(this._material&&!this._isShapeMaterial(this._material))this._material.iAddOwner(this._entity);this.invalidateMaterials()},enumerable:true,configurable:true});i.prototype.addShape=function(t){var e=this.getShapeIndex(t);if(e!=-1)this.removeShapeAt(e);this._shapes.push(t);t.addEventListener(Qt.INVALIDATE_VERTICES,this._onInvalidateVerticesDelegate);this.invalidate();return t};i.prototype.removeShape=function(t){var e=this.getShapeIndex(t);if(e==-1)throw new E("Shape parameter is not a shape of the caller");this.removeShapeAt(e)};i.prototype.removeShapeAt=function(t){if(t<0||t>=this._shapes.length)throw new N("Index is out of range");this._shapes.splice(t,1)[0].removeEventListener(Qt.INVALIDATE_VERTICES,this._onInvalidateVerticesDelegate);this.invalidate()};i.prototype.removeAllShapes=function(){var t;var e=this._shapes.length;for(var i=0;i<e;i++){t=this._shapes[i];t.removeEventListener(Qt.INVALIDATE_VERTICES,this._onInvalidateVerticesDelegate);t.removeEventListener(zt.ADD_MATERIAL,this._onAddMaterialDelegate);t.removeEventListener(zt.REMOVE_MATERIAL,this._onRemoveMaterialDelegate)}this._shapes.length=0;this.invalidate()};i.prototype.getShapeAt=function(t){return this._shapes[t]};i.prototype.getShapeIndex=function(t){return this._shapes.indexOf(t)};i.prototype.applyTransformation=function(t){var e=this._shapes.length;for(var i=0;i<e;++i){this._shapes[i].applyTransformation(t)}};i.prototype.copyTo=function(t){t.material=this._material;t.style=this._style;t.particles=this.particles;t.numParticles=this.numParticles;t._addShapes(this._shapes);if(this._animator)t.animator=this._animator.clone()};i.prototype.scale=function(t){var e=this._shapes.length;for(var i=0;i<e;++i)this._shapes[i].scale(t)};i.prototype.clear=function(){for(var t=this._shapes.length-1;t>=0;t--){this._shapes[t].clear()}};i.prototype.dispose=function(){this.material=null;this.removeAllShapes();if(this._animator)this._animator.dispose()};i.prototype.scaleUV=function(t,e){if(t===void 0){t=1}if(e===void 0){e=1}var i=this._shapes.length;for(var r=0;r<i;++r)this._shapes[r].scaleUV(t,e)};i.prototype.getBoxBounds=function(){if(this._boxBoundsInvalid){this._boxBoundsInvalid=false;if(!this._boxBounds)this._boxBounds=new T;if(this._shapes.length){this._boxBounds.setBoundIdentity();var t=this._shapes.length;for(var e=0;e<t;e++){this._boxBounds=this._boxBounds.union(this._shapes[e].getBoxBounds(),this._boxBounds)}}else{this._boxBounds.setEmpty()}}return this._boxBounds};i.prototype.getSphereBounds=function(t,e){if(e===void 0){e=null}var i=this._shapes.length;for(var r=0;r<i;r++){e=this._shapes[r].getSphereBounds(t,e)}return e};i.prototype.invalidate=function(){t.prototype.invalidate.call(this);this._boxBoundsInvalid=true;this._sphereBoundsInvalid=true};i.prototype.invalidateMaterials=function(){var t=this._shapes.length;for(var e=0;e<t;++e)this._shapes[e].invalidateMaterial()};i.prototype.invalidateElements=function(){var t=this._shapes.length;for(var e=0;e<t;++e)this._shapes[e].invalidateElements()};i.prototype._hitTestPointInternal=function(t,e){var i=this._shapes.length;for(var r=0;r<i;r++)if(this._shapes[r].hitTestPoint(t,e,0))return true;return false};i.prototype.acceptTraverser=function(t){var e=this._shapes.length;for(var i=0;i<e;i++)t[this._shapes[i].elements.traverseName](this._shapes[i])};i.prototype._onInvalidateProperties=function(t){this.invalidateMaterials()};i.prototype._onInvalidateVertices=function(t){if(t.attributesView!=t.target.positions)return;this.invalidate()};i.prototype.draw_fills=function(){De.draw_pathes(this)};i.prototype._onAddMaterial=function(t){var e=t.shape.material;if(e!=this._material)e.iAddOwner(this._entity)};i.prototype._onRemoveMaterial=function(t){var e=t.shape.material;if(e!=this._material)e.iRemoveOwner(this._entity)};i.prototype.draw_strokes=function(){var t=[];Ae.draw_pathes(this.queued_stroke_pathes,t);this.queued_stroke_pathes.length=0;var e=new p(Float32Array,3);e.set(t);var i=e.attributesBuffer;e.dispose();var r=new $t(i);r.setPositions(new f(i));r.setCustomAttributes("curves",new c(i,false));var n=we.getDefaultMaterial();n.bothSides=true;n.useColorTransform=true;n.curves=true;var s=new re;var a=this.addShape(jt.getShape(r,n));if(a){a.style=new Gt;a.style.addSamplerAt(s,a.material.getTextureAt(0));a.style.uvMatrix=new j(0,0,0,0,.126,0);a.material.animateUVs=true}};i.prototype.beginBitmapFill=function(t,e,i,r){if(e===void 0){e=null}if(i===void 0){i=true}if(r===void 0){r=false}this.draw_fills();this._active_fill_path=new Ee;this._active_fill_path.style=new Te(16777215,1);if(this._current_position.x!=0||this._current_position.y!=0)this._active_fill_path.moveTo(this._current_position.x,this._current_position.y);this._queued_fill_pathes.push(this._active_fill_path)};i.prototype.beginFill=function(t,e){if(e===void 0){e=1}this.draw_fills();this._active_fill_path=new Ee;this._active_fill_path.style=new Te(t,e);if(this._current_position.x!=0||this._current_position.y!=0)this._active_fill_path.moveTo(this._current_position.x,this._current_position.y);this._queued_fill_pathes.push(this._active_fill_path)};i.prototype.beginGradientFill=function(t,e,i,r,n,s,a,o){if(n===void 0){n=null}if(s===void 0){s="pad"}if(a===void 0){a="rgb"}if(o===void 0){o=0}this.draw_fills();this._active_fill_path=new Ee;this._active_fill_path.style=new Te(e[0],i[0]);if(this._current_position.x!=0||this._current_position.y!=0)this._active_fill_path.moveTo(this._current_position.x,this._current_position.y);this._queued_fill_pathes.push(this._active_fill_path)};i.prototype.copyFrom=function(t){t.copyTo(this)};i.prototype.cubicCurveTo=function(t,e,i,r,n,s){throw new L("cubicCurveTo")};i.prototype.curveTo=function(t,e,i,r){if(this._active_fill_path!=null){this._active_fill_path.curveTo(t,e,i,r)}if(this._active_stroke_path!=null){this._active_stroke_path.curveTo(t,e,i,r)}this._current_position.x=i;this._current_position.y=r};i.prototype.drawCircle=function(t,e,i){var r=i*1.065;if(this._active_fill_path!=null){this._active_fill_path.moveTo(t-i,e);for(var n=8;n>=0;n--){var s=n*(360/8)*Math.PI/180;var a=s+360/16*Math.PI/180;this._active_fill_path.curveTo(t-Math.cos(a)*r,e+Math.sin(a)*r,t-Math.cos(s)*i,e+Math.sin(s)*i)}}if(this._active_stroke_path!=null){this._active_stroke_path.moveTo(t,e+i);var r=i*.93;this._active_stroke_path.curveTo(t-r,e+r,t-i,e);this._active_stroke_path.curveTo(t-r,e-r,t,e-i);this._active_stroke_path.curveTo(t+r,e-r,t+i,e);this._active_stroke_path.curveTo(t+r,e+r,t,e+i)}};i.prototype.drawEllipse=function(t,e,i,r){i/=2;r/=2;if(this._active_fill_path!=null){this._active_fill_path.moveTo(t,e+r);this._active_fill_path.curveTo(t-i,e+r,t-i,e);this._active_fill_path.curveTo(t-i,e-r,t,e-r);this._active_fill_path.curveTo(t+i,e-r,t+i,e);this._active_fill_path.curveTo(t+i,e+r,t,e+r)}if(this._active_stroke_path!=null){
this._active_stroke_path.moveTo(t,e+r);this._active_stroke_path.curveTo(t-i,e+r,t-i,e);this._active_stroke_path.curveTo(t-i,e-r,t,e-r);this._active_stroke_path.curveTo(t+i,e-r,t+i,e);this._active_stroke_path.curveTo(t+i,e+r,t,e+r)}};i.prototype.drawGraphicsData=function(t){};i.prototype.drawPath=function(t,e,i){};i.prototype.drawRect=function(t,e,i,r){if(this._active_fill_path!=null){this._active_fill_path.moveTo(t,e);this._active_fill_path.lineTo(t+i,e);this._active_fill_path.lineTo(t+i,e+r);this._active_fill_path.lineTo(t,e+r);this._active_fill_path.lineTo(t,e)}if(this._active_stroke_path!=null){this._active_stroke_path.moveTo(t,e);this._active_stroke_path.lineTo(t+i,e);this._active_stroke_path.lineTo(t+i,e+r);this._active_stroke_path.lineTo(t,e+r);this._active_stroke_path.lineTo(t,e)}};i.prototype.drawRoundRect=function(t,e,i,r,n,s){if(s===void 0){s=NaN}if(!s){s=n}if(this._active_fill_path!=null){this._active_fill_path.moveTo(t+n,e);this._active_fill_path.lineTo(t+i-n,e);this._active_fill_path.curveTo(t+i,e,t+i,e+s);this._active_fill_path.lineTo(t+i,e+r-s);this._active_fill_path.curveTo(t+i,e+r,t+i-n,e+r);this._active_fill_path.lineTo(t+n,e+r);this._active_fill_path.curveTo(t,e+r,t,e+r-s);this._active_fill_path.lineTo(t,e+s);this._active_fill_path.curveTo(t,e,t+n,e)}if(this._active_stroke_path!=null){this._active_stroke_path.moveTo(t+n,e);this._active_stroke_path.lineTo(t+i-n,e);this._active_stroke_path.curveTo(t+i,e,t+i,e+s);this._active_stroke_path.lineTo(t+i,e+r-s);this._active_stroke_path.curveTo(t+i,e+r,t+i-n,e+r);this._active_stroke_path.lineTo(t+n,e+r);this._active_stroke_path.curveTo(t,e+r,t,e+r-s);this._active_stroke_path.lineTo(t,e+s);this._active_stroke_path.curveTo(t,e,t+n,e)}};i.prototype.drawTriangles=function(t,e,i,r){if(e===void 0){e=null}if(i===void 0){i=null}if(r===void 0){r=null}if(this._active_fill_path!=null){}if(this._active_stroke_path!=null){}};i.prototype.endFill=function(){this.draw_strokes();this.draw_fills();this._active_fill_path=null;this._active_stroke_path=null};i.prototype.lineBitmapStyle=function(t,e,i,r){if(e===void 0){e=null}if(i===void 0){i=true}if(r===void 0){r=false}this._active_stroke_path=new Ee;if(this._current_position.x!=0||this._current_position.y!=0)this._active_stroke_path.moveTo(this._current_position.x,this._current_position.y);this._queued_stroke_pathes.push(this._active_stroke_path)};i.prototype.lineGradientStyle=function(t,e,i,r,n,s,a,o){if(n===void 0){n=null}if(s===void 0){s=null}if(a===void 0){a=null}if(o===void 0){o=0}this._active_stroke_path=new Ee;if(this._current_position.x!=0||this._current_position.y!=0)this._active_stroke_path.moveTo(this._current_position.x,this._current_position.y);this._queued_stroke_pathes.push(this._active_stroke_path)};i.prototype.lineStyle=function(t,e,i,r,n,s,a,o){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=1}if(r===void 0){r=false}if(n===void 0){n=null}if(s===void 0){s=Xt.NONE}if(a===void 0){a=Ce.MITER}if(o===void 0){o=100}this._active_stroke_path=new Ee;this._active_stroke_path.style=new Pe(e,i,t,a,s,o);if(this._current_position.x!=0||this._current_position.y!=0)this._active_stroke_path.moveTo(this._current_position.x,this._current_position.y);this._queued_stroke_pathes.push(this._active_stroke_path)};i.prototype.lineTo=function(t,e){if(this._active_fill_path!=null){this._active_fill_path.lineTo(t,e)}if(this._active_stroke_path!=null){this._active_stroke_path.lineTo(t,e)}this._current_position.x=t;this._current_position.y=e};i.prototype.moveTo=function(t,e){if(this._active_fill_path!=null){this._active_fill_path.moveTo(t,e)}if(this._active_stroke_path!=null){this._active_stroke_path.moveTo(t,e)}this._current_position.x=t;this._current_position.y=e};i.prototype._addShapes=function(t){var e;var i=t.length;for(var r=0;r<i;r++){e=t[r];e.addEventListener(Qt.INVALIDATE_VERTICES,this._onInvalidateVerticesDelegate);e.addEventListener(zt.ADD_MATERIAL,this._onAddMaterialDelegate);e.addEventListener(zt.REMOVE_MATERIAL,this._onRemoveMaterialDelegate);this._shapes.push(e)}this.invalidate()};i.prototype._isShapeMaterial=function(t){var e=this._shapes.length;for(var i=0;i<e;i++)if(t==this._shapes[i].material)return true;return false};return i}(h);qe._pool=new Array;qe.assetType="[asset Graphics]";var Ke=function(){function t(t,e){this.useMethod=true;this.method=t;this.pass=e}t.prototype.reset=function(){this.method.iReset();this.vertexConstantsIndex=-1;this.secondaryVertexConstantsIndex=-1;this.fragmentConstantsIndex=-1;this.secondaryFragmentConstantsIndex=-1;this.needsProjection=false;this.needsView=false;this.needsNormals=false;this.needsTangents=false;this.needsGlobalVertexPos=false;this.needsGlobalFragmentPos=false;this.vertexMatrices=new Array};return t}();var Ze=function(){function t(){}return t}();var Qe=function(){function t(){}return t}();var Je=function(){function t(t,e,i,r,n,s,a,o,h,u){this.a=new Qe;this.b=new Qe;this.flags=new Ze;this.dest=t;this.a.format=e;this.a.size=i;this.b.format=r;this.b.size=n;this.opcode=s;this.flags.simple=a;this.flags.horizontal=o;this.flags.fragonly=h;this.flags.matrix=u}return t}();var $e=function(){function t(){}Object.defineProperty(t,"map",{get:function(){if(!t._map){t._map=new Array;t._map["mov"]=new Je("vector","vector",4,"none",0,0,true,null,null,null);t._map["add"]=new Je("vector","vector",4,"vector",4,1,true,null,null,null);t._map["sub"]=new Je("vector","vector",4,"vector",4,2,true,null,null,null);t._map["mul"]=new Je("vector","vector",4,"vector",4,3,true,null,null,null);t._map["div"]=new Je("vector","vector",4,"vector",4,4,true,null,null,null);t._map["rcp"]=new Je("vector","vector",4,"none",0,5,true,null,null,null);t._map["min"]=new Je("vector","vector",4,"vector",4,6,true,null,null,null);t._map["max"]=new Je("vector","vector",4,"vector",4,7,true,null,null,null);t._map["frc"]=new Je("vector","vector",4,"none",0,8,true,null,null,null);t._map["sqt"]=new Je("vector","vector",4,"none",0,9,true,null,null,null);t._map["rsq"]=new Je("vector","vector",4,"none",0,10,true,null,null,null);t._map["pow"]=new Je("vector","vector",4,"vector",4,11,true,null,null,null);t._map["log"]=new Je("vector","vector",4,"none",0,12,true,null,null,null);t._map["exp"]=new Je("vector","vector",4,"none",0,13,true,null,null,null);t._map["nrm"]=new Je("vector","vector",4,"none",0,14,true,null,null,null);t._map["sin"]=new Je("vector","vector",4,"none",0,15,true,null,null,null);t._map["cos"]=new Je("vector","vector",4,"none",0,16,true,null,null,null);t._map["crs"]=new Je("vector","vector",4,"vector",4,17,true,true,null,null);t._map["dp3"]=new Je("vector","vector",4,"vector",4,18,true,true,null,null);t._map["dp4"]=new Je("vector","vector",4,"vector",4,19,true,true,null,null);t._map["abs"]=new Je("vector","vector",4,"none",0,20,true,null,null,null);t._map["neg"]=new Je("vector","vector",4,"none",0,21,true,null,null,null);t._map["sat"]=new Je("vector","vector",4,"none",0,22,true,null,null,null);t._map["ted"]=new Je("vector","vector",4,"sampler",1,38,true,null,true,null);t._map["kil"]=new Je("none","scalar",1,"none",0,39,true,null,true,null);t._map["tex"]=new Je("vector","vector",4,"sampler",1,40,true,null,true,null);t._map["m33"]=new Je("vector","matrix",3,"vector",3,23,true,null,null,true);t._map["m44"]=new Je("vector","matrix",4,"vector",4,24,true,null,null,true);t._map["m43"]=new Je("vector","matrix",3,"vector",4,25,true,null,null,true);t._map["ddx"]=new Je("vector","vector",4,"none",0,26,true,null,true,null);t._map["ddy"]=new Je("vector","vector",4,"none",0,27,true,null,true,null);t._map["sge"]=new Je("vector","vector",4,"vector",4,41,true,null,null,null);t._map["slt"]=new Je("vector","vector",4,"vector",4,42,true,null,null,null);t._map["sgn"]=new Je("vector","vector",4,"vector",4,43,true,null,null,null);t._map["seq"]=new Je("vector","vector",4,"vector",4,44,true,null,null,null);t._map["sne"]=new Je("vector","vector",4,"vector",4,45,true,null,null,null)}return t._map},enumerable:true,configurable:true});return t}();var ti=function(){function t(t,e){if(t===void 0){t=null}if(e===void 0){e=null}this.name="";this.version=0;this.name=t;this.version=e;this.data=new mt}return t}();var ei=function(){function t(t,e){this.code=t;this.desc=e}return t}();var ii=function(){function t(){}Object.defineProperty(t,"map",{get:function(){if(!t._map){t._map=new Array;t._map["va"]=new ei(0,"vertex attribute");t._map["fc"]=new ei(1,"fragment constant");t._map["vc"]=new ei(1,"vertex constant");t._map["ft"]=new ei(2,"fragment temporary");t._map["vt"]=new ei(2,"vertex temporary");t._map["vo"]=new ei(3,"vertex output");t._map["op"]=new ei(3,"vertex output");t._map["fd"]=new ei(3,"fragment depth output");t._map["fo"]=new ei(3,"fragment output");t._map["oc"]=new ei(3,"fragment output");t._map["v"]=new ei(4,"varying");t._map["vi"]=new ei(4,"varying output");t._map["fi"]=new ei(4,"varying input");t._map["fs"]=new ei(5,"sampler")}return t._map},enumerable:true,configurable:true});return t}();var ri=function(){function t(t,e,i){this.shift=t;this.mask=e;this.value=i}return t}();var ni=function(){function t(){}Object.defineProperty(t,"map",{get:function(){if(!t._map){t._map=new Array;t._map["rgba"]=new ri(8,15,0);t._map["rg"]=new ri(8,15,5);t._map["r"]=new ri(8,15,4);t._map["compressed"]=new ri(8,15,1);t._map["compressed_alpha"]=new ri(8,15,2);t._map["dxt1"]=new ri(8,15,1);t._map["dxt5"]=new ri(8,15,2);t._map["2d"]=new ri(12,15,0);t._map["cube"]=new ri(12,15,1);t._map["3d"]=new ri(12,15,2);t._map["centroid"]=new ri(16,1,1);t._map["ignoresampler"]=new ri(16,4,4);t._map["clamp"]=new ri(20,15,0);t._map["repeat"]=new ri(20,15,1);t._map["wrap"]=new ri(20,15,1);t._map["nomip"]=new ri(24,15,0);t._map["mipnone"]=new ri(24,15,0);t._map["mipnearest"]=new ri(24,15,1);t._map["miplinear"]=new ri(24,15,2);t._map["nearest"]=new ri(28,15,0);t._map["linear"]=new ri(28,15,1)}return t._map},enumerable:true,configurable:true});return t}();var si=function(){function t(){this.r={};this.cur=new ti}t.prototype.assemble=function(t,e,i){if(e===void 0){e=null}if(i===void 0){i=null}if(!i){i=1}if(e){this.addHeader(e,i)}var r=t.replace(/[\f\n\r\v]+/g,"\n").split("\n");for(var n in r){this.processLine(r[n],n)}return this.r};t.prototype.processLine=function(t,e){var i=t.search("//");if(i!=-1){t=t.slice(0,i)}t=t.replace(/^\s+|\s+$/g,"");if(!(t.length>0)){return}var r=t.search(/<.*>/g);var n=null;if(r!=-1){n=t.slice(r).match(/([\w\.\-\+]+)/gi);t=t.slice(0,r)}var s=t.match(/([\w\.\+\[\]]+)/gi);if(!s||s.length<1){if(t.length>=3){console.log("Warning: bad line "+e+": "+t)}return}switch(s[0]){case"part":this.addHeader(s[1],Number(s[2]));break;case"endpart":if(!this.cur){throw"Unexpected endpart"}this.cur.data.position=0;this.cur=null;return;default:if(!this.cur){console.log("Warning: bad line "+e+": "+t+" (Outside of any part definition)");return}if(this.cur.name=="comment"){return}var a=$e.map[s[0]];if(!a){throw"Bad opcode "+s[0]+" "+e+": "+t}this.emitOpcode(this.cur,a.opcode);var o=1;if(a.dest&&a.dest!="none"){if(!this.emitDest(this.cur,s[o++],a.dest)){throw"Bad destination register "+s[o-1]+" "+e+": "+t}}else{this.emitZeroDword(this.cur)}if(a.a&&a.a.format!="none"){if(!this.emitSource(this.cur,s[o++],a.a))throw"Bad source register "+s[o-1]+" "+e+": "+t}else{this.emitZeroQword(this.cur)}if(a.b&&a.b.format!="none"){if(a.b.format=="sampler"){if(!this.emitSampler(this.cur,s[o++],a.b,n)){throw"Bad sampler register "+s[o-1]+" "+e+": "+t}}else{if(!this.emitSource(this.cur,s[o++],a.b)){throw"Bad source register "+s[o-1]+" "+e+": "+t}}}else{this.emitZeroQword(this.cur)}break}};t.prototype.emitHeader=function(t){t.data.writeUnsignedByte(160);t.data.writeUnsignedInt(t.version);if(t.version>=16){t.data.writeUnsignedByte(0)}t.data.writeUnsignedByte(161);switch(t.name){case"fragment":t.data.writeUnsignedByte(1);break;case"vertex":t.data.writeUnsignedByte(0);break;case"cpu":t.data.writeUnsignedByte(2);break;default:t.data.writeUnsignedByte(255);break}};t.prototype.emitOpcode=function(t,e){t.data.writeUnsignedInt(e)};t.prototype.emitZeroDword=function(t){t.data.writeUnsignedInt(0)};t.prototype.emitZeroQword=function(t){t.data.writeUnsignedInt(0);t.data.writeUnsignedInt(0)};t.prototype.emitDest=function(t,e,i){var r=e.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i);if(!ii.map[r[1]])return false;var n={num:r[2]?r[2]:0,code:ii.map[r[1]].code,mask:this.stringToMask(r[3])};t.data.writeUnsignedShort(n.num);t.data.writeUnsignedByte(n.mask);t.data.writeUnsignedByte(n.code);return true};t.prototype.stringToMask=function(t){if(!t)return 15;var e=0;if(t.indexOf("x")!=-1)e|=1;if(t.indexOf("y")!=-1)e|=2;if(t.indexOf("z")!=-1)e|=4;if(t.indexOf("w")!=-1)e|=8;return e};t.prototype.stringToSwizzle=function(t){if(!t){return 228}var e={x:0,y:1,z:2,w:3};var i=0;if(t.charAt(0)!="."){throw"Missing . for swizzle"}if(t.length>1){i|=e[t.charAt(1)]}if(t.length>2){i|=e[t.charAt(2)]<<2}else{i|=(i&3)<<2}if(t.length>3){i|=e[t.charAt(3)]<<4}else{i|=(i&3<<2)<<2}if(t.length>4){i|=e[t.charAt(4)]<<6}else{i|=(i&3<<4)<<2}return i};t.prototype.emitSampler=function(t,e,i,r){var n=e.match(/fs(\d*)/i);if(!n||!n[1]){return false}t.data.writeUnsignedShort(parseInt(n[1]));t.data.writeUnsignedByte(0);t.data.writeUnsignedByte(0);var s=5;var a=0;for(var o=0;o<r.length;o++){var h=ni.map[r[o].toLowerCase()];if(h){if((a>>h.shift&h.mask)!=0){console.log("Warning, duplicate sampler option")}a|=h.mask<<h.shift;s&=~(h.mask<<h.shift);s|=h.value<<h.shift}else{console.log("Warning, unknown sampler option: ",r[o])}}t.data.writeUnsignedInt(s);return true};t.prototype.emitSource=function(t,e,i){var r=e.match(/vc\[(v[tcai])(\d+)\.([xyzw])([\+\-]\d+)?\](\.[xyzw]{1,4})?/i);var n;if(r){if(!ii.map[r[1]]){return false}var s={x:0,y:1,z:2,w:3};var a={num:r[2]|0,code:ii.map[r[1]].code,swizzle:this.stringToSwizzle(r[5]),select:s[r[3]],offset:r[4]|0};t.data.writeUnsignedShort(a.num);t.data.writeByte(a.offset);t.data.writeUnsignedByte(a.swizzle);t.data.writeUnsignedByte(1);t.data.writeUnsignedByte(a.code);t.data.writeUnsignedByte(a.select);t.data.writeUnsignedByte(1<<7)}else{n=e.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i);if(!ii.map[n[1]]){return false}var a={num:n[2]|0,code:ii.map[n[1]].code,swizzle:this.stringToSwizzle(n[3])};t.data.writeUnsignedShort(a.num);t.data.writeUnsignedByte(0);t.data.writeUnsignedByte(a.swizzle);t.data.writeUnsignedByte(a.code);t.data.writeUnsignedByte(0);t.data.writeUnsignedByte(0);t.data.writeUnsignedByte(0)}return true};t.prototype.addHeader=function(t,e){if(!e){e=1}if(this.r[t]==undefined){this.r[t]=new ti(t,e);this.emitHeader(this.r[t])}else if(this.r[t].version!=e){throw"Multiple versions for part "+t}this.cur=this.r[t]};return t}();var ai=function(){function t(){this.progid=0;this.version=0;this.type=""}return t}();var oi=function(){function t(){this.regread=[[],[],[],[],[],[],[]];this.regwrite=[[],[],[],[],[],[],[]];this.hasindirect=false;this.writedepth=false;this.hasmatrix=false;this.samplers=[];this.tokens=[];this.header=new ai}return t}();var hi=function(){function t(t,e,i,r,n,s,a,o,h,u,l){this.s=t;this.flags=e;this.dest=i;this.a=r;this.b=n;this.matrixwidth=s;this.matrixheight=a;this.ndwm=o;this.scalar=h;this.dm=u;this.lod=l}return t}();var ui=function(){function t(t){}return t}();ui.agal2glsllut=[new hi("%dest = %cast(%a);\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(%a + %b);\n",0,true,true,true,null,null,null,null,null,null),new hi("%dest = %cast(%a - %b);\n",0,true,true,true,null,null,null,null,null,null),new hi("%dest = %cast(%a * %b);\n",0,true,true,true,null,null,null,null,null,null),new hi("%dest = %cast(%a / %b);\n",0,true,true,true,null,null,null,null,null,null),new hi("%dest = %cast(1.0) / %a;\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(min(%a,%b));\n",0,true,true,true,null,null,null,null,null,null),new hi("%dest = %cast(max(%a,%b));\n",0,true,true,true,null,null,null,null,null,null),new hi("%dest = %cast(fract(%a));\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(sqrt(abs(%a)));\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(inversesqrt(abs(%a)));\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(pow(abs(%a),%b));\n",0,true,true,true,null,null,null,null,null,null),new hi("%dest = %cast(log2(abs(%a)));\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(exp2(%a));\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(normalize(vec3( %a ) ));\n",0,true,true,false,null,null,true,null,null,null),new hi("%dest = %cast(sin(%a));\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(cos(%a));\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(cross(vec3(%a),vec3(%b)));\n",0,true,true,true,null,null,true,null,null,null),new hi("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",0,true,true,true,null,null,true,null,null,null),new hi("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",0,true,true,true,null,null,true,null,null,null),new hi("%dest = %cast(abs(%a));\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(%a * -1.0);\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(clamp(%a,0.0,1.0));\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",null,true,true,true,3,3,true,null,null,null),new hi("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,true,true,true,4,4,true,null,null,null),new hi("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,true,true,true,4,3,true,null,null,null),new hi("%dest = %cast(dFdx(%a));\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(dFdy(%a));\n",0,true,true,false,null,null,null,null,null,null),new hi("if (float(%a)==float(%b)) {;\n",0,false,true,true,null,null,null,true,null,null),new hi("if (float(%a)!=float(%b)) {;\n",0,false,true,true,null,null,null,true,null,null),new hi("if (float(%a)>=float(%b)) {;\n",0,false,true,true,null,null,null,true,null,null),new hi("if (float(%a)<float(%b)) {;\n",0,false,true,true,null,null,null,true,null,null),new hi("} else {;\n",0,false,false,false,null,null,null,null,null,null),new hi("};\n",0,false,false,false,null,null,null,null,null,null),new hi(null,null,null,null,false,null,null,null,null,null,null),new hi(null,null,null,null,false,null,null,null,null,null,null),new hi(null,null,null,null,false,null,null,null,null,null,null),new hi(null,null,null,null,false,null,null,null,null,null,null),new hi("%dest = %cast(texture%texdimLod(%b,%texsize(%a)).%dm);\n",null,true,true,true,null,null,null,null,true,null),new hi("if ( float(%a)<0.0 ) discard;\n",null,false,true,false,null,null,null,true,null,null),new hi("%dest = %cast(texture%texdim(%b,%texsize(%a)%lod).%dm);\n",null,true,true,true,null,null,true,null,true,true),new hi("%dest = %cast(greaterThanEqual(%a,%b).%dm);\n",0,true,true,true,null,null,true,null,true,null),new hi("%dest = %cast(lessThan(%a,%b).%dm);\n",0,true,true,true,null,null,true,null,true,null),new hi("%dest = %cast(sign(%a));\n",0,true,true,false,null,null,null,null,null,null),new hi("%dest = %cast(equal(%a,%b).%dm);\n",0,true,true,true,null,null,true,null,true,null),new hi("%dest = %cast(notEqual(%a,%b).%dm);\n",0,true,true,true,null,null,true,null,true,null)];var li=function(){function t(){this.mask=0;this.regnum=0;this.regtype=0;this.dim=0;this.indexoffset=0;this.swizzle=0;this.lodbiad=0;this.readmode=0;this.special=0;this.wrap=0;this.filter=0;this.indexregtype=0;this.indexselect=0;this.indirectflag=0}return t}();var pi=function(){function t(){this.dest=new li;this.opcode=0;this.a=new li;this.b=new li}return t}();var ci=function(){function t(){}t.prototype.decribeAGALByteArray=function(t){var e=new ai;if(t.readUnsignedByte()!=160){throw"Bad AGAL: Missing 0xa0 magic byte."}e.version=t.readUnsignedInt();if(e.version>=16){t.readUnsignedByte();e.version>>=1}if(t.readUnsignedByte()!=161){throw"Bad AGAL: Missing 0xa1 magic byte."}e.progid=t.readUnsignedByte();switch(e.progid){case 1:e.type="fragment";break;case 0:e.type="vertex";break;case 2:e.type="cpu";break;default:e.type="";break}var i=new oi;var r=[];while(t.position<t.length){var n=new pi;n.opcode=t.readUnsignedInt();var s=ui.agal2glsllut[n.opcode];if(!s){throw"Opcode not valid or not implemented yet: "+n.opcode}if(s.matrixheight){i.hasmatrix=true}if(s.dest){n.dest.regnum=t.readUnsignedShort();n.dest.mask=t.readUnsignedByte();n.dest.regtype=t.readUnsignedByte();i.regwrite[n.dest.regtype][n.dest.regnum]|=n.dest.mask}else{n.dest=null;t.readUnsignedInt()}if(s.a){this.readReg(n.a,1,i,t)}else{n.a=null;t.readUnsignedInt();t.readUnsignedInt()}if(s.b){this.readReg(n.b,s.matrixheight|0,i,t)}else{n.b=null;t.readUnsignedInt();t.readUnsignedInt()}r.push(n)}i.header=e;i.tokens=r;return i};t.prototype.readReg=function(t,e,i,r){t.regnum=r.readUnsignedShort();t.indexoffset=r.readByte();t.swizzle=r.readUnsignedByte();t.regtype=r.readUnsignedByte();i.regread[t.regtype][t.regnum]=15;if(t.regtype==5){t.lodbiad=t.indexoffset;t.indexoffset=undefined;t.swizzle=undefined;t.readmode=r.readUnsignedByte();t.dim=t.readmode>>4;t.readmode&=15;t.special=r.readUnsignedByte();t.wrap=t.special>>4;t.special&=15;t.mipmap=r.readUnsignedByte();t.filter=t.mipmap>>4;t.mipmap&=15;i.samplers[t.regnum]=t}else{t.indexregtype=r.readUnsignedByte();t.indexselect=r.readUnsignedByte();t.indirectflag=r.readUnsignedByte()}if(t.indirectflag){i.hasindirect=true}if(!t.indirectflag&&e){for(var n=0;n<e;n++){i.regread[t.regtype][t.regnum+n]=i.regread[t.regtype][t.regnum]}}};return t}();var _i=function(){function t(){}t.prototype.parse=function(t){var e="";var i="";e+="precision highp float;\n";var r=t.header.type[0];if(t.header.type=="vertex"){e+="uniform float yflip;\n"}var n=t.regread[1].length;if(n>0)e+="uniform vec4 "+r+"c["+n+"];\n";for(var s=0;s<t.regread[2].length||s<t.regwrite[2].length;s++){if(t.regread[2][s]||t.regwrite[2][s]){e+="vec4 "+r+"t"+s+";\n"}}for(var s=0;s<t.regread[0].length;s++){if(t.regread[0][s]){e+="attribute vec4 va"+s+";\n"}}for(var s=0;s<t.regread[4].length||s<t.regwrite[4].length;s++){if(t.regread[4][s]||t.regwrite[4][s]){e+="varying vec4 vi"+s+";\n"}}var a=["2D","Cube","3D",""];for(var s=0;s<t.samplers.length;s++){if(t.samplers[s]){e+="uniform sampler"+a[t.samplers[s].dim&3]+" fs"+s+";\n"}}if(t.header.type=="vertex"){e+="vec4 outpos;\n"}if(t.writedepth){e+="vec4 tmp_FragDepth;\n"}var o=false;i+="void main() {\n";for(var s=0;s<t.tokens.length;s++){var h=ui.agal2glsllut[t.tokens[s].opcode];if(h.s.indexOf("dFdx")!=-1||h.s.indexOf("dFdy")!=-1)o=true;if(!h){throw"Opcode not valid or not implemented yet: "}var u=h.matrixheight||1;for(var l=0;l<u;l++){var p="  "+h.s;if(t.tokens[s].dest){if(h.matrixheight){if((t.tokens[s].dest.mask>>l&1)!=1){continue}var c=this.regtostring(t.tokens[s].dest.regtype,t.tokens[s].dest.regnum,t,r);var _="float";var f=["x","y","z","w"][l];c+="."+f}else{var c=this.regtostring(t.tokens[s].dest.regtype,t.tokens[s].dest.regnum,t,r);var _;var f;if(t.tokens[s].dest.mask!=15){var d=0;f="";if(t.tokens[s].dest.mask&1){d++;f+="x"}if(t.tokens[s].dest.mask&2){d++;f+="y"}if(t.tokens[s].dest.mask&4){d++;f+="z"}if(t.tokens[s].dest.mask&8){d++;f+="w"}c+="."+f;switch(d){case 1:_="float";break;case 2:_="vec2";break;case 3:_="vec3";break;default:throw"Unexpected destination mask"}}else{_="vec4";f="xyzw"}}p=p.replace("%dest",c);p=p.replace("%cast",_);p=p.replace("%dm",f)}var g=15;if(!h.ndwm&&h.dest&&t.tokens[s].dest){g=t.tokens[s].dest.mask}if(t.tokens[s].a){p=p.replace("%a",this.sourcetostring(t.tokens[s].a,0,g,h.scalar,t,r))}if(t.tokens[s].b){p=p.replace("%b",this.sourcetostring(t.tokens[s].b,l,g,h.scalar,t,r));if(t.tokens[s].b.regtype==5){var m=["2D","Cube","3D"][t.tokens[s].b.dim];var y=["vec2","vec3","vec3"][t.tokens[s].b.dim];p=p.replace("%texdim",m);p=p.replace("%texsize",y);var v="";p=p.replace("%lod",v)}}i+=p}}if(t.header.type=="vertex"){i+="  gl_Position = vec4(outpos.x, outpos.y, outpos.z*2.0 - outpos.w, outpos.w);\n"}if(o&&t.header.type=="fragment"){e="#extension GL_OES_standard_derivatives : enable\n"+e}if(t.writedepth){i+="  gl_FragDepth = clamp(tmp_FragDepth,0.0,1.0);\n"}i+="}\n";return e+i};t.prototype.regtostring=function(t,e,i,r){switch(t){case 0:return"va"+e;case 1:return i.header.type[0]+"c["+e+"]";case 2:return r+"t"+e;case 3:return i.header.type=="vertex"?"outpos":"gl_FragColor";case 4:return"vi"+e;case 5:return"fs"+e;case 6:return"tmp_FragDepth";default:throw"Unknown register type"}};t.prototype.sourcetostring=function(t,e,i,r,n,s){var a=["x","y","z","w"];var o;if(t.indirectflag){o="vcarrr[int("+this.regtostring(t.indexregtype,t.regnum,n,s)+"."+a[t.indexselect]+")";var h=e+t.indexoffset;if(h<0)o+=h.toString();if(h>0)o+="+"+h.toString();o+="]"}else{o=this.regtostring(t.regtype,t.regnum+e,n,s)}if(t.regtype==5){return o}if(r){return o+"."+a[t.swizzle>>0&3]}if(t.swizzle==228&&i==15){return o}o+=".";if(i&1)o+=a[t.swizzle>>0&3];if(i&2)o+=a[t.swizzle>>2&3];if(i&4)o+=a[t.swizzle>>4&3];if(i&8)o+=a[t.swizzle>>6&3];return o};return t}();_i.maxvertexconstants=128;_i.maxfragconstants=28;_i.maxtemp=8;_i.maxstreams=8;_i.maxtextures=8;var fi=function(){function t(e,i,r){if(r===void 0){r=-1}this._component=r;this._regName=e;this._index=i;this._toStr=this._regName;if(this._index>=0)this._toStr+=this._index;if(r>-1)this._toStr+="."+t.COMPONENTS[r]}t.prototype.toString=function(){return this._toStr};Object.defineProperty(t.prototype,"regName",{get:function(){return this._regName},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"index",{get:function(){return this._index},enumerable:true,configurable:true});return t}();fi.COMPONENTS=["x","y","z","w"];var di=function(){function t(){this.indexDictionary=new Object}t.prototype.reset=function(t,e,i){this.rotationRegisters=new Array;this.positionAttribute=e.animatableAttributes[0];this.scaleAndRotateTarget=e.animationTargetRegisters[0];for(var r=1;r<e.animationTargetRegisters.length;r++)this.rotationRegisters.push(e.animationTargetRegisters[r]);this.vertexZeroConst=t.getFreeVertexConstant();this.vertexZeroConst=new fi(this.vertexZeroConst.regName,this.vertexZeroConst.index,0);this.vertexOneConst=new fi(this.vertexZeroConst.regName,this.vertexZeroConst.index,1);this.vertexTwoConst=new fi(this.vertexZeroConst.regName,this.vertexZeroConst.index,2);this.positionTarget=t.getFreeVertexVectorTemp();t.addVertexTempUsages(this.positionTarget,1);this.positionTarget=new fi(this.positionTarget.regName,this.positionTarget.index);if(i){this.velocityTarget=t.getFreeVertexVectorTemp();t.addVertexTempUsages(this.velocityTarget,1);this.velocityTarget=new fi(this.velocityTarget.regName,this.velocityTarget.index);this.vertexTime=new fi(this.velocityTarget.regName,this.velocityTarget.index,3);this.vertexLife=new fi(this.positionTarget.regName,this.positionTarget.index,3)}else{var n=t.getFreeVertexVectorTemp();t.addVertexTempUsages(n,1);this.vertexTime=new fi(n.regName,n.index,0);this.vertexLife=new fi(n.regName,n.index,1)}};t.prototype.setUVSourceAndTarget=function(t){this.uvVar=t.uvTarget;this.uvAttribute=t.uvSource;this.uvTarget=new fi(this.positionTarget.regName,this.positionTarget.index)};t.prototype.setRegisterIndex=function(t,e,i){var r=this.indexDictionary[t.id];if(r==null)r=this.indexDictionary[t.id]=new Array(8);r[e]=i};t.prototype.getRegisterIndex=function(t,e){return this.indexDictionary[t.id][e]};return t}();var gi=function(t){e(i,t);function i(e){return t.call(this,e)||this}return i}(i);var mi=function(t){e(i,t);function i(){var e=t.call(this)||this;e._animations=new Array;e._animationNames=new Array;e._animationDictionary=new Object;return e}i.prototype._pFindTempReg=function(t,e){if(e===void 0){e=null}var i=0;var r;while(true){r="vt"+i;if(t.indexOf(r)==-1&&e!=r)return r;++i}};Object.defineProperty(i.prototype,"usesCPU",{get:function(){return this._usesCPU},enumerable:true,configurable:true});i.prototype.resetGPUCompatibility=function(){this._usesCPU=false};i.prototype.cancelGPUCompatibility=function(){this._usesCPU=true};i.prototype.getAGALVertexCode=function(t,e,i){throw new r};i.prototype.getAGALFragmentCode=function(t,e,i){throw new r};i.prototype.getAGALUVCode=function(t,e,i){throw new r};i.prototype.doneAGALCode=function(t){throw new r};Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:true,configurable:true});i.prototype.hasAnimation=function(t){return this._animationDictionary[t]!=null};i.prototype.getAnimation=function(t){return this._animationDictionary[t]};i.prototype.addAnimation=function(t){if(this._animationDictionary[t.name])throw new gi("root node name '"+t.name+"' already exists in the set");this._animationDictionary[t.name]=t;this._animations.push(t);this._animationNames.push(t.name)};i.prototype.dispose=function(){};return i}(h);mi.assetType="[asset AnimationSet]";var yi=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._animator=i;return r}Object.defineProperty(i.prototype,"animator",{get:function(){return this._animator},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._animator)};return i}(n);yi.START="animatorStart";yi.STOP="animatorStop";yi.CYCLE_COMPLETE="animatorCycleComplete";var vi=function(t){e(i,t);function i(e){var i=t.call(this)||this;i._autoUpdate=true;i._time=0;i._playbackSpeed=1;i._pOwners=new Array;i._pAbsoluteTime=0;i._animationStates=new Object;i.updatePosition=true;i._pAnimationSet=e;i._broadcaster=new Nt(i.onEnterFrame,i);return i}i.prototype.getAnimationState=function(t){var e=t.stateClass;var i=t.id;if(this._animationStates[i]==null)this._animationStates[i]=new e(this,t);return this._animationStates[i]};i.prototype.getAnimationStateByName=function(t){return this.getAnimationState(this._pAnimationSet.getAnimation(t))};Object.defineProperty(i.prototype,"absoluteTime",{get:function(){return this._pAbsoluteTime},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animationSet",{get:function(){return this._pAnimationSet},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"activeState",{get:function(){return this._pActiveState},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"activeAnimation",{get:function(){return this._pAnimationSet.getAnimation(this._pActiveAnimationName)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"activeAnimationName",{get:function(){return this._pActiveAnimationName},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){if(this._autoUpdate==t)return;this._autoUpdate=t;if(this._autoUpdate)this.start();else this.stop()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"time",{get:function(){return this._time},set:function(t){if(this._time==t)return;this.update(t)},enumerable:true,configurable:true});i.prototype.phase=function(t){this._pActiveState.phase(t)};Object.defineProperty(i.prototype,"playbackSpeed",{get:function(){return this._playbackSpeed},set:function(t){this._playbackSpeed=t},enumerable:true,configurable:true});i.prototype.setRenderState=function(t,e,i,n){throw new r};i.prototype.start=function(){if(this._isPlaying||!this._autoUpdate)return;this._time=this._pAbsoluteTime=xt();this._isPlaying=true;this._broadcaster.start();if(!this.hasEventListener(yi.START))return;if(this._startEvent==null)this._startEvent=new yi(yi.START,this);this.dispatchEvent(this._startEvent)};i.prototype.stop=function(){if(!this._isPlaying)return;this._isPlaying=false;this._broadcaster.stop();if(!this.hasEventListener(yi.STOP))return;if(this._stopEvent==null)this._stopEvent=new yi(yi.STOP,this);this.dispatchEvent(this._stopEvent)};i.prototype.update=function(t){var e=(t-this._time)*this.playbackSpeed;this._pUpdateDeltaTime(e);

this._time=t};i.prototype.reset=function(t,e){if(e===void 0){e=0}this.getAnimationState(this._pAnimationSet.getAnimation(t)).offset(e+this._pAbsoluteTime)};i.prototype.addOwner=function(t){this._pOwners.push(t)};i.prototype.removeOwner=function(t){this._pOwners.splice(this._pOwners.indexOf(t),1)};i.prototype._pUpdateDeltaTime=function(t){this._pAbsoluteTime+=t;this._pActiveState.update(this._pAbsoluteTime);if(this.updatePosition)this.applyPositionDelta()};i.prototype.onEnterFrame=function(t){if(t===void 0){t=null}this.update(xt())};i.prototype.applyPositionDelta=function(){var t=this._pActiveState.positionDelta;var e=t.length;var i;if(e>0){i=this._pOwners.length;for(var r=0;r<i;++r)this._pOwners[r].transform.translateLocal(t,e)}};i.prototype.dispatchCycleEvent=function(){if(this.hasEventListener(yi.CYCLE_COMPLETE)){if(this._cycleEvent==null)this._cycleEvent=new yi(yi.CYCLE_COMPLETE,this);this.dispatchEvent(this._cycleEvent)}};i.prototype.clone=function(){throw new r};i.prototype.dispose=function(){};i.prototype.invalidateElements=function(){var t;var e=this._pOwners.length;for(var i=0;i<e;i++){t=this._pOwners[i];t.invalidateElements()}};i.prototype.testGPUCompatibility=function(t){throw new r};Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.getRenderableElements=function(t,e){return e};return i}(h);vi.assetType="[asset Animator]";var xi=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._stage=i;r._attributesBuffer=e;return r}i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this._attributesBuffer=null;if(this._indexBuffer){this._indexBuffer.dispose();this._indexBuffer=null}if(this._vertexBuffer){this._vertexBuffer.dispose();this._vertexBuffer=null}};i.prototype.activate=function(t,e,i,r,n){if(n===void 0){n=false}this._stage.setVertexBuffer(t,this._getVertexBuffer(),e,i,r,n)};i.prototype.draw=function(t,e,i){this._stage.context.drawIndices(t,this._getIndexBuffer(),e,i)};i.prototype._getIndexBuffer=function(){if(!this._indexBuffer){this._invalid=true;this._indexBuffer=this._stage.context.createIndexBuffer(this._attributesBuffer.count*this._attributesBuffer.stride/2)}if(this._invalid){this._invalid=false;this._indexBuffer.uploadFromByteArray(this._attributesBuffer.buffer,0,this._attributesBuffer.length)}return this._indexBuffer};i.prototype._getVertexBuffer=function(){if(!this._vertexBuffer){this._invalid=true;this._vertexBuffer=this._stage.context.createVertexBuffer(this._attributesBuffer.count,this._attributesBuffer.stride)}if(this._invalid){this._invalid=false;this._vertexBuffer.uploadFromByteArray(this._attributesBuffer.buffer,0,this._attributesBuffer.count)}return this._vertexBuffer};return i}(K);(function(t){t[t["DESTINATION_ALPHA"]=0]="DESTINATION_ALPHA";t[t["DESTINATION_COLOR"]=1]="DESTINATION_COLOR";t[t["ONE"]=2]="ONE";t[t["ONE_MINUS_DESTINATION_ALPHA"]=3]="ONE_MINUS_DESTINATION_ALPHA";t[t["ONE_MINUS_DESTINATION_COLOR"]=4]="ONE_MINUS_DESTINATION_COLOR";t[t["ONE_MINUS_SOURCE_ALPHA"]=5]="ONE_MINUS_SOURCE_ALPHA";t[t["ONE_MINUS_SOURCE_COLOR"]=6]="ONE_MINUS_SOURCE_COLOR";t[t["SOURCE_ALPHA"]=7]="SOURCE_ALPHA";t[t["SOURCE_COLOR"]=8]="SOURCE_COLOR";t[t["ZERO"]=9]="ZERO"})(t.ContextGLBlendFactor||(t.ContextGLBlendFactor={}));(function(t){t[t["COLOR"]=1]="COLOR";t[t["DEPTH"]=2]="DEPTH";t[t["STENCIL"]=4]="STENCIL";t[t["ALL"]=7]="ALL"})(t.ContextGLClearMask||(t.ContextGLClearMask={}));(function(t){t[t["ALWAYS"]=0]="ALWAYS";t[t["EQUAL"]=1]="EQUAL";t[t["GREATER"]=2]="GREATER";t[t["GREATER_EQUAL"]=3]="GREATER_EQUAL";t[t["LESS"]=4]="LESS";t[t["LESS_EQUAL"]=5]="LESS_EQUAL";t[t["NEVER"]=6]="NEVER";t[t["NOT_EQUAL"]=7]="NOT_EQUAL"})(t.ContextGLCompareMode||(t.ContextGLCompareMode={}));(function(t){t[t["TRIANGLES"]=0]="TRIANGLES";t[t["LINES"]=1]="LINES"})(t.ContextGLDrawMode||(t.ContextGLDrawMode={}));(function(t){t[t["MIPLINEAR"]=0]="MIPLINEAR";t[t["MIPNEAREST"]=1]="MIPNEAREST";t[t["MIPNONE"]=2]="MIPNONE"})(t.ContextGLMipFilter||(t.ContextGLMipFilter={}));(function(t){t[t["BASELINE"]=0]="BASELINE";t[t["BASELINE_CONSTRAINED"]=1]="BASELINE_CONSTRAINED";t[t["BASELINE_EXTENDED"]=2]="BASELINE_EXTENDED"})(t.ContextGLProfile||(t.ContextGLProfile={}));(function(t){t[t["FRAGMENT"]=0]="FRAGMENT";t[t["SAMPLER"]=1]="SAMPLER";t[t["VERTEX"]=2]="VERTEX"})(t.ContextGLProgramType||(t.ContextGLProgramType={}));(function(t){t[t["DECREMENT_SATURATE"]=0]="DECREMENT_SATURATE";t[t["DECREMENT_WRAP"]=1]="DECREMENT_WRAP";t[t["INCREMENT_SATURATE"]=2]="INCREMENT_SATURATE";t[t["INCREMENT_WRAP"]=3]="INCREMENT_WRAP";t[t["INVERT"]=4]="INVERT";t[t["KEEP"]=5]="KEEP";t[t["SET"]=6]="SET";t[t["ZERO"]=7]="ZERO"})(t.ContextGLStencilAction||(t.ContextGLStencilAction={}));(function(t){t[t["LINEAR"]=0]="LINEAR";t[t["NEAREST"]=1]="NEAREST"})(t.ContextGLTextureFilter||(t.ContextGLTextureFilter={}));(function(t){t[t["BGRA"]=0]="BGRA";t[t["BGRA_PACKED"]=1]="BGRA_PACKED";t[t["BGR_PACKED"]=2]="BGR_PACKED";t[t["COMPRESSED"]=3]="COMPRESSED";t[t["COMPRESSED_ALPHA"]=4]="COMPRESSED_ALPHA"})(t.ContextGLTextureFormat||(t.ContextGLTextureFormat={}));(function(t){t[t["BACK"]=0]="BACK";t[t["FRONT"]=1]="FRONT";t[t["FRONT_AND_BACK"]=2]="FRONT_AND_BACK";t[t["NONE"]=3]="NONE"})(t.ContextGLTriangleFace||(t.ContextGLTriangleFace={}));(function(t){t[t["FLOAT_1"]=0]="FLOAT_1";t[t["FLOAT_2"]=1]="FLOAT_2";t[t["FLOAT_3"]=2]="FLOAT_3";t[t["FLOAT_4"]=3]="FLOAT_4";t[t["BYTE_1"]=4]="BYTE_1";t[t["BYTE_2"]=5]="BYTE_2";t[t["BYTE_3"]=6]="BYTE_3";t[t["BYTE_4"]=7]="BYTE_4";t[t["UNSIGNED_BYTE_1"]=8]="UNSIGNED_BYTE_1";t[t["UNSIGNED_BYTE_2"]=9]="UNSIGNED_BYTE_2";t[t["UNSIGNED_BYTE_3"]=10]="UNSIGNED_BYTE_3";t[t["UNSIGNED_BYTE_4"]=11]="UNSIGNED_BYTE_4";t[t["SHORT_1"]=12]="SHORT_1";t[t["SHORT_2"]=13]="SHORT_2";t[t["SHORT_3"]=14]="SHORT_3";t[t["SHORT_4"]=15]="SHORT_4";t[t["UNSIGNED_SHORT_1"]=16]="UNSIGNED_SHORT_1";t[t["UNSIGNED_SHORT_2"]=17]="UNSIGNED_SHORT_2";t[t["UNSIGNED_SHORT_3"]=18]="UNSIGNED_SHORT_3";t[t["UNSIGNED_SHORT_4"]=19]="UNSIGNED_SHORT_4"})(t.ContextGLVertexBufferFormat||(t.ContextGLVertexBufferFormat={}));(function(t){t[t["CLAMP"]=0]="CLAMP";t[t["REPEAT"]=1]="REPEAT"})(t.ContextGLWrapMode||(t.ContextGLWrapMode={}));(function(t){t[t["AUTO"]=0]="AUTO";t[t["WEBGL"]=1]="WEBGL";t[t["FLASH"]=2]="FLASH";t[t["GLES"]=3]="GLES";t[t["NATIVE"]=4]="NATIVE";t[t["SOFTWARE"]=5]="SOFTWARE"})(t.ContextMode||(t.ContextMode={}));var bi=function(){function t(){}return t}();var wi=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.usages=0;r._vertices=new Object;r._verticesUpdated=new Object;r._indexMappings=Array();r._numIndices=0;r._elements=e;r._stage=i;r._onInvalidateIndicesDelegate=function(t){return r._onInvalidateIndices(t)};r._onClearIndicesDelegate=function(t){return r._onClearIndices(t)};r._onInvalidateVerticesDelegate=function(t){return r._onInvalidateVertices(t)};r._onClearVerticesDelegate=function(t){return r._onClearVertices(t)};r._elements.addEventListener(Qt.CLEAR_INDICES,r._onClearIndicesDelegate);r._elements.addEventListener(Qt.INVALIDATE_INDICES,r._onInvalidateIndicesDelegate);r._elements.addEventListener(Qt.CLEAR_VERTICES,r._onClearVerticesDelegate);r._elements.addEventListener(Qt.INVALIDATE_VERTICES,r._onInvalidateVerticesDelegate);return r}Object.defineProperty(i.prototype,"elementsType",{get:function(){throw new r},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"elementsClass",{get:function(){throw new r},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"elements",{get:function(){return this._elements},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});i.prototype.getIndexMappings=function(){if(!this._indicesUpdated)this._updateIndices();return this._indexMappings};i.prototype.getIndexBufferGL=function(){if(!this._indicesUpdated)this._updateIndices();return this._indices};i.prototype.getVertexBufferGL=function(t){if(!this._indicesUpdated)this._updateIndices();var e=t.attributesBuffer.id;if(!this._verticesUpdated[e])this._updateVertices(t);return this._vertices[e]};i.prototype.activateVertexBufferVO=function(t,e,i,r){if(i===void 0){i=0}if(r===void 0){r=0}this.getVertexBufferGL(e).activate(t,e.size,i||e.dimensions,e.offset+r,e.unsigned)};i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this._elements.removeEventListener(Qt.CLEAR_INDICES,this._onClearIndicesDelegate);this._elements.removeEventListener(Qt.INVALIDATE_INDICES,this._onInvalidateIndicesDelegate);this._elements.removeEventListener(Qt.CLEAR_VERTICES,this._onClearVerticesDelegate);this._elements.removeEventListener(Qt.INVALIDATE_VERTICES,this._onInvalidateVerticesDelegate);this._elements=null;if(this._overflow){this._overflow.onClear(e);this._overflow=null}};i.prototype._setRenderState=function(t,e,i){if(!this._verticesUpdated)this._updateIndices()};i.prototype.draw=function(t,e,i,n,s){throw new r};i.prototype._updateIndices=function(t){if(t===void 0){t=0}var e=this._elements.indices;if(e){this._indices=this._stage.getAbstraction(Zt.getSubIndices(e,this._elements.numVertices,this._indexMappings,t));this._numIndices=this._indices._attributesBuffer.count*e.dimensions}else{this._indices=null;this._numIndices=0;this._indexMappings=Array()}t+=this._numIndices;if(e&&t<e.count*this._elements.indices.dimensions){if(!this._overflow)this._overflow=this._pGetOverflowElements();this._overflow._updateIndices(t)}else if(this._overflow){this._overflow.onClear(new s(s.CLEAR,this._elements));this._overflow=null}this._indicesUpdated=true;if(this._indexMappings.length)for(var i in this._verticesUpdated)this._verticesUpdated[i]=false};i.prototype._updateVertices=function(t){this._numVertices=this._elements.numVertices;var e=t.attributesBuffer.id;this._vertices[e]=this._stage.getAbstraction(Zt.getSubVertices(t.attributesBuffer,this._indexMappings));this._verticesUpdated[e]=true};i.prototype._onInvalidateIndices=function(t){if(!t.attributesView)return;this._indicesUpdated=false};i.prototype._onClearIndices=function(t){if(!t.attributesView)return;this._indices.onClear(new s(s.CLEAR,t.attributesView));this._indices=null};i.prototype._onInvalidateVertices=function(t){if(!t.attributesView)return;var e=t.attributesView.attributesBuffer.id;this._verticesUpdated[e]=false};i.prototype._onClearVertices=function(t){if(!t.attributesView)return;var e=t.attributesView.attributesBuffer.id;if(this._vertices[e]){this._vertices[e].onClear(new s(s.CLEAR,t.attributesView));delete this._vertices[e];delete this._verticesUpdated[e]}};i.prototype._pGetOverflowElements=function(){throw new r};return i}(K);var Di=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._triangleElements=t;return r}Object.defineProperty(r.prototype,"elementsType",{get:function(){return r.elementsType},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"elementsClass",{get:function(){return r},enumerable:true,configurable:true});r._iIncludeDependencies=function(t){};r._iGetVertexCode=function(t,e,i){var r="";var n=t.globalPosDependencies>0?i.globalPositionVertex:i.animatedPosition;var s=e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();t.viewMatrixIndex=s.index*4;if(t.projectionDependencies>0){i.projectionFragment=e.getFreeVarying();var a=e.getFreeVertexVectorTemp();r+="m44 "+a+", "+n+", "+s+"\n"+"mov "+i.projectionFragment+", "+a+"\n"+"mov op, "+a+"\n"}else{r+="m44 op, "+n+", "+s+"\n"}return r};r._iGetFragmentCode=function(t,e,i){return""};r.prototype.onClear=function(t){i.prototype.onClear.call(this,t);this._triangleElements=null};r.prototype._setRenderState=function(t,e,r){i.prototype._setRenderState.call(this,t,e,r);if(e.normalIndex>=0&&this._triangleElements.autoDeriveNormals)this._triangleElements.normals;if(e.tangentIndex>=0&&this._triangleElements.autoDeriveTangents)this._triangleElements.tangents;if(e.curvesIndex>=0)this.activateVertexBufferVO(e.curvesIndex,this._triangleElements.getCustomAtributes("curves"));if(e.uvIndex>=0)this.activateVertexBufferVO(e.uvIndex,this._triangleElements.uvs||this._triangleElements.positions);if(e.secondaryUVIndex>=0)this.activateVertexBufferVO(e.secondaryUVIndex,this._triangleElements.getCustomAtributes("secondaryUVs")||this._triangleElements.uvs||this._triangleElements.positions);if(e.normalIndex>=0)this.activateVertexBufferVO(e.normalIndex,this._triangleElements.normals);if(e.tangentIndex>=0)this.activateVertexBufferVO(e.tangentIndex,this._triangleElements.tangents);if(e.jointIndexIndex>=0)this.activateVertexBufferVO(e.jointIndexIndex,this._triangleElements.jointIndices);if(e.jointWeightIndex>=0)this.activateVertexBufferVO(e.jointIndexIndex,this._triangleElements.jointWeights);this.activateVertexBufferVO(0,this._triangleElements.positions)};r.prototype.draw=function(e,i,r,n,s){if(i.sceneMatrixIndex>=0){i.sceneMatrix.copyFrom(e.renderSceneTransform,true);i.viewMatrix.copyFrom(r.viewMatrix3D,true)}else{var a=M.CALCULATION_MATRIX;a.copyFrom(e.renderSceneTransform);a.append(r.viewMatrix3D);i.viewMatrix.copyFrom(a,true)}var o=this._stage.context;o.setProgramConstantsFromArray(t.ContextGLProgramType.VERTEX,i.vertexConstantData);o.setProgramConstantsFromArray(t.ContextGLProgramType.FRAGMENT,i.fragmentConstantData);if(this._indices)this.getIndexBufferGL().draw(t.ContextGLDrawMode.TRIANGLES,s*3,n*3||this.numIndices);else this._stage.context.drawVertices(t.ContextGLDrawMode.TRIANGLES,s,n||this.numVertices)};r.prototype._pGetOverflowElements=function(){return new r(this._triangleElements,this._stage)};return r}(wi);Di.elementsType="[elements Triangle]";var Ci=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._stage=i;return r}Object.defineProperty(i.prototype,"stage",{get:function(){return this._stage},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._stage)};return i}(n);Ci.STAGE_ERROR="stageError";Ci.CONTEXT_CREATED="contextCreated";Ci.CONTEXT_DISPOSED="contextDisposed";Ci.CONTEXT_RECREATED="contextRecreated";Ci.VIEWPORT_UPDATED="viewportUpdated";var Ai=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._pass=i;return r}Object.defineProperty(i.prototype,"pass",{get:function(){return this._pass},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._pass)};return i}(n);Ai.INVALIDATE="invalidatePass";var Ti=function(){function t(){}return t}();Ti.trueValue=32;Ti.falseValue=33;Ti.intMask=63;Ti.drawTriangles=41;Ti.setProgramConstant=42;Ti.setProgram=43;Ti.present=44;Ti.clear=45;Ti.initProgram=46;Ti.initVertexBuffer=47;Ti.initIndexBuffer=48;Ti.configureBackBuffer=49;Ti.uploadArrayIndexBuffer=50;Ti.uploadArrayVertexBuffer=51;Ti.uploadAGALBytesProgram=52;Ti.setVertexBufferAt=53;Ti.uploadBytesIndexBuffer=54;Ti.uploadBytesVertexBuffer=55;Ti.setColorMask=56;Ti.setDepthTest=57;Ti.disposeProgram=58;Ti.disposeContext=59;Ti.disposeVertexBuffer=61;Ti.disposeIndexBuffer=63;Ti.initTexture=64;Ti.setTextureAt=65;Ti.uploadBytesTexture=66;Ti.disposeTexture=67;Ti.setCulling=68;Ti.setScissorRect=69;Ti.clearScissorRect=70;Ti.setBlendFactors=71;Ti.setRenderToTexture=72;Ti.clearTextureAt=73;Ti.clearVertexBufferAt=74;Ti.setStencilActions=75;Ti.setStencilReferenceValue=76;Ti.initCubeTexture=77;Ti.disposeCubeTexture=78;Ti.uploadBytesCubeTexture=79;Ti.clearRenderToTexture=80;Ti.enableErrorChecking=81;Ti.drawVertices=82;Ti.getFrameBufferForTexture=83;Ti.uploadProgram=84;Ti.disableCulling=85;Ti.disableBlending=86;Ti.setSamplerStateAt=87;Ti.enableStencil=88;Ti.disableStencil=89;Ti.setStencilActionsMasks=90;Ti.uploadTextureFromURL=92;Ti.startSound=101;Ti.stopSound=102;Ti.updateSound=103;var Pi=function(){function t(){}Object.defineProperty(t.prototype,"id",{get:function(){return this._pId},enumerable:true,configurable:true});t.prototype.dispose=function(){};t.prototype.generateMipmaps=function(){};return t}();var Si=function(t){e(i,t);function i(e,i,r,n,s){if(s===void 0){s=false}var a=t.call(this)||this;a._context=e;a._size=i;a._context.addStream(String.fromCharCode(Ti.initCubeTexture,n?Ti.trueValue:Ti.falseValue)+i+","+s+","+r+"$");a._pId=a._context.execute();a._context._iAddResource(a);return a}Object.defineProperty(i.prototype,"size",{get:function(){return this._size},enumerable:true,configurable:true});i.prototype.dispose=function(){this._context.addStream(String.fromCharCode(Ti.disposeCubeTexture)+this._pId.toString()+",");this._context.execute();this._context._iRemoveResource(this);this._context=null};i.prototype.uploadFromImage=function(t,e,i){if(i===void 0){i=0}var r=t.getImageData(e).data;var n=0;var s=gt.internalGetBase64String(r.length,function(){return r[n++]},null);this._context.addStream(String.fromCharCode(Ti.uploadBytesCubeTexture)+this._pId+","+i+","+e+","+(this.size>>i)+","+s+"%");this._context.execute()};i.prototype.uploadCompressedTextureFromByteArray=function(t,e,i){if(i===void 0){i=false}};return i}(Pi);var Ei=function(t){e(i,t);function i(e,i){var r=t.call(this)||this;r._context=e;r._numIndices=i;r._context.addStream(String.fromCharCode(Ti.initIndexBuffer,i+Ti.intMask));r._pId=r._context.execute();r._context._iAddResource(r);return r}i.prototype.uploadFromArray=function(t,e,i){this._context.addStream(String.fromCharCode(Ti.uploadArrayIndexBuffer,this._pId+Ti.intMask)+t.join()+"#"+e+","+i+",");this._context.execute()};i.prototype.uploadFromByteArray=function(t,e,i){};i.prototype.dispose=function(){this._context.addStream(String.fromCharCode(Ti.disposeIndexBuffer,this._pId+Ti.intMask));this._context.execute();this._context._iRemoveResource(this);this._context=null};Object.defineProperty(i.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:true,configurable:true});return i}(Pi);var Mi=function(t){e(i,t);function i(e){var i=t.call(this)||this;i._context=e;i._context.addStream(String.fromCharCode(Ti.initProgram));i._pId=i._context.execute();i._context._iAddResource(i);return i}i.prototype.upload=function(t,e){this._context.addStream(String.fromCharCode(Ti.uploadAGALBytesProgram,this._pId+Ti.intMask)+t.readBase64String(t.length)+"%"+e.readBase64String(e.length)+"%");if(Ri.debug)this._context.execute()};i.prototype.dispose=function(){this._context.addStream(String.fromCharCode(Ti.disposeProgram,this._pId+Ti.intMask));this._context.execute();this._context._iRemoveResource(this);this._context=null};return i}(Pi);var Oi=function(t){e(i,t);function i(e,i,r,n,s,a){if(a===void 0){a=false}var o=t.call(this)||this;o._context=e;o._width=i;o._height=r;o._context.addStream(String.fromCharCode(Ti.initTexture,s?Ti.trueValue:Ti.falseValue)+i+","+r+","+a+","+n+"$");o._pId=o._context.execute();o._context._iAddResource(o);return o}Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:true,configurable:true});i.prototype.dispose=function(){this._context.addStream(String.fromCharCode(Ti.disposeTexture)+this._pId.toString()+",");this._context.execute();this._context._iRemoveResource(this);this._context=null};i.prototype.uploadFromImage=function(t,e){if(e===void 0){e=0}var i=t.getImageData().data;var r=0;var n=gt.internalGetBase64String(i.length,function(){return i[r++]},null);this._context.addStream(String.fromCharCode(Ti.uploadBytesTexture)+this._pId+","+e+","+(this._width>>e)+","+(this._height>>e)+","+n+"%");this._context.execute()};i.prototype.uploadFromURL=function(t,e){if(e===void 0){e=0}};return i}(Pi);var Ii=function(t){e(i,t);function i(e,i,r){var n=t.call(this)||this;n._context=e;n._numVertices=i;n._dataPerVertex=r;n._context.addStream(String.fromCharCode(Ti.initVertexBuffer,r+Ti.intMask)+i.toString()+",");n._pId=n._context.execute();n._context._iAddResource(n);return n}i.prototype.uploadFromArray=function(t,e,i){this._context.addStream(String.fromCharCode(Ti.uploadArrayVertexBuffer,this._pId+Ti.intMask)+t.join()+"#"+[e,i].join()+",");this._context.execute()};i.prototype.uploadFromByteArray=function(t,e,i){};Object.defineProperty(i.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"dataPerVertex",{get:function(){return this._dataPerVertex},enumerable:true,configurable:true});i.prototype.dispose=function(){this._context.addStream(String.fromCharCode(Ti.disposeVertexBuffer,this._pId+Ti.intMask));this._context.execute();this._context._iRemoveResource(this);this._context=null};return i}(Pi);var Ri=function(){function e(t,i){this._cmdStream="";this._resources=new Array;var r="11.0.0";var n={id:t.id};var s={quality:"high",bgcolor:"#ffffff",allowscriptaccess:"sameDomain",allowfullscreen:"true",wmode:"direct"};this._errorCheckingEnabled=false;this._iDriverInfo="Unknown";var a={salign:"tl",id:t.id,name:t["name"]};this._oldCanvas=t.cloneNode();this._oldParent=t.parentNode;var o=this;e.contexts[t.id]=this;function h(t){if(!t.success)return;o._container=t.ref;o._iCallback=i}}e.prototype.enableStencil=function(){};e.prototype.disableStencil=function(){};Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"driverInfo",{get:function(){return this._iDriverInfo},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"errorCheckingEnabled",{get:function(){return this._errorCheckingEnabled},set:function(t){if(this._errorCheckingEnabled==t)return;this._errorCheckingEnabled=t;this.addStream(String.fromCharCode(Ti.enableErrorChecking,t?Ti.trueValue:Ti.falseValue));this.execute()},enumerable:true,configurable:true});e.prototype._iAddResource=function(t){this._resources.push(t)};e.prototype._iRemoveResource=function(t){this._resources.splice(this._resources.indexOf(t))};e.prototype.createTexture=function(t,e,i,r,n){if(n===void 0){n=0}return new Oi(this,t,e,i,r)};e.prototype.createCubeTexture=function(t,e,i,r){if(r===void 0){r=0}return new Si(this,t,e,i)};e.prototype.setTextureAt=function(t,i){if(i){this.addStream(String.fromCharCode(Ti.setTextureAt)+t+","+i.id+",")}else{this.addStream(String.fromCharCode(Ti.clearTextureAt)+t.toString()+",")}if(e.debug)this.execute()};e.prototype.setSamplerStateAt=function(t,e,i,r){};e.prototype.setStencilActions=function(i,r,n,s,a,o){if(i===void 0){i=t.ContextGLTriangleFace.FRONT_AND_BACK}if(r===void 0){r=t.ContextGLCompareMode.ALWAYS}if(n===void 0){n=t.ContextGLStencilAction.KEEP}if(s===void 0){s=t.ContextGLStencilAction.KEEP}if(a===void 0){a=t.ContextGLStencilAction.KEEP}if(o===void 0){o=t.CoordinateSystem.LEFT_HANDED}this.addStream(String.fromCharCode(Ti.setStencilActions)+i+"$"+r+"$"+n+"$"+s+"$"+a+"$");if(e.debug)this.execute()};e.prototype.setStencilReferenceValue=function(t,i,r){if(i===void 0){i=255}if(r===void 0){r=255}this.addStream(String.fromCharCode(Ti.setStencilReferenceValue,t+Ti.intMask,i+Ti.intMask,r+Ti.intMask));if(e.debug)this.execute()};e.prototype.setCulling=function(i,r){if(r===void 0){r=t.CoordinateSystem.LEFT_HANDED}this.addStream(String.fromCharCode(Ti.setCulling)+i+"$");if(e.debug)this.execute()};e.prototype.drawIndices=function(t,i,r,n){if(r===void 0){r=0}if(n===void 0){n=-1}r=r||0;if(!n||n<0)n=i.numIndices;this.addStream(String.fromCharCode(Ti.drawTriangles,i.id+Ti.intMask)+r+","+n+",");if(e.debug)this.execute()};e.prototype.drawVertices=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=-1}};e.prototype.setProgramConstantsFromArray=function(i,r){var n;var s=r.length/4;var a=i==t.ContextGLProgramType.VERTEX?Ti.trueValue:Ti.falseValue;for(var o=0;o<s;o++){n=o*4;this.addStream(String.fromCharCode(Ti.setProgramConstant,a,o+Ti.intMask)+r[n]+","+r[n+1]+","+r[n+2]+","+r[n+3]+",");if(e.debug)this.execute()}};e.prototype.setProgram=function(t){this.addStream(String.fromCharCode(Ti.setProgram,t.id+Ti.intMask));if(e.debug)this.execute()};e.prototype.present=function(){this.addStream(String.fromCharCode(Ti.present));this.execute()};e.prototype.clear=function(i,r,n,s,a,o,h){if(i===void 0){i=0}if(r===void 0){r=0}if(n===void 0){n=0}if(s===void 0){s=1}if(a===void 0){a=1}if(o===void 0){o=0}if(h===void 0){h=t.ContextGLClearMask.ALL}this.addStream(String.fromCharCode(Ti.clear)+i+","+r+","+n+","+s+","+a+","+o+","+h+",");if(e.debug)this.execute()};e.prototype.createProgram=function(){return new Mi(this)};e.prototype.createVertexBuffer=function(t,e){return new Ii(this,t,e)};e.prototype.createIndexBuffer=function(t){return new Ei(this,t)};e.prototype.configureBackBuffer=function(t,e,i,r){if(r===void 0){r=true}this._width=t;this._height=e;this.addStream(String.fromCharCode(Ti.configureBackBuffer)+t+","+e+",")};e.prototype.drawToBitmapImage2D=function(t){};e.prototype.setVertexBufferAt=function(t,i,r,n){if(r===void 0){r=0}if(n===void 0){n=null}if(i){this.addStream(String.fromCharCode(Ti.setVertexBufferAt,t+Ti.intMask)+i.id+","+r+","+n+"$")}else{this.addStream(String.fromCharCode(Ti.clearVertexBufferAt,t+Ti.intMask))}if(e.debug)this.execute()};e.prototype.setColorMask=function(t,i,r,n){this.addStream(String.fromCharCode(Ti.setColorMask,t?Ti.trueValue:Ti.falseValue,i?Ti.trueValue:Ti.falseValue,r?Ti.trueValue:Ti.falseValue,n?Ti.trueValue:Ti.falseValue));if(e.debug)this.execute()};e.prototype.setBlendFactors=function(t,i){this.addStream(String.fromCharCode(Ti.setBlendFactors)+t+"$"+i+"$");if(e.debug)this.execute()};e.prototype.setRenderToTexture=function(t,i,r,n){if(i===void 0){i=false}if(r===void 0){r=0}if(n===void 0){n=0}if(t===null||t===undefined){this.addStream(String.fromCharCode(Ti.clearRenderToTexture))}else{this.addStream(String.fromCharCode(Ti.setRenderToTexture,i?Ti.trueValue:Ti.falseValue)+t.id+","+(r||0)+",")}if(e.debug)this.execute()};e.prototype.setRenderToBackBuffer=function(){this.addStream(String.fromCharCode(Ti.clearRenderToTexture));if(e.debug)this.execute()};e.prototype.setScissorRectangle=function(t){if(t){this.addStream(String.fromCharCode(Ti.setScissorRect)+t.x+","+t.y+","+t.width+","+t.height+",")}else{this.addStream(String.fromCharCode(Ti.clearScissorRect))}if(e.debug)this.execute()};e.prototype.setDepthTest=function(t,i){this.addStream(String.fromCharCode(Ti.setDepthTest,t?Ti.trueValue:Ti.falseValue)+i+"$");if(e.debug)this.execute()};e.prototype.dispose=function(){if(this._container==null)return;console.log("Context3D dispose, releasing "+this._resources.length+" resources.");while(this._resources.length)this._resources[0].dispose();if(this._container){this.addStream(String.fromCharCode(Ti.disposeContext));this.execute();if(this._oldCanvas&&this._oldParent){this._oldParent.appendChild(this._oldCanvas);this._oldParent=null}this._container=null}this._oldCanvas=null};e.prototype.addStream=function(t){this._cmdStream+=t};e.prototype.execute=function(){if(e.logStream)console.log(this._cmdStream);var t=this._container["CallFunction"]('<invoke name="execStage3dOpStream" returntype="javascript"><arguments><string>'+this._cmdStream+"</string></arguments></invoke>");if(Number(t)<=-3)throw"Exec stream failed";this._cmdStream="";return Number(t)};return e}();Ri.contexts=new Object;Ri.debug=false;Ri.logStream=false;var Li=function(){function t(t,e){this._context=t;this._id=e}Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:true,configurable:true});return t}();var Ni=function(t){e(i,t);function i(e,i,r){var n=t.call(this,e,r)||this;n.textureType="";return n}i.prototype.dispose=function(){this._context._createBytes.writeInt(Ti.disposeTexture);this._context._createBytes.writeInt(this.id)};Object.defineProperty(i.prototype,"glTexture",{get:function(){return this._glTexture},enumerable:true,configurable:true});i.prototype.generateMipmaps=function(){};return i}(Li);var Fi=function(t){e(i,t);function i(e,i,r,n){var s=t.call(this,e,i,n)||this;s._textureSelectorDictionary=new Array(6);s.textureType="textureCube";s._size=r;return s}i.prototype.uploadFromImage=function(t,e,i){if(i===void 0){i=0}};i.prototype.uploadCompressedTextureFromByteArray=function(t,e,i){if(i===void 0){i=false}};Object.defineProperty(i.prototype,"size",{get:function(){return this._size},enumerable:true,configurable:true});return i}(Ni);var Bi=function(t){e(i,t);function i(e,i,r,n){var s=t.call(this,e,n)||this;s._gl=i;s._numIndices=r;return s}i.prototype.uploadFromArray=function(t,e,i){};i.prototype.uploadFromByteArray=function(t,e,i){};i.prototype.dispose=function(){};Object.defineProperty(i.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:true,configurable:true});return i}(Li);var Vi=function(){function t(){}Object.defineProperty(t,"gles",{get:function(){if(!t._gles)throw"Error: Set GlesConnector.gles before calling methods on ContextGLES!";return t._gles},set:function(e){t._gles=e},enumerable:true,configurable:true});return t}();Vi._gles=null;var Ui=function(t){e(i,t);function i(e,i,r){var n=t.call(this,e,r)||this;n._uniforms=[[],[],[]];n._attribs=[];return n}i.prototype.upload=function(t,e){var r=i._aglslParser.parse(i._tokenizer.decribeAGALByteArray(t));var n=i._aglslParser.parse(i._tokenizer.decribeAGALByteArray(e));var s=new Mt;s.writeInt(1);s.writeInt(Ti.uploadProgram);s.writeInt(this.id);s.writeUTFBytes(r);s.writeUTFBytes(n);s.bytePosition=0;var a=new Int32Array(s.byteLength/4);s.readInt32Array(a);Vi.gles.sendGLESCommands(a.buffer)};i.prototype.getUniformLocation=function(t,e){if(e===void 0){e=-1}return null};i.prototype.getAttribLocation=function(t){return 0};i.prototype.dispose=function(){this._context._createBytes.writeInt(Ti.disposeProgram);this._context._createBytes.writeInt(this.id)};i.prototype.focusProgram=function(){};Object.defineProperty(i.prototype,"glProgram",{get:function(){return this._program},enumerable:true,configurable:true});return i}(Li);Ui._tokenizer=new ci;Ui._aglslParser=new _i;Ui._uniformLocationNameDictionary=["fc","fs","vc"];var ki=function(t){e(i,t);function i(e,i,r,n,s){var a=t.call(this,e,i,s)||this;a.textureType="texture2d";a._width=r;a._height=n;return a}Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"frameBuffer",{get:function(){return this._frameBuffer},enumerable:true,configurable:true});i.prototype.uploadFromImage=function(t,e){if(e===void 0){e=0}var i=new Mt;i.writeInt(1);i.writeInt(Ti.uploadBytesTexture|e<<8);i.writeInt(this.id);i.writeFloat(this._width);i.writeFloat(this._height);i.writeInt(t.getImageData().data.buffer.byteLength);i.writeInt32Array(new Int32Array(t.getImageData().data.buffer));i.bytePosition=0;var r=new Int32Array(i.byteLength/4);i.readInt32Array(r);Vi.gles.sendGLESCommands(r.buffer)};i.prototype.uploadFromURL=function(t,e){if(e===void 0){e=0}var i=new Mt;i.writeInt(1);i.writeInt(Ti.uploadTextureFromURL|e<<8);i.writeInt(this.id);var r=t.url.replace(/[^a-zA-Z0-9]/g,"");console.log("urlRequest.url "+r);i.writeUTFBytes(r);i.bytePosition=0;var n=new Int32Array(i.byteLength/4);i.readInt32Array(n);Vi.gles.sendGLESCommands(n.buffer)};i.prototype.uploadCompressedTextureFromByteArray=function(t,e,i){if(i===void 0){i=false}};return i}(Ni);var zi=function(t){e(i,t);function i(e,i,r,n,s){var a=t.call(this,e,s)||this;a._numVertices=r;a._dataPerVertex=n;return a}i.prototype.uploadFromArray=function(t,e,i){};i.prototype.uploadFromByteArray=function(t,e,i){var r=new Mt;r.writeInt(1);r.writeInt(Ti.uploadArrayVertexBuffer);r.writeInt(this.id);r.writeInt(e);r.writeInt(t.byteLength);r.writeInt32Array(new Int32Array(t));r.bytePosition=0;var n=new Int32Array(r.byteLength/4);r.readInt32Array(n);Vi.gles.sendGLESCommands(n.buffer)};Object.defineProperty(i.prototype,"numVertices",{
get:function(){return this._numVertices},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"dataPerVertex",{get:function(){return this._dataPerVertex},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:true,configurable:true});i.prototype.dispose=function(){this._context._createBytes.writeInt(Ti.disposeVertexBuffer);this._context._createBytes.writeInt(this.id)};return i}(Li);var ji=function(){function e(i){this._blendFactorDictionary=new Object;this._drawModeDictionary=new Object;this._compareModeDictionary=new Object;this.stencilTriangleFace=new Object;this._stencilActionDictionary=new Object;this._textureIndexDictionary=new Array(8);this._textureTypeDictionary=new Object;this._wrapDictionary=new Object;this._filterDictionary=new Object;this._mipmapFilterDictionary=new Object;this._vertexBufferPropertiesDictionary=[];this._samplerStates=new Array(8);this._stencilReferenceValue=0;this._stencilReadMask=255;this._separateStencil=false;this._textureCnt=0;this._programCnt=0;this._cubeTextureCnt=0;this._indexBufferCnt=0;this._vertexBufferCnt=0;this._container=i;this._cmdBytes=new Mt;this._createBytes=new Mt;e._soundBytes=new Mt;e._soundBytes.writeUnsignedInt(100);this._cmdBytes.writeUnsignedInt(0);this._createBytes.writeUnsignedInt(1);this._blendFactorDictionary[t.ContextGLBlendFactor.ONE]=0;this._blendFactorDictionary[t.ContextGLBlendFactor.DESTINATION_ALPHA]=1;this._blendFactorDictionary[t.ContextGLBlendFactor.DESTINATION_COLOR]=2;this._blendFactorDictionary[t.ContextGLBlendFactor.ONE_MINUS_DESTINATION_ALPHA]=3;this._blendFactorDictionary[t.ContextGLBlendFactor.ONE_MINUS_DESTINATION_COLOR]=4;this._blendFactorDictionary[t.ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA]=5;this._blendFactorDictionary[t.ContextGLBlendFactor.ONE_MINUS_SOURCE_COLOR]=6;this._blendFactorDictionary[t.ContextGLBlendFactor.SOURCE_ALPHA]=7;this._blendFactorDictionary[t.ContextGLBlendFactor.SOURCE_COLOR]=8;this._blendFactorDictionary[t.ContextGLBlendFactor.ZERO]=9;this._drawModeDictionary[t.ContextGLDrawMode.LINES]=0;this._drawModeDictionary[t.ContextGLDrawMode.TRIANGLES]=1;this._compareModeDictionary[t.ContextGLCompareMode.ALWAYS]=0;this._compareModeDictionary[t.ContextGLCompareMode.EQUAL]=1;this._compareModeDictionary[t.ContextGLCompareMode.GREATER]=2;this._compareModeDictionary[t.ContextGLCompareMode.GREATER_EQUAL]=3;this._compareModeDictionary[t.ContextGLCompareMode.LESS]=4;this._compareModeDictionary[t.ContextGLCompareMode.LESS_EQUAL]=5;this._compareModeDictionary[t.ContextGLCompareMode.NEVER]=6;this._compareModeDictionary[t.ContextGLCompareMode.NOT_EQUAL]=7;this.stencilTriangleFace[t.ContextGLTriangleFace.BACK]=2;this.stencilTriangleFace[t.ContextGLTriangleFace.FRONT]=1;this.stencilTriangleFace[t.ContextGLTriangleFace.FRONT_AND_BACK]=0;this._stencilActionDictionary[t.ContextGLStencilAction.DECREMENT_SATURATE]=0;this._stencilActionDictionary[t.ContextGLStencilAction.DECREMENT_WRAP]=1;this._stencilActionDictionary[t.ContextGLStencilAction.INCREMENT_SATURATE]=2;this._stencilActionDictionary[t.ContextGLStencilAction.INCREMENT_WRAP]=3;this._stencilActionDictionary[t.ContextGLStencilAction.INVERT]=4;this._stencilActionDictionary[t.ContextGLStencilAction.KEEP]=5;this._stencilActionDictionary[t.ContextGLStencilAction.SET]=6;this._stencilActionDictionary[t.ContextGLStencilAction.ZERO]=7;this._textureTypeDictionary["texture2d"]=0;this._textureTypeDictionary["textureCube"]=1;this._wrapDictionary[t.ContextGLWrapMode.REPEAT]=0;this._wrapDictionary[t.ContextGLWrapMode.CLAMP]=1;this._filterDictionary[t.ContextGLTextureFilter.LINEAR]=0;this._filterDictionary[t.ContextGLTextureFilter.NEAREST]=1;this._mipmapFilterDictionary[t.ContextGLTextureFilter.LINEAR]=new Object;this._mipmapFilterDictionary[t.ContextGLTextureFilter.LINEAR][t.ContextGLMipFilter.MIPNEAREST]=2;this._mipmapFilterDictionary[t.ContextGLTextureFilter.LINEAR][t.ContextGLMipFilter.MIPLINEAR]=3;this._mipmapFilterDictionary[t.ContextGLTextureFilter.LINEAR][t.ContextGLMipFilter.MIPNONE]=0;this._mipmapFilterDictionary[t.ContextGLTextureFilter.NEAREST]=new Object;this._mipmapFilterDictionary[t.ContextGLTextureFilter.NEAREST][t.ContextGLMipFilter.MIPNEAREST]=4;this._mipmapFilterDictionary[t.ContextGLTextureFilter.NEAREST][t.ContextGLMipFilter.MIPLINEAR]=5;this._mipmapFilterDictionary[t.ContextGLTextureFilter.NEAREST][t.ContextGLMipFilter.MIPNONE]=1}e.startSound=function(t,i,r,n){e._soundBytes.writeInt(Ti.startSound|(n?1:0)<<8);e._soundBytes.writeFloat(r);e._soundBytes.writeInt(i);e._soundBytes.writeUTFBytes(t)};e.stopSound=function(t){e._soundBytes.writeInt(Ti.stopSound);e._soundBytes.writeInt(t)};e.updateSound=function(t,i,r){e._soundBytes.writeInt(Ti.updateSound|(r?1:0)<<8);e._soundBytes.writeFloat(i);e._soundBytes.writeInt(t)};Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"standardDerivatives",{get:function(){return this._standardDerivatives},enumerable:true,configurable:true});e.prototype.enableStencil=function(){this._cmdBytes.writeInt(Ti.enableStencil)};e.prototype.disableStencil=function(){this._cmdBytes.writeInt(Ti.disableStencil)};e.prototype.gl=function(){return this._gl};e.prototype.clear=function(e,i,r,n,s,a,o){if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}if(n===void 0){n=1}if(s===void 0){s=1}if(a===void 0){a=0}if(o===void 0){o=t.ContextGLClearMask.ALL}this._cmdBytes.writeInt(Ti.clear);this._cmdBytes.writeFloat(e);this._cmdBytes.writeFloat(i);this._cmdBytes.writeFloat(r);this._cmdBytes.writeFloat(n);this._cmdBytes.writeInt(s);this._cmdBytes.writeInt(a);this._cmdBytes.writeInt(o)};e.prototype.configureBackBuffer=function(t,e,i,r){if(r===void 0){r=true}this._width=t;this._height=e;this._cmdBytes.writeInt(Ti.configureBackBuffer|(r?1:0)<<8);this._cmdBytes.writeFloat(t);this._cmdBytes.writeFloat(e)};e.prototype.createCubeTexture=function(t,e,i,r){if(r===void 0){r=0}return new Fi(this,this._gl,t,this._cubeTextureCnt++)};e.prototype.createIndexBuffer=function(t){return new Bi(this,this._gl,t,this._indexBufferCnt++)};e.prototype.createProgram=function(){return new Ui(this,this._gl,this._programCnt++)};e.prototype.createTexture=function(t,e,i,r,n){if(n===void 0){n=0}return new ki(this,this._gl,t,e,this._textureCnt++)};e.prototype.createVertexBuffer=function(t,e){return new zi(this,this._gl,t,e,this._vertexBufferCnt++)};e.prototype.dispose=function(){this._cmdBytes.writeInt(Ti.disposeContext);this.execute()};e.prototype.drawToBitmapImage2D=function(t){};e.prototype.drawIndices=function(t,e,i,r){if(i===void 0){i=0}if(r===void 0){r=-1}};e.prototype.drawVertices=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=-1}this._cmdBytes.writeInt(Ti.drawVertices|this._drawModeDictionary[t]<<8);this._cmdBytes.writeInt(e);this._cmdBytes.writeInt(i)};e.prototype.present=function(){this.execute()};e.prototype.setBlendFactors=function(t,e){this._blendEnabled=true;this._blendSourceFactor=this._blendFactorDictionary[t];this._blendDestinationFactor=this._blendFactorDictionary[e];this.updateBlendStatus()};e.prototype.setColorMask=function(t,e,i,r){this._cmdBytes.writeInt(Ti.setColorMask);this._cmdBytes.writeInt((t?1:0)|(e?1:0)<<8|(i?1:0)<<16|(r?1:0)<<24)};e.prototype.setCulling=function(e,i){if(i===void 0){i=t.CoordinateSystem.LEFT_HANDED}if(e==t.ContextGLTriangleFace.NONE){this._cmdBytes.writeInt(Ti.disableCulling);return}var r=this.translateTriangleFace(e,i);this._cmdBytes.writeInt(Ti.setCulling|r<<8)};e.prototype.setDepthTest=function(t,e){this._cmdBytes.writeInt(Ti.setDepthTest|(t?1:0)<<8|this._compareModeDictionary[e]<<16)};e.prototype.setStencilActionsMasks=function(t,e,i,r,n,s,a){if(r===void 0){r="keep"}if(n===void 0){n="keep"}if(s===void 0){s="keep"}if(a===void 0){a="leftHanded"}var o=this._compareModeDictionary[t];var h=this._stencilActionDictionary[s];var u=this._stencilActionDictionary[n];var l=this._stencilActionDictionary[r];this._cmdBytes.writeInt(Ti.setStencilActionsMasks|o<<8);this._cmdBytes.writeInt(e);this._cmdBytes.writeInt(i|h<<8|u<<16|l<<24)};e.prototype.setStencilActions=function(e,i,r,n,s,a){if(e===void 0){e=t.ContextGLTriangleFace.FRONT_AND_BACK}if(i===void 0){i=t.ContextGLCompareMode.ALWAYS}if(r===void 0){r=t.ContextGLStencilAction.KEEP}if(n===void 0){n=t.ContextGLStencilAction.KEEP}if(s===void 0){s=t.ContextGLStencilAction.KEEP}if(a===void 0){a=t.CoordinateSystem.LEFT_HANDED}var o=this._compareModeDictionary[i];var h=this.stencilTriangleFace[e];var u=this._stencilActionDictionary[s];var l=this._stencilActionDictionary[n];var p=this._stencilActionDictionary[r];this._cmdBytes.writeInt(Ti.setStencilActions|h<<8);this._cmdBytes.writeInt(o|u<<8|l<<16|p<<24)};e.prototype.setStencilReferenceValue=function(t,e,i){if(e===void 0){e=255}if(i===void 0){i=255}this._cmdBytes.writeInt(Ti.setStencilReferenceValue);this._cmdBytes.writeInt(t);this._cmdBytes.writeInt(e);this._cmdBytes.writeInt(i)};e.prototype.setProgram=function(t){this._cmdBytes.writeInt(Ti.setProgram);this._cmdBytes.writeInt(t.id)};e.prototype.setProgramConstantsFromArray=function(t,e){this._cmdBytes.writeInt(Ti.setProgramConstant|t<<8);this._cmdBytes.writeInt(e.length);this._cmdBytes.writeFloat32Array(e)};e.prototype.setScissorRectangle=function(t){if(t){this._cmdBytes.writeInt(Ti.setScissorRect);this._cmdBytes.writeFloat(t.x);this._cmdBytes.writeFloat(t.y);this._cmdBytes.writeFloat(t.width);this._cmdBytes.writeFloat(t.height)}else{this._cmdBytes.writeInt(Ti.clearScissorRect)}};e.prototype.setTextureAt=function(t,e){if(e){this._cmdBytes.writeInt(Ti.setTextureAt|t<<8);this._cmdBytes.writeInt(e.id)}else{this._cmdBytes.writeInt(Ti.clearTextureAt|t<<8)}};e.prototype.setSamplerStateAt=function(t,e,i,r){this._cmdBytes.writeInt(Ti.setSamplerStateAt|t<<8);this._cmdBytes.writeInt(this._wrapDictionary[e]|this._filterDictionary[i]<<8|this._mipmapFilterDictionary[i][r]<<16)};e.prototype.setVertexBufferAt=function(t,e,i,r){if(i===void 0){i=0}if(r===void 0){r=4}if(e){this._cmdBytes.writeInt(Ti.setVertexBufferAt|t<<8|r<<16|e.dataPerVertex<<24);this._cmdBytes.writeInt(e.id);this._cmdBytes.writeInt(i)}else{this._cmdBytes.writeInt(Ti.clearVertexBufferAt|t<<8)}};e.prototype.setRenderToTexture=function(t,e,i,r){if(e===void 0){e=false}if(i===void 0){i=0}if(r===void 0){r=0}if(t===null||t===undefined){this._cmdBytes.writeInt(Ti.clearRenderToTexture)}else{this._cmdBytes.writeInt(Ti.setRenderToTexture|(e?1:0)<<8);this._cmdBytes.writeInt(t.id)}};e.prototype.setRenderToBackBuffer=function(){this._cmdBytes.writeInt(Ti.clearRenderToTexture)};e.prototype.updateBlendStatus=function(){if(this._blendEnabled){this._cmdBytes.writeInt(Ti.setBlendFactors|this._blendSourceFactor<<8|this._blendDestinationFactor<<16)}else{this._cmdBytes.writeUnsignedInt(Ti.disableBlending)}};e.prototype.translateTriangleFace=function(e,i){switch(e){case t.ContextGLTriangleFace.BACK:return i==t.CoordinateSystem.LEFT_HANDED?2:1;case t.ContextGLTriangleFace.FRONT:return i==t.CoordinateSystem.LEFT_HANDED?1:2;case t.ContextGLTriangleFace.FRONT_AND_BACK:return 0;default:throw"Unknown ContextGLTriangleFace type."}};e.prototype.execute=function(){if(this._createBytes.bytePosition>4){this._createBytes.bytePosition=0;var t=new Int32Array(this._createBytes.byteLength/4);this._createBytes.readInt32Array(t);Vi.gles.sendGLESCommands(t.buffer);this._createBytes.byteLength=0;this._createBytes.bytePosition=0;this._createBytes.writeUnsignedInt(1)}if(this._cmdBytes.bytePosition>4){this._cmdBytes.bytePosition=0;var i=new Int32Array(this._cmdBytes.byteLength/4);this._cmdBytes.readInt32Array(i);Vi.gles.sendGLESCommands(i.buffer);this._cmdBytes.byteLength=0;this._cmdBytes.bytePosition=0;this._cmdBytes.writeUnsignedInt(0)}if(e._soundBytes.bytePosition>4){e._soundBytes.bytePosition=0;var r=new Int32Array(e._soundBytes.byteLength/4);e._soundBytes.readInt32Array(r);Vi.gles.sendGLESCommands(r.buffer);e._soundBytes.byteLength=0;e._soundBytes.bytePosition=0;e._soundBytes.writeUnsignedInt(100)}};return e}();ji._uniformLocationNameDictionary=["fc","fs","vc"];ji.MAX_SAMPLERS=8;ji.modulo=0;var Gi=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.usages=0;r._stage=i;return r}Object.defineProperty(i.prototype,"texture",{get:function(){if(!this._texture){this._createTexture();this._invalid=true}return this._texture},enumerable:true,configurable:true});i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);if(this._texture){this._texture.dispose();this._texture=null}};i.prototype.activate=function(t,e){this._stage.context.setTextureAt(t,this._texture)};i.prototype._createTexture=function(){throw new r};return i}(K);var Hi=function(i){e(r,i);function r(){return i.apply(this,arguments)||this}r.prototype._createTexture=function(){this._texture=this._stage.context.createTexture(this._asset.width,this._asset.height,t.ContextGLTextureFormat.BGRA,true)};return r}(Gi);var Xi=function(t){e(i,t);function i(){return t.apply(this,arguments)||this}i.prototype.activate=function(e,i){if(i&&this._stage.globalDisableMipmap)i=false;if(!this._texture){this._createTexture();this._invalid=true}if(!this._mipmap&&i){this._mipmap=true;this._invalid=true}if(this._invalid){this._invalid=false;this._texture.uploadFromImage(this._asset,0);if(i)this._texture.generateMipmaps()}t.prototype.activate.call(this,e,i)};i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);if(this._mipmapData){var i=this._mipmapData.length;for(var r=0;r<i;r++)Xe._freeMipMapHolder(this._mipmapData[r])}};return i}(Hi);var Wi=function(t){e(i,t);function i(){return t.apply(this,arguments)||this}i.prototype.activate=function(e,i){if(i&&this._stage.globalDisableMipmap)i=false;if(!this._texture){this._createTexture();this._invalid=true}if(!this._mipmap&&i){this._mipmap=true;this._invalid=true}if(this._invalid){this._invalid=false;this._texture.uploadFromURL(this._asset.urlRequest,0)}t.prototype.activate.call(this,e,i)};i.prototype.onClear=function(e){t.prototype.onClear.call(this,e)};return i}(Hi);var Yi=function(i){e(r,i);function r(){return i.apply(this,arguments)||this}r.prototype._createTexture=function(){this._texture=this._stage.context.createCubeTexture(this._asset.size,t.ContextGLTextureFormat.BGRA,false)};return r}(Gi);var qi=function(t){e(i,t);function i(){var e=t.apply(this,arguments)||this;e._mipmapDataArray=new Array(6);return e}i.prototype.activate=function(e,i){if(i&&this._stage.globalDisableMipmap)i=false;if(!this._texture){this._createTexture();this._invalid=true}if(!this._mipmap&&i){this._mipmap=true;this._invalid=true}if(this._invalid){this._invalid=false;for(var r=0;r<6;++r)this._texture.uploadFromImage(this._asset,r,0);if(i)this._texture.generateMipmaps()}t.prototype.activate.call(this,e,i)};i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);for(var i=0;i<6;i++){var r=this._mipmapDataArray[i];if(r){var n=r.length;for(var s=0;s<n;i++)Xe._freeMipMapHolder(r[s])}}};return i}(Yi);var Ki=function(t){e(i,t);function i(){return t.apply(this,arguments)||this}i.prototype.activate=function(e,i){t.prototype.activate.call(this,e,false);if(!this._mipmap&&i){this._mipmap=true;this._invalid=true}if(this._invalid){this._invalid=false;if(i)this._texture.generateMipmaps()}};return i}(Hi);var Zi=function(t){e(i,t);function i(){return t.apply(this,arguments)||this}i.prototype.activate=function(e,i){t.prototype.activate.call(this,e,false)};return i}(Yi);var Qi=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._stage=i;return r}i.prototype.activate=function(t){throw new r};return i}(K);var Ji=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._sampler=e;return r}i.prototype.activate=function(t){this._stage.setSamplerState(t,this._sampler.repeat,this._sampler.smooth,this._sampler.mipmap)};return i}(Qi);var $i=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._sampler=e;return r}i.prototype.activate=function(t){this._stage.setSamplerState(t,false,this._sampler.smooth,this._sampler.mipmap)};return i}(Qi);var tr=function(){function t(t,e,i,r){this.usages=0;this._pool=t;this.stage=e;this.vertexString=i;this.fragmentString=r;this.stage.registerProgram(this)}t.prototype.dispose=function(){this.usages--;if(!this.usages){this._pool.disposeItem(this.vertexString+this.fragmentString);this.stage.unRegisterProgram(this);if(this.program){this.program.dispose();this.program=null}}};return t}();tr.PROGRAMDATA_ID_COUNT=0;var er=function(){function t(t){this._pool=new Object;this._stage=t}t.prototype.getItem=function(t,e){var i=t+e;return this._pool[i]||(this._pool[i]=new tr(this,this._stage,t,e))};t.prototype.disposeItem=function(t){this._pool[t]=null};return t}();var ir=function(){function t(t){this._numIndices=t}t.prototype.uploadFromArray=function(t,e,i){this._startOffset=e*2;this._data=new Uint16Array(t)};t.prototype.uploadFromByteArray=function(t,e,i){this._startOffset=e*2;this._data=new Uint16Array(t)};t.prototype.dispose=function(){this._data=null};Object.defineProperty(t.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"startOffset",{get:function(){return this._startOffset},enumerable:true,configurable:true});return t}();var rr=function(){function t(t,e){this._numVertices=t;this._dataPerVertex=e}t.prototype.uploadFromArray=function(t,e,i){this._floatData=new Float32Array(t)};t.prototype.uploadFromByteArray=function(t,e,i){this._floatData=new Float32Array(t,e*this._dataPerVertex,i*this._dataPerVertex/4);this._uintData=new Uint8Array(t)};Object.defineProperty(t.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dataPerVertex",{get:function(){return this._dataPerVertex},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"attributesPerVertex",{get:function(){return this._dataPerVertex/4},enumerable:true,configurable:true});t.prototype.dispose=function(){this._floatData=null};Object.defineProperty(t.prototype,"data",{get:function(){return this._floatData},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"uintData",{get:function(){return this._uintData},enumerable:true,configurable:true});return t}();var nr=function(){function t(t,e){this._mipLevels=[];this._width=t;this._height=e}Object.defineProperty(t.prototype,"textureType",{get:function(){return t.textureType},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:true,configurable:true});t.prototype.dispose=function(){this._mipLevels=null};t.prototype.isTexture=function(t){return this.textureType==t.textureType};t.prototype.uploadFromImage=function(t,e){if(e===void 0){e=0}this._mipLevels[e]=t.getImageData().data};t.prototype.uploadFromURL=function(t,e){if(e===void 0){e=0}};t.prototype.getData=function(t){return this._mipLevels[t]};t.prototype.getMipLevelsCount=function(){return this._mipLevels.length};t.prototype.generateMipmaps=function(){};return t}();nr.textureType="texture2d";var sr=function(){function t(t){this._textureSelectorDictionary=[[],[],[],[],[],[]];this._size=t}Object.defineProperty(t.prototype,"textureType",{get:function(){return t.textureType},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:true,configurable:true});t.prototype.dispose=function(){this._textureSelectorDictionary=null};t.prototype.isTexture=function(t){return this.textureType==t.textureType};t.prototype.uploadFromImage=function(t,e,i){if(i===void 0){i=0}this._textureSelectorDictionary[e][i]=t.getImageData(e).data};t.prototype.getData=function(t,e){if(e===void 0){e=0}return this._textureSelectorDictionary[t][e]};t.prototype.getMipLevelsCount=function(){return 1};t.prototype.generateMipmaps=function(){};t.prototype.uploadCompressedTextureFromByteArray=function(t,e,i){};return t}();sr.textureType="textureCube";var ar=function(){function t(){this.outputColor=new Float32Array([0,0,0,1]);this.discard=false}return t}();var or=function(){function e(){this.wrap=t.ContextGLWrapMode.REPEAT;this.filter=t.ContextGLTextureFilter.LINEAR;this.mipfilter=t.ContextGLMipFilter.MIPLINEAR}return e}();var hr=function(){function e(){this._numVarying=0}Object.defineProperty(e.prototype,"numVarying",{get:function(){return this._numVarying},enumerable:true,configurable:true});e.prototype.upload=function(t,i){this._vertexDescr=e._tokenizer.decribeAGALByteArray(t);this._vertexVO=new ar;this._vertexVO.temp=new Float32Array(this._vertexDescr.regwrite[2].length*4);this._vertexVO.attributes=new Float32Array(this._vertexDescr.regread[0].length*4);this._numVarying=this._vertexDescr.regwrite[4].length;this._fragmentDescr=e._tokenizer.decribeAGALByteArray(i);this._fragmentVO=new ar;this._fragmentVO.temp=new Float32Array(this._fragmentDescr.regwrite[2].length*4);this._fragmentVO.varying=new Float32Array(this._fragmentDescr.regread[4].length*4);this._fragmentVO.derivativeX=new Float32Array(this._fragmentVO.varying.length);this._fragmentVO.derivativeY=new Float32Array(this._fragmentVO.varying.length)};e.prototype.dispose=function(){this._vertexDescr=null;this._fragmentDescr=null};e.prototype.vertex=function(i,r,n,s){var a;var o=0;var h=this._vertexDescr.regread[0].length;var u=this._vertexVO.attributes;for(a=0;a<h;a++){var l=i._vertexBuffers[a];if(!l)continue;var p=i._vertexBufferOffsets[a]/4+r*l.attributesPerVertex;if(i._vertexBufferFormats[a]==t.ContextGLVertexBufferFormat.UNSIGNED_BYTE_4){u[o++]=l.uintData[p*4];u[o++]=l.uintData[p*4+1];u[o++]=l.uintData[p*4+2];u[o++]=l.uintData[p*4+3]}else if(i._vertexBufferFormats[a]==t.ContextGLVertexBufferFormat.FLOAT_4){u[o++]=l.data[p];u[o++]=l.data[p+1];u[o++]=l.data[p+2];u[o++]=l.data[p+3]}else if(i._vertexBufferFormats[a]==t.ContextGLVertexBufferFormat.FLOAT_3){u[o++]=l.data[p];u[o++]=l.data[p+1];u[o++]=l.data[p+2];u[o++]=1}else if(i._vertexBufferFormats[a]==t.ContextGLVertexBufferFormat.FLOAT_2){u[o++]=l.data[p];u[o++]=l.data[p+1];u[o++]=0;u[o++]=1}else if(i._vertexBufferFormats[a]==t.ContextGLVertexBufferFormat.FLOAT_1){u[o++]=l.data[p];u[o++]=0;u[o++]=0;u[o++]=1}}var c=this._vertexVO.temp;var _=c.length;for(var a=0;a<_;a+=4){c[a]=0;c[a+1]=0;c[a+2]=0;c[a+3]=1}this._vertexVO.outputPosition=n;this._vertexVO.varying=s;var f=this._vertexDescr.tokens.length;for(var a=0;a<f;a++){var d=this._vertexDescr.tokens[a];e._opCodeFunc[d.opcode](this._vertexVO,this._vertexDescr,d.dest,d.a,d.b,i)}};e.prototype.fragment=function(i,r,n,s,a,o,h,u){this._fragmentVO.outputDepth=u;var l=this._fragmentVO.temp;var p=l.length;for(var c=0;c<p;c+=4){l[c]=0;l[c+1]=0;l[c+2]=0;l[c+3]=1}var _=[];var f=this._fragmentDescr.tokens.length;for(var c=0;c<f;c++){var d=this._fragmentDescr.tokens[c];if(d.opcode==40&&i._samplerStates[d.b.regnum]&&i._samplerStates[d.b.regnum].mipfilter==t.ContextGLMipFilter.MIPLINEAR&&i._textures[d.b.regnum].getMipLevelsCount()>1)_.push(d.a.regnum)}var g=this._fragmentVO.derivativeX;var m=this._fragmentVO.derivativeY;var y=this._fragmentVO.varying;var v=y.length;for(var c=0;c<v;c+=4){y[c]=r.x*a[c]+r.y*o[c]+r.z*h[c];y[c+1]=r.x*a[c+1]+r.y*o[c+1]+r.z*h[c+1];y[c+2]=r.x*a[c+2]+r.y*o[c+2]+r.z*h[c+2];y[c+3]=r.x*a[c+3]+r.y*o[c+3]+r.z*h[c+3];if(_.indexOf(c)==-1)continue;g[c]=n.x*a[c]+n.y*o[c]+n.z*h[c];g[c+1]=n.x*a[c+1]+n.y*o[c+1]+n.z*h[c+1];g[c+2]=n.x*a[c+2]+n.y*o[c+2]+n.z*h[c+2];g[c+3]=n.x*a[c+3]+n.y*o[c+3]+n.z*h[c+3];g[c]-=y[c];g[c+1]-=y[c+1];g[c+2]-=y[c+2];g[c+3]-=y[c+3];m[c]=s.x*a[c]+s.y*o[c]+s.z*h[c];m[c+1]=s.x*a[c+1]+s.y*o[c+1]+s.z*h[c+1];m[c+2]=s.x*a[c+2]+s.y*o[c+2]+s.z*h[c+2];m[c+3]=s.x*a[c+3]+s.y*o[c+3]+s.z*h[c+3];m[c]-=y[c];m[c+1]-=y[c+1];m[c+2]-=y[c+2];m[c+3]-=y[c+3]}for(var c=0;c<f;c++){var d=this._fragmentDescr.tokens[c];e._opCodeFunc[d.opcode](this._fragmentVO,this._fragmentDescr,d.dest,d.a,d.b,i)}return this._fragmentVO};e.getDestTarget=function(t,e,i){var r;if(i.regtype==2){r=t.temp}else if(i.regtype==3){if(e.header.type=="vertex"){r=t.outputPosition}else{r=t.outputColor}}else if(i.regtype==4){r=t.varying}return r};e.getSourceTarget=function(t,e,i,r){var n;if(i.regtype==0){n=t.attributes}else if(i.regtype==1){if(e.header.type=="vertex"){n=r._vertexConstants}else{n=r._fragmentConstants}}else if(i.regtype==2){n=t.temp}else if(i.regtype==4){n=t.varying}return n};e.mov=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;if(p&1)u[o]=l[h+(n.swizzle>>0&3)];if(p&2)u[o+1]=l[h+(n.swizzle>>2&3)];if(p&4)u[o+2]=l[h+(n.swizzle>>4&3)];if(p&8)u[o+3]=l[h+(n.swizzle>>6&3)]};e.m44=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=e.getSourceTarget(t,i,n,a);var c=e.getSourceTarget(t,i,s,a);var _=r.mask;if(_&1)l[o]=p[h]*c[u]+p[h+1]*c[u+1]+p[h+2]*c[u+2]+c[u+3];if(_&2)l[o+1]=p[h]*c[u+4]+p[h+1]*c[u+5]+p[h+2]*c[u+6]+c[u+7];if(_&4)l[o+2]=p[h]*c[u+8]+p[h+1]*c[u+9]+p[h+2]*c[u+10]+c[u+11];if(_&8)l[o+3]=p[h]*c[u+12]+p[h+1]*c[u+13]+p[h+2]*c[u+14]+c[u+15]};e.sample=function(t,i,r,n,s){var a=r._textures[s];if(a.isTexture(nr))return e.sampleSimpleTexture(t,i,r,n,s);if(a.isTexture(sr))return e.sampleCubeTexture(t,i,r,n,s);throw new E("Cannot sample provided texture type")};e.sampleCubeTexture=function(i,r,n,s,a){var o=4*s.regnum;var h=e.getSourceTarget(i,r,s,n);var u=h[o+(s.swizzle>>0&3)];var l=h[o+(s.swizzle>>2&3)];var p=h[o+(s.swizzle>>4&3)];var c=0;var _=0;var f=0;var d=Math.abs(u);var g=Math.abs(l);var m=Math.abs(p);var y=Math.max(d,g,m);if(y==d){if(u>=0){c=0;_=.5-.5*(p/u);f=.5-.5*(l/u)}else{c=1;_=.5-.5*(p/u);f=.5+.5*(l/u)}}else if(y==g){if(l>=0){c=2;_=.5+.5*(u/l);f=.5+.5*(p/l)}else{c=3;_=.5-.5*(u/l);f=.5+.5*(p/l)}}else if(y==m){if(p>=0){c=4;_=.5+.5*(u/p);f=.5-.5*(l/p)}else{c=5;_=.5+.5*(u/p);f=.5+.5*(l/p)}}var v=n._textures[a];var x=n._samplerStates[a]||this._defaultSamplerState;var b=x.wrap==t.ContextGLWrapMode.REPEAT;var w=x.mipfilter==t.ContextGLMipFilter.MIPLINEAR;if(x.filter==t.ContextGLTextureFilter.LINEAR)return e.sampleBilinear(_,f,v.getData(c),v.size,v.size,b,e._colorValue0);return e.sampleNearest(_,f,v.getData(c),v.size,v.size,b,e._colorValue0)};e.sampleSimpleTexture=function(i,r,n,s,a){var o=4*s.regnum;var h=e.getSourceTarget(i,r,s,n);var u=h[o+(s.swizzle>>0&3)];var l=h[o+(s.swizzle>>2&3)];if(a>=n._textures.length||n._textures[a]==null)throw new E("textureIndex contains no texture");var p=n._textures[a];var c=n._samplerStates[a]||this._defaultSamplerState;var _=c.wrap==t.ContextGLWrapMode.REPEAT;var f=c.mipfilter==t.ContextGLMipFilter.MIPLINEAR;if(f&&p.getMipLevelsCount()>1){var d=Math.abs(i.derivativeX[o+(s.swizzle>>0&3)]);var g=Math.abs(i.derivativeX[o+(s.swizzle>>2&3)]);var m=Math.abs(i.derivativeY[o+(s.swizzle>>0&3)]);var y=Math.abs(i.derivativeY[o+(s.swizzle>>2&3)]);var v=Math.log(Math.max(p.width*Math.sqrt(d*d+g*g),p.height*Math.sqrt(m*m+y*y)))/Math.LN2;if(v>0){var x=Math.floor(v);var b=Math.ceil(v);var w=Math.log(Math.min(p.width,p.height))/Math.LN2;if(b>w)b=w;if(x>w)x=w;var D=v-Math.floor(v);var C=p.getData(x);var A=p.width/Math.pow(2,x);var T=p.height/Math.pow(2,x);var P=p.getData(b);var S=p.width/Math.pow(2,b);var M=p.height/Math.pow(2,b);if(c.filter==t.ContextGLTextureFilter.LINEAR){e.sampleBilinear(u,l,C,A,T,_,e._colorValue0);e.sampleBilinear(u,l,P,S,M,_,e._colorValue1)}else{e.sampleNearest(u,l,C,A,T,_,e._colorValue0);e.sampleNearest(u,l,P,S,M,_,e._colorValue1)}return e.interpolateColor(e._colorValue0,e._colorValue1,D,e._colorValue0)}}if(c.filter==t.ContextGLTextureFilter.LINEAR)return e.sampleBilinear(u,l,p.getData(0),p.width,p.height,_,e._colorValue0);return e.sampleNearest(u,l,p.getData(0),p.width,p.height,_,e._colorValue0)};e.sampleNearest=function(t,e,i,r,n,s,a){t*=r;e*=n;if(s){t=Math.abs(t%r);e=Math.abs(e%n)}else{if(t<0)t=0;else if(t>r-1)t=r-1;if(e<0)e=0;else if(e>n-1)e=n-1}t=Math.floor(t);e=Math.floor(e);var o=(t+e*r)*4;a[0]=i[o]/255;a[1]=i[o+1]/255;a[2]=i[o+2]/255;a[3]=i[o+3]/255;return a};e.sampleBilinear=function(t,i,r,n,s,a,o){var h=1/n;var u=1/s;t-=h/2;i-=u/2;var l=t*n;l=l-Math.floor(l);var p=i*s;p=p-Math.floor(p);return e.interpolateColor(e.interpolateColor(e.sampleNearest(t,i,r,n,s,a,e._colorInterpolated0),e.sampleNearest(t+h,i,r,n,s,a,e._colorValue0),l,e._colorInterpolated0),e.interpolateColor(e.sampleNearest(t,i+u,r,n,s,a,e._colorInterpolated1),e.sampleNearest(t+h,i+u,r,n,s,a,e._colorValue0),l,e._colorInterpolated1),p,o)};e.interpolateColor=function(t,e,i,r){r[0]=t[0]+(e[0]-t[0])*i;r[1]=t[1]+(e[1]-t[1])*i;r[2]=t[2]+(e[2]-t[2])*i;r[3]=t[3]+(e[3]-t[3])*i;return r};e.tex=function(t,i,r,n,s,a){var o=4*r.regnum;var h=e.getDestTarget(t,i,r);var u=e.sample(t,i,a,n,s.regnum);var l=r.mask;if(l&1)h[o]=u[0];if(l&2)h[o+1]=u[1];if(l&4)h[o+2]=u[2];if(l&8)h[o+3]=u[3]};e.add=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=e.getSourceTarget(t,i,n,a);var c=e.getSourceTarget(t,i,s,a);var _=r.mask;var f=n.swizzle;var d=s.swizzle;if(_&1)l[o]=p[h+(f>>0&3)]+c[u+(d>>0&3)];if(_&2)l[o+1]=p[h+(f>>2&3)]+c[u+(d>>2&3)];if(_&4)l[o+2]=p[h+(f>>4&3)]+c[u+(d>>4&3)];if(_&8)l[o+3]=p[h+(f>>6&3)]+c[u+(d>>6&3)]};e.sub=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=e.getSourceTarget(t,i,n,a);var c=e.getSourceTarget(t,i,s,a);var _=r.mask;var f=n.swizzle;var d=s.swizzle;if(_&1)l[o]=p[h+(f>>0&3)]-c[u+(d>>0&3)];if(_&2)l[o+1]=p[h+(f>>2&3)]-c[u+(d>>2&3)];if(_&4)l[o+2]=p[h+(f>>4&3)]-c[u+(d>>4&3)];if(_&8)l[o+3]=p[h+(f>>6&3)]-c[u+(d>>6&3)]};e.mul=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=e.getSourceTarget(t,i,n,a);var c=e.getSourceTarget(t,i,s,a);var _=r.mask;var f=n.swizzle;var d=s.swizzle;if(_&1)l[o]=p[h+(f>>0&3)]*c[u+(d>>0&3)];if(_&2)l[o+1]=p[h+(f>>2&3)]*c[u+(d>>2&3)];if(_&4)l[o+2]=p[h+(f>>4&3)]*c[u+(d>>4&3)];if(_&8)l[o+3]=p[h+(f>>6&3)]*c[u+(d>>6&3)]};e.div=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=e.getSourceTarget(t,i,n,a);var c=e.getSourceTarget(t,i,s,a);var _=r.mask;var f=n.swizzle;var d=s.swizzle;if(_&1)l[o]=p[h+(f>>0&3)]/c[u+(d>>0&3)];if(_&2)l[o+1]=p[h+(f>>2&3)]/c[u+(d>>2&3)];if(_&4)l[o+2]=p[h+(f>>4&3)]/c[u+(d>>4&3)];if(_&8)l[o+3]=p[h+(f>>6&3)]/c[u+(d>>6&3)]};e.rcp=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;if(p&1)u[o]=1/l[h+(c>>0&3)];if(p&2)u[o+1]=1/l[h+(c>>2&3)];if(p&4)u[o+2]=1/l[h+(c>>4&3)];if(p&8)u[o+3]=1/l[h+(c>>6&3)]};e.min=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=e.getSourceTarget(t,i,n,a);var c=e.getSourceTarget(t,i,s,a);var _=r.mask;var f=n.swizzle;var d=s.swizzle;if(_&1)l[o]=Math.min(p[h+(f>>0&3)],c[u+(d>>0&3)]);if(_&2)l[o+1]=Math.min(p[h+(f>>2&3)],c[u+(d>>2&3)]);if(_&4)l[o+2]=Math.min(p[h+(f>>4&3)],c[u+(d>>4&3)]);if(_&8)l[o+3]=Math.min(p[h+(f>>6&3)],c[u+(d>>6&3)])};e.max=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=e.getSourceTarget(t,i,n,a);var c=e.getSourceTarget(t,i,s,a);var _=r.mask;var f=n.swizzle;var d=s.swizzle;if(_&1)l[o]=Math.max(p[h+(f>>0&3)],c[u+(d>>0&3)]);if(_&2)l[o+1]=Math.max(p[h+(f>>2&3)],c[u+(d>>2&3)]);if(_&4)l[o+2]=Math.max(p[h+(f>>4&3)],c[u+(d>>4&3)]);if(_&8)l[o+3]=Math.max(p[h+(f>>6&3)],c[u+(d>>6&3)])};e.frc=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;if(p&1)u[o]=l[h+(c>>0&3)]-Math.floor(l[h+(c>>0&3)]);if(p&2)u[o+1]=l[h+(c>>2&3)]-Math.floor(l[h+(c>>2&3)]);if(p&4)u[o+2]=l[h+(c>>4&3)]-Math.floor(l[h+(c>>4&3)]);if(p&8)u[o+3]=l[h+(c>>6&3)]-Math.floor(l[h+(c>>6&3)]);

};e.sqt=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;if(p&1)u[o]=Math.sqrt(l[h+(c>>0&3)]);if(p&2)u[o+1]=Math.sqrt(l[h+(c>>2&3)]);if(p&4)u[o+2]=Math.sqrt(l[h+(c>>4&3)]);if(p&8)u[o+3]=Math.sqrt(l[h+(c>>6&3)])};e.rsq=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;if(p&1)u[o]=1/Math.sqrt(l[h+(c>>0&3)]);if(p&2)u[o+1]=1/Math.sqrt(l[h+(c>>2&3)]);if(p&4)u[o+2]=1/Math.sqrt(l[h+(c>>4&3)]);if(p&8)u[o+3]=1/Math.sqrt(l[h+(c>>6&3)])};e.pow=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=e.getSourceTarget(t,i,n,a);var c=e.getSourceTarget(t,i,s,a);var _=r.mask;var f=n.swizzle;var d=s.swizzle;if(_&1)l[o]=Math.pow(p[h+(f>>0&3)],c[u+(d>>0&3)]);if(_&2)l[o+1]=Math.pow(p[h+(f>>2&3)],c[u+(d>>2&3)]);if(_&4)l[o+2]=Math.pow(p[h+(f>>4&3)],c[u+(d>>4&3)]);if(_&8)l[o+3]=Math.pow(p[h+(f>>6&3)],c[u+(d>>6&3)])};e.log=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;if(p&1)u[o]=Math.log(l[h+(c>>0&3)])/Math.LN2;if(p&2)u[o+1]=Math.log(l[h+(c>>2&3)])/Math.LN2;if(p&4)u[o+2]=Math.log(l[h+(c>>4&3)])/Math.LN2;if(p&8)u[o+3]=Math.log(l[h+(c>>6&3)])/Math.LN2};e.exp=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;if(p&1)u[o]=Math.exp(l[h+(c>>0&3)]);if(p&2)u[o+1]=Math.exp(l[h+(c>>2&3)]);if(p&4)u[o+2]=Math.exp(l[h+(c>>4&3)]);if(p&8)u[o+3]=Math.exp(l[h+(c>>6&3)])};e.nrm=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;var _=l[h+(c>>0&3)];var f=l[h+(c>>2&3)];var d=l[h+(c>>4&3)];var g=Math.sqrt(_*_+f*f+d*d);_/=g;f/=g;d/=g;if(p&1)u[o]=_;if(p&2)u[o+1]=f;if(p&4)u[o+2]=d};e.sin=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;if(p&1)u[o]=Math.sin(l[h+(c>>0&3)]);if(p&2)u[o+1]=Math.sin(l[h+(c>>2&3)]);if(p&4)u[o+2]=Math.sin(l[h+(c>>4&3)]);if(p&8)u[o+3]=Math.sin(l[h+(c>>6&3)])};e.cos=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;if(p&1)u[o]=Math.cos(l[h+(c>>0&3)]);if(p&2)u[o+1]=Math.cos(l[h+(c>>2&3)]);if(p&4)u[o+2]=Math.cos(l[h+(c>>4&3)]);if(p&8)u[o+3]=Math.cos(l[h+(c>>6&3)])};e.crs=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=r.mask;var c=n.swizzle;var _=s.swizzle;var f=e.getSourceTarget(t,i,n,a);var d=f[h+(c>>0&3)];var g=f[h+(c>>2&3)];var m=f[h+(c>>4&3)];var y=e.getSourceTarget(t,i,s,a);var v=y[u+(_>>0&3)];var x=y[u+(_>>2&3)];var b=y[u+(_>>4&3)];if(p&1)l[o]=g*b-m*x;if(p&2)l[o+1]=m*v-d*b;if(p&4)l[o+2]=d*x-g*v};e.dp3=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=r.mask;var c=n.swizzle;var _=s.swizzle;var f=e.getSourceTarget(t,i,n,a);var d=f[h+(c>>0&3)];var g=f[h+(c>>2&3)];var m=f[h+(c>>4&3)];var y=e.getSourceTarget(t,i,s,a);var v=y[u+(_>>0&3)];var x=y[u+(_>>2&3)];var b=y[u+(_>>4&3)];if(p&1)l[o]=d*v+g*x+m*b;if(p&2)l[o+1]=d*v+g*x+m*b;if(p&4)l[o+2]=d*v+g*x+m*b;if(p&8)l[o+3]=d*v+g*x+m*b};e.dp4=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=r.mask;var c=n.swizzle;var _=s.swizzle;var f=e.getSourceTarget(t,i,n,a);var d=f[h+(c>>0&3)];var g=f[h+(c>>2&3)];var m=f[h+(c>>4&3)];var y=f[h+(c>>6&3)];var v=e.getSourceTarget(t,i,s,a);var x=v[u+(_>>0&3)];var b=v[u+(_>>2&3)];var w=v[u+(_>>4&3)];var D=v[u+(_>>6&3)];if(p&1)l[o]=d*x+g*b+m*w+y*D;if(p&2)l[o+1]=d*x+g*b+m*w+y*D;if(p&4)l[o+2]=d*x+g*b+m*w+y*D;if(p&8)l[o+3]=d*x+g*b+m*w+y*D};e.abs=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;if(p&1)u[o]=Math.abs(l[h+(c>>0&3)]);if(p&2)u[o+1]=Math.abs(l[h+(c>>2&3)]);if(p&4)u[o+2]=Math.abs(l[h+(c>>4&3)]);if(p&8)u[o+3]=Math.abs(l[h+(c>>6&3)])};e.neg=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;if(p&1)u[o]=-l[h+(c>>0&3)];if(p&2)u[o+1]=-l[h+(c>>2&3)];if(p&4)u[o+2]=-l[h+(c>>4&3)];if(p&8)u[o+3]=-l[h+(c>>6&3)]};e.sat=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=e.getSourceTarget(t,i,n,a);var p=r.mask;var c=n.swizzle;if(p&1)u[o]=Math.max(0,Math.min(1,l[h+(c>>0&3)]));if(p&2)u[o+1]=Math.max(0,Math.min(1,l[h+(c>>2&3)]));if(p&4)u[o+2]=Math.max(0,Math.min(1,l[h+(c>>4&3)]));if(p&8)u[o+3]=Math.max(0,Math.min(1,l[h+(c>>6&3)]))};e.m33=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=e.getSourceTarget(t,i,n,a);var c=e.getSourceTarget(t,i,s,a);var _=r.mask;if(_&1)l[o]=p[h]*c[u]+p[h+1]*c[u+1]+p[h+2]*c[u+2];if(_&2)l[o+1]=p[h]*c[u+4]+p[h+1]*c[u+5]+p[h+2]*c[u+6];if(_&4)l[o+2]=p[h]*c[u+8]+p[h+1]*c[u+9]+p[h+2]*c[u+10]};e.m34=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=e.getSourceTarget(t,i,n,a);var c=e.getSourceTarget(t,i,s,a);var _=r.mask;if(_&1)l[o]=p[h]*c[u]+p[h+1]*c[u+1]+p[h+2]*c[u+2]+c[u+3];if(_&2)l[o+1]=p[h]*c[u+4]+p[h+1]*c[u+5]+p[h+2]*c[u+6]+c[u+7];if(_&4)l[o+2]=p[h]*c[u+8]+p[h+1]*c[u+9]+p[h+2]*c[u+10]+c[u+11]};e.ddx=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=t.derivativeX;var p=r.mask;var c=n.swizzle;if(p&1)u[o]=l[h+(c>>0&3)];if(p&2)u[o+1]=l[h+(c>>2&3)];if(p&4)u[o+2]=l[h+(c>>4&3)];if(p&8)u[o+3]=l[h+(c>>6&3)]};e.ddy=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=t.derivativeY;var p=r.mask;var c=n.swizzle;if(p&1)u[o]=l[h+(c>>0&3)];if(p&2)u[o+1]=l[h+(c>>2&3)];if(p&4)u[o+2]=l[h+(c>>4&3)];if(p&8)u[o+3]=l[h+(c>>6&3)]};e.sge=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=r.mask;var c=n.swizzle;var _=s.swizzle;var f=e.getSourceTarget(t,i,n,a);var d=f[h+(c>>0&3)];var g=f[h+(c>>2&3)];var m=f[h+(c>>4&3)];var y=f[h+(c>>6&3)];var v=e.getSourceTarget(t,i,s,a);var x=v[u+(_>>0&3)];var b=v[u+(_>>2&3)];var w=v[u+(_>>4&3)];var D=v[u+(_>>6&3)];if(p&1)l[o]=d>=x?1:0;if(p&2)l[o+1]=g>=b?1:0;if(p&4)l[o+2]=m>=w?1:0;if(p&8)l[o+3]=y>=D?1:0};e.slt=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*s.regnum;var l=e.getDestTarget(t,i,r);var p=r.mask;var c=n.swizzle;var _=s.swizzle;var f=e.getSourceTarget(t,i,n,a);var d=f[h+(c>>0&3)];var g=f[h+(c>>2&3)];var m=f[h+(c>>4&3)];var y=f[h+(c>>6&3)];var v=e.getSourceTarget(t,i,s,a);var x=v[u+(_>>0&3)];var b=v[u+(_>>2&3)];var w=v[u+(_>>4&3)];var D=v[u+(_>>6&3)];if(p&1)l[o]=d<x?1:0;if(p&2)l[o+1]=g<b?1:0;if(p&4)l[o+2]=m<w?1:0;if(p&8)l[o+3]=y<D?1:0};e.seq=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*n.regnum;var l=e.getDestTarget(t,i,r);var p=r.mask;var c=n.swizzle;var _=s.swizzle;var f=e.getSourceTarget(t,i,n,a);var d=f[h+(c>>0&3)];var g=f[h+(c>>2&3)];var m=f[h+(c>>4&3)];var y=f[h+(c>>6&3)];var v=e.getSourceTarget(t,i,s,a);var x=v[u+(_>>0&3)];var b=v[u+(_>>2&3)];var w=v[u+(_>>4&3)];var D=v[u+(_>>6&3)];if(p&1)l[o]=d==x?1:0;if(p&2)l[o+1]=g==b?1:0;if(p&4)l[o+2]=m==w?1:0;if(p&8)l[o+3]=y==D?1:0};e.sne=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=4*n.regnum;var l=e.getDestTarget(t,i,r);var p=r.mask;var c=n.swizzle;var _=s.swizzle;var f=e.getSourceTarget(t,i,n,a);var d=f[h+(c>>0&3)];var g=f[h+(c>>2&3)];var m=f[h+(c>>4&3)];var y=f[h+(c>>6&3)];var v=e.getSourceTarget(t,i,s,a);var x=v[u+(_>>0&3)];var b=v[u+(_>>2&3)];var w=v[u+(_>>4&3)];var D=v[u+(_>>6&3)];if(p&1)l[o]=d!=x?1:0;if(p&2)l[o+1]=g!=b?1:0;if(p&4)l[o+2]=m!=w?1:0;if(p&8)l[o+3]=y!=D?1:0};e.sgn=function(t,i,r,n,s,a){var o=4*r.regnum;var h=4*n.regnum;var u=e.getDestTarget(t,i,r);var l=r.mask;var p=n.swizzle;var c=e.getSourceTarget(t,i,n,a);var _=c[h+(p>>0&3)];var f=c[h+(p>>2&3)];var d=c[h+(p>>4&3)];var g=c[h+(p>>6&3)];if(l&1)u[o]=_<0?-1:_>0?1:0;if(l&2)u[o+1]=f<0?-1:f>0?1:0;if(l&4)u[o+2]=d<0?-1:d>0?1:0;if(l&8)u[o+3]=g<0?-1:g>0?1:0};e.kil=function(t,i,r,n,s,a){var o=4*n.regnum;var h=n.swizzle;var u=e.getSourceTarget(t,i,n,a);var l=u[o+(h>>0&3)];if(l<0)t.discard=true};return e}();hr._defaultSamplerState=new or;hr._tokenizer=new ci;hr._opCodeFunc=[hr.mov,hr.add,hr.sub,hr.mul,hr.div,hr.rcp,hr.min,hr.max,hr.frc,hr.sqt,hr.rsq,hr.pow,hr.log,hr.exp,hr.nrm,hr.sin,hr.cos,hr.crs,hr.dp3,hr.dp4,hr.abs,hr.neg,hr.sat,hr.m33,hr.m44,hr.m34,null,null,null,null,null,null,null,null,null,null,null,null,null,hr.kil,hr.tex,hr.sge,hr.slt,hr.sgn,hr.seq,hr.sne];hr._colorValue0=new Float32Array(4);hr._colorValue1=new Float32Array(4);hr._colorInterpolated0=new Float32Array(4);hr._colorInterpolated1=new Float32Array(4);var ur=function(){function t(){}t.destinationAlpha=function(t,e,i,r){t[0]=e[0]*i[3]/255;t[1]=e[1]*i[3]/255;t[2]=e[2]*i[3]/255;t[3]=e[3]*i[3]/255};t.destinationColor=function(t,e,i,r){t[0]=e[0]*i[0]/255;t[1]=e[1]*i[1]/255;t[2]=e[2]*i[2]/255;t[3]=e[3]*i[3]/255};t.one=function(t,e,i,r){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3]};t.oneMinusDestinationAlpha=function(t,e,i,r){t[0]=e[0]*(1-i[3]/255);t[1]=e[1]*(1-i[3]/255);t[2]=e[2]*(1-i[3]/255);t[3]=e[3]*(1-i[3]/255)};t.oneMinusDestinationColor=function(t,e,i,r){t[0]=e[0]*(1-i[0]/255);t[1]=e[1]*(1-i[1]/255);t[2]=e[2]*(1-i[2]/255);t[3]=e[3]*(1-i[3]/255)};t.oneMinusSourceAlpha=function(t,e,i,r){t[0]=e[0]*(1-r[3]/255);t[1]=e[1]*(1-r[3]/255);t[2]=e[2]*(1-r[3]/255);t[3]=e[3]*(1-r[3]/255)};t.oneMinusSourceColor=function(t,e,i,r){t[0]=e[0]*(1-r[0]/255);t[1]=e[1]*(1-r[1]/255);t[2]=e[2]*(1-r[2]/255);t[3]=e[3]*(1-r[3]/255)};t.sourceAlpha=function(t,e,i,r){t[0]=e[0]*r[3]/255;t[1]=e[1]*r[3]/255;t[2]=e[2]*r[3]/255;t[3]=e[3]*r[3]/255};t.sourceColor=function(t,e,i,r){t[0]=e[0]*r[0]/255;t[1]=e[1]*r[1]/255;t[2]=e[2]*r[2]/255;t[3]=e[3]*r[3]/255};t.zero=function(t,e,i,r){};return t}();var lr=function(){function t(){}t.always=function(t,e){return true};t.equal=function(t,e){return t==e};t.greater=function(t,e){return t>e};t.greaterEqual=function(t,e){return t>=e};t.less=function(t,e){return t<e};t.lessEqual=function(t,e){return t<=e};t.never=function(t,e){return false};t.notEqual=function(t,e){return t!=e};return t}();var pr=function(){function e(e){this._backBufferRect=new Y;this._cullingMode=t.ContextGLTriangleFace.BACK;this._blendSource=t.ContextGLBlendFactor.ONE;this._blendDestination=t.ContextGLBlendFactor.ZERO;this._colorMaskR=true;this._colorMaskG=true;this._colorMaskB=true;this._colorMaskA=true;this._writeDepth=true;this._depthCompareMode=t.ContextGLCompareMode.LESS;this._depthCompareModeSoftware=function(t,e){return void[]};this._blendModeSoftware=function(t,e,i){return void[]};this._screenMatrix=new M;this._frontBufferMatrix=new j;this._bboxMin=new z;this._bboxMax=new z;this._clamp=new z;this._samplerStates=[];this._textures=[];this.textureBuffersColor=[];this.textureBuffersZ=[];this.textureBuffersZClear=[];this._vertexBuffers=[];this._vertexBufferOffsets=[];this._vertexBufferFormats=[];this._rgba=new Uint8ClampedArray(4);this._source=new Uint8ClampedArray(4);this._dest=new Uint8ClampedArray(4);this._destComp=new Uint8ClampedArray(4);this._sourceComp=new Uint8ClampedArray(4);this._antialias=0;this._p0=new A;this._p1=new A;this._p2=new A;this._project=new A;this._barycentric=new A;this._barycentricRight=new A;this._barycentricBottom=new A;this._canvas=e;this._backBufferColor=new pe(100,100,false,0,false);this._frontBuffer=new pe(100,100,false,0,false);this._activeBufferColor=this._backBufferColor;var i=100*100;var r=new ArrayBuffer(i*8);this._backBufferZ=new Float32Array(r,0,i);this._backBufferZClear=new Float32Array(r,i*4,i);for(var n=0;n<i;n++)this._backBufferZClear[n]=1e7;this._activeBufferZ=this._backBufferZ;if(document&&document.body){var s=this._frontBuffer.getCanvas();s.style.position="absolute";document.body.appendChild(s)}this._depthCompareModeSoftware[t.ContextGLCompareMode.ALWAYS]=lr.always;this._depthCompareModeSoftware[t.ContextGLCompareMode.EQUAL]=lr.equal;this._depthCompareModeSoftware[t.ContextGLCompareMode.GREATER]=lr.greaterEqual;this._depthCompareModeSoftware[t.ContextGLCompareMode.GREATER_EQUAL]=lr.greater;this._depthCompareModeSoftware[t.ContextGLCompareMode.LESS]=lr.less;this._depthCompareModeSoftware[t.ContextGLCompareMode.LESS_EQUAL]=lr.lessEqual;this._depthCompareModeSoftware[t.ContextGLCompareMode.NEVER]=lr.never;this._depthCompareModeSoftware[t.ContextGLCompareMode.NOT_EQUAL]=lr.notEqual;this._blendModeSoftware[t.ContextGLBlendFactor.DESTINATION_ALPHA]=ur.destinationAlpha;this._blendModeSoftware[t.ContextGLBlendFactor.DESTINATION_COLOR]=ur.destinationColor;this._blendModeSoftware[t.ContextGLBlendFactor.ONE]=ur.one;this._blendModeSoftware[t.ContextGLBlendFactor.ONE_MINUS_DESTINATION_ALPHA]=ur.oneMinusDestinationAlpha;this._blendModeSoftware[t.ContextGLBlendFactor.ONE_MINUS_DESTINATION_COLOR]=ur.oneMinusDestinationColor;this._blendModeSoftware[t.ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA]=ur.oneMinusSourceAlpha;this._blendModeSoftware[t.ContextGLBlendFactor.ONE_MINUS_SOURCE_COLOR]=ur.oneMinusSourceColor;this._blendModeSoftware[t.ContextGLBlendFactor.SOURCE_ALPHA]=ur.sourceAlpha;this._blendModeSoftware[t.ContextGLBlendFactor.SOURCE_COLOR]=ur.sourceColor;this._blendModeSoftware[t.ContextGLBlendFactor.ZERO]=ur.zero}e.prototype.configureBackBuffer=function(t,e,i,r){this._antialias=i;if(this._antialias%2!=0)this._antialias=Math.floor(this._antialias-.5);if(this._antialias==0)this._antialias=1;this._frontBuffer._setSize(t,e);var n=t*this._antialias;var s=e*this._antialias;var a=n*s;var o=new ArrayBuffer(a*8);this._backBufferZ=new Float32Array(o,0,a);this._backBufferZClear=new Float32Array(o,a*4,a);for(var h=0;h<a;h++)this._backBufferZClear[h]=1e7;if(this._activeBufferColor==this._backBufferColor)this._activeBufferZ=this._backBufferZ;this._backBufferRect.width=n;this._backBufferRect.height=s;this._backBufferColor._setSize(n,s);this.activateScreenMatrix(this._backBufferRect.width,this._backBufferRect.height,true);this._frontBufferMatrix=new j;this._frontBufferMatrix.scale(1/this._antialias,1/this._antialias)};e.prototype.activateScreenMatrix=function(t,e,i){var r=this._screenMatrix._rawData;r[0]=t/2;r[1]=0;r[2]=0;r[3]=0;r[4]=0;r[5]=i?-e/2:e/2;r[6]=0;r[7]=0;r[8]=0;r[9]=0;r[10]=1;r[11]=0;r[12]=t/2;r[13]=e/2;r[14]=0;r[15]=0;this._yflip=i};e.prototype.setRenderToTexture=function(t,e,i,r){var n=this.textureBuffersColor[r];if(n==null){n=this.textureBuffersColor[r]=new pe(t.width,t.height,false,16777215,true);t.uploadFromImage(n)}else{n.fillRect(n.rect,16777215)}this._activeBufferColor=n;this._activeBufferColor.lock();var s=this.textureBuffersZ[r];var a=this.textureBuffersZClear[r];if(s==null){var o=t.width*t.height;var h=new ArrayBuffer(o*8);s=this.textureBuffersZ[r]=new Float32Array(h,0,o);a=this.textureBuffersZClear[r]=new Float32Array(h,o*4,o);for(var u=0;u<o;u++)a[u]=1e7}s.set(a);this._activeBufferZ=s;this.activateScreenMatrix(t.width,t.height,false);this._activeTexture=t};e.prototype.setRenderToBackBuffer=function(){this._activeBufferColor=this._backBufferColor;this._activeBufferZ=this._backBufferZ;this.activateScreenMatrix(this._backBufferColor.width,this._backBufferColor.height,true)};e.prototype.drawIndices=function(e,i,r,n){if(!this._program)return;var s=new Float32Array(4);var a=new Float32Array(4);var o=new Float32Array(4);var h=new Float32Array(4);var u=new Float32Array(4);var l=new Float32Array(this._program.numVarying*4);var p=new Float32Array(this._program.numVarying*4);var c=new Float32Array(this._program.numVarying*4);var _=new Float32Array(this._program.numVarying*4);var f=new Float32Array(this._program.numVarying*4);var d=new Array(5);var g=new Array(4);d[0]=a;d[1]=o;d[2]=s;d[3]=h;d[4]=u;var m=new Array(5);var y=new Array(4);m[0]=p;m[1]=c;m[2]=l;m[3]=_;m[4]=f;if(this._yflip&&this._cullingMode==t.ContextGLTriangleFace.BACK||!this._yflip&&this._cullingMode==t.ContextGLTriangleFace.FRONT){for(var v=r;v<n;v+=3){this._program.vertex(this,i.data[i.startOffset+v],s,l);this._program.vertex(this,i.data[i.startOffset+v+1],a,p);this._program.vertex(this,i.data[i.startOffset+v+2],o,c);this._triangle(d,g,m,y)}}else if(this._yflip&&this._cullingMode==t.ContextGLTriangleFace.FRONT||!this._yflip&&this._cullingMode==t.ContextGLTriangleFace.BACK){for(var v=r;v<n;v+=3){this._program.vertex(this,i.data[i.startOffset+v+2],s,l);this._program.vertex(this,i.data[i.startOffset+v+1],a,p);this._program.vertex(this,i.data[i.startOffset+v],o,c);this._triangle(d,g,m,y)}}else if(this._cullingMode==t.ContextGLTriangleFace.FRONT_AND_BACK||this._cullingMode==t.ContextGLTriangleFace.NONE){for(var v=r;v<n;v+=3){this._program.vertex(this,i.data[i.startOffset+v+2],s,l);this._program.vertex(this,i.data[i.startOffset+v+1],a,p);this._program.vertex(this,i.data[i.startOffset+v],o,c);this._triangle(d,g,m,y);this._program.vertex(this,i.data[i.startOffset+v],s,l);this._program.vertex(this,i.data[i.startOffset+v+1],a,p);this._program.vertex(this,i.data[i.startOffset+v+2],o,c);this._triangle(d,g,m,y)}}if(this._activeBufferColor!=this._backBufferColor){this._activeBufferColor.unlock();this._activeTexture.uploadFromImage(this._activeBufferColor)}};e.prototype._triangle=function(t,e,i,r){var n=0;var s=0;var a=0;var o=t[2];var h=i[2];var u=o[2]>0;if(u){e[0]=o;r[0]=h;a++;n++}for(var l=0;l<3;l++){var p=t[l];var c=i[l];var _=p[2]>0;if(_!=u){var f=Math.abs(p[2]);var d=Math.abs(o[2]);var g=d/(d+f);this._interpolateVertexPair(g,p,o,t[3+s]);e[a]=t[3+s];this._interpolateVertexPair(g,c,h,i[3+s]);r[a]=i[3+s];a++;s++}if(_&&l!=2){e[a]=p;r[a]=c;a++;n++}o=p;h=c;u=_}if(n==3){this._projectTriangle(t[0],t[1],t[2],i[0],i[1],i[2])}else if(n==2){this._projectTriangle(e[0],e[1],e[2],r[0],r[1],r[2]);this._projectTriangle(e[0],e[2],e[3],r[0],r[2],r[3])}else if(n==1){this._projectTriangle(e[0],e[1],e[2],r[0],r[1],r[2])}};e.prototype._projectTriangle=function(t,e,i,r,n,s){this._p0.x=t[0];this._p0.y=t[1];this._p0.z=t[2];this._p0.w=t[3];this._p1.x=e[0];this._p1.y=e[1];this._p1.z=e[2];this._p1.w=e[3];this._p2.x=i[0];this._p2.y=i[1];this._p2.z=i[2];this._p2.w=i[3];if(this._p0.w==0||this._p1.w==0||this._p2.w==0){return}if(isNaN(this._p0.x)||isNaN(this._p0.y)||isNaN(this._p0.z)||isNaN(this._p0.w)){return}if(isNaN(this._p1.x)||isNaN(this._p1.y)||isNaN(this._p1.z)||isNaN(this._p1.w)){return}if(isNaN(this._p2.x)||isNaN(this._p2.y)||isNaN(this._p2.z)||isNaN(this._p2.w)){return}this._p0.z=this._p0.z*2-this._p0.w;this._p1.z=this._p1.z*2-this._p1.w;this._p2.z=this._p2.z*2-this._p2.w;this._p0.scaleBy(1/this._p0.w);this._p1.scaleBy(1/this._p1.w);this._p2.scaleBy(1/this._p2.w);this._project.x=this._p0.w;this._project.y=this._p1.w;this._project.z=this._p2.w;this._p0=this._screenMatrix.transformVector(this._p0,this._p0);this._p1=this._screenMatrix.transformVector(this._p1,this._p1);this._p2=this._screenMatrix.transformVector(this._p2,this._p2);this._bboxMin.x=1e6;this._bboxMin.y=1e6;this._bboxMax.x=-1e6;this._bboxMax.y=-1e6;this._clamp.x=this._activeBufferColor.width-1;this._clamp.y=this._activeBufferColor.height-1;this._bboxMin.x=Math.max(0,Math.min(this._bboxMin.x,this._p0.x));this._bboxMin.y=Math.max(0,Math.min(this._bboxMin.y,this._p0.y));this._bboxMin.x=Math.max(0,Math.min(this._bboxMin.x,this._p1.x));this._bboxMin.y=Math.max(0,Math.min(this._bboxMin.y,this._p1.y));this._bboxMin.x=Math.max(0,Math.min(this._bboxMin.x,this._p2.x));this._bboxMin.y=Math.max(0,Math.min(this._bboxMin.y,this._p2.y));this._bboxMax.x=Math.min(this._clamp.x,Math.max(this._bboxMax.x,this._p0.x));this._bboxMax.y=Math.min(this._clamp.y,Math.max(this._bboxMax.y,this._p0.y));this._bboxMax.x=Math.min(this._clamp.x,Math.max(this._bboxMax.x,this._p1.x));this._bboxMax.y=Math.min(this._clamp.y,Math.max(this._bboxMax.y,this._p1.y));this._bboxMax.x=Math.min(this._clamp.x,Math.max(this._bboxMax.x,this._p2.x));this._bboxMax.y=Math.min(this._clamp.y,Math.max(this._bboxMax.y,this._p2.y));this._bboxMin.x=Math.floor(this._bboxMin.x);this._bboxMin.y=Math.floor(this._bboxMin.y);this._bboxMax.x=Math.floor(this._bboxMax.x);this._bboxMax.y=Math.floor(this._bboxMax.y);var a=this._bboxMax.x-this._bboxMin.x;var o=this._bboxMax.y-this._bboxMin.y;if(a<=0||o<=0){return}var h=(this._p1.x-this._p0.x)*(this._p2.y-this._p0.y)-(this._p1.y-this._p0.y)*(this._p2.x-this._p0.x);if(h<0){return}var u=-(this._p2.y-this._p1.y)/h;var l=-(this._p0.y-this._p2.y)/h;var p=-(this._p1.y-this._p0.y)/h;var c=(this._p2.x-this._p1.x)/h;var _=(this._p0.x-this._p2.x)/h;var f=(this._p1.x-this._p0.x)/h;var d=((this._p2.x-this._p1.x)*(this._bboxMin.y-this._p1.y)-(this._p2.y-this._p1.y)*(this._bboxMin.x-this._p1.x))/h;var g=((this._p0.x-this._p2.x)*(this._bboxMin.y-this._p2.y)-(this._p0.y-this._p2.y)*(this._bboxMin.x-this._p2.x))/h;var m=((this._p1.x-this._p0.x)*(this._bboxMin.y-this._p0.y)-(this._p1.y-this._p0.y)*(this._bboxMin.x-this._p0.x))/h;var y=0;var v=0;for(var x=this._bboxMin.x;x<=this._bboxMax.x;x++){for(var b=this._bboxMin.y;b<=this._bboxMax.y;b++){this._barycentric.x=d+u*y+c*v;this._barycentric.y=g+l*y+_*v;this._barycentric.z=m+p*y+f*v;v+=1;if(this._barycentric.x<0||this._barycentric.y<0||this._barycentric.z<0)continue;if(x!=this._bboxMax.x){this._barycentricRight.x=this._barycentric.x+u;this._barycentricRight.y=this._barycentric.y+l;this._barycentricRight.z=this._barycentric.z+p;this._barycentricRight.x/=this._project.x;this._barycentricRight.y/=this._project.y;this._barycentricRight.z/=this._project.z;this._barycentricRight.scaleBy(1/(this._barycentricRight.x+this._barycentricRight.y+this._barycentricRight.z))}if(b!=this._bboxMax.y){this._barycentricBottom.x=this._barycentric.x+c;this._barycentricBottom.y=this._barycentric.y+_;this._barycentricBottom.z=this._barycentric.z+f;this._barycentricBottom.x/=this._project.x;this._barycentricBottom.y/=this._project.y;this._barycentricBottom.z/=this._project.z;this._barycentricBottom.scaleBy(1/(this._barycentricBottom.x+this._barycentricBottom.y+this._barycentricBottom.z))}var w=x%this._activeBufferColor.width+b*this._activeBufferColor.width;var D=(this._barycentric.x*this._p0.z+this._barycentric.y*this._p1.z+this._barycentric.z*this._p2.z)/(this._barycentric.x+this._barycentric.y+this._barycentric.z);this._barycentric.x/=this._project.x;this._barycentric.y/=this._project.y;this._barycentric.z/=this._project.z;this._barycentric.scaleBy(1/(this._barycentric.x+this._barycentric.y+this._barycentric.z));if(!this._depthCompareModeSoftware[this._depthCompareMode](D,this._activeBufferZ[w]))continue;if(this._writeDepth)this._activeBufferZ[w]=D;var C=this._program.fragment(this,this._barycentric,this._barycentricRight,this._barycentricBottom,r,n,s,D);if(C.discard)continue;this._source[0]=C.outputColor[0]*255;this._source[1]=C.outputColor[1]*255;this._source[2]=C.outputColor[2]*255;this._source[3]=C.outputColor[3]*255;this._activeBufferColor.getPixelData(x,b,this._dest);this._putPixel(x,b)}v=0;y+=1}};e.prototype._putPixel=function(t,e){this._blendModeSoftware[this._blendDestination](this._destComp,this._dest,this._dest,this._source);this._blendModeSoftware[this._blendSource](this._sourceComp,this._source,this._dest,this._source);this._rgba[0]=this._sourceComp[0]+this._destComp[0];this._rgba[1]=this._sourceComp[1]+this._destComp[1];this._rgba[2]=this._sourceComp[2]+this._destComp[2];this._rgba[3]=this._sourceComp[3]+this._destComp[3];this._activeBufferColor.setPixelData(t,e,this._rgba)};e.prototype.createCubeTexture=function(t,e,i,r){return new sr(t)};e.prototype.createIndexBuffer=function(t){return new ir(t)};e.prototype.createProgram=function(){return new hr};e.prototype.createTexture=function(t,e,i,r,n){return new nr(t,e)};e.prototype.createVertexBuffer=function(t,e){return new rr(t,e)};e.prototype.dispose=function(){};e.prototype.setBlendFactors=function(t,e){this._blendSource=t;this._blendDestination=e};e.prototype.setColorMask=function(t,e,i,r){this._colorMaskR=t;this._colorMaskG=e;this._colorMaskB=i;this._colorMaskA=r};e.prototype.setStencilActions=function(e,i,r,n,s,a){if(e===void 0){e=t.ContextGLTriangleFace.FRONT_AND_BACK}if(i===void 0){i=t.ContextGLCompareMode.ALWAYS}if(r===void 0){r=t.ContextGLStencilAction.KEEP}if(n===void 0){n=t.ContextGLStencilAction.KEEP}if(s===void 0){s=t.ContextGLStencilAction.KEEP}if(a===void 0){a=t.CoordinateSystem.LEFT_HANDED}};e.prototype.setStencilReferenceValue=function(t,e,i){};e.prototype.setCulling=function(t,e){this._cullingMode=t};e.prototype.setDepthTest=function(t,e){this._writeDepth=t;this._depthCompareMode=e};e.prototype.setProgram=function(t){this._program=t};e.prototype.setProgramConstantsFromArray=function(e,i){var r;if(e==t.ContextGLProgramType.VERTEX)r=this._vertexConstants=new Float32Array(i.length);else if(e==t.ContextGLProgramType.FRAGMENT)r=this._fragmentConstants=new Float32Array(i.length);r.set(i)};e.prototype.setTextureAt=function(t,e){this._textures[t]=e};e.prototype.setVertexBufferAt=function(t,e,i,r){this._vertexBuffers[t]=e;this._vertexBufferOffsets[t]=i;this._vertexBufferFormats[t]=r};e.prototype.present=function(){this._backBufferColor.unlock();this._frontBuffer.fillRect(this._frontBuffer.rect,0);this._frontBuffer.draw(this._backBufferColor,this._frontBufferMatrix)};e.prototype.drawToBitmapImage2D=function(t){t.setPixels(this._activeBufferColor.rect,this._activeBufferColor.getImageData().data)};e.prototype._interpolateVertexPair=function(t,e,i,r){for(var n=0;n<e.length;n++){var s=e[n]-i[n];r[n]=i[n]+s*t}};e.prototype.clamp=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=1}return Math.max(e,Math.min(t,i))};e.prototype.interpolate=function(t,e,i){return t+(e-t)*this.clamp(i)};e.prototype.drawVertices=function(t,e,i){};e.prototype.setScissorRectangle=function(t){};e.prototype.setSamplerStateAt=function(t,e,i,r){var n=this._samplerStates[t];if(!n)n=this._samplerStates[t]=new or;n.wrap=e;n.filter=i;n.mipfilter=r};e.prototype.enableStencil=function(){};e.prototype.disableStencil=function(){};Object.defineProperty(e.prototype,"frontBuffer",{get:function(){return this._frontBuffer},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"container",{get:function(){return this._canvas},enumerable:true,configurable:true});e.prototype.clear=function(e,i,r,n,s,a,o){if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}if(n===void 0){n=1}if(s===void 0){s=1}if(a===void 0){a=0}if(o===void 0){o=t.ContextGLClearMask.ALL}this._backBufferColor.lock();if(o&t.ContextGLClearMask.COLOR)this._backBufferColor.fillRect(this._backBufferRect,D.ARGBtoFloat32(n*255,e*255,i*255,r*255));if(o&t.ContextGLClearMask.DEPTH)this._backBufferZ.set(this._backBufferZClear)};return e}();pr.MAX_SAMPLERS=8;var cr=function(){function t(t){this.textureType="";this._gl=t}t.prototype.dispose=function(){this._gl.deleteTexture(this._glTexture)};Object.defineProperty(t.prototype,"glTexture",{get:function(){return this._glTexture},enumerable:true,configurable:true});t.prototype.generateMipmaps=function(){throw new r};return t}();var _r=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._textureSelectorDictionary=new Array(6);r.textureType="textureCube";r._size=i;r._glTexture=r._gl.createTexture();r._textureSelectorDictionary[0]=e.TEXTURE_CUBE_MAP_POSITIVE_X;r._textureSelectorDictionary[1]=e.TEXTURE_CUBE_MAP_NEGATIVE_X;r._textureSelectorDictionary[2]=e.TEXTURE_CUBE_MAP_POSITIVE_Y;r._textureSelectorDictionary[3]=e.TEXTURE_CUBE_MAP_NEGATIVE_Y;r._textureSelectorDictionary[4]=e.TEXTURE_CUBE_MAP_POSITIVE_Z;r._textureSelectorDictionary[5]=e.TEXTURE_CUBE_MAP_NEGATIVE_Z;return r}i.prototype.uploadFromImage=function(t,e,i){if(i===void 0){i=0}this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._glTexture);this._gl.texImage2D(this._textureSelectorDictionary[e],i,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t.getImageData(e));this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null)};i.prototype.uploadCompressedTextureFromByteArray=function(t,e,i){if(i===void 0){i=false}};Object.defineProperty(i.prototype,"size",{get:function(){return this._size},enumerable:true,configurable:true});i.prototype.generateMipmaps=function(){this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._glTexture);this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP)};return i}(cr);var fr=function(){function t(t,e){this._gl=t;this._buffer=this._gl.createBuffer();this._numIndices=e}t.prototype.uploadFromArray=function(t,e,i){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._buffer);if(e)this._gl.bufferSubData(this._gl.ELEMENT_ARRAY_BUFFER,e*2,new Uint16Array(t));else this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),this._gl.STATIC_DRAW)};t.prototype.uploadFromByteArray=function(t,e,i){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._buffer);if(e)this._gl.bufferSubData(this._gl.ELEMENT_ARRAY_BUFFER,e*2,t);else this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,t,this._gl.STATIC_DRAW)};t.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)};Object.defineProperty(t.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:true,configurable:true});return t}();var dr=function(){function t(t){this._uniforms=[[],[],[]];this._attribs=[];this._gl=t;this._program=this._gl.createProgram()}t.prototype.upload=function(e,i){var r=t._aglslParser.parse(t._tokenizer.decribeAGALByteArray(e));var n=t._aglslParser.parse(t._tokenizer.decribeAGALByteArray(i));this._vertexShader=this._gl.createShader(this._gl.VERTEX_SHADER);this._fragmentShader=this._gl.createShader(this._gl.FRAGMENT_SHADER);this._gl.shaderSource(this._vertexShader,r);this._gl.compileShader(this._vertexShader);if(!this._gl.getShaderParameter(this._vertexShader,this._gl.COMPILE_STATUS))throw new Error(this._gl.getShaderInfoLog(this._vertexShader));this._gl.shaderSource(this._fragmentShader,n);this._gl.compileShader(this._fragmentShader);if(!this._gl.getShaderParameter(this._fragmentShader,this._gl.COMPILE_STATUS))throw new Error(this._gl.getShaderInfoLog(this._fragmentShader));this._gl.attachShader(this._program,this._vertexShader);this._gl.attachShader(this._program,this._fragmentShader);this._gl.linkProgram(this._program);if(!this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS))throw new Error(this._gl.getProgramInfoLog(this._program));this._uniforms[0].length=0;this._uniforms[1].length=0;this._uniforms[2].length=0;this._attribs.length=0};t.prototype.getUniformLocation=function(e,i){if(i===void 0){i=-1}if(this._uniforms[e][i+1]!=null)return this._uniforms[e][i+1];var r=i==-1?t._uniformLocationNameDictionary[e]:t._uniformLocationNameDictionary[e]+i;return this._uniforms[e][i+1]=this._gl.getUniformLocation(this._program,r)};t.prototype.getAttribLocation=function(t){if(this._attribs[t]!=null)return this._attribs[t];return this._attribs[t]=this._gl.getAttribLocation(this._program,"va"+t)};t.prototype.dispose=function(){this._gl.deleteProgram(this._program)};t.prototype.focusProgram=function(){this._gl.useProgram(this._program)};Object.defineProperty(t.prototype,"glProgram",{get:function(){return this._program},enumerable:true,configurable:true});return t}();dr._tokenizer=new ci;dr._aglslParser=new _i;dr._uniformLocationNameDictionary=["fc","fs","vc"];var gr=function(t){e(i,t);function i(e,i,r){var n=t.call(this,e)||this;n.textureType="texture2d";n._width=i;n._height=r;n._glTexture=n._gl.createTexture();return n}Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"frameBuffer",{get:function(){if(!this._frameBuffer){this._frameBuffer=this._gl.createFramebuffer();this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._frameBuffer);

this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture);this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._width,this._height,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null);var t=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,t);this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_STENCIL,this._width,this._height);this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._glTexture,0);this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_STENCIL_ATTACHMENT,this._gl.RENDERBUFFER,t);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,null);this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}return this._frameBuffer},enumerable:true,configurable:true});i.prototype.uploadFromImage=function(t,e){if(e===void 0){e=0}this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture);this._gl.texImage2D(this._gl.TEXTURE_2D,e,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t.getImageData());this._gl.bindTexture(this._gl.TEXTURE_2D,null)};i.prototype.uploadFromURL=function(t,e){if(e===void 0){e=0}this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture);this._gl.texImage2D(this._gl.TEXTURE_2D,e,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,we.getDefaultImage2D().getImageData());this._gl.bindTexture(this._gl.TEXTURE_2D,null)};i.prototype.uploadCompressedTextureFromByteArray=function(t,e,i){if(i===void 0){i=false}var r=this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")};i.prototype.generateMipmaps=function(){this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture);this._gl.generateMipmap(this._gl.TEXTURE_2D)};return i}(cr);var mr=function(){function t(t,e,i){this._gl=t;this._buffer=this._gl.createBuffer();this._numVertices=e;this._dataPerVertex=i}t.prototype.uploadFromArray=function(t,e,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._buffer);if(e)this._gl.bufferSubData(this._gl.ARRAY_BUFFER,e*this._dataPerVertex,new Float32Array(t));else this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(t),this._gl.STATIC_DRAW)};t.prototype.uploadFromByteArray=function(t,e,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._buffer);if(e)this._gl.bufferSubData(this._gl.ARRAY_BUFFER,e*this._dataPerVertex,t);else this._gl.bufferData(this._gl.ARRAY_BUFFER,t,this._gl.STATIC_DRAW)};Object.defineProperty(t.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dataPerVertex",{get:function(){return this._dataPerVertex},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:true,configurable:true});t.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)};return t}();var yr=function(){function e(i){this._blendFactorDictionary=new Object;this._drawModeDictionary=new Object;this._compareModeDictionary=new Object;this._stencilActionDictionary=new Object;this._textureIndexDictionary=new Array(8);this._textureTypeDictionary=new Object;this._wrapDictionary=new Object;this._filterDictionary=new Object;this._mipmapFilterDictionary=new Object;this._vertexBufferPropertiesDictionary=[];this._samplerStates=new Array(8);this._stencilReferenceValue=0;this._stencilReadMask=255;this._separateStencil=false;this._container=i;var r={premultipliedAlpha:false,alpha:false,stencil:true};try{this._gl=i.getContext("experimental-webgl",r);if(!this._gl)this._gl=i.getContext("webgl",r)}catch(n){}if(this._gl){if(this._gl.getExtension("OES_standard_derivatives")){this._standardDerivatives=true}else{this._standardDerivatives=false}this._blendFactorDictionary[t.ContextGLBlendFactor.ONE]=this._gl.ONE;this._blendFactorDictionary[t.ContextGLBlendFactor.DESTINATION_ALPHA]=this._gl.DST_ALPHA;this._blendFactorDictionary[t.ContextGLBlendFactor.DESTINATION_COLOR]=this._gl.DST_COLOR;this._blendFactorDictionary[t.ContextGLBlendFactor.ONE]=this._gl.ONE;this._blendFactorDictionary[t.ContextGLBlendFactor.ONE_MINUS_DESTINATION_ALPHA]=this._gl.ONE_MINUS_DST_ALPHA;this._blendFactorDictionary[t.ContextGLBlendFactor.ONE_MINUS_DESTINATION_COLOR]=this._gl.ONE_MINUS_DST_COLOR;this._blendFactorDictionary[t.ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA]=this._gl.ONE_MINUS_SRC_ALPHA;this._blendFactorDictionary[t.ContextGLBlendFactor.ONE_MINUS_SOURCE_COLOR]=this._gl.ONE_MINUS_SRC_COLOR;this._blendFactorDictionary[t.ContextGLBlendFactor.SOURCE_ALPHA]=this._gl.SRC_ALPHA;this._blendFactorDictionary[t.ContextGLBlendFactor.SOURCE_COLOR]=this._gl.SRC_COLOR;this._blendFactorDictionary[t.ContextGLBlendFactor.ZERO]=this._gl.ZERO;this._drawModeDictionary[t.ContextGLDrawMode.LINES]=this._gl.LINES;this._drawModeDictionary[t.ContextGLDrawMode.TRIANGLES]=this._gl.TRIANGLES;this._compareModeDictionary[t.ContextGLCompareMode.ALWAYS]=this._gl.ALWAYS;this._compareModeDictionary[t.ContextGLCompareMode.EQUAL]=this._gl.EQUAL;this._compareModeDictionary[t.ContextGLCompareMode.GREATER]=this._gl.GREATER;this._compareModeDictionary[t.ContextGLCompareMode.GREATER_EQUAL]=this._gl.GEQUAL;this._compareModeDictionary[t.ContextGLCompareMode.LESS]=this._gl.LESS;this._compareModeDictionary[t.ContextGLCompareMode.LESS_EQUAL]=this._gl.LEQUAL;this._compareModeDictionary[t.ContextGLCompareMode.NEVER]=this._gl.NEVER;this._compareModeDictionary[t.ContextGLCompareMode.NOT_EQUAL]=this._gl.NOTEQUAL;this._stencilActionDictionary[t.ContextGLStencilAction.DECREMENT_SATURATE]=this._gl.DECR;this._stencilActionDictionary[t.ContextGLStencilAction.DECREMENT_WRAP]=this._gl.DECR_WRAP;this._stencilActionDictionary[t.ContextGLStencilAction.INCREMENT_SATURATE]=this._gl.INCR;this._stencilActionDictionary[t.ContextGLStencilAction.INCREMENT_WRAP]=this._gl.INCR_WRAP;this._stencilActionDictionary[t.ContextGLStencilAction.INVERT]=this._gl.INVERT;this._stencilActionDictionary[t.ContextGLStencilAction.KEEP]=this._gl.KEEP;this._stencilActionDictionary[t.ContextGLStencilAction.SET]=this._gl.REPLACE;this._stencilActionDictionary[t.ContextGLStencilAction.ZERO]=this._gl.ZERO;this._textureIndexDictionary[0]=this._gl.TEXTURE0;this._textureIndexDictionary[1]=this._gl.TEXTURE1;this._textureIndexDictionary[2]=this._gl.TEXTURE2;this._textureIndexDictionary[3]=this._gl.TEXTURE3;this._textureIndexDictionary[4]=this._gl.TEXTURE4;this._textureIndexDictionary[5]=this._gl.TEXTURE5;this._textureIndexDictionary[6]=this._gl.TEXTURE6;this._textureIndexDictionary[7]=this._gl.TEXTURE7;this._textureTypeDictionary["texture2d"]=this._gl.TEXTURE_2D;this._textureTypeDictionary["textureCube"]=this._gl.TEXTURE_CUBE_MAP;this._wrapDictionary[t.ContextGLWrapMode.REPEAT]=this._gl.REPEAT;this._wrapDictionary[t.ContextGLWrapMode.CLAMP]=this._gl.CLAMP_TO_EDGE;this._filterDictionary[t.ContextGLTextureFilter.LINEAR]=this._gl.LINEAR;this._filterDictionary[t.ContextGLTextureFilter.NEAREST]=this._gl.NEAREST;this._mipmapFilterDictionary[t.ContextGLTextureFilter.LINEAR]=new Object;this._mipmapFilterDictionary[t.ContextGLTextureFilter.LINEAR][t.ContextGLMipFilter.MIPNEAREST]=this._gl.LINEAR_MIPMAP_NEAREST;this._mipmapFilterDictionary[t.ContextGLTextureFilter.LINEAR][t.ContextGLMipFilter.MIPLINEAR]=this._gl.LINEAR_MIPMAP_LINEAR;this._mipmapFilterDictionary[t.ContextGLTextureFilter.LINEAR][t.ContextGLMipFilter.MIPNONE]=this._gl.LINEAR;this._mipmapFilterDictionary[t.ContextGLTextureFilter.NEAREST]=new Object;this._mipmapFilterDictionary[t.ContextGLTextureFilter.NEAREST][t.ContextGLMipFilter.MIPNEAREST]=this._gl.NEAREST_MIPMAP_NEAREST;this._mipmapFilterDictionary[t.ContextGLTextureFilter.NEAREST][t.ContextGLMipFilter.MIPLINEAR]=this._gl.NEAREST_MIPMAP_LINEAR;this._mipmapFilterDictionary[t.ContextGLTextureFilter.NEAREST][t.ContextGLMipFilter.MIPNONE]=this._gl.NEAREST;this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.FLOAT_1]=new vr(1,this._gl.FLOAT,false);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.FLOAT_2]=new vr(2,this._gl.FLOAT,false);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.FLOAT_3]=new vr(3,this._gl.FLOAT,false);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.FLOAT_4]=new vr(4,this._gl.FLOAT,false);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.BYTE_1]=new vr(1,this._gl.BYTE,true);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.BYTE_2]=new vr(2,this._gl.BYTE,true);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.BYTE_3]=new vr(3,this._gl.BYTE,true);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.BYTE_4]=new vr(4,this._gl.BYTE,true);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.UNSIGNED_BYTE_1]=new vr(1,this._gl.UNSIGNED_BYTE,true);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.UNSIGNED_BYTE_2]=new vr(2,this._gl.UNSIGNED_BYTE,true);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.UNSIGNED_BYTE_3]=new vr(3,this._gl.UNSIGNED_BYTE,true);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.UNSIGNED_BYTE_4]=new vr(4,this._gl.UNSIGNED_BYTE,true);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.SHORT_1]=new vr(1,this._gl.SHORT,false);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.SHORT_2]=new vr(2,this._gl.SHORT,false);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.SHORT_3]=new vr(3,this._gl.SHORT,false);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.SHORT_4]=new vr(4,this._gl.SHORT,false);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.UNSIGNED_SHORT_1]=new vr(1,this._gl.UNSIGNED_SHORT,false);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.UNSIGNED_SHORT_2]=new vr(2,this._gl.UNSIGNED_SHORT,false);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.UNSIGNED_SHORT_3]=new vr(3,this._gl.UNSIGNED_SHORT,false);this._vertexBufferPropertiesDictionary[t.ContextGLVertexBufferFormat.UNSIGNED_SHORT_4]=new vr(4,this._gl.UNSIGNED_SHORT,false);this._stencilCompareMode=this._gl.ALWAYS;this._stencilCompareModeBack=this._gl.ALWAYS;this._stencilCompareModeFront=this._gl.ALWAYS}else{alert("WebGL is not available.")}for(var s=0;s<e.MAX_SAMPLERS;++s){this._samplerStates[s]=new bi;this._samplerStates[s].wrap=this._gl.REPEAT;this._samplerStates[s].filter=this._gl.LINEAR;this._samplerStates[s].mipfilter=this._gl.LINEAR}}Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"standardDerivatives",{get:function(){return this._standardDerivatives},enumerable:true,configurable:true});e.prototype.gl=function(){return this._gl};e.prototype.clear=function(e,i,r,n,s,a,o){if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}if(n===void 0){n=1}if(s===void 0){s=1}if(a===void 0){a=0}if(o===void 0){o=t.ContextGLClearMask.ALL}if(!this._drawing){this.updateBlendStatus();this._drawing=true}var h=0;if(o&t.ContextGLClearMask.COLOR)h|=this._gl.COLOR_BUFFER_BIT;if(o&t.ContextGLClearMask.STENCIL)h|=this._gl.STENCIL_BUFFER_BIT;if(o&t.ContextGLClearMask.DEPTH)h|=this._gl.DEPTH_BUFFER_BIT;this._gl.clearColor(e,i,r,n);this._gl.clearDepth(s);this._gl.clearStencil(a);this._gl.clear(h)};e.prototype.configureBackBuffer=function(t,e,i,r){if(r===void 0){r=true}this._width=t;this._height=e;if(r){this._gl.enable(this._gl.STENCIL_TEST);this._gl.enable(this._gl.DEPTH_TEST)}this._gl.viewport["width"]=t;this._gl.viewport["height"]=e;this._gl.viewport(0,0,t,e)};e.prototype.createCubeTexture=function(t,e,i,r){if(r===void 0){r=0}return new _r(this._gl,t)};e.prototype.createIndexBuffer=function(t){return new fr(this._gl,t)};e.prototype.createProgram=function(){return new dr(this._gl)};e.prototype.createTexture=function(t,e,i,r,n){if(n===void 0){n=0}return new gr(this._gl,t,e)};e.prototype.createVertexBuffer=function(t,e){return new mr(this._gl,t,e)};e.prototype.dispose=function(){for(var t=0;t<this._samplerStates.length;++t)this._samplerStates[t]=null};e.prototype.drawToBitmapImage2D=function(t){var e=new Uint8Array(t.width*t.height*4);this._gl.readPixels(0,0,t.width,t.height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e);t.setPixels(new Y(0,0,t.width,t.height),new Uint8ClampedArray(e.buffer))};e.prototype.drawIndices=function(t,e,i,r){if(i===void 0){i=0}if(r===void 0){r=-1}if(!this._drawing)throw"Need to clear before drawing if the buffer has not been cleared since the last present() call.";this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,e.glBuffer);this._gl.drawElements(this._drawModeDictionary[t],r==-1?e.numIndices:r,this._gl.UNSIGNED_SHORT,i*2)};e.prototype.drawVertices=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=-1}if(!this._drawing)throw"Need to clear before drawing if the buffer has not been cleared since the last present() call.";this._gl.drawArrays(this._drawModeDictionary[t],e,i)};e.prototype.present=function(){this._drawing=false};e.prototype.setBlendFactors=function(t,e){this._blendEnabled=true;this._blendSourceFactor=this._blendFactorDictionary[t];this._blendDestinationFactor=this._blendFactorDictionary[e];this.updateBlendStatus()};e.prototype.setColorMask=function(t,e,i,r){this._gl.colorMask(t,e,i,r)};e.prototype.setCulling=function(e,i){if(i===void 0){i=t.CoordinateSystem.LEFT_HANDED}if(e==t.ContextGLTriangleFace.NONE){this._gl.disable(this._gl.CULL_FACE)}else{this._gl.enable(this._gl.CULL_FACE);this._gl.cullFace(this.translateTriangleFace(e,i))}};e.prototype.setDepthTest=function(t,e){this._gl.depthFunc(this._compareModeDictionary[e]);this._gl.depthMask(t)};e.prototype.enableStencil=function(){this._gl.enable(this._gl.STENCIL_TEST)};e.prototype.disableStencil=function(){this._gl.disable(this._gl.STENCIL_TEST)};e.prototype.setStencilActions=function(e,i,r,n,s,a){if(e===void 0){e=t.ContextGLTriangleFace.FRONT_AND_BACK}if(i===void 0){i=t.ContextGLCompareMode.ALWAYS}if(r===void 0){r=t.ContextGLStencilAction.KEEP}if(n===void 0){n=t.ContextGLStencilAction.KEEP}if(s===void 0){s=t.ContextGLStencilAction.KEEP}if(a===void 0){a=t.CoordinateSystem.LEFT_HANDED}this._separateStencil=e!=t.ContextGLTriangleFace.FRONT_AND_BACK;var o=this._compareModeDictionary[i];var h=this._stencilActionDictionary[s];var u=this._stencilActionDictionary[n];var l=this._stencilActionDictionary[r];if(!this._separateStencil){this._stencilCompareMode=o;this._gl.stencilFunc(o,this._stencilReferenceValue,this._stencilReadMask);this._gl.stencilOp(h,u,l)}else if(e==t.ContextGLTriangleFace.BACK){this._stencilCompareModeBack=o;this._gl.stencilFuncSeparate(this._gl.BACK,o,this._stencilReferenceValue,this._stencilReadMask);this._gl.stencilOpSeparate(this._gl.BACK,h,u,l)}else if(e==t.ContextGLTriangleFace.FRONT){this._stencilCompareModeFront=o;this._gl.stencilFuncSeparate(this._gl.FRONT,o,this._stencilReferenceValue,this._stencilReadMask);this._gl.stencilOpSeparate(this._gl.FRONT,h,u,l)}};e.prototype.setStencilReferenceValue=function(t,e,i){if(e===void 0){e=255}if(i===void 0){i=255}this._stencilReferenceValue=t;this._stencilReadMask=e;if(this._separateStencil){this._gl.stencilFuncSeparate(this._gl.FRONT,this._stencilCompareModeFront,t,e);this._gl.stencilFuncSeparate(this._gl.BACK,this._stencilCompareModeBack,t,e)}else{this._gl.stencilFunc(this._stencilCompareMode,t,e)}this._gl.stencilMask(i)};e.prototype.setProgram=function(t){this._currentProgram=t;t.focusProgram()};e.prototype.setProgramConstantsFromArray=function(t,e){if(e.length)this._gl.uniform4fv(this._currentProgram.getUniformLocation(t),e)};e.prototype.setScissorRectangle=function(t){if(!t){this._gl.disable(this._gl.SCISSOR_TEST);return}this._gl.enable(this._gl.SCISSOR_TEST);this._gl.scissor(t.x,t.y,t.width,t.height)};e.prototype.setTextureAt=function(e,i){var r=this._samplerStates[e];if(this._activeTexture!=e&&(i||r.type)){this._activeTexture=e;this._gl.activeTexture(this._textureIndexDictionary[e])}if(!i){if(r.type){this._gl.bindTexture(r.type,null);r.type=null}return}var n=this._textureTypeDictionary[i.textureType];r.type=n;this._gl.bindTexture(n,i.glTexture);this._gl.uniform1i(this._currentProgram.getUniformLocation(t.ContextGLProgramType.SAMPLER,e),e);this._gl.texParameteri(n,this._gl.TEXTURE_WRAP_S,r.wrap);this._gl.texParameteri(n,this._gl.TEXTURE_WRAP_T,r.wrap);this._gl.texParameteri(n,this._gl.TEXTURE_MAG_FILTER,r.filter);this._gl.texParameteri(n,this._gl.TEXTURE_MIN_FILTER,r.mipfilter)};e.prototype.setSamplerStateAt=function(t,i,r,n){if(0<=t&&t<e.MAX_SAMPLERS){this._samplerStates[t].wrap=this._wrapDictionary[i];this._samplerStates[t].filter=this._filterDictionary[r];this._samplerStates[t].mipfilter=this._mipmapFilterDictionary[r][n]}else{throw"Sampler is out of bounds."}};e.prototype.setVertexBufferAt=function(t,e,i,r){if(i===void 0){i=0}if(r===void 0){r=4}var n=this._currentProgram?this._currentProgram.getAttribLocation(t):-1;if(!e){if(n>-1)this._gl.disableVertexAttribArray(n);return}if(this._currentArrayBuffer!=e){this._currentArrayBuffer=e;this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e?e.glBuffer:null)}var s=this._vertexBufferPropertiesDictionary[r];this._gl.enableVertexAttribArray(n);this._gl.vertexAttribPointer(n,s.size,s.type,s.normalized,e.dataPerVertex,i)};e.prototype.setRenderToTexture=function(t,e,i,r){if(e===void 0){e=false}if(i===void 0){i=0}if(r===void 0){r=0}var n=t;var s=n.frameBuffer;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,s);if(e){this._gl.enable(this._gl.STENCIL_TEST);this._gl.enable(this._gl.DEPTH_TEST)}this._gl.viewport(0,0,n.width,n.height)};e.prototype.setRenderToBackBuffer=function(){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)};e.prototype.updateBlendStatus=function(){if(this._blendEnabled){this._gl.enable(this._gl.BLEND);this._gl.blendEquation(this._gl.FUNC_ADD);this._gl.blendFunc(this._blendSourceFactor,this._blendDestinationFactor)}else{this._gl.disable(this._gl.BLEND)}};e.prototype.translateTriangleFace=function(e,i){switch(e){case t.ContextGLTriangleFace.BACK:return i==t.CoordinateSystem.LEFT_HANDED?this._gl.FRONT:this._gl.BACK;case t.ContextGLTriangleFace.FRONT:return i==t.CoordinateSystem.LEFT_HANDED?this._gl.BACK:this._gl.FRONT;case t.ContextGLTriangleFace.FRONT_AND_BACK:return this._gl.FRONT_AND_BACK;default:throw"Unknown ContextGLTriangleFace type."}};return e}();yr.MAX_SAMPLERS=8;yr.modulo=0;var vr=function(){function t(t,e,i){this.size=t;this.type=e;this.normalized=i}return t}();var xr=function(i){e(r,i);function r(e,r,n,s,a){if(s===void 0){s=false}if(a===void 0){a=t.ContextGLProfile.BASELINE}var o=i.call(this)||this;o._abstractionPool=new Object;o._programData=new Array;o._x=0;o._y=0;o._stageIndex=-1;o._antiAlias=0;o._renderTarget=null;o._renderSurfaceSelector=0;o._initialised=false;o._bufferFormatDictionary=new Array(5);o.globalDisableMipmap=false;o.globalDisableSmooth=false;o._programDataPool=new er(o);o._container=e;if(o._container){o._container.addEventListener("webglcontextlost",function(t){return o.onContextLost(t)});o._container.addEventListener("webglcontextrestored",function(t){return o.onContextRestored(t)})}o._stageIndex=r;o._stageManager=n;o._viewPort=new Y;o._enableDepthAndStencil=true;It.setElementX(o._container,0);It.setElementY(o._container,0);o._bufferFormatDictionary[1]=new Array(5);o._bufferFormatDictionary[1][1]=t.ContextGLVertexBufferFormat.BYTE_1;o._bufferFormatDictionary[1][2]=t.ContextGLVertexBufferFormat.BYTE_2;o._bufferFormatDictionary[1][3]=t.ContextGLVertexBufferFormat.BYTE_3;o._bufferFormatDictionary[1][4]=t.ContextGLVertexBufferFormat.BYTE_4;o._bufferFormatDictionary[2]=new Array(5);o._bufferFormatDictionary[2][1]=t.ContextGLVertexBufferFormat.SHORT_1;o._bufferFormatDictionary[2][2]=t.ContextGLVertexBufferFormat.SHORT_2;o._bufferFormatDictionary[2][3]=t.ContextGLVertexBufferFormat.SHORT_3;o._bufferFormatDictionary[2][4]=t.ContextGLVertexBufferFormat.SHORT_4;o._bufferFormatDictionary[4]=new Array(5);o._bufferFormatDictionary[4][1]=t.ContextGLVertexBufferFormat.FLOAT_1;o._bufferFormatDictionary[4][2]=t.ContextGLVertexBufferFormat.FLOAT_2;o._bufferFormatDictionary[4][3]=t.ContextGLVertexBufferFormat.FLOAT_3;o._bufferFormatDictionary[4][4]=t.ContextGLVertexBufferFormat.FLOAT_4;o._bufferFormatDictionary[5]=new Array(5);o._bufferFormatDictionary[5][1]=t.ContextGLVertexBufferFormat.UNSIGNED_BYTE_1;o._bufferFormatDictionary[5][2]=t.ContextGLVertexBufferFormat.UNSIGNED_BYTE_2;o._bufferFormatDictionary[5][3]=t.ContextGLVertexBufferFormat.UNSIGNED_BYTE_3;o._bufferFormatDictionary[5][4]=t.ContextGLVertexBufferFormat.UNSIGNED_BYTE_4;o._bufferFormatDictionary[6]=new Array(5);o._bufferFormatDictionary[6][1]=t.ContextGLVertexBufferFormat.UNSIGNED_SHORT_1;o._bufferFormatDictionary[6][2]=t.ContextGLVertexBufferFormat.UNSIGNED_SHORT_2;o._bufferFormatDictionary[6][3]=t.ContextGLVertexBufferFormat.UNSIGNED_SHORT_3;o._bufferFormatDictionary[6][4]=t.ContextGLVertexBufferFormat.UNSIGNED_SHORT_4;o.visible=true;return o}r.prototype.getProgramData=function(t,e){return this._programDataPool.getItem(t,e)};r.prototype.setRenderTarget=function(t,e,i){if(e===void 0){e=false}if(i===void 0){i=0}if(this._renderTarget===t&&i==this._renderSurfaceSelector&&this._enableDepthAndStencil==e)return;this._renderTarget=t;this._renderSurfaceSelector=i;this._enableDepthAndStencil=e;if(t){this._context.setRenderToTexture(this.getAbstraction(t).texture,e,this._antiAlias,i)}else{this._context.setRenderToBackBuffer();this.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil)}};r.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new r._abstractionClassPool[t.assetType](t,this))};r.prototype.clearAbstraction=function(t){this._abstractionPool[t.id]=null};r.registerAbstraction=function(t,e){r._abstractionClassPool[e.assetType]=t};r.prototype.requestContext=function(e,i,r){var n=this;if(e===void 0){e=false}if(i===void 0){i=t.ContextGLProfile.BASELINE}if(r===void 0){r=t.ContextMode.AUTO}if(this._usesSoftwareRendering!=null)this._usesSoftwareRendering=e;this._profile=i;try{if(r==t.ContextMode.FLASH)new Ri(this._container,function(t){return n._callback(t)});else if(r==t.ContextMode.SOFTWARE)this._context=new pr(this._container);else if(r==t.ContextMode.GLES)this._context=new ji(this._container);else this._context=new yr(this._container)}catch(s){try{if(r==t.ContextMode.AUTO)new Ri(this._container,function(t){return n._callback(t)});else this.dispatchEvent(new Ci(Ci.STAGE_ERROR,this))}catch(s){this.dispatchEvent(new Ci(Ci.STAGE_ERROR,this))}}if(this._context)this._callback(this._context)};Object.defineProperty(r.prototype,"width",{get:function(){return this._width},set:function(t){if(this._width==t)return;It.setElementWidth(this._container,t);this._width=this._viewPort.width=t;this._backBufferDirty=true;this.notifyViewportUpdated()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"height",{get:function(){return this._height},set:function(t){if(this._height==t)return;It.setElementHeight(this._container,t);this._height=this._viewPort.height=t;this._backBufferDirty=true;this.notifyViewportUpdated()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(t){if(this._x==t)return;It.setElementX(this._container,t);this._x=this._viewPort.x=t;this.notifyViewportUpdated()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(t){if(this._y==t)return;It.setElementY(this._container,t);this._y=this._viewPort.y=t;this.notifyViewportUpdated()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"visible",{get:function(){return It.getElementVisibility(this._container)},set:function(t){It.setElementVisibility(this._container,t)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"container",{get:function(){return this._container},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"context",{get:function(){return this._context},enumerable:true,configurable:true});r.prototype.notifyViewportUpdated=function(){if(this._viewportDirty)return;this._viewportDirty=true;this.dispatchEvent(new Ci(Ci.VIEWPORT_UPDATED,this))};Object.defineProperty(r.prototype,"profile",{get:function(){return this._profile},enumerable:true,configurable:true});r.prototype.dispose=function(){for(var t in this._abstractionPool)this._abstractionPool[t].clear();this._abstractionPool=null;this._stageManager.iRemoveStage(this);this.freeContext();this._stageManager=null;this._stageIndex=-1};r.prototype.configureBackBuffer=function(t,e,i,r){this.width=t;this.height=e;this._antiAlias=i;this._enableDepthAndStencil=r;if(this._context)this._context.configureBackBuffer(t,e,i,r)};Object.defineProperty(r.prototype,"enableDepthAndStencil",{get:function(){return this._enableDepthAndStencil},set:function(t){this._enableDepthAndStencil=t;this._backBufferDirty=true},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"renderSurfaceSelector",{get:function(){return this._renderSurfaceSelector},enumerable:true,configurable:true});r.prototype.clear=function(){if(!this._context)return;if(this._backBufferDirty){this.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil);this._backBufferDirty=false}this._context.clear((this._color&4278190080)>>>24,(this._color&16711680)>>>16,(this._color&65280)>>>8,this._color&255);this._bufferClear=true};Object.defineProperty(r.prototype,"scissorRect",{get:function(){return this._scissorRect},set:function(t){this._scissorRect=t;this._context.setScissorRectangle(this._scissorRect)},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"stageIndex",{get:function(){return this._stageIndex},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"usesSoftwareRendering",{get:function(){return this._usesSoftwareRendering},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(t){this._antiAlias=t;this._backBufferDirty=true},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"viewPort",{get:function(){this._viewportDirty=false;return this._viewPort},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"bufferClear",{get:function(){return this._bufferClear},set:function(t){this._bufferClear=t},enumerable:true,configurable:true});r.prototype.registerProgram=function(t){var e=0;while(this._programData[e]!=null)e++;this._programData[e]=t;t.id=e};r.prototype.unRegisterProgram=function(t){this._programData[t.id]=null;t.id=-1};r.prototype.freeContext=function(){if(this._context){this._context.dispose();this.dispatchEvent(new Ci(Ci.CONTEXT_DISPOSED,this))}this._context=null;this._initialised=false};r.prototype.onContextLost=function(t){};r.prototype.onContextRestored=function(t){};r.prototype.recoverFromDisposal=function(){if(!this._context)return false;return true};r.prototype._callback=function(t){this._context=t;this._container=this._context.container;if(this._width&&this._height)this._context.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil);this.dispatchEvent(new Ci(this._initialised?Ci.CONTEXT_RECREATED:Ci.CONTEXT_CREATED,this));this._initialised=true};r.prototype.setVertexBuffer=function(t,e,i,r,n,s){if(s===void 0){s=false}this._context.setVertexBufferAt(t,e,n,this._bufferFormatDictionary[s?i+4:i][r])};r.prototype.setSamplerState=function(e,i,r,n){var s=i?t.ContextGLWrapMode.REPEAT:t.ContextGLWrapMode.CLAMP;var a=r&&!this.globalDisableSmooth?t.ContextGLTextureFilter.LINEAR:t.ContextGLTextureFilter.NEAREST;var o=n&&!this.globalDisableMipmap?t.ContextGLMipFilter.MIPLINEAR:t.ContextGLMipFilter.MIPNONE;this._context.setSamplerStateAt(e,s,a,o)};return r}(a);xr._abstractionClassPool=new Object;var br=function(i){e(r,i);function r(){var t=i.call(this)||this;t._stages=new Array(r.STAGE_MAX_QUANTITY);t._onContextCreatedDelegate=function(e){return t.onContextCreated(e)};return t}r.getInstance=function(){if(this._instance==null)this._instance=new r;return this._instance};r.prototype.getStageAt=function(e,i,n,s){if(i===void 0){i=false}if(n===void 0){n=t.ContextGLProfile.BASELINE}if(s===void 0){s=t.ContextMode.AUTO}if(e<0||e>=r.STAGE_MAX_QUANTITY)throw new E("Index is out of bounds [0.."+r.STAGE_MAX_QUANTITY+"]");if(!this._stages[e]){r._numStages++;if(document){var a=document.createElement("canvas");a.id="stage"+e;document.body.appendChild(a)}var o=this._stages[e]=new xr(a,e,this,i,n);o.addEventListener(Ci.CONTEXT_CREATED,this._onContextCreatedDelegate);o.requestContext(i,n,s)}return o};r.prototype.iRemoveStage=function(t){r._numStages--;t.removeEventListener(Ci.CONTEXT_CREATED,this._onContextCreatedDelegate);this._stages[t.stageIndex]=null};r.prototype.getFreeStage=function(e,i,r){if(e===void 0){e=false}if(i===void 0){i=t.ContextGLProfile.BASELINE}if(r===void 0){r=t.ContextMode.AUTO}var n=0;var s=this._stages.length;while(n<s){if(!this._stages[n])return this.getStageAt(n,e,i,r);++n}return null};Object.defineProperty(r.prototype,"hasFreeStage",{get:function(){return r._numStages<r.STAGE_MAX_QUANTITY?true:false},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"numSlotsFree",{get:function(){return r.STAGE_MAX_QUANTITY-r._numStages},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"numSlotsUsed",{get:function(){return r._numStages},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"numSlotsTotal",{get:function(){return this._stages.length},enumerable:true,configurable:true});r.prototype.onContextCreated=function(t){};return r}(a);br.STAGE_MAX_QUANTITY=8;br._numStages=0;var wr=function(){function t(t,e,i){if(i===void 0){i=true}this._regName=t;this._regCount=e;this._persistent=i;this.initRegisters(t,e)}t.prototype.requestFreeVectorReg=function(){for(var t=0;t<this._regCount;++t){if(!this.isRegisterUsed(t)){if(this._persistent)this._usedVectorCount[t]++;return this._vectorRegisters[t]}}throw new Error("Register overflow!")};t.prototype.requestFreeRegComponent=function(){for(var t=0;t<this._regCount;++t){if(this._usedVectorCount[t]>0)continue;for(var e=0;e<4;++e){if(this._usedSingleCount[e][t]==0){if(this._persistent)this._usedSingleCount[e][t]++;return this._registerComponents[e][t]}}}throw new Error("Register overflow!")};t.prototype.addUsage=function(t,e){if(t._component>-1)this._usedSingleCount[t._component][t.index]+=e;else this._usedVectorCount[t.index]+=e};t.prototype.removeUsage=function(t){if(t._component>-1){if(--this._usedSingleCount[t._component][t.index]<0)throw new Error("More usages removed than exist!")}else{if(--this._usedVectorCount[t.index]<0)throw new Error("More usages removed than exist!")}};t.prototype.dispose=function(){this._vectorRegisters=null;this._registerComponents=null;this._usedSingleCount=null;this._usedVectorCount=null};t.prototype.hasRegisteredRegs=function(){for(var t=0;t<this._regCount;++t)if(this.isRegisterUsed(t))return true;return false};t.prototype.initRegisters=function(e,i){var r=t._initPool(e,i);this._vectorRegisters=t._regPool[r];this._registerComponents=t._regCompsPool[r];this._usedVectorCount=this._initArray(Array(i),0);this._usedSingleCount=new Array(4);this._usedSingleCount[0]=this._initArray(new Array(i),0);this._usedSingleCount[1]=this._initArray(new Array(i),0);this._usedSingleCount[2]=this._initArray(new Array(i),0);this._usedSingleCount[3]=this._initArray(new Array(i),0)};t._initPool=function(e,i){var r=e+i;if(t._regPool[r]!=undefined)return r;var n=new Array(i);t._regPool[r]=n;var s=[[],[],[],[]];t._regCompsPool[r]=s;for(var a=0;a<i;++a){n[a]=new fi(e,a);for(var o=0;o<4;++o)s[o][a]=new fi(e,a,o)}return r};t.prototype.isRegisterUsed=function(t){
if(this._usedVectorCount[t]>0)return true;for(var e=0;e<4;++e)if(this._usedSingleCount[e][t]>0)return true;return false};t.prototype._initArray=function(t,e){var i=t.length;for(var r=0;r<i;r++)t[r]=e;return t};return t}();wr._regPool=new Object;wr._regCompsPool=new Object;var Dr=function(){function t(t){this._numUsedVertexConstants=0;this._numUsedFragmentConstants=0;this._numUsedStreams=0;this._numUsedTextures=0;this._numUsedVaryings=0;this._profile=t;this.reset()}t.prototype.reset=function(){this._fragmentTempCache=new wr("ft",8,false);this._vertexTempCache=new wr("vt",8,false);this._varyingCache=new wr("v",8);this._textureCache=new wr("fs",8);this._vertexAttributesCache=new wr("va",8);this._fragmentConstantsCache=new wr("fc",28);this._vertexConstantsCache=new wr("vc",128);this._fragmentOutputRegister=new fi("oc",-1);this._vertexOutputRegister=new fi("op",-1);this._numUsedVertexConstants=0;this._numUsedStreams=0;this._numUsedTextures=0;this._numUsedVaryings=0;this._numUsedFragmentConstants=0};t.prototype.dispose=function(){this._fragmentTempCache.dispose();this._vertexTempCache.dispose();this._varyingCache.dispose();this._fragmentConstantsCache.dispose();this._vertexAttributesCache.dispose();this._fragmentTempCache=null;this._vertexTempCache=null;this._varyingCache=null;this._fragmentConstantsCache=null;this._vertexAttributesCache=null;this._fragmentOutputRegister=null;this._vertexOutputRegister=null};t.prototype.addFragmentTempUsages=function(t,e){this._fragmentTempCache.addUsage(t,e)};t.prototype.removeFragmentTempUsage=function(t){this._fragmentTempCache.removeUsage(t)};t.prototype.addVertexTempUsages=function(t,e){this._vertexTempCache.addUsage(t,e)};t.prototype.removeVertexTempUsage=function(t){this._vertexTempCache.removeUsage(t)};t.prototype.getFreeFragmentVectorTemp=function(){return this._fragmentTempCache.requestFreeVectorReg()};t.prototype.getFreeFragmentSingleTemp=function(){return this._fragmentTempCache.requestFreeRegComponent()};t.prototype.getFreeVarying=function(){++this._numUsedVaryings;return this._varyingCache.requestFreeVectorReg()};t.prototype.getFreeFragmentConstant=function(){++this._numUsedFragmentConstants;return this._fragmentConstantsCache.requestFreeVectorReg()};t.prototype.getFreeVertexConstant=function(){++this._numUsedVertexConstants;return this._vertexConstantsCache.requestFreeVectorReg()};t.prototype.getFreeVertexVectorTemp=function(){return this._vertexTempCache.requestFreeVectorReg()};t.prototype.getFreeVertexSingleTemp=function(){return this._vertexTempCache.requestFreeRegComponent()};t.prototype.getFreeVertexAttribute=function(){++this._numUsedStreams;return this._vertexAttributesCache.requestFreeVectorReg()};t.prototype.getFreeTextureReg=function(){++this._numUsedTextures;return this._textureCache.requestFreeVectorReg()};Object.defineProperty(t.prototype,"fragmentOutputRegister",{get:function(){return this._fragmentOutputRegister},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numUsedVertexConstants",{get:function(){return this._numUsedVertexConstants},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numUsedFragmentConstants",{get:function(){return this._numUsedFragmentConstants},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numUsedStreams",{get:function(){return this._numUsedStreams},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numUsedTextures",{get:function(){return this._numUsedTextures},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numUsedVaryings",{get:function(){return this._numUsedVaryings},enumerable:true,configurable:true});return t}();var Cr=function(){function t(){this.textures=new Array;this.animatableAttributes=new Array;this.animationTargetRegisters=new Array}return t}();var Ar=function(){function t(t,e,i){this._pVertexCode="";this._pFragmentCode="";this._pPostAnimationFragmentCode="";this._pElementsClass=t;this._pRenderPass=e;this._pShader=i;this._pSharedRegisters=new Cr;this._pRegisterCache=new Dr(i.profile)}t.prototype.compile=function(){this._pShader.reset();this._pShader._iIncludeDependencies();this.pInitRegisterIndices();this.pCompileDependencies();this._pVertexCode+=this._pRenderPass._iGetVertexCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);this._pPostAnimationFragmentCode+=this._pRenderPass._iGetFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);this._pPostAnimationFragmentCode+="mov "+this._pRegisterCache.fragmentOutputRegister+", "+this._pSharedRegisters.shadedTarget+"\n";this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.shadedTarget)};t.prototype.compileColorTransformCode=function(){var t=this._pRegisterCache.getFreeFragmentConstant();var e=this._pRegisterCache.getFreeFragmentConstant();this._pShader.colorTransformIndex=t.index*4;this._pPostAnimationFragmentCode+="mul "+this._pSharedRegisters.shadedTarget+", "+this._pSharedRegisters.shadedTarget+", "+t+"\n";this._pPostAnimationFragmentCode+="add "+this._pSharedRegisters.shadedTarget+", "+this._pSharedRegisters.shadedTarget+", "+e+"\n"};t.prototype.pCompileDependencies=function(){this._pSharedRegisters.shadedTarget=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget,1);if(this._pShader.globalPosDependencies>0)this.compileGlobalPositionCode();if(this._pShader.usesPositionFragment)this.compilePositionCode();if(this._pShader.usesCurves)this.compileCurvesCode();if(this._pShader.usesColorTransform)this.compileColorTransformCode();if(this._pShader.uvDependencies>0)this.compileUVCode();if(this._pShader.secondaryUVDependencies>0)this.compileSecondaryUVCode();if(this._pShader.normalDependencies>0)this.compileNormalCode();if(this._pShader.viewDirDependencies>0)this.compileViewDirCode();this._pVertexCode+=this._pElementsClass._iGetVertexCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._pElementsClass._iGetFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);this._pVertexCode+=this._pRenderPass._iGetPreLightingVertexCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._pRenderPass._iGetPreLightingFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters)};t.prototype.compileGlobalPositionCode=function(){this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.globalPositionVertex=this._pRegisterCache.getFreeVertexVectorTemp(),this._pShader.globalPosDependencies);var t=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pShader.sceneMatrixIndex=t.index*4;this._pVertexCode+="m44 "+this._pSharedRegisters.globalPositionVertex+", "+this._pSharedRegisters.animatedPosition+", "+t+"\n";if(this._pShader.usesGlobalPosFragment){this._pSharedRegisters.globalPositionVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.globalPositionVarying+", "+this._pSharedRegisters.globalPositionVertex+"\n"}};t.prototype.compilePositionCode=function(){this._pSharedRegisters.positionVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.positionVarying+", "+this._pSharedRegisters.animatedPosition+"\n"};t.prototype.compileCurvesCode=function(){this._pSharedRegisters.curvesInput=this._pRegisterCache.getFreeVertexAttribute();this._pShader.curvesIndex=this._pSharedRegisters.curvesInput.index;this._pSharedRegisters.curvesVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.curvesVarying+", "+this._pSharedRegisters.curvesInput+"\n";var t=this._pRegisterCache.getFreeFragmentSingleTemp();this._pFragmentCode+="mul "+t+", "+this._pSharedRegisters.curvesVarying+".y, "+this._pSharedRegisters.curvesVarying+".y\n"+"sub "+t+", "+t+", "+this._pSharedRegisters.curvesVarying+".z\n"+"mul "+t+", "+t+", "+this._pSharedRegisters.curvesVarying+".x\n"+"kil "+t+"\n"};t.prototype.compileUVCode=function(){var t=this._pRegisterCache.getFreeVertexAttribute();this._pShader.uvIndex=t.index;var e=this._pSharedRegisters.uvVarying=this._pRegisterCache.getFreeVarying();if(this._pShader.usesUVTransform){var i=this._pRegisterCache.getFreeVertexConstant();var r=this._pRegisterCache.getFreeVertexConstant();this._pShader.uvMatrixIndex=i.index*4;this._pVertexCode+="dp4 "+e+".x, "+t+", "+i+"\n"+"dp4 "+e+".y, "+t+", "+r+"\n"+"mov "+e+".zw, "+t+".zw \n"}else{this._pShader.uvMatrixIndex=-1;this._pSharedRegisters.uvTarget=e;this._pSharedRegisters.uvSource=t}};t.prototype.compileSecondaryUVCode=function(){var t=this._pRegisterCache.getFreeVertexAttribute();this._pShader.secondaryUVIndex=t.index;this._pSharedRegisters.secondaryUVVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.secondaryUVVarying+", "+t+"\n"};t.prototype.compileViewDirCode=function(){var t=this._pRegisterCache.getFreeVertexConstant();this._pSharedRegisters.viewDirVarying=this._pRegisterCache.getFreeVarying();this._pSharedRegisters.viewDirFragment=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment,this._pShader.viewDirDependencies);this._pShader.cameraPositionIndex=t.index*4;if(this._pShader.usesTangentSpace){var e=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+e+", "+t+", "+this._pSharedRegisters.animatedPosition+"\n"+"m33 "+this._pSharedRegisters.viewDirVarying+".xyz, "+e+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+this._pSharedRegisters.viewDirVarying+".w, "+this._pSharedRegisters.animatedPosition+".w\n"}else{this._pVertexCode+="sub "+this._pSharedRegisters.viewDirVarying+", "+t+", "+this._pSharedRegisters.globalPositionVertex+"\n";this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex)}this._pFragmentCode+="nrm "+this._pSharedRegisters.viewDirFragment+".xyz, "+this._pSharedRegisters.viewDirVarying+"\n"+"mov "+this._pSharedRegisters.viewDirFragment+".w,   "+this._pSharedRegisters.viewDirVarying+".w\n"};t.prototype.compileNormalCode=function(){this._pSharedRegisters.normalFragment=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment,this._pShader.normalDependencies);if(this._pShader.outputsNormals&&!this._pShader.outputsTangentNormals){this._pVertexCode+=this._pRenderPass._iGetNormalVertexCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._pRenderPass._iGetNormalFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);return}var t;if(!this._pShader.outputsNormals||!this._pShader.usesTangentSpace){t=new Array(3);t[0]=this._pRegisterCache.getFreeVertexConstant();t[1]=this._pRegisterCache.getFreeVertexConstant();t[2]=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pShader.sceneNormalMatrixIndex=t[0].index*4;this._pSharedRegisters.normalVarying=this._pRegisterCache.getFreeVarying()}if(this._pShader.outputsNormals){if(this._pShader.usesTangentSpace){this._pVertexCode+="nrm "+this._pSharedRegisters.animatedNormal+".xyz, "+this._pSharedRegisters.animatedNormal+"\n"+"nrm "+this._pSharedRegisters.animatedTangent+".xyz, "+this._pSharedRegisters.animatedTangent+"\n"+"crs "+this._pSharedRegisters.bitangent+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\n";this._pFragmentCode+=this._pRenderPass._iGetNormalFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters)}else{this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying();this._pSharedRegisters.bitangentVarying=this._pRegisterCache.getFreeVarying();var e=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="m33 "+e+".xyz, "+this._pSharedRegisters.animatedNormal+", "+t[0]+"\n"+"nrm "+this._pSharedRegisters.animatedNormal+".xyz, "+e+"\n"+"m33 "+e+".xyz, "+this._pSharedRegisters.animatedTangent+", "+t[0]+"\n"+"nrm "+this._pSharedRegisters.animatedTangent+".xyz, "+e+"\n"+"mov "+this._pSharedRegisters.tangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".x  \n"+"mov "+this._pSharedRegisters.tangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".x  \n"+"mov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \n"+"mov "+this._pSharedRegisters.bitangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".y  \n"+"mov "+this._pSharedRegisters.bitangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".y  \n"+"mov "+this._pSharedRegisters.bitangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \n"+"mov "+this._pSharedRegisters.normalVarying+".x, "+this._pSharedRegisters.animatedTangent+".z  \n"+"mov "+this._pSharedRegisters.normalVarying+".z, "+this._pSharedRegisters.animatedNormal+".z  \n"+"mov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.normalInput+".w  \n"+"crs "+e+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+this._pSharedRegisters.tangentVarying+".y, "+e+".x    \n"+"mov "+this._pSharedRegisters.bitangentVarying+".y, "+e+".y  \n"+"mov "+this._pSharedRegisters.normalVarying+".y, "+e+".z    \n";this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedTangent);var i;var r;var n;i=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(i,1);r=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(r,1);n=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(n,1);this._pFragmentCode+="nrm "+i+".xyz, "+this._pSharedRegisters.tangentVarying+"\n"+"mov "+i+".w, "+this._pSharedRegisters.tangentVarying+".w	\n"+"nrm "+r+".xyz, "+this._pSharedRegisters.bitangentVarying+"\n"+"nrm "+n+".xyz, "+this._pSharedRegisters.normalVarying+"\n";this._pFragmentCode+=this._pRenderPass._iGetNormalFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters)+"m33 "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalFragment+", "+i+"\n"+"mov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n";this._pRegisterCache.removeFragmentTempUsage(r);this._pRegisterCache.removeFragmentTempUsage(i);this._pRegisterCache.removeFragmentTempUsage(n)}}else{this._pVertexCode+="m33 "+this._pSharedRegisters.normalVarying+".xyz, "+this._pSharedRegisters.animatedNormal+", "+t[0]+"\n"+"mov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.animatedNormal+".w\n";this._pFragmentCode+="nrm "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalVarying+"\n"+"mov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n";if(this._pShader.tangentDependencies>0){this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+this._pSharedRegisters.tangentVarying+".xyz, "+this._pSharedRegisters.animatedTangent+", "+t[0]+"\n"+"mov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.animatedTangent+".w\n"}}if(!this._pShader.usesTangentSpace)this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedNormal)};t.prototype.pInitRegisterIndices=function(){this._pShader.pInitRegisterIndices();this._pSharedRegisters.animatedPosition=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedPosition,1);this._pSharedRegisters.animatableAttributes.push(this._pRegisterCache.getFreeVertexAttribute());this._pSharedRegisters.animationTargetRegisters.push(this._pSharedRegisters.animatedPosition);this._pVertexCode="";this._pFragmentCode="";this._pPostAnimationFragmentCode="";if(this._pShader.usesCommonData||this._pShader.normalDependencies>0){this._pSharedRegisters.commons=this._pRegisterCache.getFreeFragmentConstant();this._pShader.commonsDataIndex=this._pSharedRegisters.commons.index*4}if(this._pShader.tangentDependencies>0||this._pShader.outputsNormals){this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute();this._pShader.tangentIndex=this._pSharedRegisters.tangentInput.index;this._pSharedRegisters.animatedTangent=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent,1);if(this._pShader.usesTangentSpace){this._pSharedRegisters.bitangent=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.bitangent,1)}this._pSharedRegisters.animatableAttributes.push(this._pSharedRegisters.tangentInput);this._pSharedRegisters.animationTargetRegisters.push(this._pSharedRegisters.animatedTangent)}if(this._pShader.normalDependencies>0){this._pSharedRegisters.normalInput=this._pRegisterCache.getFreeVertexAttribute();this._pShader.normalIndex=this._pSharedRegisters.normalInput.index;this._pSharedRegisters.animatedNormal=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal,1);this._pSharedRegisters.animatableAttributes.push(this._pSharedRegisters.normalInput);this._pSharedRegisters.animationTargetRegisters.push(this._pSharedRegisters.animatedNormal)}if(this._pShader.colorDependencies>0){this._pSharedRegisters.colorInput=this._pRegisterCache.getFreeVertexAttribute();this._pShader.colorBufferIndex=this._pSharedRegisters.colorInput.index;this._pSharedRegisters.colorVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.colorVarying+", "+this._pSharedRegisters.colorInput+"\n"}};t.prototype.dispose=function(){this._pRegisterCache.dispose();this._pRegisterCache=null;this._pSharedRegisters=null};Object.defineProperty(t.prototype,"vertexCode",{get:function(){return this._pVertexCode},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"fragmentCode",{get:function(){return this._pFragmentCode},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"postAnimationFragmentCode",{get:function(){return this._pPostAnimationFragmentCode},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"shadedTarget",{get:function(){return this._pSharedRegisters.shadedTarget},enumerable:true,configurable:true});return t}();var Tr=function(){function e(e,i,r){this._abstractionPool=new Object;this._blendFactorSource=t.ContextGLBlendFactor.ONE;this._blendFactorDest=t.ContextGLBlendFactor.ZERO;this._invalidProgram=true;this._animationVertexCode="";this._animationFragmentCode="";this.usesBlending=false;this.useImageRect=false;this.usesCurves=false;this.depthCompareMode=t.ContextGLCompareMode.LESS_EQUAL;this.writeDepth=true;this._defaultCulling=t.ContextGLTriangleFace.BACK;this._pInverseSceneMatrix=new Float32Array(16);this.ambientR=255;this.ambientG=255;this.ambientB=255;this.usesGlobalPosFragment=false;this.usesPositionFragment=false;this.imageIndices=new Array;this._elementsClass=e;this._pass=i;this._stage=r;this.profile=this._stage.profile}Object.defineProperty(e.prototype,"programData",{get:function(){if(this._invalidProgram)this._updateProgram();return this._programData},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"usesAnimation",{get:function(){return this._usesAnimation},set:function(t){if(this._usesAnimation==t)return;this._usesAnimation=t;this.invalidateProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedVertexConstants",{get:function(){if(this._invalidProgram)this._updateProgram();return this._numUsedVertexConstants},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedFragmentConstants",{get:function(){if(this._invalidProgram)this._updateProgram();return this._numUsedFragmentConstants},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedStreams",{get:function(){if(this._invalidProgram)this._updateProgram();return this._numUsedStreams},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedTextures",{get:function(){if(this._invalidProgram)this._updateProgram();return this._numUsedTextures},enumerable:true,configurable:true});e.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new e._abstractionClassPool[t.assetType](t,this))};e.prototype.clearAbstraction=function(t){this._abstractionPool[t.id]=null};e.registerAbstraction=function(t,i){e._abstractionClassPool[i.assetType]=t};e.prototype.getImageIndex=function(t,e){if(e===void 0){e=0}return this._pass.getImageIndex(t,e)};e.prototype._iIncludeDependencies=function(){this._pass._iIncludeDependencies(this)};e.prototype.createCompiler=function(t,e){return new Ar(t,e,this)};e.prototype.reset=function(){this.projectionDependencies=0;this.normalDependencies=0;this.colorDependencies=0;this.viewDirDependencies=0;this.uvDependencies=0;this.secondaryUVDependencies=0;this.globalPosDependencies=0;this.tangentDependencies=0;this.usesCommonData=false;this.usesGlobalPosFragment=false;this.usesPositionFragment=false;this.usesFragmentAnimation=false;this.usesTangentSpace=false;this.outputsNormals=false;this.outputsTangentNormals=false};e.prototype.pInitRegisterIndices=function(){this.commonsDataIndex=-1;this.cameraPositionIndex=-1;this.curvesIndex=-1;this.uvIndex=-1;this.uvMatrixIndex=-1;this.colorTransformIndex=-1;this.secondaryUVIndex=-1;this.normalIndex=-1;this.colorBufferIndex=-1;this.tangentIndex=-1;this.sceneMatrixIndex=-1;this.sceneNormalMatrixIndex=-1;this.jointIndexIndex=-1;this.jointWeightIndex=-1;this.imageIndices.length=0};e.prototype.initConstantData=function(t){this._numUsedVertexConstants=t.numUsedVertexConstants;this._numUsedFragmentConstants=t.numUsedFragmentConstants;this._numUsedStreams=t.numUsedStreams;this._numUsedTextures=t.numUsedTextures;this.vertexConstantData=new Float32Array(t.numUsedVertexConstants*4);this.fragmentConstantData=new Float32Array(t.numUsedFragmentConstants*4);if(this.viewMatrixIndex>=0){this.viewMatrix=new M(new Float32Array(this.vertexConstantData.buffer,this.viewMatrixIndex*4,16))}else if(this.viewMatrix){this.viewMatrix=null}if(this.sceneMatrixIndex>=0){this.sceneMatrix=new M(new Float32Array(this.vertexConstantData.buffer,this.sceneMatrixIndex*4,16))}else if(this.sceneMatrix){this.sceneMatrix=null}if(this.commonsDataIndex>=0){this.fragmentConstantData[this.commonsDataIndex]=.5;this.fragmentConstantData[this.commonsDataIndex+1]=0;this.fragmentConstantData[this.commonsDataIndex+2]=1/255;this.fragmentConstantData[this.commonsDataIndex+3]=1}if(this.uvMatrixIndex>=0){this.vertexConstantData[this.uvMatrixIndex]=1;this.vertexConstantData[this.uvMatrixIndex+1]=0;this.vertexConstantData[this.uvMatrixIndex+2]=0;this.vertexConstantData[this.uvMatrixIndex+3]=0;this.vertexConstantData[this.uvMatrixIndex+4]=0;this.vertexConstantData[this.uvMatrixIndex+5]=1;this.vertexConstantData[this.uvMatrixIndex+6]=0;this.vertexConstantData[this.uvMatrixIndex+7]=0}if(this.colorTransformIndex>=0){this.fragmentConstantData[this.colorTransformIndex]=1;this.fragmentConstantData[this.colorTransformIndex+1]=1;this.fragmentConstantData[this.colorTransformIndex+2]=1;this.fragmentConstantData[this.colorTransformIndex+3]=1;this.fragmentConstantData[this.colorTransformIndex+4]=0;this.fragmentConstantData[this.colorTransformIndex+5]=0;this.fragmentConstantData[this.colorTransformIndex+6]=0;this.fragmentConstantData[this.colorTransformIndex+7]=0}if(this.sceneNormalMatrixIndex>=0){this.sceneNormalMatrix=new M(new Float32Array(this.vertexConstantData.buffer,this.sceneNormalMatrixIndex*4,16))}else if(this.sceneNormalMatrix){this.sceneNormalMatrix=null}if(this.cameraPositionIndex>=0)this.vertexConstantData[this.cameraPositionIndex+3]=1;this._pass._iInitConstantData(this);if(this.usesAnimation)this._pass.animationSet.doneAGALCode(this)};e.prototype.setBlendMode=function(e){switch(e){case fe.NORMAL:this._blendFactorSource=t.ContextGLBlendFactor.ONE;this._blendFactorDest=t.ContextGLBlendFactor.ZERO;this.usesBlending=false;break;case fe.LAYER:this._blendFactorSource=t.ContextGLBlendFactor.SOURCE_ALPHA;this._blendFactorDest=t.ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA;this.usesBlending=true;break;case fe.MULTIPLY:this._blendFactorSource=t.ContextGLBlendFactor.ZERO;this._blendFactorDest=t.ContextGLBlendFactor.SOURCE_COLOR;this.usesBlending=true;break;case fe.ADD:this._blendFactorSource=t.ContextGLBlendFactor.SOURCE_ALPHA;this._blendFactorDest=t.ContextGLBlendFactor.ONE;this.usesBlending=true;break;case fe.ALPHA:this._blendFactorSource=t.ContextGLBlendFactor.ZERO;this._blendFactorDest=t.ContextGLBlendFactor.SOURCE_ALPHA;this.usesBlending=true;break;default:throw new E("Unsupported blend mode!")}};e.prototype._iActivate=function(e){this._stage.context.setCulling(this.useBothSides?t.ContextGLTriangleFace.NONE:this._defaultCulling,e.coordinateSystem);if(!this.usesTangentSpace&&this.cameraPositionIndex>=0){var i=e.transform.concatenatedMatrix3D.position;this.vertexConstantData[this.cameraPositionIndex]=i.x;this.vertexConstantData[this.cameraPositionIndex+1]=i.y;this.vertexConstantData[this.cameraPositionIndex+2]=i.z}this._stage.context.setDepthTest(this.writeDepth&&!this.usesBlending,this.depthCompareMode);if(this.usesBlending)this._stage.context.setBlendFactors(this._blendFactorSource,this._blendFactorDest);this.activeElements=null};e.prototype._iDeactivate=function(){this._stage.context.setDepthTest(true,t.ContextGLCompareMode.LESS_EQUAL);this.activeElements=null};e.prototype._setRenderState=function(t,e){if(t.sourceEntity.animator)t.sourceEntity.animator.setRenderState(this,t,this._stage,e);var i;if(this.usesUVTransform){var r=t.uvMatrix;if(r){i=r.rawData;this.vertexConstantData[this.uvMatrixIndex]=i[0];this.vertexConstantData[this.uvMatrixIndex+1]=i[2];this.vertexConstantData[this.uvMatrixIndex+3]=i[4];this.vertexConstantData[this.uvMatrixIndex+4]=i[1];this.vertexConstantData[this.uvMatrixIndex+5]=i[3];this.vertexConstantData[this.uvMatrixIndex+7]=i[5]}else{this.vertexConstantData[this.uvMatrixIndex]=1;this.vertexConstantData[this.uvMatrixIndex+1]=0;this.vertexConstantData[this.uvMatrixIndex+3]=0;this.vertexConstantData[this.uvMatrixIndex+4]=0;this.vertexConstantData[this.uvMatrixIndex+5]=1;this.vertexConstantData[this.uvMatrixIndex+7]=0}}if(this.usesColorTransform){var n=t.sourceEntity._iAssignedColorTransform();if(n){i=n._rawData;this.fragmentConstantData[this.colorTransformIndex]=i[0];this.fragmentConstantData[this.colorTransformIndex+1]=i[1];this.fragmentConstantData[this.colorTransformIndex+2]=i[2];this.fragmentConstantData[this.colorTransformIndex+3]=i[3];this.fragmentConstantData[this.colorTransformIndex+4]=i[4]/255;this.fragmentConstantData[this.colorTransformIndex+5]=i[5]/255;this.fragmentConstantData[this.colorTransformIndex+6]=i[6]/255;this.fragmentConstantData[this.colorTransformIndex+7]=i[7]/255}else{this.fragmentConstantData[this.colorTransformIndex]=1;this.fragmentConstantData[this.colorTransformIndex+1]=1;this.fragmentConstantData[this.colorTransformIndex+2]=1;this.fragmentConstantData[this.colorTransformIndex+3]=1;this.fragmentConstantData[this.colorTransformIndex+4]=0;this.fragmentConstantData[this.colorTransformIndex+5]=0;this.fragmentConstantData[this.colorTransformIndex+6]=0;this.fragmentConstantData[this.colorTransformIndex+7]=0}}if(this.sceneNormalMatrixIndex>=0){this.sceneNormalMatrix.copyFrom(t.sourceEntity.transform.inverseConcatenatedMatrix3D)}if(this.usesTangentSpace&&this.cameraPositionIndex>=0){t.sourceEntity.transform.inverseConcatenatedMatrix3D.copyRawDataTo(this._pInverseSceneMatrix);var s=e.transform.concatenatedMatrix3D.position;var a=s.x;var o=s.y;var h=s.z;this.vertexConstantData[this.cameraPositionIndex]=this._pInverseSceneMatrix[0]*a+this._pInverseSceneMatrix[4]*o+this._pInverseSceneMatrix[8]*h+this._pInverseSceneMatrix[12];this.vertexConstantData[this.cameraPositionIndex+1]=this._pInverseSceneMatrix[1]*a+this._pInverseSceneMatrix[5]*o+this._pInverseSceneMatrix[9]*h+this._pInverseSceneMatrix[13];this.vertexConstantData[this.cameraPositionIndex+2]=this._pInverseSceneMatrix[2]*a+this._pInverseSceneMatrix[6]*o+this._pInverseSceneMatrix[10]*h+this._pInverseSceneMatrix[14]}};e.prototype.invalidateProgram=function(){this._invalidProgram=true};e.prototype.dispose=function(){this._programData.dispose();this._programData=null};e.prototype._updateProgram=function(){this._invalidProgram=false;var t=this.createCompiler(this._elementsClass,this._pass);t.compile();this._calcAnimationCode(t._pRegisterCache,t.shadedTarget,t._pSharedRegisters);this.initConstantData(t._pRegisterCache);var e=this._stage.getProgramData(this._animationVertexCode+t.vertexCode,t.fragmentCode+this._animationFragmentCode+t.postAnimationFragmentCode);if(this._programData!=e){if(this._programData)this._programData.dispose();this._programData=e;e.usages++}};e.prototype._calcAnimationCode=function(t,e,i){this._animationVertexCode="";this._animationFragmentCode="";if(this.usesAnimation){var r=this._pass.animationSet;this._animationVertexCode+=r.getAGALVertexCode(this,t,i);if(this.uvDependencies>0&&!this.usesUVTransform)this._animationVertexCode+=r.getAGALUVCode(this,t,i);if(this.usesFragmentAnimation)this._animationFragmentCode+=r.getAGALFragmentCode(this,t,e)}else{var n=i.animatableAttributes.length;for(var s=0;s<n;++s)this._animationVertexCode+="mov "+i.animationTargetRegisters[s]+", "+i.animatableAttributes[s]+"\n";if(this.uvDependencies>0&&!this.usesUVTransform)this._animationVertexCode+="mov "+i.uvTarget+","+i.uvSource+"\n"}};e.prototype.setVertexConst=function(t,e,i,r,n){if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}if(n===void 0){n=0}t*=4;this.vertexConstantData[t++]=e;this.vertexConstantData[t++]=i;this.vertexConstantData[t++]=r;this.vertexConstantData[t]=n};e.prototype.setVertexConstFromArray=function(t,e){t*=4;for(var i=0;i<e.length;i++)this.vertexConstantData[t++]=e[i]};e.prototype.setVertexConstFromMatrix=function(t,e){t*=4;var i=e._rawData;this.vertexConstantData[t++]=i[0];this.vertexConstantData[t++]=i[4];this.vertexConstantData[t++]=i[8];this.vertexConstantData[t++]=i[12];this.vertexConstantData[t++]=i[1];this.vertexConstantData[t++]=i[5];this.vertexConstantData[t++]=i[9];this.vertexConstantData[t++]=i[13];this.vertexConstantData[t++]=i[2];this.vertexConstantData[t++]=i[6];this.vertexConstantData[t++]=i[10];this.vertexConstantData[t++]=i[14];this.vertexConstantData[t++]=i[3];this.vertexConstantData[t++]=i[7];this.vertexConstantData[t++]=i[11];this.vertexConstantData[t]=i[15]};e.prototype.setFragmentConst=function(t,e,i,r,n){if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}if(n===void 0){n=0}t*=4;this.fragmentConstantData[t++]=e;this.fragmentConstantData[t++]=i;this.fragmentConstantData[t++]=r;this.fragmentConstantData[t]=n};return e}();Tr._abstractionClassPool=new Object;var Pr=function(t){e(i,t);function i(e,i,r){var n=t.call(this)||this;n._preserveAlpha=true;n._forceSeparateMVP=false;n._render=e;n._material=i;n._elementsClass=r.elementsClass;n._stage=r.materialGroup.stage;return n}Object.defineProperty(i.prototype,"shader",{get:function(){return this._shader},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animationSet",{get:function(){return this._material.animationSet},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(t){if(this._preserveAlpha==t)return;this._preserveAlpha=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"forceSeparateMVP",{get:function(){return this._forceSeparateMVP},set:function(t){if(this._forceSeparateMVP==t)return;this._forceSeparateMVP=t;this.invalidate()},enumerable:true,configurable:true});i.prototype.getImageIndex=function(t,e){
if(e===void 0){e=0}return this._render.getImageIndex(t,e)};i.prototype.invalidate=function(){this._shader.invalidateProgram();this.dispatchEvent(new Ai(Ai.INVALIDATE,this))};i.prototype.dispose=function(){this._render=null;this._material=null;this._elementsClass=null;this._stage=null;if(this._shader){this._shader.dispose();this._shader=null}};i.prototype._setRenderState=function(t,e){this._shader._setRenderState(t,e)};i.prototype._iActivate=function(t){this._shader._iActivate(t)};i.prototype._iDeactivate=function(){this._shader._iDeactivate()};i.prototype._iIncludeDependencies=function(t){this._render._iIncludeDependencies(t);if(this._forceSeparateMVP)t.globalPosDependencies++};i.prototype._iInitConstantData=function(t){};i.prototype._iGetPreLightingVertexCode=function(t,e,i){return""};i.prototype._iGetPreLightingFragmentCode=function(t,e,i){return""};i.prototype._iGetVertexCode=function(t,e,i){return""};i.prototype._iGetFragmentCode=function(t,e,i){return""};i.prototype._iGetNormalVertexCode=function(t,e,i){return""};i.prototype._iGetNormalFragmentCode=function(t,e,i){return""};return i}(a);var Sr=function(t){e(i,t);function i(e,i,r){var n=t.call(this,e,i,r)||this;n._diffuseR=1;n._diffuseG=1;n._diffuseB=1;n._diffuseA=1;n._shader=new Tr(r.elementsClass,n,n._stage);n.invalidate();return n}i.prototype._iIncludeDependencies=function(e){t.prototype._iIncludeDependencies.call(this,e);if(this._textureVO!=null)e.uvDependencies++};i.prototype.invalidate=function(){t.prototype.invalidate.call(this);this._textureVO=this._material.getTextureAt(0)?this._shader.getAbstraction(this._material.getTextureAt(0)):null};i.prototype.dispose=function(){if(this._textureVO){this._textureVO.onClear(new s(s.CLEAR,this._material.getTextureAt(0)));this._textureVO=null}t.prototype.dispose.call(this)};i.prototype._iGetFragmentCode=function(t,e,i){var r="";var n;if(this.preserveAlpha){n=e.getFreeFragmentSingleTemp();e.addFragmentTempUsages(n,1);r+="mov "+n+", "+i.shadedTarget+".w\n"}var s=i.shadedTarget;if(this._textureVO!=null){r+=this._textureVO._iGetFragmentCode(s,e,i,i.uvVarying);if(t.alphaThreshold>0){var a=e.getFreeFragmentConstant();this._fragmentConstantsIndex=a.index*4;r+="sub "+s+".w, "+s+".w, "+a+".x\n"+"kil "+s+".w\n"+"add "+s+".w, "+s+".w, "+a+".x\n"}}else if(t.colorBufferIndex!=-1){r+="mov "+s+", "+i.colorVarying+"\n"}else{var o=e.getFreeFragmentConstant();this._fragmentConstantsIndex=o.index*4;r+="mov "+s+", "+o+"\n"}if(this.preserveAlpha){r+="mul "+i.shadedTarget+".w, "+i.shadedTarget+".w, "+n+"\n";e.removeFragmentTempUsage(n)}return r};i.prototype._setRenderState=function(e,i){t.prototype._setRenderState.call(this,e,i);if(this._textureVO!=null)this._textureVO._setRenderState(e)};i.prototype._iActivate=function(e){t.prototype._iActivate.call(this,e);if(this._textureVO!=null){this._textureVO.activate(this._render);if(this._shader.alphaThreshold>0)this._shader.fragmentConstantData[this._fragmentConstantsIndex]=this._shader.alphaThreshold}else if(this._shader.colorBufferIndex==-1){var i=this._fragmentConstantsIndex;var r=this._shader.fragmentConstantData;r[i]=this._diffuseR;r[i+1]=this._diffuseG;r[i+2]=this._diffuseB;r[i+3]=this._diffuseA}};return i}(Pr);var Er=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.usages=0;r._forceSeparateMVP=false;r._usesAnimation=true;r._invalidAnimation=true;r._invalidRender=true;r._invalidImages=true;r._passes=new Array;r._imageIndices=new Object;r._pRequiresBlending=false;r.images=new Array;r.samplers=new Array;r._onInvalidateAnimationDelegate=function(t){return r.onInvalidateAnimation(t)};r._onInvalidatePassesDelegate=function(t){return r.onInvalidatePasses(t)};r.materialID=e.id;r._material=e;r._elementsClass=i.elementsClass;r._stage=i.materialGroup.stage;r._material.addEventListener(de.INVALIDATE_ANIMATION,r._onInvalidateAnimationDelegate);r._material.addEventListener(de.INVALIDATE_PASSES,r._onInvalidatePassesDelegate);r._onPassInvalidateDelegate=function(t){return r.onPassInvalidate(t)};return r}Object.defineProperty(i.prototype,"requiresBlending",{get:function(){return this._pRequiresBlending},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"renderOrderId",{get:function(){if(this._invalidAnimation)this._updateAnimation();return this._renderOrderId},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"passes",{get:function(){if(this._invalidAnimation)this._updateAnimation();return this._passes},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"material",{get:function(){return this._material},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numImages",{get:function(){if(this._invalidImages)this._updateImages();return this._numImages},enumerable:true,configurable:true});i.prototype._iIncludeDependencies=function(t){this._elementsClass._iIncludeDependencies(t);t.alphaThreshold=this._material.alphaThreshold;t.useImageRect=this._material.imageRect;t.usesCurves=this._material.curves;if(this._material instanceof ge){var e=this._material;t.useAlphaPremultiplied=e.alphaPremultiplied;t.useBothSides=e.bothSides;t.usesUVTransform=e.animateUVs;t.usesColorTransform=e.useColorTransform}};i.prototype.getImageIndex=function(t,e){if(e===void 0){e=0}if(this._invalidImages)this._updateImages();return this._imageIndices[t.id][e]};i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this._material=null;this._elementsClass=null;this._stage=null;var i=this._passes.length;for(var r=0;r<i;r++){this._passes[r].removeEventListener(Ai.INVALIDATE,this._onPassInvalidateDelegate);this._passes[r].dispose()}this._passes=null};i.prototype.onInvalidate=function(e){t.prototype.onInvalidate.call(this,e);this._invalidRender=true;this._invalidAnimation=true};i.prototype.onInvalidatePasses=function(t){var e=this._passes.length;for(var i=0;i<e;i++)this._passes[i].invalidate();this._invalidAnimation=true;this._invalidImages=true};i.prototype.onInvalidateAnimation=function(t){this._invalidAnimation=true};i.prototype._updateAnimation=function(){if(this._invalidRender)this._pUpdateRender();this._invalidAnimation=false;var t=this._getEnabledGPUAnimation();var e=0;var i=1;var r;var n=this._passes.length;for(var s=0;s<n;s++){r=this._passes[s].shader;r.usesAnimation=t;e+=r.programData.id*i;i*=1e3}if(this._usesAnimation!=t){this._usesAnimation=t;var a=this._material.iOwners;var o=a.length;for(var h=0;h<o;h++)a[h].invalidateElements()}this._renderOrderId=e};i.prototype._updateImages=function(){this._invalidImages=false;var t=this._material.getNumTextures();var e;var i;var r;var n;var s;var a=0;for(var o=0;o<t;o++){e=this._material.getTextureAt(o);i=e.getNumImages();r=this._imageIndices[e.id]=new Array;for(var h=0;h<i;h++){n=e.getImageAt(h)||(this._material.style?this._material.style.getImageAt(e,h):null)||we.getDefaultImage2D();this.images[a]=this._stage.getAbstraction(n);s=e.getSamplerAt(h)||(this._material.style?this._material.style.getSamplerAt(e,h):null)||we.getDefaultSampler();this.samplers[a]=this._stage.getAbstraction(s);r[h]=a++}}this._numImages=a};i.prototype._pUpdateRender=function(){this._invalidRender=false};i.prototype._pRemovePass=function(t){t.removeEventListener(Ai.INVALIDATE,this._onPassInvalidateDelegate);this._passes.splice(this._passes.indexOf(t),1)};i.prototype._pClearPasses=function(){var t=this._passes.length;for(var e=0;e<t;++e)this._passes[e].removeEventListener(Ai.INVALIDATE,this._onPassInvalidateDelegate);this._passes.length=0};i.prototype._pAddPass=function(t){this._passes.push(t);t.addEventListener(Ai.INVALIDATE,this._onPassInvalidateDelegate)};i.prototype.onPassInvalidate=function(t){this._invalidAnimation=true};i.prototype._getEnabledGPUAnimation=function(){if(this._material.animationSet){this._material.animationSet.resetGPUCompatibility();var t=this._material.iOwners;var e=t.length;var i=this._passes.length;var r;for(var n=0;n<i;n++){r=this._passes[n].shader;r.usesAnimation=false;for(var s=0;s<e;s++)if(t[s].animator)t[s].animator.testGPUCompatibility(r)}return!this._material.animationSet.usesCPU}return false};return i}(K);var Mr=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._basicMaterial=e;r._pAddPass(r._pass=new Sr(r,e,i));return r}i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this._basicMaterial=null};i.prototype._pUpdateRender=function(){t.prototype._pUpdateRender.call(this);this._pRequiresBlending=this._basicMaterial.blendMode!=fe.NORMAL||this._basicMaterial.alphaBlending||this._basicMaterial.colorTransform&&this._basicMaterial.colorTransform.alphaMultiplier<1;this._pass.preserveAlpha=this._basicMaterial.preserveAlpha;this._pass.shader.setBlendMode(this._basicMaterial.blendMode==fe.NORMAL&&this._pRequiresBlending?fe.LAYER:this._basicMaterial.blendMode)};return i}(Er);var Or=function(t){e(i,t);function i(){return t.apply(this,arguments)||this}Object.defineProperty(i.prototype,"shader",{get:function(){return this._shader},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animationSet",{get:function(){return this._material.animationSet},enumerable:true,configurable:true});i.prototype.invalidate=function(){this._shader.invalidateProgram();this.dispatchEvent(new Ai(Ai.INVALIDATE,this))};i.prototype.dispose=function(){if(this._shader){this._shader.dispose();this._shader=null}};i.prototype._setRenderState=function(t,e){this._shader._setRenderState(t,e)};i.prototype._iActivate=function(t){this._shader._iActivate(t)};i.prototype._iDeactivate=function(){this._shader._iDeactivate()};i.prototype._iInitConstantData=function(t){};i.prototype._iGetPreLightingVertexCode=function(t,e,i){return""};i.prototype._iGetPreLightingFragmentCode=function(t,e,i){return""};i.prototype._iGetVertexCode=function(t,e,i){return""};i.prototype._iGetFragmentCode=function(t,e,i){return""};i.prototype._iGetNormalVertexCode=function(t,e,i){return""};i.prototype._iGetNormalFragmentCode=function(t,e,i){return""};return i}(Er);var Ir=function(){function t(t,e){this._abstractionPool=new Object;this._entity=t;this._materialGroup=e}Object.defineProperty(t.prototype,"entity",{get:function(){return this._entity},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"materialGroup",{get:function(){return this._materialGroup},enumerable:true,configurable:true});t.prototype.getAbstraction=function(e){return this._abstractionPool[e.id]||(this._abstractionPool[e.id]=new t._abstractionClassPool[e.assetType](e,this))};t.prototype.clearAbstraction=function(t){this._abstractionPool[t.id]=null};t.registerAbstraction=function(e,i){t._abstractionClassPool[i.assetType]=e};return t}();Ir._abstractionClassPool=new Object;var Rr=function(){function t(t,e){this._abstractionPool=new Object;this._elementsClass=t;this._materialGroup=e;this._abstractionClassPool=e.abstractionClassPool}Object.defineProperty(t.prototype,"elementsClass",{get:function(){return this._elementsClass},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"materialGroup",{get:function(){return this._materialGroup},enumerable:true,configurable:true});t.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new this._abstractionClassPool[t.assetType](t,this))};t.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]};return t}();var Lr=function(){function t(t,e){this._abstractionClassPool=new Object;this._materialPools=new Object;this._renderablePools=new Object;this._stage=t;this._abstractionClassPool=e}Object.defineProperty(t.prototype,"stage",{get:function(){return this._stage},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"abstractionClassPool",{get:function(){return this._abstractionClassPool},enumerable:true,configurable:true});t.prototype.getMaterialPool=function(t){return this._materialPools[t.elementsType]||(this._materialPools[t.elementsType]=new Rr(t.elementsClass,this))};t.prototype.getRenderablePool=function(t){return this._renderablePools[t.id]||(this._renderablePools[t.id]=new Ir(t,this))};return t}();var Nr=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._count=0;r._offset=0;r._elementsDirty=true;r._materialDirty=true;r.images=new Array;r.samplers=new Array;r._onInvalidateMaterialDelegate=function(t){return r._onInvalidateMaterial(t)};r._onInvalidateElementsDelegate=function(t){return r.onInvalidateElements(t)};r.sourceEntity=i.entity;r._materialGroup=i.materialGroup;r._stage=r._materialGroup.stage;r.renderable=e;r.renderable.addEventListener(Ut.INVALIDATE_MATERIAL,r._onInvalidateMaterialDelegate);r.renderable.addEventListener(Ut.INVALIDATE_ELEMENTS,r._onInvalidateElementsDelegate);return r}Object.defineProperty(i.prototype,"elementsGL",{get:function(){if(this._elementsDirty)this._updateElements();return this._elementsGL},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"materialGL",{get:function(){if(this._materialDirty)this._updateMaterial();return this._materialGL},enumerable:true,configurable:true});i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this.next=null;this.masksConfig=null;this.renderSceneTransform=null;this.sourceEntity=null;this._materialGroup=null;this._stage=null;this.renderable.removeEventListener(Ut.INVALIDATE_MATERIAL,this._onInvalidateMaterialDelegate);this.renderable.removeEventListener(Ut.INVALIDATE_ELEMENTS,this._onInvalidateElementsDelegate);this.renderable=null;this._materialGL.usages--;if(!this._materialGL.usages)this._materialGL.onClear(new s(s.CLEAR,this._materialGL.material));this._materialGL=null;this._elementsGL=null};i.prototype.onInvalidateElements=function(t){this._elementsDirty=true};i.prototype._onInvalidateMaterial=function(t){this._materialDirty=true};i.prototype._pGetElements=function(){throw new r};i.prototype._pGetMaterial=function(){throw new r};i.prototype._iRender=function(t,e){this._setRenderState(t,e);this._elementsGL.draw(this,t.shader,e,this._count,this._offset)};i.prototype._setRenderState=function(t,e){if(this._elementsDirty)this._updateElements();t._setRenderState(this,e);if(t.shader.activeElements!=this._elementsGL){t.shader.activeElements=this._elementsGL;this._elementsGL._setRenderState(this,t.shader,e)}};i.prototype._updateElements=function(){this._elementsGL=this._pGetElements();this._elementsDirty=false};i.prototype._updateMaterial=function(){var t=this._pGetMaterial();if(this._materialGL!=t){if(this._materialGL){this._materialGL.usages--;if(!this._materialGL.usages)this._materialGL.onClear(new s(s.CLEAR,this._materialGL.material))}this._materialGL=t;this._materialGL.usages++}var e=t.numImages;var i=this.renderable.style||this.sourceEntity.style;var r=this._materialGL.material;this.images.length=e;this.samplers.length=e;this.uvMatrix=i?i.uvMatrix:r.style?r.style.uvMatrix:null;var n=this._materialGL.material.getNumTextures();var a;var e;var o;var h;var u;for(var l=0;l<n;l++){a=r.getTextureAt(l);e=a.getNumImages();for(var p=0;p<e;p++){u=t.getImageIndex(a,p);o=i?i.getImageAt(a,p):null;this.images[u]=o?this._stage.getAbstraction(o):null;h=i?i.getSamplerAt(a,p):null;this.samplers[u]=h?this._stage.getAbstraction(h):null}}this._materialDirty=false};return i}(K);var Fr=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.shape=e;return r}i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this.shape=null};i.prototype._pGetElements=function(){this._offset=this.shape.offset;this._count=this.shape.count;return this._stage.getAbstraction(this.sourceEntity.animator?this.sourceEntity.animator.getRenderableElements(this,this.shape.elements):this.shape.elements)};i.prototype._pGetMaterial=function(){return this._materialGroup.getMaterialPool(this.elementsGL).getAbstraction(this.shape.material||this.sourceEntity.material||we.getDefaultMaterial(this.renderable))};return i}(Nr);var Br=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._texture=e;r._shader=i;r._stage=i._stage;return r}i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this._texture=null;this._shader=null;this._stage=null};i.prototype._iGetFragmentCode=function(t,e,i,n){if(n===void 0){n=null}throw new r};i.prototype._setRenderState=function(t){};i.prototype.activate=function(t){};i.prototype.getTextureReg=function(t,e,i){var r=this._shader.imageIndices.indexOf(t);if(r==-1){var n=e.getFreeTextureReg();i.textures.push(n);this._shader.imageIndices.push(t);return n}return i.textures[r]};return i}(K);var Vr=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._single2DTexture=e;return r}i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this._single2DTexture=null};i.prototype._iGetFragmentCode=function(t,e,i,r){var n="";var s="wrap";var a="";var o="linear,miplinear";var h;if(this._single2DTexture.mappingMode==me.RADIAL_GRADIENT){h=e.getFreeFragmentVectorTemp();n+="mul "+h+".xy, "+r+", "+r+"\n";n+="mul "+h+".xy, "+r+", "+r+"\n";n+="add "+h+".x, "+h+".x, "+h+".y\n";n+="sub "+h+".y, "+h+".y, "+h+".y\n";n+="sqt "+h+".x, "+h+".x, "+h+".x\n";r=h}if(this._shader.useImageRect){var u=e.getFreeFragmentConstant();this._samplerIndex=u.index*4;h=e.getFreeFragmentVectorTemp();n+="mul "+h+", "+r+", "+u+".xy\n";n+="add "+h+", "+h+", "+u+".zw\n";r=h}this._imageIndex=this._shader.getImageIndex(this._single2DTexture,0);var l=this.getTextureReg(this._imageIndex,e,i);this._textureIndex=l.index;n+="tex "+t+", "+r+", "+l+" <2d,"+o+","+a+s+">\n";return n};i.prototype.activate=function(t){var e=t.samplers[this._imageIndex];e.activate(this._textureIndex);var i=t.images[this._imageIndex];i.activate(this._textureIndex,e._sampler.mipmap);if(this._shader.useImageRect){var r=this._samplerIndex;var n=this._shader.fragmentConstantData;if(!e._sampler.imageRect){n[r]=1;n[r+1]=1;n[r+2]=0;n[r+3]=0}else{n[r]=e._sampler.imageRect.width;n[r+1]=e._sampler.imageRect.height;n[r+2]=e._sampler.imageRect.x;n[r+3]=e._sampler.imageRect.y}}};i.prototype._setRenderState=function(t){var e=t.samplers[this._imageIndex];if(e)e.activate(this._textureIndex);var i=t.images[this._imageIndex];if(i)i.activate(this._textureIndex,e._sampler.mipmap);if(this._shader.useImageRect&&e){var r=this._samplerIndex;var n=this._shader.fragmentConstantData;if(!e._sampler.imageRect){n[r]=1;n[r+1]=1;n[r+2]=0;n[r+3]=0}else{n[r]=e._sampler.imageRect.width;n[r+1]=e._sampler.imageRect.height;n[r+2]=e._sampler.imageRect.x;n[r+3]=e._sampler.imageRect.y}}};return i}(Br);var Ur=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._singleCubeTexture=e;return r}i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this._singleCubeTexture=null};i.prototype._iIncludeDependencies=function(t){if(t===void 0){t=true}if(t)this._shader.usesPositionFragment=true};i.prototype._iGetFragmentCode=function(t,e,i,r){var n="";var s="linear,miplinear";this._imageIndex=this._shader.getImageIndex(this._singleCubeTexture,0);var a=this.getTextureReg(this._imageIndex,e,i);this._textureIndex=a.index;return"tex "+t+", "+r+", "+a+" <cube,"+n+s+">\n"};i.prototype.activate=function(t){var e=t.samplers[this._imageIndex];if(e)e.activate(this._textureIndex);if(t.images[this._imageIndex])t.images[this._imageIndex].activate(this._textureIndex,e._sampler.mipmap)};i.prototype._setRenderState=function(t){var e=t.samplers[this._imageIndex];if(e)e.activate(this._textureIndex);if(t.images[this._imageIndex]&&e)t.images[this._imageIndex].activate(this._textureIndex,e._sampler.mipmap)};return i}(Br);var kr=function(){function t(){this._pVertexBuffer=new Array(8);this._pBufferContext=new Array(8);this._pBufferDirty=new Array(8);this.numProcessedVertices=0;this.previousTime=Number.NEGATIVE_INFINITY;this.animationParticles=new Array;for(var e=0;e<8;e++)this._pBufferDirty[e]=true;this._iUniqueId=t.SUBGEOM_ID_COUNT++}t.prototype.createVertexData=function(t,e){this._numVertices=t;this._totalLenOfOneVertex=e;this._pVertexData=new Array(t*e)};t.prototype.activateVertexBuffer=function(t,e,i,r){var n=i.stageIndex;var s=i.context;var a=this._pVertexBuffer[n];if(!a||this._pBufferContext[n]!=s){a=this._pVertexBuffer[n]=s.createVertexBuffer(this._numVertices,this._totalLenOfOneVertex*4);this._pBufferContext[n]=s;this._pBufferDirty[n]=true}if(this._pBufferDirty[n]){a.uploadFromArray(this._pVertexData,0,this._numVertices);this._pBufferDirty[n]=false}s.setVertexBufferAt(t,a,e*4,r)};t.prototype.dispose=function(){while(this._pVertexBuffer.length){var t=this._pVertexBuffer.pop();if(t)t.dispose()}};t.prototype.invalidateBuffer=function(){for(var t=0;t<8;t++)this._pBufferDirty[t]=true};Object.defineProperty(t.prototype,"vertexData",{get:function(){return this._pVertexData},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"totalLenOfOneVertex",{get:function(){return this._totalLenOfOneVertex},enumerable:true,configurable:true});return t}();kr.SUBGEOM_ID_COUNT=0;var zr=function(){function t(t,e){if(t<=0||t>=1)throw new Error("life exceeds range (0,1)");this._life=t;this._color=e}Object.defineProperty(t.prototype,"color",{get:function(){return this._color},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"life",{get:function(){return this._life},enumerable:true,configurable:true});return t}();var jr=function(){function t(){this.orientation=new W;this.translation=new A}t.prototype.toMatrix3D=function(t){if(t===void 0){t=null}if(t==null)t=new M;this.orientation.toMatrix3D(t);t.appendTranslation(this.translation.x,this.translation.y,this.translation.z);return t};t.prototype.copyFrom=function(t){var e=t.orientation;var i=t.translation;this.orientation.x=e.x;this.orientation.y=e.y;this.orientation.z=e.z;this.orientation.w=e.w;this.translation.x=i.x;this.translation.y=i.y;this.translation.z=i.z};return t}();var Gr=function(){function t(t,e,i,r,n){this.index=t;this.startTime=e;this.totalTime=i+r;this.duration=i;this.delay=r;this.startVertexIndex=n.startVertexIndex;this.numVertices=n.numVertices}return t}();var Hr=function(){function t(){}return t}();var Xr=function(){function t(){}return t}();Xr.GLOBAL=0;Xr.LOCAL_STATIC=1;Xr.LOCAL_DYNAMIC=2;var Wr=function(t){e(i,t);function i(){var e=t.call(this)||this;e.joints=new Array;return e}Object.defineProperty(i.prototype,"numJoints",{get:function(){return this.joints.length},enumerable:true,configurable:true});i.prototype.jointFromName=function(t){var e=this.jointIndexFromName(t);if(e!=-1)return this.joints[e];else return null};i.prototype.jointIndexFromName=function(t){var e;var i;for(var r;r<this.joints.length;r++){i=this.joints[r];if(i.name==t)return e;e++}return-1};i.prototype.dispose=function(){this.joints.length=0};Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});return i}(h);Wr.assetType="[asset Skeleton]";var Yr=function(){function t(){this.parentIndex=-1}return t}();var qr=function(t){e(i,t);function i(){var e=t.call(this)||this;e.jointPoses=new Array;return e}Object.defineProperty(i.prototype,"numJointPoses",{get:function(){return this.jointPoses.length},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.jointPoseFromName=function(t){var e=this.jointPoseIndexFromName(t);if(e!=-1)return this.jointPoses[e];else return null};i.prototype.jointPoseIndexFromName=function(t){var e;var i;for(var r;r<this.jointPoses.length;r++){i=this.jointPoses[r];if(i.name==t)return e;e++}return-1};i.prototype.clone=function(){var t=new i;var e=this.jointPoses.length;for(var r=0;r<e;r++){var n=new jr;var s=this.jointPoses[r];n.name=s.name;n.copyFrom(s);t.jointPoses[r]=n}return t};i.prototype.dispose=function(){this.jointPoses.length=0};return i}(h);qr.assetType="[asset SkeletonPose]";var Kr=function(){function t(){}return t}();Kr.ADDITIVE="additive";Kr.ABSOLUTE="absolute";var Zr=function(t){e(i,t);function i(){var e=t.call(this)||this;e._pLooping=true;e._pTotalDuration=0;e._pStitchDirty=true;e._pStitchFinalFrame=false;e._pNumFrames=0;e._pDurations=new Array;e._pTotalDelta=new A;e.fixedFrameRate=true;return e}Object.defineProperty(i.prototype,"looping",{get:function(){return this._pLooping},set:function(t){if(this._pLooping==t)return;this._pLooping=t;this._pStitchDirty=true},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"stitchFinalFrame",{get:function(){return this._pStitchFinalFrame},set:function(t){if(this._pStitchFinalFrame==t)return;this._pStitchFinalFrame=t;this._pStitchDirty=true},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"totalDuration",{get:function(){if(this._pStitchDirty)this._pUpdateStitch();return this._pTotalDuration},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"totalDelta",{get:function(){if(this._pStitchDirty)this._pUpdateStitch();return this._pTotalDelta},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"lastFrame",{get:function(){if(this._pStitchDirty)this._pUpdateStitch();return this._pLastFrame},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"durations",{get:function(){return this._pDurations},enumerable:true,configurable:true});i.prototype._pUpdateStitch=function(){this._pStitchDirty=false;this._pLastFrame=this._pStitchFinalFrame?this._pNumFrames:this._pNumFrames-1;this._pTotalDuration=0;this._pTotalDelta.x=0;this._pTotalDelta.y=0;this._pTotalDelta.z=0};return i}(Vt);var Qr=function(){function t(t,e){this._pRootDelta=new A;this._pPositionDeltaDirty=true;this._pStartTime=0;this._pAnimator=t;this._pAnimationNode=e}Object.defineProperty(t.prototype,"positionDelta",{get:function(){if(this._pPositionDeltaDirty){this._pUpdatePositionDelta()}return this._pRootDelta},enumerable:true,configurable:true});t.prototype.offset=function(t){this._pStartTime=t;this._pPositionDeltaDirty=true};t.prototype.update=function(t){if(this._pTime==t-this._pStartTime){return}this._pUpdateTime(t)};t.prototype.phase=function(t){};t.prototype._pUpdateTime=function(t){this._pTime=t-this._pStartTime;this._pPositionDeltaDirty=true};t.prototype._pUpdatePositionDelta=function(){};return t}();var Jr=function(t){e(i,t);function i(e,i,r){if(r===void 0){r=false}var n=t.call(this,e,i)||this;n._pDynamicProperties=new Array;n._pDynamicPropertiesDirty=new Object;n._pParticleAnimator=e;n._particleNode=i;n._pNeedUpdateTime=r;return n}Object.defineProperty(i.prototype,"needUpdateTime",{get:function(){return this._pNeedUpdateTime},enumerable:true,configurable:true});i.prototype.setRenderState=function(t,e,i,r,n,s){};i.prototype._pUpdateDynamicProperties=function(t){this._pDynamicPropertiesDirty[t._iUniqueId]=true;var e=t.animationParticles;var i=t.vertexData;var r=t.totalLenOfOneVertex;var n=this._particleNode.dataLength;var s=this._particleNode._iDataOffset;var a;var o;var h;var u;var l;var p=this._pDynamicProperties.length;var c=0;var _=0;var f=0;while(c<p){while(_<p&&(l=e[_]).index==c){u=this._pDynamicProperties[c];a=l.numVertices*r;o=l.startVertexIndex*r+s;for(f=0;f<a;f+=r){h=o+f;for(f=0;f<a;f+=r){h=o+f;i[h++]=u.x;i[h++]=u.y;i[h++]=u.z;if(n==4)i[h++]=u.w}}_++}c++}t.invalidateBuffer()};return i}(Qr);var $r=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._particleAccelerationNode=e;r._acceleration=r._particleAccelerationNode._acceleration;r.updateAccelerationData();return r}Object.defineProperty(r.prototype,"acceleration",{get:function(){return this._acceleration},set:function(t){this._acceleration.x=t.x;this._acceleration.y=t.y;this._acceleration.z=t.z;this.updateAccelerationData()},enumerable:true,configurable:true});r.prototype.setRenderState=function(e,i,n,s,a,o){var h=s.getRegisterIndex(this._pAnimationNode,r.ACCELERATION_INDEX);if(this._particleAccelerationNode.mode==Xr.LOCAL_STATIC)n.activateVertexBuffer(h,this._particleAccelerationNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_3);else e.setVertexConst(h,this._halfAcceleration.x,this._halfAcceleration.y,this._halfAcceleration.z)};r.prototype.updateAccelerationData=function(){if(this._particleAccelerationNode.mode==Xr.GLOBAL)this._halfAcceleration=new A(this._acceleration.x/2,this._acceleration.y/2,this._acceleration.z/2)};return r}(Jr);$r.ACCELERATION_INDEX=0;var tn=function(t){e(i,t);function i(e,r,n,s){if(s===void 0){s=1}var a=t.call(this)||this;a._pDataLength=3;e=e+i.MODES[r];a.name=e;a._pMode=r;a._priority=s;a._pDataLength=n;a._pOneData=new Array(a._pDataLength);return a}Object.defineProperty(i.prototype,"mode",{get:function(){return this._pMode},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"priority",{get:function(){return this._priority},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"dataLength",{get:function(){return this._pDataLength},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"oneData",{get:function(){return this._pOneData},enumerable:true,configurable:true});i.prototype.getAGALVertexCode=function(t,e,i,r){return""};i.prototype.getAGALFragmentCode=function(t,e,i,r){return""};i.prototype.getAGALUVCode=function(t,e,i,r){return""};i.prototype._iGeneratePropertyOfOneParticle=function(t){};i.prototype._iProcessAnimationSetting=function(t){};return i}(Vt);tn.GLOBAL="Global";tn.LOCAL_STATIC="LocalStatic";tn.LOCAL_DYNAMIC="LocalDynamic";tn.MODES={0:tn.GLOBAL,1:tn.LOCAL_STATIC,2:tn.LOCAL_DYNAMIC};var en=function(t){e(i,t);function i(e,i){if(i===void 0){i=null}var r=t.call(this,"ParticleAcceleration",e,3)||this;r._pStateClass=$r;r._acceleration=i||new A;return r}i.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,$r.ACCELERATION_INDEX,n.index);var s=i.getFreeVertexVectorTemp();i.addVertexTempUsages(s,1);var a="mul "+s+","+r.vertexTime+","+n+"\n";if(e.needVelocity){var o=i.getFreeVertexVectorTemp();a+="mul "+o+","+s+","+r.vertexTwoConst+"\n";a+="add "+r.velocityTarget+".xyz,"+o+".xyz,"+r.velocityTarget+".xyz\n"}i.removeVertexTempUsage(s);a+="mul "+s+","+s+","+r.vertexTime+"\n";a+="add "+r.positionTarget+".xyz,"+s+","+r.positionTarget+".xyz\n";return a};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.ACCELERATION_VECTOR3D];if(!e)throw new Error("there is no "+i.ACCELERATION_VECTOR3D+" in param!");this._pOneData[0]=e.x/2;this._pOneData[1]=e.y/2;this._pOneData[2]=e.z/2};return i}(tn);en.ACCELERATION_VECTOR3D="AccelerationVector3D";var rn=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._particleBezierCurveNode=e;r._controlPoint=r._particleBezierCurveNode._iControlPoint;r._endPoint=r._particleBezierCurveNode._iEndPoint;return r}Object.defineProperty(r.prototype,"controlPoint",{get:function(){return this._controlPoint},set:function(t){this._controlPoint=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"endPoint",{get:function(){return this._endPoint},set:function(t){this._endPoint=t},enumerable:true,configurable:true});r.prototype.setRenderState=function(e,i,n,s,a,o){var h=s.getRegisterIndex(this._pAnimationNode,r.BEZIER_CONTROL_INDEX);var u=s.getRegisterIndex(this._pAnimationNode,r.BEZIER_END_INDEX);if(this._particleBezierCurveNode.mode==Xr.LOCAL_STATIC){n.activateVertexBuffer(h,this._particleBezierCurveNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_3);n.activateVertexBuffer(u,this._particleBezierCurveNode._iDataOffset+3,o,t.ContextGLVertexBufferFormat.FLOAT_3)}else{e.setVertexConst(h,this._controlPoint.x,this._controlPoint.y,this._controlPoint.z);e.setVertexConst(u,this._endPoint.x,this._endPoint.y,this._endPoint.z)}};return r}(Jr);rn.BEZIER_CONTROL_INDEX=0;rn.BEZIER_END_INDEX=1;var nn=function(t){e(i,t);function i(e,i,r){if(i===void 0){i=null}if(r===void 0){r=null}var n=t.call(this,"ParticleBezierCurve",e,6)||this;n._pStateClass=rn;n._iControlPoint=i||new A;n._iEndPoint=r||new A;return n}i.prototype.getAGALVertexCode=function(t,e,i,r){
var n=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,rn.BEZIER_CONTROL_INDEX,n.index);var s=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,rn.BEZIER_END_INDEX,s.index);var a=i.getFreeVertexVectorTemp();var o=new fi(a.regName,a.index,0);var h=new fi(a.regName,a.index,1);var u=new fi(a.regName,a.index,2);i.addVertexTempUsages(a,1);var l=i.getFreeVertexVectorTemp();var p=new fi(l.regName,l.index);i.removeVertexTempUsage(a);var c="";c+="sub "+o+","+r.vertexOneConst+","+r.vertexLife+"\n";c+="mul "+h+","+r.vertexLife+","+r.vertexLife+"\n";c+="mul "+u+","+r.vertexLife+","+o+"\n";c+="mul "+u+","+u+","+r.vertexTwoConst+"\n";c+="mul "+p+".xyz,"+u+","+n+"\n";c+="add "+r.positionTarget+".xyz,"+p+".xyz,"+r.positionTarget+".xyz\n";c+="mul "+p+".xyz,"+h+","+s+"\n";c+="add "+r.positionTarget+".xyz,"+p+".xyz,"+r.positionTarget+".xyz\n";if(e.needVelocity){c+="mul "+h+","+r.vertexLife+","+r.vertexTwoConst+"\n";c+="sub "+u+","+r.vertexOneConst+","+h+"\n";c+="mul "+u+","+r.vertexTwoConst+","+u+"\n";c+="mul "+p+".xyz,"+n+","+u+"\n";c+="add "+r.velocityTarget+".xyz,"+p+".xyz,"+r.velocityTarget+".xyz\n";c+="mul "+p+".xyz,"+s+","+h+"\n";c+="add "+r.velocityTarget+".xyz,"+p+".xyz,"+r.velocityTarget+".xyz\n"}return c};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.BEZIER_CONTROL_VECTOR3D];if(!e)throw new Error("there is no "+i.BEZIER_CONTROL_VECTOR3D+" in param!");var r=t[i.BEZIER_END_VECTOR3D];if(!r)throw new Error("there is no "+i.BEZIER_END_VECTOR3D+" in param!");this._pOneData[0]=e.x;this._pOneData[1]=e.y;this._pOneData[2]=e.z;this._pOneData[3]=r.x;this._pOneData[4]=r.y;this._pOneData[5]=r.z};return i}(tn);nn.BEZIER_CONTROL_VECTOR3D="BezierControlVector3D";nn.BEZIER_END_VECTOR3D="BezierEndVector3D";var sn=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._matrix=new M;r._billboardAxis=i._iBillboardAxis;return r}i.prototype.setRenderState=function(t,e,r,n,s,a){var o;if(this._billboardAxis){var h=e.sourceEntity.transform.concatenatedMatrix3D.position;var u=s.transform.concatenatedMatrix3D.position.subtract(h);var l=u.crossProduct(this._billboardAxis);l.normalize();u=this.billboardAxis.crossProduct(l);u.normalize();this._matrix.copyFrom(e.sourceEntity.transform.concatenatedMatrix3D);o=this._matrix.decompose(S.AXIS_ANGLE);this._matrix.copyColumnFrom(0,l);this._matrix.copyColumnFrom(1,this.billboardAxis);this._matrix.copyColumnFrom(2,u);this._matrix.copyColumnFrom(3,h);this._matrix.appendRotation(-o[1].w*P.RADIANS_TO_DEGREES,o[1])}else{this._matrix.copyFrom(e.sourceEntity.transform.concatenatedMatrix3D);this._matrix.append(s.transform.inverseConcatenatedMatrix3D);o=this._matrix.decompose(S.AXIS_ANGLE);this._matrix.identity();this._matrix.appendRotation(-o[1].w*P.RADIANS_TO_DEGREES,o[1])}t.setVertexConstFromMatrix(n.getRegisterIndex(this._pAnimationNode,i.MATRIX_INDEX),this._matrix)};Object.defineProperty(i.prototype,"billboardAxis",{get:function(){return this.billboardAxis},set:function(t){this.billboardAxis=t?t.clone():null;if(this.billboardAxis)this.billboardAxis.normalize()},enumerable:true,configurable:true});return i}(Jr);sn.MATRIX_INDEX=0;var an=function(t){e(i,t);function i(e){if(e===void 0){e=null}var i=t.call(this,"ParticleBillboard",Xr.GLOBAL,0,4)||this;i._pStateClass=sn;i._iBillboardAxis=e;return i}i.prototype.getAGALVertexCode=function(t,e,i,r){var n=i.getFreeVertexConstant();r.setRegisterIndex(this,sn.MATRIX_INDEX,n.index);i.getFreeVertexConstant();i.getFreeVertexConstant();i.getFreeVertexConstant();var s=i.getFreeVertexVectorTemp();var a="m33 "+s+".xyz,"+r.scaleAndRotateTarget+","+n+"\n"+"mov "+r.scaleAndRotateTarget+".xyz,"+s+"\n";var o;for(var h=0;h<r.rotationRegisters.length;h++){o=r.rotationRegisters[h];a+="m33 "+s+".xyz,"+o+","+n+"\n"+"mov "+o+".xyz,"+o+"\n"}return a};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iProcessAnimationSetting=function(t){t.hasBillboard=true};return i}(tn);var on=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._particleColorNode=e;r._usesMultiplier=r._particleColorNode._iUsesMultiplier;r._usesOffset=r._particleColorNode._iUsesOffset;r._usesCycle=r._particleColorNode._iUsesCycle;r._usesPhase=r._particleColorNode._iUsesPhase;r._startColor=r._particleColorNode._iStartColor;r._endColor=r._particleColorNode._iEndColor;r._cycleDuration=r._particleColorNode._iCycleDuration;r._cyclePhase=r._particleColorNode._iCyclePhase;r.updateColorData();return r}Object.defineProperty(r.prototype,"startColor",{get:function(){return this._startColor},set:function(t){this._startColor=t;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"endColor",{get:function(){return this._endColor},set:function(t){this._endColor=t;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t;this.updateColorData()},enumerable:true,configurable:true});r.prototype.setRenderState=function(e,i,n,s,a,o){if(e.usesFragmentAnimation){var h=this._particleColorNode._iDataOffset;var u;if(this._usesCycle)e.setVertexConst(s.getRegisterIndex(this._pAnimationNode,r.CYCLE_INDEX),this._cycleData.x,this._cycleData.y,this._cycleData.z,this._cycleData.w);if(this._usesMultiplier){if(this._particleColorNode.mode==Xr.LOCAL_STATIC){n.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,r.START_MULTIPLIER_INDEX),h,o,t.ContextGLVertexBufferFormat.FLOAT_4);h+=4;n.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,r.DELTA_MULTIPLIER_INDEX),h,o,t.ContextGLVertexBufferFormat.FLOAT_4);h+=4}else{e.setVertexConst(s.getRegisterIndex(this._pAnimationNode,r.START_MULTIPLIER_INDEX),this._startMultiplierData.x,this._startMultiplierData.y,this._startMultiplierData.z,this._startMultiplierData.w);e.setVertexConst(s.getRegisterIndex(this._pAnimationNode,r.DELTA_MULTIPLIER_INDEX),this._deltaMultiplierData.x,this._deltaMultiplierData.y,this._deltaMultiplierData.z,this._deltaMultiplierData.w)}}if(this._usesOffset){if(this._particleColorNode.mode==Xr.LOCAL_STATIC){n.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,r.START_OFFSET_INDEX),h,o,t.ContextGLVertexBufferFormat.FLOAT_4);h+=4;n.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,r.DELTA_OFFSET_INDEX),h,o,t.ContextGLVertexBufferFormat.FLOAT_4)}else{e.setVertexConst(s.getRegisterIndex(this._pAnimationNode,r.START_OFFSET_INDEX),this._startOffsetData.x,this._startOffsetData.y,this._startOffsetData.z,this._startOffsetData.w);e.setVertexConst(s.getRegisterIndex(this._pAnimationNode,r.DELTA_OFFSET_INDEX),this._deltaOffsetData.x,this._deltaOffsetData.y,this._deltaOffsetData.z,this._deltaOffsetData.w)}}}};r.prototype.updateColorData=function(){if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._cycleData=new A(Math.PI*2/this._cycleDuration,this._cyclePhase*Math.PI/180,0,0)}if(this._particleColorNode.mode==Xr.GLOBAL){if(this._usesCycle){if(this._usesMultiplier){this._startMultiplierData=new A((this._startColor.redMultiplier+this._endColor.redMultiplier)/2,(this._startColor.greenMultiplier+this._endColor.greenMultiplier)/2,(this._startColor.blueMultiplier+this._endColor.blueMultiplier)/2,(this._startColor.alphaMultiplier+this._endColor.alphaMultiplier)/2);this._deltaMultiplierData=new A((this._endColor.redMultiplier-this._startColor.redMultiplier)/2,(this._endColor.greenMultiplier-this._startColor.greenMultiplier)/2,(this._endColor.blueMultiplier-this._startColor.blueMultiplier)/2,(this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)/2)}if(this._usesOffset){this._startOffsetData=new A((this._startColor.redOffset+this._endColor.redOffset)/(255*2),(this._startColor.greenOffset+this._endColor.greenOffset)/(255*2),(this._startColor.blueOffset+this._endColor.blueOffset)/(255*2),(this._startColor.alphaOffset+this._endColor.alphaOffset)/(255*2));this._deltaOffsetData=new A((this._endColor.redOffset-this._startColor.redOffset)/(255*2),(this._endColor.greenOffset-this._startColor.greenOffset)/(255*2),(this._endColor.blueOffset-this._startColor.blueOffset)/(255*2),(this._endColor.alphaOffset-this._startColor.alphaOffset)/(255*2))}}else{if(this._usesMultiplier){this._startMultiplierData=new A(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier);this._deltaMultiplierData=new A(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)}if(this._usesOffset){this._startOffsetData=new A(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255);this._deltaOffsetData=new A((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255)}}}};return r}(Jr);on.START_MULTIPLIER_INDEX=0;on.DELTA_MULTIPLIER_INDEX=1;on.START_OFFSET_INDEX=2;on.DELTA_OFFSET_INDEX=3;on.CYCLE_INDEX=4;var hn=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e,true)||this;r._particleTimeNode=e;return r}r.prototype.setRenderState=function(e,i,n,s,a,o){n.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,r.TIME_STREAM_INDEX),this._particleTimeNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_4);var h=this._pTime/1e3;e.setVertexConst(s.getRegisterIndex(this._pAnimationNode,r.TIME_CONSTANT_INDEX),h,h,h,h)};return r}(Jr);hn.TIME_STREAM_INDEX=0;hn.TIME_CONSTANT_INDEX=1;var un=function(t){e(i,t);function i(e,i,r){if(e===void 0){e=false}if(i===void 0){i=false}if(r===void 0){r=false}var n=t.call(this,"ParticleTime",Xr.LOCAL_STATIC,4,0)||this;n._pStateClass=hn;n._iUsesDuration=e;n._iUsesLooping=i;n._iUsesDelay=r;return n}i.prototype.getAGALVertexCode=function(t,e,i,r){var n=i.getFreeVertexAttribute();r.setRegisterIndex(this,hn.TIME_STREAM_INDEX,n.index);var s=i.getFreeVertexConstant();r.setRegisterIndex(this,hn.TIME_CONSTANT_INDEX,s.index);var a="";a+="sub "+r.vertexTime+","+s+","+n+".x\n";var o=i.getFreeVertexSingleTemp();a+="sge "+o+","+r.vertexTime+","+r.vertexZeroConst+"\n";a+="mul "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+o+"\n";if(this._iUsesDuration){if(this._iUsesLooping){var h=i.getFreeVertexSingleTemp();if(this._iUsesDelay){a+="div "+h+","+r.vertexTime+","+n+".z\n";a+="frc "+h+","+h+"\n";a+="mul "+r.vertexTime+","+h+","+n+".z\n";a+="slt "+h+","+r.vertexTime+","+n+".y\n";a+="mul "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+h+"\n"}else{a+="mul "+h+","+r.vertexTime+","+n+".w\n";a+="frc "+h+","+h+"\n";a+="mul "+r.vertexTime+","+h+","+n+".y\n"}}else{var u=i.getFreeVertexSingleTemp();a+="sge "+u+","+n+".y,"+r.vertexTime+"\n";a+="mul "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+u+"\n"}}a+="mul "+r.vertexLife+","+r.vertexTime+","+n+".w\n";return a};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iGeneratePropertyOfOneParticle=function(t){this._pOneData[0]=t.startTime;this._pOneData[1]=t.duration;this._pOneData[2]=t.delay+t.duration;this._pOneData[3]=1/t.duration};return i}(tn);var ln=function(t){e(i,t);function i(e,i,r){if(e===void 0){e=false}if(i===void 0){i=false}if(r===void 0){r=false}var n=t.call(this)||this;n._animationElements=new Object;n._particleNodes=new Array;n._localDynamicNodes=new Array;n._localStaticNodes=new Array;n._totalLenOfOneVertex=0;n.shareAnimationGraphics=true;n.addAnimation(n._timeNode=new un(e,i,r));return n}Object.defineProperty(i.prototype,"particleNodes",{get:function(){return this._particleNodes},enumerable:true,configurable:true});i.prototype.addAnimation=function(e){var i;var r=e;r._iProcessAnimationSetting(this);if(r.mode==Xr.LOCAL_STATIC){r._iDataOffset=this._totalLenOfOneVertex;this._totalLenOfOneVertex+=r.dataLength;this._localStaticNodes.push(r)}else if(r.mode==Xr.LOCAL_DYNAMIC)this._localDynamicNodes.push(r);for(i=this._particleNodes.length-1;i>=0;i--){if(this._particleNodes[i].priority<=r.priority)break}this._particleNodes.splice(i+1,0,r);t.prototype.addAnimation.call(this,e)};i.prototype.getAGALVertexCode=function(t,e,r){this._iAnimationRegisterData=t.animationRegisterData;if(this._iAnimationRegisterData==null)this._iAnimationRegisterData=t.animationRegisterData=new di;this._iAnimationRegisterData.reset(e,r,this.needVelocity);var n="";var s=r.animatableAttributes.length;for(var a=0;a<s;a++)n+="mov "+r.animationTargetRegisters[a]+","+r.animatableAttributes[a]+"\n";n+="mov "+this._iAnimationRegisterData.positionTarget+".xyz,"+this._iAnimationRegisterData.vertexZeroConst+"\n";if(this.needVelocity)n+="mov "+this._iAnimationRegisterData.velocityTarget+".xyz,"+this._iAnimationRegisterData.vertexZeroConst+"\n";var o;var a;for(a=0;a<this._particleNodes.length;a++){o=this._particleNodes[a];if(o.priority<i.POST_PRIORITY)n+=o.getAGALVertexCode(t,this,e,this._iAnimationRegisterData)}n+="add "+this._iAnimationRegisterData.scaleAndRotateTarget+".xyz,"+this._iAnimationRegisterData.scaleAndRotateTarget+".xyz,"+this._iAnimationRegisterData.positionTarget+".xyz\n";for(a=0;a<this._particleNodes.length;a++){o=this._particleNodes[a];if(o.priority>=i.POST_PRIORITY&&o.priority<i.COLOR_PRIORITY)n+=o.getAGALVertexCode(t,this,e,this._iAnimationRegisterData)}if(this.hasColorMulNode){this._iAnimationRegisterData.colorMulTarget=e.getFreeVertexVectorTemp();e.addVertexTempUsages(this._iAnimationRegisterData.colorMulTarget,1);this._iAnimationRegisterData.colorMulVary=e.getFreeVarying();n+="mov "+this._iAnimationRegisterData.colorMulTarget+","+this._iAnimationRegisterData.vertexOneConst+"\n"}if(this.hasColorAddNode){this._iAnimationRegisterData.colorAddTarget=e.getFreeVertexVectorTemp();e.addVertexTempUsages(this._iAnimationRegisterData.colorAddTarget,1);this._iAnimationRegisterData.colorAddVary=e.getFreeVarying();n+="mov "+this._iAnimationRegisterData.colorAddTarget+","+this._iAnimationRegisterData.vertexZeroConst+"\n"}for(a=0;a<this._particleNodes.length;a++){o=this._particleNodes[a];if(o.priority>=i.COLOR_PRIORITY)n+=o.getAGALVertexCode(t,this,e,this._iAnimationRegisterData)}if(t.usesFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)){if(this.hasColorMulNode)n+="mov "+this._iAnimationRegisterData.colorMulVary+","+this._iAnimationRegisterData.colorMulTarget+"\n";if(this.hasColorAddNode)n+="mov "+this._iAnimationRegisterData.colorAddVary+","+this._iAnimationRegisterData.colorAddTarget+"\n"}return n};i.prototype.getAGALUVCode=function(t,e,i){var r="";if(this.hasUVNode){this._iAnimationRegisterData.setUVSourceAndTarget(i);r+="mov "+this._iAnimationRegisterData.uvTarget+".xy,"+this._iAnimationRegisterData.uvAttribute.toString()+"\n";var n;for(var s=0;s<this._particleNodes.length;s++)n=this._particleNodes[s];r+=n.getAGALUVCode(t,this,e,this._iAnimationRegisterData);r+="mov "+this._iAnimationRegisterData.uvVar+","+this._iAnimationRegisterData.uvTarget+".xy\n"}else r+="mov "+i.uvTarget+","+i.uvSource+"\n";return r};i.prototype.getAGALFragmentCode=function(t,e,i){var r="";if(t.usesFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)){if(this.hasColorMulNode)r+="mul "+i+","+i+","+this._iAnimationRegisterData.colorMulVary+"\n";if(this.hasColorAddNode)r+="add "+i+","+i+","+this._iAnimationRegisterData.colorAddVary+"\n"}return r};i.prototype.doneAGALCode=function(t){t.setVertexConst(this._iAnimationRegisterData.vertexZeroConst.index,0,1,2,0)};Object.defineProperty(i.prototype,"usesCPU",{get:function(){return false},enumerable:true,configurable:true});i.prototype.cancelGPUCompatibility=function(){};i.prototype.dispose=function(){for(var e in this._animationElements)this._animationElements[e].dispose();t.prototype.dispose.call(this)};i.prototype.getAnimationElements=function(t,e){var i=this.shareAnimationGraphics?this._animationElements[e.elements.id]:this._animationElements[e.id];if(i)return i;this._iGenerateAnimationElements(t);return this.shareAnimationGraphics?this._animationElements[e.elements.id]:this._animationElements[e.id]};i.prototype._iGenerateAnimationElements=function(t){if(this.initParticleFunc==null)throw new Error("no initParticleFunc set");var e,i,r;var n;var s=false;var a;var o;var h;for(e=0;e<t.count;e++){o=t.getShapeAt(e);a=o.elements;if(this.shareAnimationGraphics){n=this._animationElements[a.id];if(n)continue}n=new kr;if(this.shareAnimationGraphics)this._animationElements[a.id]=n;else this._animationElements[o.id]=n;s=true;n.createVertexData(a.numVertices,this._totalLenOfOneVertex)}if(!s)return;var u=t.particles;var l=u.length;var p=t.numParticles;var c=new Hr;var _;var f;var d;var g;var m;var y;var v;var x;var b;var w;var D;c.total=p;c.startTime=0;c.duration=1e3;c.delay=.1;e=0;i=0;while(e<p){c.index=e;this.initParticleFunc.call(this.initParticleScope,c);for(r=0;r<this._localStaticNodes.length;r++)this._localStaticNodes[r]._iGeneratePropertyOfOneParticle(c);while(i<l&&(_=u[i]).particleIndex==e){for(r=0;r<t.count;r++){o=t.getShapeAt(r);if(o.elements==_.elements){n=this.shareAnimationGraphics?this._animationElements[o.elements.id]:this._animationElements[o.id];break}}v=_.numVertices;x=n.vertexData;b=v*this._totalLenOfOneVertex;w=n.numProcessedVertices*this._totalLenOfOneVertex;for(r=0;r<this._localStaticNodes.length;r++){h=this._localStaticNodes[r];y=h.oneData;f=h.dataLength;d=w+h._iDataOffset;for(g=0;g<b;g+=this._totalLenOfOneVertex){D=d+g;for(m=0;m<f;m++)x[D+m]=y[m]}}if(this._localDynamicNodes.length)n.animationParticles.push(new Gr(e,c.startTime,c.duration,c.delay,_));n.numProcessedVertices+=v;i++}e++}};return i}(mi);ln.POST_PRIORITY=9;ln.COLOR_PRIORITY=18;var pn=function(t){e(i,t);function i(e,i,r,n,s,a,o,h,u){if(i===void 0){i=true}if(r===void 0){r=true}if(n===void 0){n=false}if(s===void 0){s=false}if(a===void 0){a=null}if(o===void 0){o=null}if(h===void 0){h=1}if(u===void 0){u=0}var l=t.call(this,"ParticleColor",e,i&&r?16:8,ln.COLOR_PRIORITY)||this;l._pStateClass=on;l._iUsesMultiplier=i;l._iUsesOffset=r;l._iUsesCycle=n;l._iUsesPhase=s;l._iStartColor=a||new C;l._iEndColor=o||new C;l._iCycleDuration=h;l._iCyclePhase=u;return l}i.prototype.getAGALVertexCode=function(t,e,i,r){var n="";if(t.usesFragmentAnimation){var s=i.getFreeVertexVectorTemp();if(this._iUsesCycle){var a=i.getFreeVertexConstant();r.setRegisterIndex(this,on.CYCLE_INDEX,a.index);i.addVertexTempUsages(s,1);var o=i.getFreeVertexSingleTemp();i.removeVertexTempUsage(s);n+="mul "+o+","+r.vertexTime+","+a+".x\n";if(this._iUsesPhase)n+="add "+o+","+o+","+a+".y\n";n+="sin "+o+","+o+"\n"}if(this._iUsesMultiplier){var h=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();var u=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,on.START_MULTIPLIER_INDEX,h.index);r.setRegisterIndex(this,on.DELTA_MULTIPLIER_INDEX,u.index);n+="mul "+s+","+u+","+(this._iUsesCycle?o:r.vertexLife)+"\n";n+="add "+s+","+s+","+h+"\n";n+="mul "+r.colorMulTarget+","+s+","+r.colorMulTarget+"\n"}if(this._iUsesOffset){var l=this._pMode==Xr.LOCAL_STATIC?i.getFreeVertexAttribute():i.getFreeVertexConstant();var p=this._pMode==Xr.LOCAL_STATIC?i.getFreeVertexAttribute():i.getFreeVertexConstant();r.setRegisterIndex(this,on.START_OFFSET_INDEX,l.index);r.setRegisterIndex(this,on.DELTA_OFFSET_INDEX,p.index);n+="mul "+s+","+p+","+(this._iUsesCycle?o:r.vertexLife)+"\n";n+="add "+s+","+s+","+l+"\n";n+="add "+r.colorAddTarget+","+s+","+r.colorAddTarget+"\n"}}return n};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iProcessAnimationSetting=function(t){if(this._iUsesMultiplier)t.hasColorMulNode=true;if(this._iUsesOffset)t.hasColorAddNode=true};i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.COLOR_START_COLORTRANSFORM];if(!e)throw new Error("there is no "+i.COLOR_START_COLORTRANSFORM+" in param!");var r=t[i.COLOR_END_COLORTRANSFORM];if(!r)throw new Error("there is no "+i.COLOR_END_COLORTRANSFORM+" in param!");var n=0;if(!this._iUsesCycle){if(this._iUsesMultiplier){this._pOneData[n++]=e.redMultiplier;this._pOneData[n++]=e.greenMultiplier;this._pOneData[n++]=e.blueMultiplier;this._pOneData[n++]=e.alphaMultiplier;this._pOneData[n++]=r.redMultiplier-e.redMultiplier;this._pOneData[n++]=r.greenMultiplier-e.greenMultiplier;this._pOneData[n++]=r.blueMultiplier-e.blueMultiplier;this._pOneData[n++]=r.alphaMultiplier-e.alphaMultiplier}if(this._iUsesOffset){this._pOneData[n++]=e.redOffset/255;this._pOneData[n++]=e.greenOffset/255;this._pOneData[n++]=e.blueOffset/255;this._pOneData[n++]=e.alphaOffset/255;this._pOneData[n++]=(r.redOffset-e.redOffset)/255;this._pOneData[n++]=(r.greenOffset-e.greenOffset)/255;this._pOneData[n++]=(r.blueOffset-e.blueOffset)/255;this._pOneData[n++]=(r.alphaOffset-e.alphaOffset)/255}}else{if(this._iUsesMultiplier){this._pOneData[n++]=(e.redMultiplier+r.redMultiplier)/2;this._pOneData[n++]=(e.greenMultiplier+r.greenMultiplier)/2;this._pOneData[n++]=(e.blueMultiplier+r.blueMultiplier)/2;this._pOneData[n++]=(e.alphaMultiplier+r.alphaMultiplier)/2;this._pOneData[n++]=(e.redMultiplier-r.redMultiplier)/2;this._pOneData[n++]=(e.greenMultiplier-r.greenMultiplier)/2;this._pOneData[n++]=(e.blueMultiplier-r.blueMultiplier)/2;this._pOneData[n++]=(e.alphaMultiplier-r.alphaMultiplier)/2}if(this._iUsesOffset){this._pOneData[n++]=(e.redOffset+r.redOffset)/(255*2);this._pOneData[n++]=(e.greenOffset+r.greenOffset)/(255*2);this._pOneData[n++]=(e.blueOffset+r.blueOffset)/(255*2);this._pOneData[n++]=(e.alphaOffset+r.alphaOffset)/(255*2);this._pOneData[n++]=(e.redOffset-r.redOffset)/(255*2);this._pOneData[n++]=(e.greenOffset-r.greenOffset)/(255*2);this._pOneData[n++]=(e.blueOffset-r.blueOffset)/(255*2);this._pOneData[n++]=(e.alphaOffset-r.alphaOffset)/(255*2)}}};return i}(tn);pn.COLOR_START_COLORTRANSFORM="ColorStartColorTransform";pn.COLOR_END_COLORTRANSFORM="ColorEndColorTransform";var cn=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e,true)||this;r._targetPos=new A;r._targetEuler=new A;r._temp=new A;r._particleFollowNode=e;r._smooth=e._iSmooth;return r}Object.defineProperty(r.prototype,"followTarget",{get:function(){return this._followTarget},set:function(t){this._followTarget=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"smooth",{get:function(){return this._smooth},set:function(t){this._smooth=t},enumerable:true,configurable:true});r.prototype.setRenderState=function(e,i,n,s,a,o){if(this._followTarget){if(this._particleFollowNode._iUsesPosition){this._targetPos.x=this._followTarget.transform.position.x/i.sourceEntity.transform.scale.x;this._targetPos.y=this._followTarget.transform.position.y/i.sourceEntity.transform.scale.y;this._targetPos.z=this._followTarget.transform.position.z/i.sourceEntity.transform.scale.z}if(this._particleFollowNode._iUsesRotation){this._targetEuler.x=this._followTarget.rotationX;this._targetEuler.y=this._followTarget.rotationY;this._targetEuler.z=this._followTarget.rotationZ;this._targetEuler.scaleBy(P.DEGREES_TO_RADIANS)}}if(!this._prePos)this._prePos=this._targetPos.clone();if(!this._preEuler)this._preEuler=this._targetEuler.clone();var h=this._pTime/1e3;var u=n.previousTime;var l=h-u;var p=u!=h;if(this._particleFollowNode._iUsesPosition&&this._particleFollowNode._iUsesRotation){if(p)this.processPositionAndRotation(h,l,n);n.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,r.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_3);n.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,r.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset+3,o,t.ContextGLVertexBufferFormat.FLOAT_3)}else if(this._particleFollowNode._iUsesPosition){if(p)this.processPosition(h,l,n);n.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,r.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_3)}else if(this._particleFollowNode._iUsesRotation){if(p)this.precessRotation(h,l,n);n.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,r.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_3)}this._prePos.copyFrom(this._targetPos);this._targetEuler.copyFrom(this._targetEuler);n.previousTime=h};r.prototype.processPosition=function(t,e,i){var r=i.animationParticles;var n=i.vertexData;var s=false;var a=r.length;var o;var h;if(this._smooth){h=this._prePos.subtract(this._targetPos);h.scaleBy(1/e)}else o=this._targetPos;for(var u=0;u<a;u++){var l=(t-r[u].startTime)/r[u].totalTime;var p=(l-Math.floor(l))*r[u].totalTime;if(p-e<=0){var c=r[u].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth){this._temp.copyFrom(h);this._temp.scaleBy(p);o=this._targetPos.add(this._temp)}if(n[c]!=o.x||n[c+1]!=o.y||n[c+2]!=o.z){s=true;for(var _=0;_<r[u].numVertices;_++){n[c++]=o.x;n[c++]=o.y;n[c++]=o.z}}}}if(s)i.invalidateBuffer()};r.prototype.precessRotation=function(t,e,i){var r=i.animationParticles;var n=i.vertexData;var s=false;var a=r.length;var o;var h;if(this._smooth){h=this._preEuler.subtract(this._targetEuler);h.scaleBy(1/e)}else o=this._targetEuler;for(var u=0;u<a;u++){var l=(t-r[u].startTime)/r[u].totalTime;var p=(l-Math.floor(l))*r[u].totalTime;if(p-e<=0){var c=r[u].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth){this._temp.copyFrom(h);this._temp.scaleBy(p);o=this._targetEuler.add(this._temp)}if(n[c]!=o.x||n[c+1]!=o.y||n[c+2]!=o.z){s=true;for(var _=0;_<r[u].numVertices;_++){n[c++]=o.x;n[c++]=o.y;n[c++]=o.z}}}}if(s)i.invalidateBuffer()};r.prototype.processPositionAndRotation=function(t,e,i){var r=i.animationParticles;var n=i.vertexData;var s=false;var a=r.length;var o;var h;var u;var l;if(this._smooth){u=this._prePos.subtract(this._targetPos);u.scaleBy(1/e);l=this._preEuler.subtract(this._targetEuler);l.scaleBy(1/e)}else{o=this._targetPos;h=this._targetEuler}for(var p=0;p<a;p++){var c=(t-r[p].startTime)/r[p].totalTime;var _=(c-Math.floor(c))*r[p].totalTime;if(_-e<=0){var f=r[p].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth){this._temp.copyFrom(u);this._temp.scaleBy(_);o=this._targetPos.add(this._temp);this._temp.copyFrom(l);this._temp.scaleBy(_);h=this._targetEuler.add(this._temp)}if(n[f]!=o.x||n[f+1]!=o.y||n[f+2]!=o.z||n[f+3]!=h.x||n[f+4]!=h.y||n[f+5]!=h.z){s=true;for(var d=0;d<r[p].numVertices;d++){n[f++]=o.x;n[f++]=o.y;n[f++]=o.z;n[f++]=h.x;n[f++]=h.y;n[f++]=h.z}}}}if(s)i.invalidateBuffer()};return r}(Jr);cn.FOLLOW_POSITION_INDEX=0;cn.FOLLOW_ROTATION_INDEX=1;var _n=function(t){e(i,t);function i(e,i,r){if(e===void 0){e=true}if(i===void 0){i=true}if(r===void 0){r=false}var n=t.call(this,"ParticleFollow",Xr.LOCAL_DYNAMIC,e&&i?6:3,ln.POST_PRIORITY)||this;n._pStateClass=cn;n._iUsesPosition=e;n._iUsesRotation=i;n._iSmooth=r;return n}i.prototype.getAGALVertexCode=function(t,e,i,r){var n="";if(this._iUsesRotation){var s=i.getFreeVertexAttribute();r.setRegisterIndex(this,cn.FOLLOW_ROTATION_INDEX,s.index);var a=i.getFreeVertexVectorTemp();i.addVertexTempUsages(a,1);var o=i.getFreeVertexVectorTemp();i.addVertexTempUsages(o,1);var h=i.getFreeVertexVectorTemp();var u;if(e.hasBillboard){i.addVertexTempUsages(h,1);u=i.getFreeVertexVectorTemp()}i.removeVertexTempUsage(a);i.removeVertexTempUsage(o);if(e.hasBillboard)i.removeVertexTempUsage(h);var l=r.rotationRegisters.length;var p;n+="mov "+a+","+r.vertexZeroConst+"\n";n+="mov "+a+".x,"+r.vertexOneConst+"\n";n+="mov "+h+","+r.vertexZeroConst+"\n";n+="sin "+h+".y,"+s+".x\n";n+="cos "+h+".z,"+s+".x\n";n+="mov "+o+".x,"+r.vertexZeroConst+"\n";n+="mov "+o+".y,"+h+".z\n";n+="neg "+o+".z,"+h+".y\n";if(e.hasBillboard)n+="m33 "+u+".xyz,"+r.positionTarget+".xyz,"+a+"\n";else{n+="m33 "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+a+"\n";for(p=0;p<l;p++)n+="m33 "+r.rotationRegisters[p]+".xyz,"+r.rotationRegisters[p]+","+a+"\n"}n+="mov "+a+","+r.vertexZeroConst+"\n";n+="cos "+a+".x,"+s+".y\n";n+="sin "+a+".z,"+s+".y\n";n+="mov "+o+","+r.vertexZeroConst+"\n";n+="mov "+o+".y,"+r.vertexOneConst+"\n";n+="mov "+h+","+r.vertexZeroConst+"\n";n+="neg "+h+".x,"+a+".z\n";n+="mov "+h+".z,"+a+".x\n";if(e.hasBillboard)n+="m33 "+u+".xyz,"+u+".xyz,"+a+"\n";else{n+="m33 "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+a+"\n";for(p=0;p<l;p++)n+="m33 "+r.rotationRegisters[p]+".xyz,"+r.rotationRegisters[p]+","+a+"\n"}n+="mov "+o+","+r.vertexZeroConst+"\n";n+="sin "+o+".x,"+s+".z\n";n+="cos "+o+".y,"+s+".z\n";n+="mov "+a+","+r.vertexZeroConst+"\n";n+="mov "+a+".x,"+o+".y\n";n+="neg "+a+".y,"+o+".x\n";n+="mov "+h+","+r.vertexZeroConst+"\n";n+="mov "+h+".z,"+r.vertexOneConst+"\n";if(e.hasBillboard){n+="m33 "+u+".xyz,"+u+".xyz,"+a+"\n";n+="sub "+u+".xyz,"+u+".xyz,"+r.positionTarget+".xyz\n";n+="add "+r.scaleAndRotateTarget+".xyz,"+u+".xyz,"+r.scaleAndRotateTarget+".xyz\n"}else{n+="m33 "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+a+"\n";for(p=0;p<l;p++)n+="m33 "+r.rotationRegisters[p]+".xyz,"+r.rotationRegisters[p]+","+a+"\n"}}if(this._iUsesPosition){var c=i.getFreeVertexAttribute();r.setRegisterIndex(this,cn.FOLLOW_POSITION_INDEX,c.index);n+="add "+r.scaleAndRotateTarget+".xyz,"+c+","+r.scaleAndRotateTarget+".xyz\n"}return n};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};return i}(tn);var fn=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._particleInitialColorNode=e;r._usesMultiplier=e._iUsesMultiplier;r._usesOffset=e._iUsesOffset;r._initialColor=e._iInitialColor;r.updateColorData();return r}Object.defineProperty(r.prototype,"initialColor",{get:function(){return this._initialColor},set:function(t){this._initialColor=t},enumerable:true,configurable:true});r.prototype.setRenderState=function(e,i,n,s,a,o){if(e.usesFragmentAnimation){var h;if(this._particleInitialColorNode.mode==Xr.LOCAL_STATIC){var u=this._particleInitialColorNode._iDataOffset;if(this._usesMultiplier){n.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,r.MULTIPLIER_INDEX),u,o,t.ContextGLVertexBufferFormat.FLOAT_4);u+=4}if(this._usesOffset)n.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,r.OFFSET_INDEX),u,o,t.ContextGLVertexBufferFormat.FLOAT_4)}else{if(this._usesMultiplier)e.setVertexConst(s.getRegisterIndex(this._pAnimationNode,r.MULTIPLIER_INDEX),this._multiplierData.x,this._multiplierData.y,this._multiplierData.z,this._multiplierData.w);if(this._usesOffset)e.setVertexConst(s.getRegisterIndex(this._pAnimationNode,r.OFFSET_INDEX),this._offsetData.x,this._offsetData.y,this._offsetData.z,this._offsetData.w)}}};r.prototype.updateColorData=function(){if(this._particleInitialColorNode.mode==Xr.GLOBAL){if(this._usesMultiplier)this._multiplierData=new A(this._initialColor.redMultiplier,this._initialColor.greenMultiplier,this._initialColor.blueMultiplier,this._initialColor.alphaMultiplier);if(this._usesOffset)this._offsetData=new A(this._initialColor.redOffset/255,this._initialColor.greenOffset/255,this._initialColor.blueOffset/255,this._initialColor.alphaOffset/255)}};return r}(Jr);fn.MULTIPLIER_INDEX=0;fn.OFFSET_INDEX=1;var dn=function(t){e(i,t);function i(e,i,r,n){if(i===void 0){i=true}if(r===void 0){r=false}if(n===void 0){n=null}var s=t.call(this,"ParticleInitialColor",e,i&&r?8:4,ln.COLOR_PRIORITY)||this;s._pStateClass=fn;s._iUsesMultiplier=i;s._iUsesOffset=r;s._iInitialColor=n||new C;return s}i.prototype.getAGALVertexCode=function(t,e,i,r){
var n="";if(t.usesFragmentAnimation){if(this._iUsesMultiplier){var s=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,fn.MULTIPLIER_INDEX,s.index);n+="mul "+r.colorMulTarget+","+s+","+r.colorMulTarget+"\n"}if(this._iUsesOffset){var a=this._pMode==Xr.LOCAL_STATIC?i.getFreeVertexAttribute():i.getFreeVertexConstant();r.setRegisterIndex(this,fn.OFFSET_INDEX,a.index);n+="add "+r.colorAddTarget+","+a+","+r.colorAddTarget+"\n"}}return n};i.prototype._iProcessAnimationSetting=function(t){if(this._iUsesMultiplier)t.hasColorMulNode=true;if(this._iUsesOffset)t.hasColorAddNode=true};i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.COLOR_INITIAL_COLORTRANSFORM];if(!e)throw new Error("there is no "+i.COLOR_INITIAL_COLORTRANSFORM+" in param!");var r=0;if(this._iUsesMultiplier){this._pOneData[r++]=e.redMultiplier;this._pOneData[r++]=e.greenMultiplier;this._pOneData[r++]=e.blueMultiplier;this._pOneData[r++]=e.alphaMultiplier}if(this._iUsesOffset){this._pOneData[r++]=e.redOffset/255;this._pOneData[r++]=e.greenOffset/255;this._pOneData[r++]=e.blueOffset/255;this._pOneData[r++]=e.alphaOffset/255}};return i}(tn);dn.COLOR_INITIAL_COLORTRANSFORM="ColorInitialColorTransform";var gn=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._particleOrbitNode=e;r._usesEulers=r._particleOrbitNode._iUsesEulers;r._usesCycle=r._particleOrbitNode._iUsesCycle;r._usesPhase=r._particleOrbitNode._iUsesPhase;r._eulers=r._particleOrbitNode._iEulers;r._radius=r._particleOrbitNode._iRadius;r._cycleDuration=r._particleOrbitNode._iCycleDuration;r._cyclePhase=r._particleOrbitNode._iCyclePhase;r.updateOrbitData();return r}Object.defineProperty(r.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t;this.updateOrbitData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t;this.updateOrbitData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t;this.updateOrbitData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"eulers",{get:function(){return this._eulers},set:function(t){this._eulers=t;this.updateOrbitData()},enumerable:true,configurable:true});r.prototype.setRenderState=function(e,i,n,s,a,o){var h=s.getRegisterIndex(this._pAnimationNode,r.ORBIT_INDEX);if(this._particleOrbitNode.mode==Xr.LOCAL_STATIC){if(this._usesPhase)n.activateVertexBuffer(h,this._particleOrbitNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_4);else n.activateVertexBuffer(h,this._particleOrbitNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_3)}else e.setVertexConst(h,this._orbitData.x,this._orbitData.y,this._orbitData.z,this._orbitData.w);if(this._usesEulers)e.setVertexConstFromMatrix(s.getRegisterIndex(this._pAnimationNode,r.EULERS_INDEX),this._eulersMatrix)};r.prototype.updateOrbitData=function(){if(this._usesEulers){this._eulersMatrix=new M;this._eulersMatrix.appendRotation(this._eulers.x,A.X_AXIS);this._eulersMatrix.appendRotation(this._eulers.y,A.Y_AXIS);this._eulersMatrix.appendRotation(this._eulers.z,A.Z_AXIS)}if(this._particleOrbitNode.mode==Xr.GLOBAL){this._orbitData=new A(this._radius,0,this._radius*Math.PI*2,this._cyclePhase*Math.PI/180);if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._orbitData.y=Math.PI*2/this._cycleDuration}else this._orbitData.y=Math.PI*2}};return r}(Jr);gn.ORBIT_INDEX=0;gn.EULERS_INDEX=1;var mn=function(t){e(i,t);function i(e,i,r,n,s,a,o,h){if(i===void 0){i=true}if(r===void 0){r=false}if(n===void 0){n=false}if(s===void 0){s=100}if(a===void 0){a=1}if(o===void 0){o=0}if(h===void 0){h=null}var u;var l=3;if(n)l++;u=t.call(this,"ParticleOrbit",e,l)||this;u._pStateClass=gn;u._iUsesEulers=i;u._iUsesCycle=r;u._iUsesPhase=n;u._iRadius=s;u._iCycleDuration=a;u._iCyclePhase=o;u._iEulers=h||new A;return u}i.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,gn.ORBIT_INDEX,n.index);var s=i.getFreeVertexConstant();r.setRegisterIndex(this,gn.EULERS_INDEX,s.index);i.getFreeVertexConstant();i.getFreeVertexConstant();i.getFreeVertexConstant();var a=i.getFreeVertexVectorTemp();i.addVertexTempUsages(a,1);var o=new fi(a.regName,a.index);var h=i.getFreeVertexVectorTemp();var u=new fi(h.regName,h.index,0);var l=new fi(h.regName,h.index,1);var p=new fi(h.regName,h.index,2);i.removeVertexTempUsage(a);var c="";if(this._iUsesCycle){c+="mul "+p+","+r.vertexTime+","+n+".y\n";if(this._iUsesPhase)c+="add "+p+","+p+","+n+".w\n"}else c+="mul "+p+","+r.vertexLife+","+n+".y\n";c+="cos "+u+","+p+"\n";c+="sin "+l+","+p+"\n";c+="mul "+o+".x,"+u+","+n+".x\n";c+="mul "+o+".y,"+l+","+n+".x\n";c+="mov "+o+".wz"+r.vertexZeroConst+"\n";if(this._iUsesEulers)c+="m44 "+o+","+o+","+s+"\n";c+="add "+r.positionTarget+".xyz,"+o+".xyz,"+r.positionTarget+".xyz\n";if(e.needVelocity){c+="neg "+o+".x,"+l+"\n";c+="mov "+o+".y,"+u+"\n";c+="mov "+o+".zw,"+r.vertexZeroConst+"\n";if(this._iUsesEulers)c+="m44 "+o+","+o+","+s+"\n";c+="mul "+o+","+o+","+n+".z\n";c+="div "+o+","+o+","+n+".y\n";if(!this._iUsesCycle)c+="div "+o+","+o+","+r.vertexLife+"\n";c+="add "+r.velocityTarget+".xyz,"+r.velocityTarget+".xyz,"+o+".xyz\n"}return c};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.ORBIT_VECTOR3D];if(!e)throw new Error("there is no "+i.ORBIT_VECTOR3D+" in param!");this._pOneData[0]=e.x;if(this._iUsesCycle&&e.y<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[1]=Math.PI*2/(!this._iUsesCycle?1:e.y);this._pOneData[2]=e.x*Math.PI*2;if(this._iUsesPhase)this._pOneData[3]=e.z*Math.PI/180};return i}(tn);mn.ORBIT_VECTOR3D="OrbitVector3D";var yn=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._particleOscillatorNode=e;r._oscillator=r._particleOscillatorNode._iOscillator;r.updateOscillatorData();return r}Object.defineProperty(r.prototype,"oscillator",{get:function(){return this._oscillator},set:function(t){this._oscillator=t;this.updateOscillatorData()},enumerable:true,configurable:true});r.prototype.setRenderState=function(e,i,n,s,a,o){var h=s.getRegisterIndex(this._pAnimationNode,r.OSCILLATOR_INDEX);if(this._particleOscillatorNode.mode==Xr.LOCAL_STATIC)n.activateVertexBuffer(h,this._particleOscillatorNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_4);else e.setVertexConst(h,this._oscillatorData.x,this._oscillatorData.y,this._oscillatorData.z,this._oscillatorData.w)};r.prototype.updateOscillatorData=function(){if(this._particleOscillatorNode.mode==Xr.GLOBAL){if(this._oscillator.w<=0)throw new Error("the cycle duration must greater than zero");if(this._oscillatorData==null)this._oscillatorData=new A;this._oscillatorData.x=this._oscillator.x;this._oscillatorData.y=this._oscillator.y;this._oscillatorData.z=this._oscillator.z;this._oscillatorData.w=Math.PI*2/this._oscillator.w}};return r}(Jr);yn.OSCILLATOR_INDEX=0;var vn=function(t){e(i,t);function i(e,i){if(i===void 0){i=null}var r=t.call(this,"ParticleOscillator",e,4)||this;r._pStateClass=yn;r._iOscillator=i||new A;return r}i.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,yn.OSCILLATOR_INDEX,n.index);var s=i.getFreeVertexVectorTemp();var a=new fi(s.regName,s.index,0);var o=new fi(s.regName,s.index,1);var h=new fi(s.regName,s.index,2);i.addVertexTempUsages(s,1);var u=i.getFreeVertexVectorTemp();var l=new fi(u.regName,u.index);i.removeVertexTempUsage(s);var p="";p+="mul "+a+","+r.vertexTime+","+n+".w\n";p+="sin "+o+","+a+"\n";p+="mul "+l+".xyz,"+o+","+n+".xyz\n";p+="add "+r.positionTarget+".xyz,"+l+".xyz,"+r.positionTarget+".xyz\n";if(e.needVelocity){p+="cos "+h+","+a+"\n";p+="mul "+l+".xyz,"+h+","+n+".xyz\n";p+="add "+r.velocityTarget+".xyz,"+l+".xyz,"+r.velocityTarget+".xyz\n"}return p};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.OSCILLATOR_VECTOR3D];if(!e)throw new Error("there is no "+i.OSCILLATOR_VECTOR3D+" in param!");this._pOneData[0]=e.x;this._pOneData[1]=e.y;this._pOneData[2]=e.z;if(e.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=Math.PI*2/e.w};return i}(tn);vn.OSCILLATOR_VECTOR3D="OscillatorVector3D";var xn=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._particlePositionNode=e;r._position=r._particlePositionNode._iPosition;return r}Object.defineProperty(r.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:true,configurable:true});r.prototype.getPositions=function(){return this._pDynamicProperties};r.prototype.setPositions=function(t){this._pDynamicProperties=t;this._pDynamicPropertiesDirty=new Object};r.prototype.setRenderState=function(e,i,n,s,a,o){if(this._particlePositionNode.mode==Xr.LOCAL_DYNAMIC&&!this._pDynamicPropertiesDirty[n._iUniqueId])this._pUpdateDynamicProperties(n);var h=s.getRegisterIndex(this._pAnimationNode,r.POSITION_INDEX);if(this._particlePositionNode.mode==Xr.GLOBAL)e.setVertexConst(h,this._position.x,this._position.y,this._position.z);else n.activateVertexBuffer(h,this._particlePositionNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_3)};return r}(Jr);xn.POSITION_INDEX=0;var bn=function(t){e(i,t);function i(e,i){if(i===void 0){i=null}var r=t.call(this,"ParticlePosition",e,3)||this;r._pStateClass=xn;r._iPosition=i||new A;return r}i.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,xn.POSITION_INDEX,n.index);return"add "+r.positionTarget+".xyz,"+n+".xyz,"+r.positionTarget+".xyz\n"};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.POSITION_VECTOR3D];if(!e)throw new Error("there is no "+i.POSITION_VECTOR3D+" in param!");this._pOneData[0]=e.x;this._pOneData[1]=e.y;this._pOneData[2]=e.z};return i}(tn);bn.POSITION_VECTOR3D="PositionVector3D";var wn=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._matrix=new M;return r}i.prototype.setRenderState=function(t,e,r,n,s,a){if(this._pParticleAnimator.animationSet.hasBillboard){this._matrix.copyFrom(e.sourceEntity.transform.concatenatedMatrix3D);this._matrix.append(s.transform.inverseConcatenatedMatrix3D);t.setVertexConstFromMatrix(n.getRegisterIndex(this._pAnimationNode,i.MATRIX_INDEX),this._matrix)}};return i}(Jr);wn.MATRIX_INDEX=0;var Dn=function(t){e(i,t);function i(){var e=t.call(this,"ParticleRotateToHeading",Xr.GLOBAL,0,3)||this;e._pStateClass=wn;return e}i.prototype.getAGALVertexCode=function(t,e,i,r){var n="";var s=r.rotationRegisters.length;var a;if(e.hasBillboard){var o=i.getFreeVertexVectorTemp();i.addVertexTempUsages(o,1);var h=i.getFreeVertexVectorTemp();i.addVertexTempUsages(h,1);var u=i.getFreeVertexVectorTemp();var l=i.getFreeVertexConstant();r.setRegisterIndex(this,wn.MATRIX_INDEX,l.index);i.getFreeVertexConstant();i.getFreeVertexConstant();i.getFreeVertexConstant();i.removeVertexTempUsage(o);i.removeVertexTempUsage(h);n+="m33 "+o+".xyz,"+r.velocityTarget+".xyz,"+l+"\n";n+="mov "+u+","+r.vertexZeroConst+"\n";n+="mov "+u+".xy,"+o+".xy\n";n+="nrm "+u+".xyz,"+u+".xyz\n";n+="mov "+h+","+r.vertexZeroConst+"\n";n+="mov "+h+".x,"+u+".y\n";n+="mov "+h+".y,"+u+".x\n";n+="mov "+o+","+r.vertexZeroConst+"\n";n+="mov "+o+".x,"+u+".x\n";n+="neg "+o+".y,"+u+".y\n";n+="mov "+u+","+r.vertexZeroConst+"\n";n+="mov "+u+".z,"+r.vertexOneConst+"\n";n+="m33 "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+o+"\n";for(a=0;a<s;a++)n+="m33 "+r.rotationRegisters[a]+".xyz,"+r.rotationRegisters[a]+","+o+"\n"}else{var p=i.getFreeVertexVectorTemp();i.addVertexTempUsages(p,1);var c=i.getFreeVertexVectorTemp();i.addVertexTempUsages(c,1);var _=i.getFreeVertexVectorTemp();i.addVertexTempUsages(_,1);var f=i.getFreeVertexVectorTemp();var d=new fi(_.regName,_.index,3);var g=new fi(f.regName,f.index,3);var m=new fi(p.regName,p.index,3);var y=g;i.removeVertexTempUsage(p);i.removeVertexTempUsage(c);i.removeVertexTempUsage(_);n+="mov "+c+".x,"+r.vertexOneConst+"\n";n+="mov "+c+".yz,"+r.vertexZeroConst+"\n";n+="nrm "+p+".xyz,"+r.velocityTarget+".xyz\n";n+="dp3 "+m+","+p+".xyz,"+c+".xyz\n";n+="crs "+p+".xyz,"+c+".xyz,"+p+".xyz\n";n+="nrm "+p+".xyz,"+p+".xyz\n";n+="dp3 "+_+".x,"+p+".xyz,"+p+".xyz\n";n+="sge "+_+".x,"+r.vertexZeroConst+","+_+".x\n";n+="add "+p+".z,"+_+".x,"+p+".z\n";n+="add "+y+","+m+","+r.vertexOneConst+"\n";n+="div "+y+","+y+","+r.vertexTwoConst+"\n";n+="sqt "+d+","+y+"\n";n+="sub "+y+","+r.vertexOneConst+","+m+"\n";n+="div "+y+","+y+","+r.vertexTwoConst+"\n";n+="sqt "+g+","+y+"\n";n+="mul "+_+".xyz,"+g+","+p+".xyz\n";n+="mul "+f+".xyz,"+g+","+p+".xyz\n";n+="neg "+f+".xyz,"+f+".xyz\n";n+="crs "+p+".xyz,"+_+".xyz,"+r.scaleAndRotateTarget+".xyz\n";n+="mul "+c+".xyz,"+d+","+r.scaleAndRotateTarget+".xyz\n";n+="add "+p+".xyz,"+p+".xyz,"+c+".xyz\n";n+="dp3 "+c+".w,"+_+".xyz,"+r.scaleAndRotateTarget+".xyz\n";n+="neg "+p+".w,"+c+".w\n";n+="crs "+_+".xyz,"+p+".xyz,"+f+".xyz\n";n+="mul "+c+".xyzw,"+p+".xyzw,"+d+"\n";n+="add "+_+".xyz,"+_+".xyz,"+c+".xyz\n";n+="mul "+c+".xyz,"+p+".w,"+f+".xyz\n";n+="add "+r.scaleAndRotateTarget+".xyz,"+_+".xyz,"+c+".xyz\n";for(a=0;a<s;a++){n+="mov "+c+".x,"+r.vertexOneConst+"\n";n+="mov "+c+".yz,"+r.vertexZeroConst+"\n";n+="nrm "+p+".xyz,"+r.velocityTarget+".xyz\n";n+="dp3 "+m+","+p+".xyz,"+c+".xyz\n";n+="crs "+p+".xyz,"+c+".xyz,"+p+".xyz\n";n+="nrm "+p+".xyz,"+p+".xyz\n";n+="dp3 "+_+".x,"+p+".xyz,"+p+".xyz\n";n+="sge "+_+".x,"+r.vertexZeroConst+","+_+".x\n";n+="add "+p+".z,"+_+".x,"+p+".z\n";n+="add "+y+","+m+","+r.vertexOneConst+"\n";n+="div "+y+","+y+","+r.vertexTwoConst+"\n";n+="sqt "+d+","+y+"\n";n+="sub "+y+","+r.vertexOneConst+","+m+"\n";n+="div "+y+","+y+","+r.vertexTwoConst+"\n";n+="sqt "+g+","+y+"\n";n+="mul "+_+".xyz,"+g+","+p+".xyz\n";n+="mul "+f+".xyz,"+g+","+p+".xyz\n";n+="neg "+f+".xyz,"+f+".xyz\n";n+="crs "+p+".xyz,"+_+".xyz,"+r.rotationRegisters[a]+".xyz\n";n+="mul "+c+".xyz,"+d+","+r.rotationRegisters[a]+".xyz\n";n+="add "+p+".xyz,"+p+".xyz,"+c+".xyz\n";n+="dp3 "+c+".w,"+_+".xyz,"+r.rotationRegisters[a]+".xyz\n";n+="neg "+p+".w,"+c+".w\n";n+="crs "+_+".xyz,"+p+".xyz,"+f+".xyz\n";n+="mul "+c+".xyzw,"+p+".xyzw,"+d+"\n";n+="add "+_+".xyz,"+_+".xyz,"+c+".xyz\n";n+="mul "+c+".xyz,"+p+".w,"+f+".xyz\n";n+="add "+r.rotationRegisters[a]+".xyz,"+_+".xyz,"+c+".xyz\n"}}return n};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iProcessAnimationSetting=function(t){t.needVelocity=true};return i}(tn);var Cn=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._matrix=new M;r._particleRotateToPositionNode=e;r._position=r._particleRotateToPositionNode._iPosition;return r}Object.defineProperty(r.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:true,configurable:true});r.prototype.setRenderState=function(e,i,n,s,a,o){var h=s.getRegisterIndex(this._pAnimationNode,r.POSITION_INDEX);if(this._pParticleAnimator.animationSet.hasBillboard){this._matrix.copyFrom(i.sourceEntity.transform.concatenatedMatrix3D);this._matrix.append(a.transform.inverseConcatenatedMatrix3D);e.setVertexConstFromMatrix(s.getRegisterIndex(this._pAnimationNode,r.MATRIX_INDEX),this._matrix)}if(this._particleRotateToPositionNode.mode==Xr.GLOBAL){this._offset=i.sourceEntity.transform.inverseConcatenatedMatrix3D.transformVector(this._position);e.setVertexConst(h,this._offset.x,this._offset.y,this._offset.z)}else n.activateVertexBuffer(h,this._particleRotateToPositionNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_3)};return r}(Jr);Cn.MATRIX_INDEX=0;Cn.POSITION_INDEX=1;var An=function(t){e(i,t);function i(e,i){if(i===void 0){i=null}var r=t.call(this,"ParticleRotateToPosition",e,3,3)||this;r._pStateClass=Cn;r._iPosition=i||new A;return r}i.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,Cn.POSITION_INDEX,n.index);var s="";var a=r.rotationRegisters.length;var o;if(e.hasBillboard){var h=i.getFreeVertexVectorTemp();i.addVertexTempUsages(h,1);var u=i.getFreeVertexVectorTemp();i.addVertexTempUsages(u,1);var l=i.getFreeVertexVectorTemp();var p=i.getFreeVertexConstant();r.setRegisterIndex(this,Cn.MATRIX_INDEX,p.index);i.getFreeVertexConstant();i.getFreeVertexConstant();i.getFreeVertexConstant();i.removeVertexTempUsage(h);i.removeVertexTempUsage(u);s+="sub "+h+".xyz,"+n+".xyz,"+r.positionTarget+".xyz\n";s+="m33 "+h+".xyz,"+h+".xyz,"+p+"\n";s+="mov "+l+","+r.vertexZeroConst+"\n";s+="mov "+l+".xy,"+h+".xy\n";s+="nrm "+l+".xyz,"+l+".xyz\n";s+="mov "+u+","+r.vertexZeroConst+"\n";s+="mov "+u+".x,"+l+".y\n";s+="mov "+u+".y,"+l+".x\n";s+="mov "+h+","+r.vertexZeroConst+"\n";s+="mov "+h+".x,"+l+".x\n";s+="neg "+h+".y,"+l+".y\n";s+="mov "+l+","+r.vertexZeroConst+"\n";s+="mov "+l+".z,"+r.vertexOneConst+"\n";s+="m33 "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+h+"\n";for(o=0;o<a;o++)s+="m33 "+r.rotationRegisters[o]+".xyz,"+r.rotationRegisters[o]+","+h+"\n"}else{var c=i.getFreeVertexVectorTemp();i.addVertexTempUsages(c,1);var _=i.getFreeVertexVectorTemp();i.addVertexTempUsages(_,1);var f=new fi(_.regName,_.index,0);var d=new fi(_.regName,_.index,1);var g=new fi(_.regName,_.index,2);var m=new fi(_.regName,_.index,3);var y=i.getFreeVertexVectorTemp();i.addVertexTempUsages(y,1);i.removeVertexTempUsage(c);i.removeVertexTempUsage(_);i.removeVertexTempUsage(y);s+="sub "+c+".xyz,"+n+".xyz,"+r.positionTarget+".xyz\n";s+="nrm "+c+".xyz,"+c+".xyz\n";s+="mov "+d+","+c+".y\n";s+="mul "+f+","+d+","+d+"\n";s+="sub "+f+","+r.vertexOneConst+","+f+"\n";s+="sqt "+f+","+f+"\n";s+="mul "+y+".x,"+f+","+r.scaleAndRotateTarget+".y\n";s+="mul "+y+".y,"+d+","+r.scaleAndRotateTarget+".z\n";s+="mul "+y+".z,"+d+","+r.scaleAndRotateTarget+".y\n";s+="mul "+y+".w,"+f+","+r.scaleAndRotateTarget+".z\n";s+="sub "+r.scaleAndRotateTarget+".y,"+y+".x,"+y+".y\n";s+="add "+r.scaleAndRotateTarget+".z,"+y+".z,"+y+".w\n";s+="abs "+y+".y,"+c+".y\n";s+="sge "+y+".z,"+y+".y,"+r.vertexOneConst+"\n";s+="mul "+y+".x,"+y+".y,"+c+".y\n";s+="mov "+c+".y,"+r.vertexZeroConst+"\n";s+="dp3 "+d+","+c+".xyz,"+c+".xyz\n";s+="sge "+m+","+r.vertexZeroConst+","+d+"\n";s+="mov "+c+".y,"+r.vertexZeroConst+"\n";s+="nrm "+c+".xyz,"+c+".xyz\n";s+="sub "+d+","+r.vertexOneConst+","+m+"\n";s+="mul "+d+","+d+","+c+".x\n";s+="mov "+f+","+c+".z\n";s+="neg "+f+","+f+"\n";s+="sub "+g+","+r.vertexOneConst+","+f+"\n";s+="mul "+g+","+y+".x,"+m+"\n";s+="add "+f+","+f+","+g+"\n";s+="mul "+y+".x,"+f+","+r.scaleAndRotateTarget+".x\n";s+="mul "+y+".y,"+d+","+r.scaleAndRotateTarget+".z\n";s+="mul "+y+".z,"+d+","+r.scaleAndRotateTarget+".x\n";s+="mul "+y+".w,"+f+","+r.scaleAndRotateTarget+".z\n";s+="sub "+r.scaleAndRotateTarget+".x,"+y+".x,"+y+".y\n";s+="add "+r.scaleAndRotateTarget+".z,"+y+".z,"+y+".w\n";for(o=0;o<a;o++){s+="sub "+c+".xyz,"+n+".xyz,"+r.positionTarget+".xyz\n";s+="nrm "+c+".xyz,"+c+".xyz\n";s+="mov "+d+","+c+".y\n";s+="mul "+f+","+d+","+d+"\n";s+="sub "+f+","+r.vertexOneConst+","+f+"\n";s+="sqt "+f+","+f+"\n";s+="mul "+y+".x,"+f+","+r.rotationRegisters[o]+".y\n";s+="mul "+y+".y,"+d+","+r.rotationRegisters[o]+".z\n";s+="mul "+y+".z,"+d+","+r.rotationRegisters[o]+".y\n";s+="mul "+y+".w,"+f+","+r.rotationRegisters[o]+".z\n";s+="sub "+r.rotationRegisters[o]+".y,"+y+".x,"+y+".y\n";s+="add "+r.rotationRegisters[o]+".z,"+y+".z,"+y+".w\n";s+="abs "+y+".y,"+c+".y\n";s+="sge "+y+".z,"+y+".y,"+r.vertexOneConst+"\n";s+="mul "+y+".x,"+y+".y,"+c+".y\n";s+="mov "+c+".y,"+r.vertexZeroConst+"\n";s+="dp3 "+d+","+c+".xyz,"+c+".xyz\n";s+="sge "+m+","+r.vertexZeroConst+","+d+"\n";s+="mov "+c+".y,"+r.vertexZeroConst+"\n";s+="nrm "+c+".xyz,"+c+".xyz\n";s+="sub "+d+","+r.vertexOneConst+","+m+"\n";s+="mul "+d+","+d+","+c+".x\n";s+="mov "+f+","+c+".z\n";s+="neg "+f+","+f+"\n";s+="sub "+g+","+r.vertexOneConst+","+f+"\n";s+="mul "+g+","+y+".x,"+m+"\n";s+="add "+f+","+f+","+g+"\n";s+="mul "+y+".x,"+f+","+r.rotationRegisters[o]+".x\n";s+="mul "+y+".y,"+d+","+r.rotationRegisters[o]+".z\n";s+="mul "+y+".z,"+d+","+r.rotationRegisters[o]+".x\n";s+="mul "+y+".w,"+f+","+r.rotationRegisters[o]+".z\n";s+="sub "+r.rotationRegisters[o]+".x,"+y+".x,"+y+".y\n";s+="add "+r.rotationRegisters[o]+".z,"+y+".z,"+y+".w\n"}}return s};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.POSITION_VECTOR3D];if(!e)throw new Error("there is no "+i.POSITION_VECTOR3D+" in param!");this._pOneData[0]=e.x;this._pOneData[1]=e.y;this._pOneData[2]=e.z};return i}(tn);An.POSITION_VECTOR3D="RotateToPositionVector3D";var Tn=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._particleRotationalVelocityNode=e;r._rotationalVelocity=r._particleRotationalVelocityNode._iRotationalVelocity;r.updateRotationalVelocityData();return r}Object.defineProperty(r.prototype,"rotationalVelocity",{get:function(){return this._rotationalVelocity},set:function(t){this._rotationalVelocity=t;this.updateRotationalVelocityData()},enumerable:true,configurable:true});r.prototype.getRotationalVelocities=function(){return this._pDynamicProperties};r.prototype.setRotationalVelocities=function(t){this._pDynamicProperties=t;this._pDynamicPropertiesDirty=new Object};r.prototype.setRenderState=function(e,i,n,s,a,o){if(this._particleRotationalVelocityNode.mode==Xr.LOCAL_DYNAMIC&&!this._pDynamicPropertiesDirty[n._iUniqueId])this._pUpdateDynamicProperties(n);var h=s.getRegisterIndex(this._pAnimationNode,r.ROTATIONALVELOCITY_INDEX);if(this._particleRotationalVelocityNode.mode==Xr.GLOBAL)e.setVertexConst(h,this._rotationalVelocityData.x,this._rotationalVelocityData.y,this._rotationalVelocityData.z,this._rotationalVelocityData.w);else n.activateVertexBuffer(h,this._particleRotationalVelocityNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_4)};r.prototype.updateRotationalVelocityData=function(){if(this._particleRotationalVelocityNode.mode==Xr.GLOBAL){if(this._rotationalVelocity.w<=0)throw new Error("the cycle duration must greater than zero");var t=this._rotationalVelocity.clone();if(t.length<=0)t.z=1;else t.normalize();this._rotationalVelocityData=new A(t.x,t.y,t.z,Math.PI/t.w)}};return r}(Jr);Tn.ROTATIONALVELOCITY_INDEX=0;var Pn=function(t){e(i,t);function i(e,i){if(i===void 0){i=null}var r=t.call(this,"ParticleRotationalVelocity",e,4)||this;r._pStateClass=Tn;r._iRotationalVelocity=i||new A;return r}i.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,Tn.ROTATIONALVELOCITY_INDEX,n.index);var s=i.getFreeVertexVectorTemp();i.addVertexTempUsages(s,1);var a=i.getFreeVertexVectorTemp();i.addVertexTempUsages(a,1);var o=i.getFreeVertexVectorTemp();i.addVertexTempUsages(o,1);var h=new fi(o.regName,o.index);var u=i.getFreeVertexVectorTemp();u=new fi(u.regName,u.index);var l=new fi(h.regName,h.index,3);var p=new fi(u.regName,u.index,3);i.removeVertexTempUsage(s);i.removeVertexTempUsage(a);i.removeVertexTempUsage(o);var c="";c+="mov "+s+".xyz,"+n+".xyz\n";c+="mov "+s+".w,"+r.vertexZeroConst+"\n";c+="mul "+l+","+r.vertexTime+","+n+".w\n";c+="sin "+p+","+l+"\n";c+="cos "+l+","+l+"\n";c+="mul "+h+".xyz,"+p+","+s+".xyz\n";c+="mul "+u+".xyz,"+p+","+s+".xyz\n";c+="neg "+u+".xyz,"+u+".xyz\n";c+="crs "+s+".xyz,"+h+".xyz,"+r.scaleAndRotateTarget+".xyz\n";c+="mul "+a+".xyz,"+l+","+r.scaleAndRotateTarget+".xyz\n";c+="add "+s+".xyz,"+s+".xyz,"+a+".xyz\n";c+="dp3 "+a+".w,"+h+".xyz,"+r.scaleAndRotateTarget+".xyz\n";c+="neg "+s+".w,"+a+".w\n";c+="crs "+h+".xyz,"+s+".xyz,"+u+".xyz\n";c+="mul "+a+".xyzw,"+s+".xyzw,"+l+"\n";c+="add "+h+".xyz,"+h+".xyz,"+a+".xyz\n";c+="mul "+a+".xyz,"+s+".w,"+u+".xyz\n";c+="add "+r.scaleAndRotateTarget+".xyz,"+h+".xyz,"+a+".xyz\n";var _=r.rotationRegisters.length;for(var f=0;f<_;f++){c+="mov "+s+".xyz,"+n+".xyz\n";c+="mov "+s+".w,"+r.vertexZeroConst+"\n";c+="mul "+l+","+r.vertexTime+","+n+".w\n";c+="sin "+p+","+l+"\n";c+="cos "+l+","+l+"\n";c+="mul "+h+".xyz,"+p+","+s+".xyz\n";c+="mul "+u+".xyz,"+p+","+s+".xyz\n";c+="neg "+u+".xyz,"+u+".xyz\n";c+="crs "+s+".xyz,"+h+".xyz,"+r.rotationRegisters[f]+".xyz\n";c+="mul "+a+".xyz,"+l+","+r.rotationRegisters[f]+"\n";c+="add "+s+".xyz,"+s+".xyz,"+a+".xyz\n";c+="dp3 "+a+".w,"+h+".xyz,"+r.rotationRegisters[f]+"\n";c+="neg "+s+".w,"+a+".w\n";c+="crs "+h+".xyz,"+s+".xyz,"+u+".xyz\n";c+="mul "+a+".xyzw,"+s+".xyzw,"+l+"\n";c+="add "+h+".xyz,"+h+".xyz,"+a+".xyz\n";c+="mul "+a+".xyz,"+s+".w,"+u+".xyz\n";c+="add "+r.rotationRegisters[f]+","+h+".xyz,"+a+".xyz\n"}return c};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.ROTATIONALVELOCITY_VECTOR3D];if(!e)throw new Error("there is no "+i.ROTATIONALVELOCITY_VECTOR3D+" in param!");if(e.length<=0)e.z=1;else e.normalize();this._pOneData[0]=e.x;this._pOneData[1]=e.y;this._pOneData[2]=e.z;if(e.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=Math.PI/e.w};return i}(tn);Pn.ROTATIONALVELOCITY_VECTOR3D="RotationalVelocityVector3D";var Sn=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._particleScaleNode=e;r._usesCycle=r._particleScaleNode._iUsesCycle;r._usesPhase=r._particleScaleNode._iUsesPhase;r._minScale=r._particleScaleNode._iMinScale;r._maxScale=r._particleScaleNode._iMaxScale;r._cycleDuration=r._particleScaleNode._iCycleDuration;r._cyclePhase=r._particleScaleNode._iCyclePhase;r.updateScaleData();return r}Object.defineProperty(r.prototype,"minScale",{get:function(){return this._minScale},set:function(t){this._minScale=t;this.updateScaleData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"maxScale",{get:function(){return this._maxScale},set:function(t){this._maxScale=t;this.updateScaleData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t;this.updateScaleData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t;this.updateScaleData()},enumerable:true,configurable:true});r.prototype.setRenderState=function(e,i,n,s,a,o){var h=s.getRegisterIndex(this._pAnimationNode,r.SCALE_INDEX);if(this._particleScaleNode.mode==Xr.LOCAL_STATIC){if(this._usesCycle){if(this._usesPhase)n.activateVertexBuffer(h,this._particleScaleNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_4);else n.activateVertexBuffer(h,this._particleScaleNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_3)}else n.activateVertexBuffer(h,this._particleScaleNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_2)}else e.setVertexConst(h,this._scaleData.x,this._scaleData.y,this._scaleData.z,this._scaleData.w)};r.prototype.updateScaleData=function(){if(this._particleScaleNode.mode==Xr.GLOBAL){if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._scaleData=new A((this._minScale+this._maxScale)/2,Math.abs(this._minScale-this._maxScale)/2,Math.PI*2/this._cycleDuration,this._cyclePhase*Math.PI/180)}else this._scaleData=new A(this._minScale,this._maxScale-this._minScale,0,0)}};return r}(Jr);Sn.SCALE_INDEX=0;var En=function(t){e(i,t);function i(e,i,r,n,s,a,o){if(n===void 0){n=1}if(s===void 0){s=1}if(a===void 0){a=1}if(o===void 0){o=0}var h=t.call(this,"ParticleScale",e,i&&r?4:i||r?3:2,3)||this;h._pStateClass=Sn;h._iUsesCycle=i;h._iUsesPhase=r;h._iMinScale=n;h._iMaxScale=s;h._iCycleDuration=a;h._iCyclePhase=o;return h}i.prototype.getAGALVertexCode=function(t,e,i,r){var n="";var s=i.getFreeVertexSingleTemp();var a=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,Sn.SCALE_INDEX,a.index);if(this._iUsesCycle){n+="mul "+s+","+r.vertexTime+","+a+".z\n";if(this._iUsesPhase)n+="add "+s+","+s+","+a+".w\n";n+="sin "+s+","+s+"\n"}n+="mul "+s+","+a+".y,"+(this._iUsesCycle?s:r.vertexLife)+"\n";n+="add "+s+","+a+".x,"+s+"\n";n+="mul "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+s+"\n";return n};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.SCALE_VECTOR3D];if(!e)throw new Error("there is no "+i.SCALE_VECTOR3D+" in param!");if(this._iUsesCycle){this._pOneData[0]=(e.x+e.y)/2;this._pOneData[1]=Math.abs(e.x-e.y)/2;if(e.z<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[2]=Math.PI*2/e.z;if(this._iUsesPhase)this._pOneData[3]=e.w*Math.PI/180}else{this._pOneData[0]=e.x;this._pOneData[1]=e.y-e.x}};return i}(tn);En.SCALE_VECTOR3D="ScaleVector3D";var Mn=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._usesMultiplier=i._iUsesMultiplier;r._usesOffset=i._iUsesOffset;r._startColor=i._iStartColor;r._endColor=i._iEndColor;r._segmentPoints=i._iSegmentPoints;r._numSegmentPoint=i._iNumSegmentPoint;r.updateColorData();return r}Object.defineProperty(i.prototype,"startColor",{get:function(){return this._startColor},set:function(t){this._startColor=t;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"endColor",{get:function(){return this._endColor},set:function(t){this._endColor=t;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numSegmentPoint",{get:function(){return this._numSegmentPoint},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentPoints",{get:function(){return this._segmentPoints},set:function(t){this._segmentPoints=t;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"usesMultiplier",{get:function(){return this._usesMultiplier},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"usesOffset",{get:function(){return this._usesOffset},enumerable:true,configurable:true});i.prototype.setRenderState=function(t,e,r,n,s,a){if(t.usesFragmentAnimation){if(this._numSegmentPoint>0)t.setVertexConst(n.getRegisterIndex(this._pAnimationNode,i.TIME_DATA_INDEX),this._timeLifeData[0],this._timeLifeData[1],this._timeLifeData[2],this._timeLifeData[3]);if(this._usesMultiplier)t.setVertexConstFromArray(n.getRegisterIndex(this._pAnimationNode,i.START_MULTIPLIER_INDEX),this._multiplierData);if(this._usesOffset)t.setVertexConstFromArray(n.getRegisterIndex(this._pAnimationNode,i.START_OFFSET_INDEX),this._offsetData)}};i.prototype.updateColorData=function(){this._timeLifeData=new Float32Array(4);this._multiplierData=new Float32Array(4*(this._numSegmentPoint+1));this._offsetData=new Float32Array(4*(this._numSegmentPoint+1));var t;var e=0;var i=this._numSegmentPoint>3?3:this._numSegmentPoint;for(t=0;t<i;t++){if(t==0)this._timeLifeData[e++]=this._segmentPoints[t].life;else this._timeLifeData[e++]=this._segmentPoints[t].life-this._segmentPoints[t-1].life}t=i;if(this._numSegmentPoint==0)this._timeLifeData[e++]=1;else this._timeLifeData[e++]=1-this._segmentPoints[t-1].life;if(this._usesMultiplier){e=0;this._multiplierData[e++]=this._startColor.redMultiplier;this._multiplierData[e++]=this._startColor.greenMultiplier;this._multiplierData[e++]=this._startColor.blueMultiplier;this._multiplierData[e++]=this._startColor.alphaMultiplier;for(t=0;t<this._numSegmentPoint;t++){if(t==0){this._multiplierData[e++]=(this._segmentPoints[t].color.redMultiplier-this._startColor.redMultiplier)/this._timeLifeData[t];this._multiplierData[e++]=(this._segmentPoints[t].color.greenMultiplier-this._startColor.greenMultiplier)/this._timeLifeData[t];

this._multiplierData[e++]=(this._segmentPoints[t].color.blueMultiplier-this._startColor.blueMultiplier)/this._timeLifeData[t];this._multiplierData[e++]=(this._segmentPoints[t].color.alphaMultiplier-this._startColor.alphaMultiplier)/this._timeLifeData[t]}else{this._multiplierData[e++]=(this._segmentPoints[t].color.redMultiplier-this._segmentPoints[t-1].color.redMultiplier)/this._timeLifeData[t];this._multiplierData[e++]=(this._segmentPoints[t].color.greenMultiplier-this._segmentPoints[t-1].color.greenMultiplier)/this._timeLifeData[t];this._multiplierData[e++]=(this._segmentPoints[t].color.blueMultiplier-this._segmentPoints[t-1].color.blueMultiplier)/this._timeLifeData[t];this._multiplierData[e++]=(this._segmentPoints[t].color.alphaMultiplier-this._segmentPoints[t-1].color.alphaMultiplier)/this._timeLifeData[t]}}t=this._numSegmentPoint;if(this._numSegmentPoint==0){this._multiplierData[e++]=this._endColor.redMultiplier-this._startColor.redMultiplier;this._multiplierData[e++]=this._endColor.greenMultiplier-this._startColor.greenMultiplier;this._multiplierData[e++]=this._endColor.blueMultiplier-this._startColor.blueMultiplier;this._multiplierData[e++]=this._endColor.alphaMultiplier-this._startColor.alphaMultiplier}else{this._multiplierData[e++]=(this._endColor.redMultiplier-this._segmentPoints[t-1].color.redMultiplier)/this._timeLifeData[t];this._multiplierData[e++]=(this._endColor.greenMultiplier-this._segmentPoints[t-1].color.greenMultiplier)/this._timeLifeData[t];this._multiplierData[e++]=(this._endColor.blueMultiplier-this._segmentPoints[t-1].color.blueMultiplier)/this._timeLifeData[t];this._multiplierData[e++]=(this._endColor.alphaMultiplier-this._segmentPoints[t-1].color.alphaMultiplier)/this._timeLifeData[t]}}if(this._usesOffset){e=0;this._offsetData[e++]=this._startColor.redOffset/255;this._offsetData[e++]=this._startColor.greenOffset/255;this._offsetData[e++]=this._startColor.blueOffset/255;this._offsetData[e++]=this._startColor.alphaOffset/255;for(t=0;t<this._numSegmentPoint;t++){if(t==0){this._offsetData[e++]=(this._segmentPoints[t].color.redOffset-this._startColor.redOffset)/this._timeLifeData[t]/255;this._offsetData[e++]=(this._segmentPoints[t].color.greenOffset-this._startColor.greenOffset)/this._timeLifeData[t]/255;this._offsetData[e++]=(this._segmentPoints[t].color.blueOffset-this._startColor.blueOffset)/this._timeLifeData[t]/255;this._offsetData[e++]=(this._segmentPoints[t].color.alphaOffset-this._startColor.alphaOffset)/this._timeLifeData[t]/255}else{this._offsetData[e++]=(this._segmentPoints[t].color.redOffset-this._segmentPoints[t-1].color.redOffset)/this._timeLifeData[t]/255;this._offsetData[e++]=(this._segmentPoints[t].color.greenOffset-this._segmentPoints[t-1].color.greenOffset)/this._timeLifeData[t]/255;this._offsetData[e++]=(this._segmentPoints[t].color.blueOffset-this._segmentPoints[t-1].color.blueOffset)/this._timeLifeData[t]/255;this._offsetData[e++]=(this._segmentPoints[t].color.alphaOffset-this._segmentPoints[t-1].color.alphaOffset)/this._timeLifeData[t]/255}}t=this._numSegmentPoint;if(this._numSegmentPoint==0){this._offsetData[e++]=(this._endColor.redOffset-this._startColor.redOffset)/255;this._offsetData[e++]=(this._endColor.greenOffset-this._startColor.greenOffset)/255;this._offsetData[e++]=(this._endColor.blueOffset-this._startColor.blueOffset)/255;this._offsetData[e++]=(this._endColor.alphaOffset-this._startColor.alphaOffset)/255}else{this._offsetData[t]=(this._endColor.redOffset-this._segmentPoints[t-1].color.redOffset)/this._timeLifeData[t]/255;this._offsetData[e++]=(this._endColor.greenOffset-this._segmentPoints[t-1].color.greenOffset)/this._timeLifeData[t]/255;this._offsetData[e++]=(this._endColor.blueOffset-this._segmentPoints[t-1].color.blueOffset)/this._timeLifeData[t]/255;this._offsetData[e++]=(this._endColor.alphaOffset-this._segmentPoints[t-1].color.alphaOffset)/this._timeLifeData[t]/255}}};return i}(Jr);Mn.START_MULTIPLIER_INDEX=0;Mn.START_OFFSET_INDEX=1;Mn.TIME_DATA_INDEX=2;var On=function(t){e(i,t);function i(e,i,r,n,s,a){var o=t.call(this,"ParticleSegmentedColor",Xr.GLOBAL,0,ln.COLOR_PRIORITY)||this;o._pStateClass=Mn;if(r>4)throw new Error("the numSegmentPoint must be less or equal 4");o._iUsesMultiplier=e;o._iUsesOffset=i;o._iNumSegmentPoint=r;o._iStartColor=n;o._iEndColor=s;o._iSegmentPoints=a;return o}i.prototype._iProcessAnimationSetting=function(t){if(this._iUsesMultiplier)t.hasColorMulNode=true;if(this._iUsesOffset)t.hasColorAddNode=true};i.prototype.getAGALVertexCode=function(t,e,i,r){var n="";if(t.usesFragmentAnimation){var s;if(this._iUsesMultiplier){s=i.getFreeVertexVectorTemp();i.addVertexTempUsages(s,1)}var a=i.getFreeVertexVectorTemp();i.addVertexTempUsages(a,1);var o=i.getFreeVertexVectorTemp();var h=new fi(o.regName,o.index,0);var u=new fi(o.regName,o.index,1);if(this._iUsesMultiplier)i.removeVertexTempUsage(s);i.removeVertexTempUsage(a);var l=i.getFreeVertexConstant();r.setRegisterIndex(this,Mn.TIME_DATA_INDEX,l.index);var p;var c;var _;if(this._iUsesMultiplier){c=i.getFreeVertexConstant();r.setRegisterIndex(this,Mn.START_MULTIPLIER_INDEX,c.index);_=new Array;for(p=0;p<this._iNumSegmentPoint+1;p++)_.push(i.getFreeVertexConstant())}var f;var d;if(this._iUsesOffset){f=i.getFreeVertexConstant();r.setRegisterIndex(this,Mn.START_OFFSET_INDEX,f.index);d=new Array;for(p=0;p<this._iNumSegmentPoint+1;p++)d.push(i.getFreeVertexConstant())}if(this._iUsesMultiplier)n+="mov "+s+","+c+"\n";if(this._iUsesOffset)n+="add "+r.colorAddTarget+","+r.colorAddTarget+","+f+"\n";for(p=0;p<this._iNumSegmentPoint;p++){switch(p){case 0:n+="min "+u+","+r.vertexLife+","+l+".x\n";break;case 1:n+="sub "+h+","+r.vertexLife+","+l+".x\n";n+="max "+u+","+h+","+r.vertexZeroConst+"\n";n+="min "+u+","+u+","+l+".y\n";break;case 2:n+="sub "+h+","+h+","+l+".y\n";n+="max "+u+","+h+","+r.vertexZeroConst+"\n";n+="min "+u+","+u+","+l+".z\n";break;case 3:n+="sub "+h+","+h+","+l+".z\n";n+="max "+u+","+h+","+r.vertexZeroConst+"\n";n+="min "+u+","+u+","+l+".w\n";break}if(this._iUsesMultiplier){n+="mul "+a+","+u+","+_[p]+"\n";n+="add "+s+","+s+","+a+"\n"}if(this._iUsesOffset){n+="mul "+a+","+u+","+d[p]+"\n";n+="add "+r.colorAddTarget+","+r.colorAddTarget+","+a+"\n"}}if(this._iNumSegmentPoint==0)u=r.vertexLife;else{switch(this._iNumSegmentPoint){case 1:n+="sub "+h+","+r.vertexLife+","+l+".x\n";break;case 2:n+="sub "+h+","+h+","+l+".y\n";break;case 3:n+="sub "+h+","+h+","+l+".z\n";break;case 4:n+="sub "+h+","+h+","+l+".w\n";break}n+="max "+u+","+h+","+r.vertexZeroConst+"\n"}if(this._iUsesMultiplier){n+="mul "+a+","+u+","+_[this._iNumSegmentPoint]+"\n";n+="add "+s+","+s+","+a+"\n";n+="mul "+r.colorMulTarget+","+r.colorMulTarget+","+s+"\n"}if(this._iUsesOffset){n+="mul "+a+","+u+","+d[this._iNumSegmentPoint]+"\n";n+="add "+r.colorAddTarget+","+r.colorAddTarget+","+a+"\n"}}return n};return i}(tn);var In=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._particleSpriteSheetNode=e;r._usesCycle=r._particleSpriteSheetNode._iUsesCycle;r._usesPhase=r._particleSpriteSheetNode._iUsesCycle;r._totalFrames=r._particleSpriteSheetNode._iTotalFrames;r._numColumns=r._particleSpriteSheetNode._iNumColumns;r._numRows=r._particleSpriteSheetNode._iNumRows;r._cycleDuration=r._particleSpriteSheetNode._iCycleDuration;r._cyclePhase=r._particleSpriteSheetNode._iCyclePhase;r.updateSpriteSheetData();return r}Object.defineProperty(r.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t;this.updateSpriteSheetData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t;this.updateSpriteSheetData()},enumerable:true,configurable:true});r.prototype.setRenderState=function(e,i,n,s,a,o){if(!e.usesUVTransform){e.setVertexConst(s.getRegisterIndex(this._pAnimationNode,r.UV_INDEX_0),this._spriteSheetData[0],this._spriteSheetData[1],this._spriteSheetData[2],this._spriteSheetData[3]);if(this._usesCycle){var h=s.getRegisterIndex(this._pAnimationNode,r.UV_INDEX_1);if(this._particleSpriteSheetNode.mode==Xr.LOCAL_STATIC){if(this._usesPhase)n.activateVertexBuffer(h,this._particleSpriteSheetNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_3);else n.activateVertexBuffer(h,this._particleSpriteSheetNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_2)}else e.setVertexConst(h,this._spriteSheetData[4],this._spriteSheetData[5])}}};r.prototype.updateSpriteSheetData=function(){this._spriteSheetData=new Array(8);var t=this._totalFrames/this._numColumns;this._spriteSheetData[0]=t;this._spriteSheetData[1]=1/this._numColumns;this._spriteSheetData[2]=1/this._numRows;if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._spriteSheetData[4]=t/this._cycleDuration;this._spriteSheetData[5]=this._cycleDuration;if(this._usesPhase)this._spriteSheetData[6]=this._cyclePhase}};return r}(Jr);In.UV_INDEX_0=0;In.UV_INDEX_1=1;var Rn=function(t){e(i,t);function i(e,i,r,n,s,a,o,h){if(n===void 0){n=1}if(s===void 0){s=1}if(a===void 0){a=1}if(o===void 0){o=0}if(h===void 0){h=Number.MAX_VALUE}var u=t.call(this,"ParticleSpriteSheet",e,i?r?3:2:1,ln.POST_PRIORITY+1)||this;u._pStateClass=In;u._iUsesCycle=i;u._iUsesPhase=r;u._iNumColumns=n;u._iNumRows=s;u._iCyclePhase=o;u._iCycleDuration=a;u._iTotalFrames=Math.min(h,n*s);return u}Object.defineProperty(i.prototype,"numColumns",{get:function(){return this._iNumColumns},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numRows",{get:function(){return this._iNumRows},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"totalFrames",{get:function(){return this._iTotalFrames},enumerable:true,configurable:true});i.prototype.getAGALUVCode=function(t,e,i,r){var n=i.getFreeVertexConstant();var s=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,In.UV_INDEX_0,n.index);r.setRegisterIndex(this,In.UV_INDEX_1,s.index);var a=new fi(n.regName,n.index,0);var o=new fi(n.regName,n.index,1);var h=new fi(n.regName,n.index,2);var u=new fi(s.regName,s.index,0);var l=new fi(s.regName,s.index,1);var p=new fi(s.regName,s.index,2);var c=i.getFreeVertexVectorTemp();var _=new fi(c.regName,c.index,0);var f=new fi(c.regName,c.index,1);c=new fi(c.regName,c.index,2);var d=new fi(c.regName,c.index,3);var g=new fi(r.uvTarget.regName,r.uvTarget.index,0);var m=new fi(r.uvTarget.regName,r.uvTarget.index,1);var y="";y+="mul "+g+","+g+","+o+"\n";if(this._iNumRows>1)y+="mul "+m+","+m+","+h+"\n";if(this._iUsesCycle){if(this._iUsesPhase)y+="add "+_+","+r.vertexTime+","+p+"\n";else y+="mov "+_+","+r.vertexTime+"\n";y+="div "+_+","+_+","+l+"\n";y+="frc "+_+","+_+"\n";y+="mul "+_+","+_+","+l+"\n";y+="mul "+c+","+_+","+u+"\n"}else y+="mul "+c.toString()+","+r.vertexLife+","+a+"\n";if(this._iNumRows>1){y+="frc "+d+","+c+"\n";y+="sub "+f+","+c+","+d+"\n";y+="mul "+f+","+f+","+h+"\n";y+="add "+m+","+m+","+f+"\n"}y+="div "+d+","+c+","+o+"\n";y+="frc "+c+","+d+"\n";y+="sub "+d+","+d+","+c+"\n";y+="mul "+c+","+d+","+o+"\n";if(this._iNumRows>1)y+="frc "+c+","+c+"\n";y+="add "+g+","+g+","+c+"\n";return y};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iProcessAnimationSetting=function(t){t.hasUVNode=true};i.prototype._iGeneratePropertyOfOneParticle=function(t){if(this._iUsesCycle){var e=t[i.UV_VECTOR3D];if(!e)throw new Error("there is no "+i.UV_VECTOR3D+" in param!");if(e.x<=0)throw new Error("the cycle duration must be greater than zero");var r=this._iTotalFrames/this._iNumColumns;this._pOneData[0]=r/e.x;this._pOneData[1]=e.x;if(this._iUsesPhase)this._pOneData[2]=e.y}};return i}(tn);Rn.UV_VECTOR3D="UVVector3D";var Ln=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._particleUVNode=i;return r}i.prototype.setRenderState=function(t,e,r,n,s,a){if(!t.usesUVTransform){var o=n.getRegisterIndex(this._pAnimationNode,i.UV_INDEX);var h=this._particleUVNode._iUvData;t.setVertexConst(o,h.x,h.y)}};return i}(Jr);Ln.UV_INDEX=0;var Nn=function(t){e(i,t);function i(e,i,r,n){if(i===void 0){i=1}if(r===void 0){r=1}if(n===void 0){n="x"}var s=t.call(this,"ParticleUV",Xr.GLOBAL,4,ln.POST_PRIORITY+1)||this;s._pStateClass=Ln;s._cycle=i;s._scale=r;s._axis=n;s.updateUVData();return s}Object.defineProperty(i.prototype,"cycle",{get:function(){return this._cycle},set:function(t){this._cycle=t;this.updateUVData()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t;this.updateUVData()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"axis",{get:function(){return this._axis},set:function(t){this._axis=t},enumerable:true,configurable:true});i.prototype.getAGALUVCode=function(t,e,i,r){var n="";var s=i.getFreeVertexConstant();r.setRegisterIndex(this,Ln.UV_INDEX,s.index);var a=this._axis=="x"?0:this._axis=="y"?1:2;var o=new fi(r.uvTarget.regName,r.uvTarget.index,a);var h=i.getFreeVertexSingleTemp();if(this._scale!=1)n+="mul "+o+","+o+","+s+".y\n";n+="mul "+h+","+r.vertexTime+","+s+".x\n";n+="sin "+h+","+h+"\n";n+="add "+o+","+o+","+h+"\n";return n};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype.updateUVData=function(){this._iUvData=new A(Math.PI*2/this._cycle,this._scale,0,0)};i.prototype._iProcessAnimationSetting=function(t){t.hasUVNode=true};return i}(tn);Nn.U_AXIS="x";Nn.V_AXIS="y";var Fn=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._particleVelocityNode=e;r._velocity=r._particleVelocityNode._iVelocity;return r}Object.defineProperty(r.prototype,"velocity",{get:function(){return this._velocity},set:function(t){this._velocity=t},enumerable:true,configurable:true});r.prototype.getVelocities=function(){return this._pDynamicProperties};r.prototype.setVelocities=function(t){this._pDynamicProperties=t;this._pDynamicPropertiesDirty=new Object};r.prototype.setRenderState=function(e,i,n,s,a,o){if(this._particleVelocityNode.mode==Xr.LOCAL_DYNAMIC&&!this._pDynamicPropertiesDirty[n._iUniqueId])this._pUpdateDynamicProperties(n);var h=s.getRegisterIndex(this._pAnimationNode,r.VELOCITY_INDEX);if(this._particleVelocityNode.mode==Xr.GLOBAL)e.setVertexConst(h,this._velocity.x,this._velocity.y,this._velocity.z);else n.activateVertexBuffer(h,this._particleVelocityNode._iDataOffset,o,t.ContextGLVertexBufferFormat.FLOAT_3)};return r}(Jr);Fn.VELOCITY_INDEX=0;var Bn=function(t){e(i,t);function i(e,i){if(i===void 0){i=null}var r=t.call(this,"ParticleVelocity",e,3)||this;r._pStateClass=Fn;r._iVelocity=i||new A;return r}i.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==Xr.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,Fn.VELOCITY_INDEX,n.index);var s=i.getFreeVertexVectorTemp();var a="";a+="mul "+s+","+r.vertexTime+","+n+"\n";a+="add "+r.positionTarget+".xyz,"+s+","+r.positionTarget+".xyz\n";if(e.needVelocity)a+="add "+r.velocityTarget+".xyz,"+n+".xyz,"+r.velocityTarget+".xyz\n";return a};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._iGeneratePropertyOfOneParticle=function(t){var e=t[i.VELOCITY_VECTOR3D];if(!e)throw new Error("there is no "+i.VELOCITY_VECTOR3D+" in param!");this._pOneData[0]=e.x;this._pOneData[1]=e.y;this._pOneData[2]=e.z};return i}(tn);Bn.VELOCITY_VECTOR3D="VelocityVector3D";var Vn=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._blendWeight=0;r._skeletonPose=new qr;r._skeletonPoseDirty=true;r._skeletonAnimationNode=i;r._inputA=e.getAnimationState(r._skeletonAnimationNode.inputA);r._inputB=e.getAnimationState(r._skeletonAnimationNode.inputB);return r}Object.defineProperty(i.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(t){this._blendWeight=t;this._pPositionDeltaDirty=true;this._skeletonPoseDirty=true},enumerable:true,configurable:true});i.prototype.phase=function(t){this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;this._inputA.phase(t);this._inputB.phase(t)};i.prototype._pUpdateTime=function(e){this._skeletonPoseDirty=true;this._inputA.update(e);this._inputB.update(e);t.prototype._pUpdateTime.call(this,e)};i.prototype.getSkeletonPose=function(t){if(this._skeletonPoseDirty)this.updateSkeletonPose(t);return this._skeletonPose};i.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;var t=this._inputA.positionDelta;var e=this._inputB.positionDelta;this._pRootDelta.x=t.x+this._blendWeight*(e.x-t.x);this._pRootDelta.y=t.y+this._blendWeight*(e.y-t.y);this._pRootDelta.z=t.z+this._blendWeight*(e.z-t.z)};i.prototype.updateSkeletonPose=function(t){this._skeletonPoseDirty=false;var e;var i=this._skeletonPose.jointPoses;var r=this._inputA.getSkeletonPose(t).jointPoses;var n=this._inputB.getSkeletonPose(t).jointPoses;var s,a;var o,h;var u;var l=t.numJoints;if(i.length!=l)i.length=l;for(var p=0;p<l;++p){e=i[p];if(e==null)e=i[p]=new jr;s=r[p];a=n[p];o=s.translation;h=a.translation;e.orientation.lerp(s.orientation,a.orientation,this._blendWeight);u=e.translation;u.x=o.x+this._blendWeight*(h.x-o.x);u.y=o.y+this._blendWeight*(h.y-o.y);u.z=o.z+this._blendWeight*(h.z-o.z)}};return i}(Qr);var Un=function(t){e(i,t);function i(){var e=t.call(this)||this;e._pStateClass=Vn;return e}i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};return i}(Vt);var kn=function(t){e(i,t);function i(e,i,r,n){var s=t.call(this,e)||this;s._animator=i;s._animationState=r;s._animationNode=n;return s}Object.defineProperty(i.prototype,"animator",{get:function(){return this._animator},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animationState",{get:function(){return this._animationState},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animationNode",{get:function(){return this._animationNode},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._animator,this._animationState,this._animationNode)};return i}(n);kn.PLAYBACK_COMPLETE="playbackComplete";kn.TRANSITION_COMPLETE="transitionComplete";var zn=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._pFramesDirty=true;r._animationClipNode=i;return r}Object.defineProperty(i.prototype,"blendWeight",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._pBlendWeight},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"currentFrame",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._pCurrentFrame},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"nextFrame",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._pNextFrame},enumerable:true,configurable:true});i.prototype.update=function(t){if(!this._animationClipNode.looping){if(t>this._pStartTime+this._animationClipNode.totalDuration)t=this._pStartTime+this._animationClipNode.totalDuration;else if(t<this._pStartTime)t=this._pStartTime}if(this._pTime==t-this._pStartTime)return;this._pUpdateTime(t)};i.prototype.phase=function(t){var e=t*this._animationClipNode.totalDuration+this._pStartTime;if(this._pTime==e-this._pStartTime)return;this._pUpdateTime(e)};i.prototype._pUpdateTime=function(e){this._pFramesDirty=true;this._pTimeDir=e-this._pStartTime>this._pTime?1:-1;t.prototype._pUpdateTime.call(this,e)};i.prototype._pUpdateFrames=function(){this._pFramesDirty=false;var t=this._animationClipNode.looping;var e=this._animationClipNode.totalDuration;var i=this._animationClipNode.lastFrame;var r=this._pTime;if(t&&(r>=e||r<0)){r%=e;if(r<0)r+=e}if(!t&&r>=e){this.notifyPlaybackComplete();this._pCurrentFrame=i;this._pNextFrame=i;this._pBlendWeight=0}else if(!t&&r<=0){this._pCurrentFrame=0;this._pNextFrame=0;this._pBlendWeight=0}else if(this._animationClipNode.fixedFrameRate){var n=r/e*i;this._pCurrentFrame=Math.floor(n);this._pBlendWeight=n-this._pCurrentFrame;this._pNextFrame=this._pCurrentFrame+1}else{this._pCurrentFrame=0;this._pNextFrame=0;var s=0,a;var o=this._animationClipNode.durations;do{a=s;s+=o[this._pNextFrame];this._pCurrentFrame=this._pNextFrame++}while(r>s);if(this._pCurrentFrame==i){this._pCurrentFrame=0;this._pNextFrame=1}this._pBlendWeight=(r-a)/o[this._pCurrentFrame]}};i.prototype.notifyPlaybackComplete=function(){if(this._animationStatePlaybackComplete==null)this._animationStatePlaybackComplete=new kn(kn.PLAYBACK_COMPLETE,this._pAnimator,this,this._animationClipNode);this._animationClipNode.dispatchEvent(this._animationStatePlaybackComplete)};return i}(Qr);var jn=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._rootPos=new A;r._skeletonPose=new qr;r._skeletonPoseDirty=true;r._skeletonClipNode=i;r._frames=r._skeletonClipNode.frames;return r}Object.defineProperty(i.prototype,"currentPose",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._currentPose},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"nextPose",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._nextPose},enumerable:true,configurable:true});i.prototype.getSkeletonPose=function(t){if(this._skeletonPoseDirty)this.updateSkeletonPose(t);return this._skeletonPose};i.prototype._pUpdateTime=function(e){this._skeletonPoseDirty=true;t.prototype._pUpdateTime.call(this,e)};i.prototype._pUpdateFrames=function(){t.prototype._pUpdateFrames.call(this);this._currentPose=this._frames[this._pCurrentFrame];if(this._skeletonClipNode.looping&&this._pNextFrame>=this._skeletonClipNode.lastFrame){this._nextPose=this._frames[0];this._pAnimator.dispatchCycleEvent()}else this._nextPose=this._frames[this._pNextFrame]};i.prototype.updateSkeletonPose=function(t){this._skeletonPoseDirty=false;if(!this._skeletonClipNode.totalDuration)return;if(this._pFramesDirty)this._pUpdateFrames();var e=this._currentPose.jointPoses;var i=this._nextPose.jointPoses;var r=t.numJoints;var n,s;var a,o;var h=this._skeletonPose.jointPoses;var u;var l;if(h.length!=r)h.length=r;if(r!=e.length||r!=i.length)throw new Error("joint counts don't match!");for(var p=0;p<r;++p){u=h[p];if(u==null)u=h[p]=new jr;a=e[p];o=i[p];n=a.translation;s=o.translation;if(this._skeletonClipNode.highQuality)u.orientation.slerp(a.orientation,o.orientation,this._pBlendWeight);else u.orientation.lerp(a.orientation,o.orientation,this._pBlendWeight);if(p>0){l=u.translation;l.x=n.x+this._pBlendWeight*(s.x-n.x);l.y=n.y+this._pBlendWeight*(s.y-n.y);l.z=n.z+this._pBlendWeight*(s.z-n.z)}}};i.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;if(this._pFramesDirty)this._pUpdateFrames();var t,e,i;var r=this._skeletonClipNode.totalDelta;if(this._pTimeDir>0&&this._pNextFrame<this._pOldFrame||this._pTimeDir<0&&this._pNextFrame>this._pOldFrame){this._rootPos.x-=r.x*this._pTimeDir;this._rootPos.y-=r.y*this._pTimeDir;this._rootPos.z-=r.z*this._pTimeDir}var n=this._rootPos.x;var s=this._rootPos.y;var a=this._rootPos.z;if(this._skeletonClipNode.stitchFinalFrame&&this._pNextFrame==this._skeletonClipNode.lastFrame){t=this._frames[0].jointPoses[0].translation;e=this._frames[1].jointPoses[0].translation;i=this._currentPose.jointPoses[0].translation;this._rootPos.x=i.x+t.x+this._pBlendWeight*(e.x-t.x);this._rootPos.y=i.y+t.y+this._pBlendWeight*(e.y-t.y);this._rootPos.z=i.z+t.z+this._pBlendWeight*(e.z-t.z)}else{t=this._currentPose.jointPoses[0].translation;e=this._frames[this._pNextFrame].jointPoses[0].translation;this._rootPos.x=t.x+this._pBlendWeight*(e.x-t.x);this._rootPos.y=t.y+this._pBlendWeight*(e.y-t.y);this._rootPos.z=t.z+this._pBlendWeight*(e.z-t.z)}this._pRootDelta.x=this._rootPos.x-n;this._pRootDelta.y=this._rootPos.y-s;this._pRootDelta.z=this._rootPos.z-a;this._pOldFrame=this._pNextFrame};return i}(zn);var Gn=function(t){e(i,t);function i(){var e=t.call(this)||this;e._frames=new Array;e.highQuality=false;e._pStateClass=jn;return e}Object.defineProperty(i.prototype,"frames",{get:function(){return this._frames},enumerable:true,configurable:true});i.prototype.addFrame=function(t,e){this._frames.push(t);this._pDurations.push(e);this._pNumFrames=this._pDurations.length;this._pStitchDirty=true};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};i.prototype._pUpdateStitch=function(){t.prototype._pUpdateStitch.call(this);var e=this._pNumFrames-1;var i,r,n;while(e--){this._pTotalDuration+=this._pDurations[e];i=this._frames[e].jointPoses[0].translation;r=this._frames[e+1].jointPoses[0].translation;n=r.subtract(i);this._pTotalDelta.x+=n.x;this._pTotalDelta.y+=n.y;this._pTotalDelta.z+=n.z}if(this._pStitchFinalFrame||!this._pLooping){this._pTotalDuration+=this._pDurations[this._pNumFrames-1];i=this._frames[0].jointPoses[0].translation;r=this._frames[1].jointPoses[0].translation;n=r.subtract(i);this._pTotalDelta.x+=n.x;this._pTotalDelta.y+=n.y;this._pTotalDelta.z+=n.z}};return i}(Zr);var Hn=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._blendWeight=0;r._skeletonPose=new qr;r._skeletonPoseDirty=true;r._skeletonAnimationNode=i;r._baseInput=e.getAnimationState(r._skeletonAnimationNode.baseInput);r._differenceInput=e.getAnimationState(r._skeletonAnimationNode.differenceInput);return r}Object.defineProperty(i.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(t){this._blendWeight=t;this._pPositionDeltaDirty=true;this._skeletonPoseDirty=true},enumerable:true,configurable:true});i.prototype.phase=function(t){this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;this._baseInput.phase(t);this._baseInput.phase(t)};i.prototype._pUpdateTime=function(e){this._skeletonPoseDirty=true;this._baseInput.update(e);this._differenceInput.update(e);t.prototype._pUpdateTime.call(this,e)};i.prototype.getSkeletonPose=function(t){if(this._skeletonPoseDirty)this.updateSkeletonPose(t);return this._skeletonPose};i.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;var t=this._baseInput.positionDelta;var e=this._differenceInput.positionDelta;this.positionDelta.x=t.x+this._blendWeight*e.x;this.positionDelta.y=t.y+this._blendWeight*e.y;this.positionDelta.z=t.z+this._blendWeight*e.z};i.prototype.updateSkeletonPose=function(t){this._skeletonPoseDirty=false;var e;var r=this._skeletonPose.jointPoses;var n=this._baseInput.getSkeletonPose(t).jointPoses;var s=this._differenceInput.getSkeletonPose(t).jointPoses;var a,o;var h,u;var l;var p=t.numJoints;if(r.length!=p)r.length=p;for(var c=0;c<p;++c){e=r[c];if(e==null)e=r[c]=new jr;a=n[c];o=s[c];h=a.translation;u=o.translation;i._tempQuat.multiply(o.orientation,a.orientation);e.orientation.lerp(a.orientation,i._tempQuat,this._blendWeight);l=e.translation;l.x=h.x+this._blendWeight*u.x;l.y=h.y+this._blendWeight*u.y;l.z=h.z+this._blendWeight*u.z}};return i}(Qr);Hn._tempQuat=new W;var Xn=function(t){e(i,t);function i(){var e=t.call(this)||this;e._pStateClass=Hn;return e}i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};return i}(Vt);var Wn=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._skeletonPose=new qr;r._skeletonPoseDirty=true;r._blendWeight=0;r._direction=0;r._blendDirty=true;r._skeletonAnimationNode=i;r._forward=e.getAnimationState(r._skeletonAnimationNode.forward);r._backward=e.getAnimationState(r._skeletonAnimationNode.backward);r._left=e.getAnimationState(r._skeletonAnimationNode.left);r._right=e.getAnimationState(r._skeletonAnimationNode.right);return r}Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},set:function(t){if(this._direction==t)return;this._direction=t;this._blendDirty=true;this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true},enumerable:true,configurable:true});i.prototype.phase=function(t){if(this._blendDirty)this.updateBlend();this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;this._inputA.phase(t);this._inputB.phase(t)};i.prototype._pUdateTime=function(e){if(this._blendDirty)this.updateBlend();this._skeletonPoseDirty=true;this._inputA.update(e);this._inputB.update(e);t.prototype._pUpdateTime.call(this,e)};i.prototype.getSkeletonPose=function(t){if(this._skeletonPoseDirty)this.updateSkeletonPose(t);return this._skeletonPose};i.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;if(this._blendDirty)this.updateBlend();var t=this._inputA.positionDelta;var e=this._inputB.positionDelta;this.positionDelta.x=t.x+this._blendWeight*(e.x-t.x);this.positionDelta.y=t.y+this._blendWeight*(e.y-t.y);this.positionDelta.z=t.z+this._blendWeight*(e.z-t.z)};i.prototype.updateSkeletonPose=function(t){this._skeletonPoseDirty=false;if(this._blendDirty)this.updateBlend();var e;var i=this._skeletonPose.jointPoses;var r=this._inputA.getSkeletonPose(t).jointPoses;var n=this._inputB.getSkeletonPose(t).jointPoses;var s,a;var o,h;var u;var l=t.numJoints;if(i.length!=l)i.length=l;for(var p=0;p<l;++p){e=i[p];if(e==null)e=i[p]=new jr;s=r[p];a=n[p];o=s.translation;h=a.translation;e.orientation.lerp(s.orientation,a.orientation,this._blendWeight);u=e.translation;u.x=o.x+this._blendWeight*(h.x-o.x);u.y=o.y+this._blendWeight*(h.y-o.y);u.z=o.z+this._blendWeight*(h.z-o.z)}};i.prototype.updateBlend=function(){this._blendDirty=false;if(this._direction<0||this._direction>360){this._direction%=360;if(this._direction<0)this._direction+=360}if(this._direction<90){this._inputA=this._forward;this._inputB=this._right;this._blendWeight=this._direction/90}else if(this._direction<180){this._inputA=this._right;this._inputB=this._backward;this._blendWeight=(this._direction-90)/90}else if(this._direction<270){this._inputA=this._backward;this._inputB=this._left;this._blendWeight=(this._direction-180)/90}else{this._inputA=this._left;this._inputB=this._forward;this._blendWeight=(this._direction-270)/90}};return i}(Qr);var Yn=function(t){e(i,t);function i(){var e=t.call(this)||this;e._pStateClass=Wn;return e}i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};return i}(Vt);var qn=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._skeletonPose=new qr;r._skeletonPoseDirty=true;r._blendWeights=new Array;r._inputs=new Array;r._skeletonAnimationNode=i;var n=r._skeletonAnimationNode.numInputs;while(n--)r._inputs[n]=e.getAnimationState(r._skeletonAnimationNode._iInputs[n]);return r}i.prototype.phase=function(t){this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;for(var e=0;e<this._skeletonAnimationNode.numInputs;++e){if(this._blendWeights[e])this._inputs[e].update(t)}};i.prototype._pUdateTime=function(e){for(var i=0;i<this._skeletonAnimationNode.numInputs;++i){if(this._blendWeights[i])this._inputs[i].update(e)}t.prototype._pUpdateTime.call(this,e)};i.prototype.getSkeletonPose=function(t){if(this._skeletonPoseDirty)this.updateSkeletonPose(t);return this._skeletonPose};i.prototype.getBlendWeightAt=function(t){return this._blendWeights[t]};i.prototype.setBlendWeightAt=function(t,e){this._blendWeights[t]=e;this._pPositionDeltaDirty=true;this._skeletonPoseDirty=true};i.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;var t;var e;this.positionDelta.x=0;this.positionDelta.y=0;this.positionDelta.z=0;for(var i=0;i<this._skeletonAnimationNode.numInputs;++i){e=this._blendWeights[i];if(e){t=this._inputs[i].positionDelta;this.positionDelta.x+=e*t.x;this.positionDelta.y+=e*t.y;this.positionDelta.z+=e*t.z}}};i.prototype.updateSkeletonPose=function(t){this._skeletonPoseDirty=false;var e;var i=this._skeletonPose.jointPoses;var r;var n,s;var a,o;var h,u;var l;var p;var c,_,f,d;var g,m,y,v;var x=t.numJoints;if(i.length!=x)i.length=x;for(var b=0;b<this._skeletonAnimationNode.numInputs;++b){e=this._blendWeights[b];if(!e)continue;r=this._inputs[b].getSkeletonPose(t).jointPoses;if(!l){l=r;for(p=0;p<x;++p){n=i[p];if(n==null)n=i[p]=new jr;s=r[p];u=s.orientation;o=s.translation;h=n.orientation;h.x=e*u.x;h.y=e*u.y;h.z=e*u.z;h.w=e*u.w;a=n.translation;a.x=e*o.x;a.y=e*o.y;a.z=e*o.z}}else{for(p=0;p<t.numJoints;++p){n=i[p];s=r[p];u=l[p].orientation;_=u.x;f=u.y;d=u.z;c=u.w;u=s.orientation;o=s.translation;m=u.x;

y=u.y;v=u.z;g=u.w;if(_*m+f*y+d*v+c*g<0){m=-m;y=-y;v=-v;g=-g}h=n.orientation;h.x+=e*m;h.y+=e*y;h.z+=e*v;h.w+=e*g;a=n.translation;a.x+=e*o.x;a.y+=e*o.y;a.z+=e*o.z}}}for(p=0;p<t.numJoints;++p)i[p].orientation.normalize()};return i}(Qr);var Kn=function(t){e(i,t);function i(){var e=t.call(this)||this;e._iInputs=new Array;e._pStateClass=qn;return e}Object.defineProperty(i.prototype,"numInputs",{get:function(){return this._numInputs},enumerable:true,configurable:true});i.prototype.getInputIndex=function(t){return this._iInputs.indexOf(t)};i.prototype.getInputAt=function(t){return this._iInputs[t]};i.prototype.addInput=function(t){this._iInputs[this._numInputs++]=t};i.prototype.getAnimationState=function(t){return t.getAnimationState(this)};return i}(Vt);var Zn=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._vertexClipNode=i;r._frames=r._vertexClipNode.frames;return r}Object.defineProperty(i.prototype,"currentGraphics",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._currentGraphics},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"nextGraphics",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._nextGraphics},enumerable:true,configurable:true});i.prototype._pUpdateFrames=function(){t.prototype._pUpdateFrames.call(this);this._currentGraphics=this._frames[this._pCurrentFrame];if(this._vertexClipNode.looping&&this._pNextFrame>=this._vertexClipNode.lastFrame){this._nextGraphics=this._frames[0];this._pAnimator.dispatchCycleEvent()}else this._nextGraphics=this._frames[this._pNextFrame]};i.prototype._pUpdatePositionDelta=function(){};return i}(zn);var Qn=function(t){e(i,t);function i(){var e=t.call(this)||this;e._frames=new Array;e._translations=new Array;e._pStateClass=Zn;return e}Object.defineProperty(i.prototype,"frames",{get:function(){return this._frames},enumerable:true,configurable:true});i.prototype.addFrame=function(t,e,i){if(i===void 0){i=null}this._frames.push(t);this._pDurations.push(e);this._translations.push(i||new A);this._pNumFrames=this._pDurations.length;this._pStitchDirty=true};i.prototype._pUpdateStitch=function(){t.prototype._pUpdateStitch.call(this);var e=this._pNumFrames-1;var i,r,n;while(e--){this._pTotalDuration+=this._pDurations[e];i=this._translations[e];r=this._translations[e+1];n=r.subtract(i);this._pTotalDelta.x+=n.x;this._pTotalDelta.y+=n.y;this._pTotalDelta.z+=n.z}if(this._pNumFrames>1&&(this._pStitchFinalFrame||!this._pLooping)){this._pTotalDuration+=this._pDurations[this._pNumFrames-1];i=this._translations[0];r=this._translations[1];n=r.subtract(i);this._pTotalDelta.x+=n.x;this._pTotalDelta.y+=n.y;this._pTotalDelta.z+=n.z}};return i}(Zr);var Jn=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._crossfadeTransitionNode=i;return r}i.prototype._pUpdateTime=function(e){this.blendWeight=Math.abs(e-this._crossfadeTransitionNode.startBlend)/(1e3*this._crossfadeTransitionNode.blendSpeed);if(this.blendWeight>=1){this.blendWeight=1;if(this._animationStateTransitionComplete==null)this._animationStateTransitionComplete=new kn(kn.TRANSITION_COMPLETE,this._pAnimator,this,this._crossfadeTransitionNode);this._crossfadeTransitionNode.dispatchEvent(this._animationStateTransitionComplete)}t.prototype._pUpdateTime.call(this,e)};return i}(Vn);var $n=function(t){e(i,t);function i(){var e=t.call(this)||this;e._pStateClass=Jn;return e}return i}(Un);var ts=function(){function t(t){this.blendSpeed=.5;this.blendSpeed=t}t.prototype.getAnimationNode=function(t,e,i,r){var n=new $n;n.inputA=e;n.inputB=i;n.blendSpeed=this.blendSpeed;n.startBlend=r;return n};return t}();var es=function(t){e(i,t);function i(e){var i=t.call(this,e)||this;i._animationParticleStates=new Array;i._animatorParticleStates=new Array;i._timeParticleStates=new Array;i._totalLenOfOneVertex=0;i._animatorSubGeometries=new Object;i._particleAnimationSet=e;var r;var n;for(var s=0;s<i._particleAnimationSet.particleNodes.length;s++){n=i._particleAnimationSet.particleNodes[s];r=i.getAnimationState(n);if(n.mode==Xr.LOCAL_DYNAMIC){i._animatorParticleStates.push(r);n._iDataOffset=i._totalLenOfOneVertex;i._totalLenOfOneVertex+=n.dataLength}else{i._animationParticleStates.push(r)}if(r.needUpdateTime)i._timeParticleStates.push(r)}return i}i.prototype.clone=function(){return new i(this._particleAnimationSet)};i.prototype.setRenderState=function(t,e,i,r){var n=this._particleAnimationSet._iAnimationRegisterData;var s=e.sourceEntity.graphics;var a=e.shape;if(!a)throw new Error("Must be shape");var o=this._particleAnimationSet.getAnimationElements(s,a);var h;for(h=0;h<this._animationParticleStates.length;h++)this._animationParticleStates[h].setRenderState(t,e,o,n,r,i);var u=this.getAnimatorElements(s,a);for(h=0;h<this._animatorParticleStates.length;h++)this._animatorParticleStates[h].setRenderState(t,e,u,n,r,i)};i.prototype.testGPUCompatibility=function(t){};i.prototype.start=function(){t.prototype.start.call(this);for(var e=0;e<this._timeParticleStates.length;e++)this._timeParticleStates[e].offset(this._pAbsoluteTime)};i.prototype._pUpdateDeltaTime=function(t){this._pAbsoluteTime+=t;for(var e=0;e<this._timeParticleStates.length;e++)this._timeParticleStates[e].update(this._pAbsoluteTime)};i.prototype.resetTime=function(t){if(t===void 0){t=0}for(var e=0;e<this._timeParticleStates.length;e++)this._timeParticleStates[e].offset(this._pAbsoluteTime+t);this.update(this.time)};i.prototype.dispose=function(){for(var t in this._animatorSubGeometries)this._animatorSubGeometries[t].dispose()};i.prototype.getAnimatorElements=function(t,e){if(!this._animatorParticleStates.length)return;var i=e.elements;var r=this._animatorSubGeometries[i.id]=new kr;r.createVertexData(i.numVertices,this._totalLenOfOneVertex);r.animationParticles=this._particleAnimationSet.getAnimationElements(t,e).animationParticles};return i}(vi);var is=function(t){e(i,t);function i(e){if(e===void 0){e=4}var i=t.call(this)||this;i._jointsPerVertex=e;return i}Object.defineProperty(i.prototype,"jointsPerVertex",{get:function(){return this._jointsPerVertex},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"matricesIndex",{get:function(){return this._matricesIndex},enumerable:true,configurable:true});i.prototype.getAGALVertexCode=function(t,e,i){this._matricesIndex=e.numUsedVertexConstants;var r=this._matricesIndex;var n=this._matricesIndex+1;var s=this._matricesIndex+2;var a=e.getFreeVertexAttribute();t.jointIndexIndex=a.index;var o=e.getFreeVertexAttribute();t.jointWeightIndex=o.index;var h=[a+".x",a+".y",a+".z",a+".w"];var u=[o+".x",o+".y",o+".z",o+".w"];var l=e.getFreeVertexVectorTemp();var p="dp4";var c="";var _=i.animatableAttributes.length;for(var f=0;f<_;++f){var d=i.animatableAttributes[f];var g=i.animationTargetRegisters[f];for(var m=0;m<this._jointsPerVertex;++m){e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();c+=p+" "+l+".x, "+d+", vc["+h[m]+"+"+r+"]\n"+p+" "+l+".y, "+d+", vc["+h[m]+"+"+n+"]\n"+p+" "+l+".z, "+d+", vc["+h[m]+"+"+s+"]\n"+"mov "+l+".w, "+d+".w\n"+"mul "+l+", "+l+", "+u[m]+"\n";if(m==0)c+="mov "+g+", "+l+"\n";else c+="add "+g+", "+g+", "+l+"\n"}p="dp3"}return c};i.prototype.getAGALFragmentCode=function(t,e,i){return""};i.prototype.getAGALUVCode=function(t,e,i){return"mov "+i.uvTarget+","+i.uvSource+"\n"};i.prototype.doneAGALCode=function(t){};return i}(mi);var rs=function(t){e(i,t);function i(e,i,r){if(r===void 0){r=false}var n=t.call(this,e)||this;n._globalPose=new qr;n._morphedElements=new Object;n._morphedElementsDirty=new Object;n._skeletonAnimationSet=e;n._skeleton=i;n._forceCPU=r;n._jointsPerVertex=e.jointsPerVertex;n._numJoints=n._skeleton.numJoints;n._globalMatrices=new Float32Array(n._numJoints*12);var s=0;for(var a=0;a<n._numJoints;++a){n._globalMatrices[s++]=1;n._globalMatrices[s++]=0;n._globalMatrices[s++]=0;n._globalMatrices[s++]=0;n._globalMatrices[s++]=0;n._globalMatrices[s++]=1;n._globalMatrices[s++]=0;n._globalMatrices[s++]=0;n._globalMatrices[s++]=0;n._globalMatrices[s++]=0;n._globalMatrices[s++]=1;n._globalMatrices[s++]=0}n._onTransitionCompleteDelegate=function(t){return n.onTransitionComplete(t)};n._onIndicesUpdateDelegate=function(t){return n.onIndicesUpdate(t)};n._onVerticesUpdateDelegate=function(t){return n.onVerticesUpdate(t)};return n}Object.defineProperty(i.prototype,"globalMatrices",{get:function(){if(this._globalPropertiesDirty)this.updateGlobalProperties();return this._globalMatrices},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"globalPose",{get:function(){if(this._globalPropertiesDirty)this.updateGlobalProperties();return this._globalPose},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._skeleton},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"forceCPU",{get:function(){return this._forceCPU},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"useCondensedIndices",{get:function(){return this._useCondensedIndices},set:function(t){this._useCondensedIndices=t},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this._skeletonAnimationSet,this._skeleton,this._forceCPU)};i.prototype.play=function(t,e,i){if(e===void 0){e=null}if(i===void 0){i=NaN}if(this._pActiveAnimationName==t)return;this._pActiveAnimationName=t;if(!this._pAnimationSet.hasAnimation(t))throw new Error("Animation root node "+t+" not found!");if(e&&this._pActiveNode){this._pActiveNode=e.getAnimationNode(this,this._pActiveNode,this._pAnimationSet.getAnimation(t),this._pAbsoluteTime);this._pActiveNode.addEventListener(kn.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate)}else this._pActiveNode=this._pAnimationSet.getAnimation(t);this._pActiveState=this.getAnimationState(this._pActiveNode);if(this.updatePosition){this._pActiveState.update(this._pAbsoluteTime);this._pActiveState.positionDelta}this._activeSkeletonState=this._pActiveState;this.start();if(!isNaN(i))this.reset(t,i)};i.prototype.setRenderState=function(t,e,i,r){if(this._globalPropertiesDirty)this.updateGlobalProperties();var n=e.shape.elements;n.useCondensedIndices=this._useCondensedIndices;if(this._useCondensedIndices){this.updateCondensedMatrices(n.condensedIndexLookUp);t.setVertexConstFromArray(this._skeletonAnimationSet.matricesIndex,this._condensedMatrices)}else{if(this._pAnimationSet.usesCPU){if(this._morphedElementsDirty[n.id])this.morphElements(e,n);return}t.setVertexConstFromArray(this._skeletonAnimationSet.matricesIndex,this._globalMatrices)}};i.prototype.testGPUCompatibility=function(t){if(!this._useCondensedIndices&&(this._forceCPU||this._jointsPerVertex>4||t.numUsedVertexConstants+this._numJoints*3>128))this._pAnimationSet.cancelGPUCompatibility()};i.prototype._pUpdateDeltaTime=function(e){t.prototype._pUpdateDeltaTime.call(this,e);this._globalPropertiesDirty=true;if(this._pAnimationSet.usesCPU)this.invalidateElements()};i.prototype.updateCondensedMatrices=function(t){var e=0,i=0;var r=t.length;var n;this._condensedMatrices=new Float32Array(r*12);for(var s=0;s<r;s++){n=t[s]*12;i=12;while(i--)this._condensedMatrices[e++]=this._globalMatrices[n++]}};i.prototype.updateGlobalProperties=function(){this._globalPropertiesDirty=false;this.localToGlobalPose(this._activeSkeletonState.getSkeletonPose(this._skeleton),this._globalPose,this._skeleton);var t=0;var e=this._globalPose.jointPoses;var i;var r,n,s,a;var o,h,u;var l,p,c;var _,f,d;var g,m,y;var v,x,b;var w,D,C,A;var T,P,S,E;var M,O,I,R;var L=this._skeleton.joints;var N;var F;var B;var V;for(var U=0;U<this._numJoints;++U){N=e[U];F=N.orientation;B=N.translation;r=F.x;n=F.y;s=F.z;a=F.w;o=(V=2*r)*n;h=V*s;u=V*a;l=(V=2*n)*s;p=V*a;c=2*s*a;l=2*n*s;p=2*n*a;c=2*s*a;r*=r;n*=n;s*=s;a*=a;_=(V=r-n)-s+a;f=o-c;d=h+p;g=o+c;m=-V-s+a;y=l-u;v=h-p;x=l+u;b=-r-n+s+a;i=L[U].inverseBindPose;w=i[0];D=i[4];C=i[8];A=i[12];T=i[1];P=i[5];S=i[9];E=i[13];M=i[2];O=i[6];I=i[10];R=i[14];this._globalMatrices[t]=_*w+f*T+d*M;this._globalMatrices[t+1]=_*D+f*P+d*O;this._globalMatrices[t+2]=_*C+f*S+d*I;this._globalMatrices[t+3]=_*A+f*E+d*R+B.x;this._globalMatrices[t+4]=g*w+m*T+y*M;this._globalMatrices[t+5]=g*D+m*P+y*O;this._globalMatrices[t+6]=g*C+m*S+y*I;this._globalMatrices[t+7]=g*A+m*E+y*R+B.y;this._globalMatrices[t+8]=v*w+x*T+b*M;this._globalMatrices[t+9]=v*D+x*P+b*O;this._globalMatrices[t+10]=v*C+x*S+b*I;this._globalMatrices[t+11]=v*A+x*E+b*R+B.z;t=t+12}};i.prototype.getRenderableElements=function(t,e){this._morphedElementsDirty[e.id]=true;if(!this._pAnimationSet.usesCPU)return e;var i;if(!(i=this._morphedElements[e.id])){e.normals;e.tangents;i=this._morphedElements[e.id]=e.clone();i.autoDeriveNormals=false;i.autoDeriveTangents=false;e.addEventListener(Qt.INVALIDATE_INDICES,this._onIndicesUpdateDelegate);e.addEventListener(Qt.INVALIDATE_VERTICES,this._onVerticesUpdateDelegate)}return i};i.prototype.morphElements=function(t,e){this._morphedElementsDirty[e.id]=false;var i=e.numVertices;var r=e.positions.get(i);var n=e.normals.get(i);var s=e.tangents.get(i);var a=e.positions.dimensions;var o=e.positions.stride;var h=e.normals.stride;var u=e.tangents.stride;var l=e.jointIndices.get(i);var p=e.jointWeights.get(i);var c=e.jointIndices.stride;var _=this._morphedElements[e.id];var f=_.positions.get(i);var d=_.normals.get(i);var g=_.tangents.get(i);_.positions.attributesBuffer.invalidate();_.normals.attributesBuffer.invalidate();_.tangents.attributesBuffer.invalidate();var m=0;var y=0;var v=0;var x=0;var b=0;var w;var D,C,A;var T,P,S;var E,M,O;var I;var R,L,N;var F,B,V;var U,k,z;var j,G,H,X;var W,Y,q,K;var Z,Q,J,$;while(m<i){y=m*o;R=r[y];L=r[y+1];N=a==3?r[y+2]:0;v=m*h;F=n[v];B=n[v+1];V=n[v+2];x=m*u;U=s[x];k=s[x+1];z=s[x+2];D=0;C=0;A=0;T=0;P=0;S=0;E=0;M=0;O=0;w=0;b=m*c;while(w<this._jointsPerVertex){I=p[b+w];if(I>0){var tt=l[b+w]<<2;j=this._globalMatrices[tt];G=this._globalMatrices[tt+1];H=this._globalMatrices[tt+2];X=this._globalMatrices[tt+3];W=this._globalMatrices[tt+4];Y=this._globalMatrices[tt+5];q=this._globalMatrices[tt+6];K=this._globalMatrices[tt+7];Z=this._globalMatrices[tt+8];Q=this._globalMatrices[tt+9];J=this._globalMatrices[tt+10];$=this._globalMatrices[tt+11];D+=I*(j*R+G*L+H*N+X);C+=I*(W*R+Y*L+q*N+K);A+=I*(Z*R+Q*L+J*N+$);T+=I*(j*F+G*B+H*V);P+=I*(W*F+Y*B+q*V);S+=I*(Z*F+Q*B+J*V);E+=I*(j*U+G*k+H*z);M+=I*(W*U+Y*k+q*z);O+=I*(Z*U+Q*k+J*z);w++}else{w=this._jointsPerVertex}}f[y]=D;f[y+1]=C;if(a==3)f[y+2]=A;d[v]=T;d[v+1]=P;d[v+2]=S;g[x]=E;g[x+1]=M;g[x+2]=O;m++}};i.prototype.localToGlobalPose=function(t,e,i){var r=e.jointPoses;var n;var s=i.joints;var a=t.numJointPoses;var o=t.jointPoses;var h;var u;var l;var p;var c;var _;var f;var d;var g,m,y,v;var x,b,w,D;var C,A,T;if(r.length!=a)r.length=a;for(var P=0;P<a;++P){n=r[P];if(n==null)n=r[P]=new jr;u=s[P];h=u.parentIndex;p=o[P];d=n.orientation;f=n.translation;if(h<0){_=p.translation;c=p.orientation;d.x=c.x;d.y=c.y;d.z=c.z;d.w=c.w;f.x=_.x;f.y=_.y;f.z=_.z}else{l=r[h];c=l.orientation;_=p.translation;x=c.x;b=c.y;w=c.z;D=c.w;C=_.x;A=_.y;T=_.z;v=-x*C-b*A-w*T;g=D*C+b*T-w*A;m=D*A-x*T+w*C;y=D*T+x*A-b*C;_=l.translation;f.x=-v*x+g*D-m*w+y*b+_.x;f.y=-v*b+g*w+m*D-y*x+_.y;f.z=-v*w-g*b+m*x+y*D+_.z;g=c.x;m=c.y;y=c.z;v=c.w;c=p.orientation;x=c.x;b=c.y;w=c.z;D=c.w;d.w=v*D-g*x-m*b-y*w;d.x=v*x+g*D+m*w-y*b;d.y=v*b-g*w+m*D+y*x;d.z=v*w+g*b-m*x+y*D}}};i.prototype.onTransitionComplete=function(t){if(t.type==kn.TRANSITION_COMPLETE){t.animationNode.removeEventListener(kn.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate);if(this._pActiveState==t.animationState){this._pActiveNode=this._pAnimationSet.getAnimation(this._pActiveAnimationName);this._pActiveState=this.getAnimationState(this._pActiveNode);this._activeSkeletonState=this._pActiveState}}};i.prototype.onIndicesUpdate=function(t){var e=t.target;this._morphedElements[e.id].setIndices(e.indices)};i.prototype.onVerticesUpdate=function(t){if(t.attributesView!=e.uvs&&t.attributesView!=e.getCustomAtributes("secondaryUVs"))return;var e=t.target;var i=this._morphedElements[e.id];var r=i.uvs.get(e.numVertices);i.invalidateVertices(i.uvs);var n=i.uvs.stride;var s=t.attributesView.get(e.numVertices);var a=e.numVertices*n;for(var o=0;o<a;o+=n){r[o]=s[o];r[o+1]=s[o+1]}};return i}(vi);var ns=function(t){e(i,t);function i(e,i){if(e===void 0){e=2}if(i===void 0){i="absolute"}var r=t.call(this)||this;r._numPoses=e;r._blendMode=i;return r}Object.defineProperty(i.prototype,"numPoses",{get:function(){return this._numPoses},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._blendMode},enumerable:true,configurable:true});i.prototype.getAGALVertexCode=function(t,e,i){this._iAnimationRegisterData=t.animationRegisterData;if(this._iAnimationRegisterData==null)this._iAnimationRegisterData=t.animationRegisterData=new di;if(this._blendMode==Kr.ABSOLUTE)return this.getAbsoluteAGALCode(t,e,i);else return this.getAdditiveAGALCode(t,e,i)};i.prototype.getAGALFragmentCode=function(t,e,i){return""};i.prototype.getAGALUVCode=function(t,e,i){return"mov "+i.uvTarget+","+i.uvSource+"\n"};i.prototype.doneAGALCode=function(t){};i.prototype.getAbsoluteAGALCode=function(t,e,i){var r="";var n=e.getFreeVertexVectorTemp();e.addVertexTempUsages(n,1);var s=e.getFreeVertexVectorTemp();var a=new Array(".x",".y",".z",".w");var o=i.animatableAttributes.length;var h=e.getFreeVertexConstant();this._iAnimationRegisterData.weightsIndex=h.index;this._iAnimationRegisterData.poseIndices=new Array(this._numPoses);var u;var l=0;if(o>2)o=2;for(var p=0;p<o;++p){r+="mul "+n+", "+i.animatableAttributes[p]+", "+h+a[0]+"\n";for(var c=1;c<this._numPoses;++c){u=e.getFreeVertexAttribute();this._iAnimationRegisterData.poseIndices[l++]=u.index;r+="mul "+s+", "+u+", "+h+a[c]+"\n";if(c<this._numPoses-1)r+="add "+n+", "+n+", "+s+"\n"}r+="add "+i.animationTargetRegisters[p]+", "+n+", "+s+"\n"}if(t.tangentDependencies>0||t.outputsNormals){r+="dp3 "+n+".x, "+i.animatableAttributes[2]+", "+i.animationTargetRegisters[1]+"\n"+"mul "+n+", "+i.animationTargetRegisters[1]+", "+n+".x\n"+"sub "+i.animationTargetRegisters[2]+", "+i.animationTargetRegisters[2]+", "+n+"\n"}return r};i.prototype.getAdditiveAGALCode=function(t,e,i){var r="";var n=i.animatableAttributes.length;var s=[".x",".y",".z",".w"];var a=e.getFreeVertexVectorTemp();var o=e.getFreeVertexConstant();this._iAnimationRegisterData.weightsIndex=o.index;this._iAnimationRegisterData.poseIndices=new Array(this._numPoses);var h;var u=0;if(n>2)n=2;r+="mov  "+i.animationTargetRegisters[0]+", "+i.animatableAttributes[0]+"\n";if(t.normalDependencies>0)r+="mov "+i.animationTargetRegisters[1]+", "+i.animatableAttributes[1]+"\n";for(var l=0;l<n;++l){for(var p=0;p<this._numPoses;++p){h=e.getFreeVertexAttribute();this._iAnimationRegisterData.poseIndices[u++]=h.index;r+="mul "+a+", "+h+", "+o+s[p]+"\n"+"add "+i.animationTargetRegisters[l]+", "+i.animationTargetRegisters[l]+", "+a+"\n"}}if(t.tangentDependencies>0||t.outputsNormals){r+="dp3 "+a+".x, "+i.animatableAttributes[2]+", "+i.animationTargetRegisters[1]+"\n"+"mul "+a+", "+i.animationTargetRegisters[1]+", "+a+".x\n"+"sub "+i.animationTargetRegisters[2]+", "+i.animatableAttributes[2]+", "+a+"\n"}return r};return i}(mi);var ss=function(t){e(i,t);function i(e){var i=t.call(this,e)||this;i._poses=new Array;i._weights=new Float32Array([1,0,0,0]);i._vertexAnimationSet=e;return i}i.prototype.clone=function(){return new i(this._vertexAnimationSet)};i.prototype.play=function(t,e,i){if(e===void 0){e=null}if(i===void 0){i=NaN}if(this._pActiveAnimationName==t)return;this._pActiveAnimationName=t;if(!this._pAnimationSet.hasAnimation(t))throw new Error("Animation root node "+t+" not found!");this._pActiveNode=this._pAnimationSet.getAnimation(t);this._pActiveState=this.getAnimationState(this._pActiveNode);if(this.updatePosition){this._pActiveState.update(this._pAbsoluteTime);this._pActiveState.positionDelta}this._activeVertexState=this._pActiveState;this.start();if(!isNaN(i))this.reset(t,i)};i.prototype._pUpdateDeltaTime=function(e){t.prototype._pUpdateDeltaTime.call(this,e);var i=false;if(this._poses[0]!=this._activeVertexState.currentGraphics){this._poses[0]=this._activeVertexState.currentGraphics;i=true}if(this._poses[1]!=this._activeVertexState.nextGraphics)this._poses[1]=this._activeVertexState.nextGraphics;this._weights[0]=1-(this._weights[1]=this._activeVertexState.blendWeight);if(i)this.invalidateElements()};i.prototype.setRenderState=function(t,e,i,r){var n=e.shape;var s=e.sourceEntity;var a=n.elements;if(!this._poses.length){this.setNullPose(t,a,i);return}var o=t.animationRegisterData;var h;var u=this._vertexAnimationSet.numPoses;t.setVertexConstFromArray(o.weightsIndex,this._weights);if(this._vertexAnimationSet.blendMode==Kr.ABSOLUTE)h=1;else h=0;var l;var p=0;var c=s.graphics.getShapeIndex(n);for(;h<u;++h){a=this._poses[h].getShapeAt(c).elements||n.elements;l=i.getAbstraction(a);l._indexMappings=i.getAbstraction(n.elements).getIndexMappings();if(a.isAsset($t)){l.activateVertexBufferVO(o.poseIndices[p++],a.positions);if(t.normalDependencies>0)l.activateVertexBufferVO(o.poseIndices[p++],a.normals)}}};i.prototype.setNullPose=function(t,e,i){var r=t.animationRegisterData;t.setVertexConstFromArray(r.weightsIndex,this._weights);var n=i.getAbstraction(e);var s=0;if(this._vertexAnimationSet.blendMode==Kr.ABSOLUTE){var a=this._vertexAnimationSet.numPoses;for(var o=1;o<a;++o){if(e.isAsset($t)){n.activateVertexBufferVO(r.poseIndices[s++],e.positions);if(t.normalDependencies>0)n.activateVertexBufferVO(r.poseIndices[s++],e.normals)}}}};i.prototype.testGPUCompatibility=function(t){};i.prototype.getRenderableElements=function(t,e){if(this._vertexAnimationSet.blendMode==Kr.ABSOLUTE&&this._poses.length)return this._poses[0].getShapeAt(t.sourceEntity.graphics.getShapeIndex(t.shape)).elements||e;return e};return i}(vi);var as=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._rttManager=i;return r}Object.defineProperty(i.prototype,"rttManager",{get:function(){return this._rttManager},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._rttManager)};return i}(n);as.RESIZE="rttManagerResize";var os=function(t){e(i,t);function i(e){var i=t.call(this)||this;i._viewWidth=-1;i._viewHeight=-1;i._textureWidth=-1;i._textureHeight=-1;i._buffersInvalid=true;i._renderToTextureRect=new Y;i._stage=e;return i}i.getInstance=function(t){if(!t)throw new Error("stage key cannot be null!");if(i._instances==null)i._instances=new Array;var e=i.getRTTBufferManagerFromStage(t);if(e==null){e=new i(t);var r=new hs;r.stage3d=t;r.rttbfm=e;i._instances.push(r)}return e};i.getRTTBufferManagerFromStage=function(t){var e=i._instances.length;var r;for(var n=0;n<e;n++){r=i._instances[n];if(r.stage3d===t)return r.rttbfm}return null};i.deleteRTTBufferManager=function(t){var e=i._instances.length;var r;for(var n=0;n<e;n++){r=i._instances[n];if(r.stage3d===t){i._instances.splice(n,1);return}}};Object.defineProperty(i.prototype,"textureRatioX",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._textureRatioX},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"textureRatioY",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._textureRatioY},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"viewWidth",{get:function(){return this._viewWidth},set:function(t){if(t==this._viewWidth)return;this._viewWidth=t;this._buffersInvalid=true;this._textureWidth=se.getBestPowerOf2(this._viewWidth);if(this._textureWidth>this._viewWidth){this._renderToTextureRect.x=Math.floor((this._textureWidth-this._viewWidth)*.5);this._renderToTextureRect.width=this._viewWidth}else{this._renderToTextureRect.x=0;this._renderToTextureRect.width=this._textureWidth}this.dispatchEvent(new as(as.RESIZE,this))},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"viewHeight",{get:function(){return this._viewHeight},set:function(t){if(t==this._viewHeight)return;this._viewHeight=t;this._buffersInvalid=true;this._textureHeight=se.getBestPowerOf2(this._viewHeight);if(this._textureHeight>this._viewHeight){this._renderToTextureRect.y=Math.floor((this._textureHeight-this._viewHeight)*.5);this._renderToTextureRect.height=this._viewHeight}else{this._renderToTextureRect.y=0;this._renderToTextureRect.height=this._textureHeight}this.dispatchEvent(new as(as.RESIZE,this))},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"renderToTextureVertexBuffer",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._renderToTextureVertexBuffer},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"renderToScreenVertexBuffer",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._renderToScreenVertexBuffer},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"renderToTextureRect",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._renderToTextureRect},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"textureWidth",{get:function(){return this._textureWidth},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"textureHeight",{get:function(){return this._textureHeight},enumerable:true,configurable:true});i.prototype.dispose=function(){i.deleteRTTBufferManager(this._stage);if(this._indexBuffer){this._indexBuffer.dispose();this._renderToScreenVertexBuffer.dispose();this._renderToTextureVertexBuffer.dispose();this._renderToScreenVertexBuffer=null;this._renderToTextureVertexBuffer=null;this._indexBuffer=null}};i.prototype.updateRTTBuffers=function(){var t=this._stage.context;var e;var i;var r;var n;if(this._renderToTextureVertexBuffer==null)this._renderToTextureVertexBuffer=t.createVertexBuffer(4,20);if(this._renderToScreenVertexBuffer==null)this._renderToScreenVertexBuffer=t.createVertexBuffer(4,20);if(!this._indexBuffer){this._indexBuffer=t.createIndexBuffer(6);this._indexBuffer.uploadFromArray([2,1,0,3,2,0],0,6)}this._textureRatioX=r=Math.min(this._viewWidth/this._textureWidth,1);this._textureRatioY=n=Math.min(this._viewHeight/this._textureHeight,1);var s=(1-r)*.5;var a=(r+1)*.5;var o=(1-n)*.5;var h=(n+1)*.5;e=[-r,-n,s,o,0,r,-n,a,o,1,r,n,a,h,2,-r,n,s,h,3];i=[-1,-1,s,o,0,1,-1,a,o,1,1,1,a,h,2,-1,1,s,h,3];this._renderToTextureVertexBuffer.uploadFromArray(e,0,4);this._renderToScreenVertexBuffer.uploadFromArray(i,0,4);this._buffersInvalid=false};return i}(a);var hs=function(){function t(){}return t}();var us=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._shader=new Tr(i.elementsClass,r,r._stage);r._pAddPass(r);return r}i.prototype.invalidate=function(){t.prototype.invalidate.call(this);this._textureVO=this._material.getTextureAt(0)?this._shader.getAbstraction(this._material.getTextureAt(0)):null};i.prototype._iIncludeDependencies=function(e){t.prototype._iIncludeDependencies.call(this,e);e.projectionDependencies++;if(e.alphaThreshold>0)e.uvDependencies++};i.prototype._iInitConstantData=function(e){t.prototype._iInitConstantData.call(this,e);var i=this._fragmentConstantsIndex;var r=e.fragmentConstantData;r[i]=1;r[i+1]=255;r[i+2]=65025;r[i+3]=16581375;r[i+4]=1/255;r[i+5]=1/255;r[i+6]=1/255;r[i+7]=0};i.prototype._iGetFragmentCode=function(t,e,i){var r="";var n=i.shadedTarget;var s=e.getFreeFragmentConstant();var a=e.getFreeFragmentConstant();this._fragmentConstantsIndex=s.index*4;var o=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(o,1);var h=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(h,1);r+="div "+o+", "+i.projectionFragment+", "+i.projectionFragment+".w\n"+"mul "+o+", "+s+", "+o+".z\n"+"frc "+o+", "+o+"\n"+"mul "+h+", "+o+".yzww, "+a+"\n";if(this._textureVO&&t.alphaThreshold>0){var u=e.getFreeFragmentVectorTemp();r+=this._textureVO._iGetFragmentCode(u,e,i,i.uvVarying);var l=e.getFreeFragmentConstant();r+="sub "+u+".w, "+u+".w, "+l+".x\n"+"kil "+u+".w\n"}r+="sub "+n+", "+o+", "+h+"\n";e.removeFragmentTempUsage(o);e.removeFragmentTempUsage(h);return r};i.prototype._iActivate=function(e){t.prototype._iActivate.call(this,e);if(this._textureVO&&this._shader.alphaThreshold>0){this._textureVO.activate(this);this._shader.fragmentConstantData[this._fragmentConstantsIndex+8]=this._shader.alphaThreshold}};return i}(Or);var ls=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._shader=new Tr(i.elementsClass,r,r._stage);r._pAddPass(r);return r}i.prototype.invalidate=function(){t.prototype.invalidate.call(this);this._textureVO=this._material.getTextureAt(0)?this._shader.getAbstraction(this._material.getTextureAt(0)):null};i.prototype._iInitConstantData=function(e){t.prototype._iInitConstantData.call(this,e);var i=this._fragmentConstantsIndex;var r=e.fragmentConstantData;r[i+4]=1/255;r[i+5]=1/255;r[i+6]=1/255;r[i+7]=0};i.prototype._iIncludeDependencies=function(e){t.prototype._iIncludeDependencies.call(this,e);e.projectionDependencies++;e.viewDirDependencies++;if(e.alphaThreshold>0)e.uvDependencies++;if(e.viewDirDependencies>0)e.globalPosDependencies++};i.prototype._iGetFragmentCode=function(t,e,i){var r;var n=i.shadedTarget;var s=e.getFreeFragmentConstant();var a=e.getFreeFragmentConstant();this._fragmentConstantsIndex=s.index*4;var o=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(o,1);var h=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(h,1);r="dp3 "+o+".z, "+i.viewDirVarying+".xyz, "+i.viewDirVarying+".xyz\n"+"mul "+o+", "+s+", "+o+".z\n"+"frc "+o+", "+o+"\n"+"mul "+h+", "+o+".yzww, "+a+"\n";if(this._textureVO&&t.alphaThreshold>0){var u=e.getFreeFragmentVectorTemp();r+=this._textureVO._iGetFragmentCode(u,e,i,i.uvVarying);var l=e.getFreeFragmentConstant();r+="sub "+u+".w, "+u+".w, "+l+".x\n"+"kil "+u+".w\n"}r+="sub "+n+", "+o+", "+h+"\n";return r};i.prototype._iActivate=function(e){t.prototype._iActivate.call(this,e);var i=e.far;i=1/(2*i*i);var r=this._fragmentConstantsIndex;var n=this._shader.fragmentConstantData;n[r]=1*i;n[r+1]=255*i;n[r+2]=65025*i;n[r+3]=16581375*i;if(this._textureVO&&this._shader.alphaThreshold>0){this._textureVO.activate(this);n[r+8]=this._shader.alphaThreshold}};return i}(Or);var ps=function(t){e(i,t);function i(e){return t.call(this,e)||this}return i}(n);ps.VIEWPORT_UPDATED="viewportUpdated";ps.SCISSOR_UPDATED="scissorUpdated";var cs=function(){function t(){}t.prototype.sortBlendedRenderables=function(t){var e;var i;var r;if(!t||!t.next){return t}r=t;i=t.next;while(i){i=i.next;if(i){r=r.next;i=i.next}}e=r.next;r.next=null;t=this.sortBlendedRenderables(t);e=this.sortBlendedRenderables(e);var n;var s;var a;if(!t)return e;if(!e)return t;while(t&&e){if(t.zIndex<e.zIndex){a=t;t=t.next}else{a=e;e=e.next}if(!n)n=a;else s.next=a;s=a}if(t)s.next=t;else if(e)s.next=e;return n};t.prototype.sortOpaqueRenderables=function(t){var e;var i,r;if(!t||!t.next){return t}r=t;i=t.next;while(i){i=i.next;if(i){r=r.next;i=i.next}}e=r.next;r.next=null;t=this.sortOpaqueRenderables(t);e=this.sortOpaqueRenderables(e);var n;var s;var a;var o=0;if(!t)return e;if(!e)return t;while(t&&e&&t!=null&&e!=null){var h=t.renderOrderId;var u=e.renderOrderId;if(h==u){var l=t.materialID;var p=e.materialID;if(l==p){if(t.zIndex<e.zIndex)o=1;else o=-1}else if(l>p){o=1}else{o=-1}}else if(h>u){o=1}else{o=-1}if(o<0){a=t;t=t.next}else{a=e;e=e.next}if(!n){n=a;s=a}else{s.next=a;s=a}}if(t)s.next=t;else if(e)s.next=e;return n};return t}();var _s=function(i){e(r,i);function r(e,r,n,s){if(e===void 0){e=null}if(r===void 0){r=false}if(n===void 0){n=t.ContextGLProfile.BASELINE}if(s===void 0){s=t.ContextMode.AUTO}var a=i.call(this)||this;a._activeMasksConfig=new Array;a._registeredMasks=new Array;a._numUsedStreams=0;a._numUsedTextures=0;a._cameraForward=new A;a._viewPort=new Y;a._pBackBufferInvalid=true;a._pDepthTextureInvalid=true;a._depthPrepass=false;a._backgroundR=0;a._backgroundG=0;a._backgroundB=0;a._backgroundAlpha=1;a.textureRatioX=1;a.textureRatioY=1;a._localPos=new z;a._globalPos=new z;a._pScissorRect=new Y;

a._pNumElements=0;a._disableColor=false;a._renderBlended=true;a._numCullPlanes=0;a._onViewportUpdatedDelegate=function(t){return a.onViewportUpdated(t)};a._onContextUpdateDelegate=function(t){return a.onContextUpdate(t)};a.renderableSorter=new cs;a._pStage=e||br.getInstance().getFreeStage(r,n,s);a._pStage.addEventListener(Ci.CONTEXT_CREATED,a._onContextUpdateDelegate);a._pStage.addEventListener(Ci.CONTEXT_RECREATED,a._onContextUpdateDelegate);a._pStage.addEventListener(Ci.VIEWPORT_UPDATED,a._onViewportUpdatedDelegate);if(a._pStage.context)a._pContext=a._pStage.context;return a}Object.defineProperty(r.prototype,"cullPlanes",{get:function(){return this._customCullPlanes},set:function(t){this._customCullPlanes=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"renderBlended",{get:function(){return this._renderBlended},set:function(t){this._renderBlended=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"disableColor",{get:function(){return this._disableColor},set:function(t){this._disableColor=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"numElements",{get:function(){return this._pNumElements},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"scissorRect",{get:function(){return this._pScissorRect},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"x",{get:function(){return this._localPos.x},set:function(t){if(this.x==t)return;this._pStage.x=t;this._globalPos.x=this._localPos.x=t;this.updateGlobalPos()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"y",{get:function(){return this._localPos.y},set:function(t){if(this.y==t)return;this._pStage.y=t;this._globalPos.y=this._localPos.y=t;this.updateGlobalPos()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"width",{get:function(){return this._width},set:function(t){if(this._width==t)return;this._width=t;this._pScissorRect.width=t;if(this._pRttBufferManager)this._pRttBufferManager.viewWidth=t;this._pBackBufferInvalid=true;this._pDepthTextureInvalid=true;this.notifyScissorUpdate()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"height",{get:function(){return this._height},set:function(t){if(this._height==t)return;this._height=t;this._pScissorRect.height=t;if(this._pRttBufferManager)this._pRttBufferManager.viewHeight=t;this._pBackBufferInvalid=true;this._pDepthTextureInvalid=true;this.notifyScissorUpdate()},enumerable:true,configurable:true});r.prototype.activatePass=function(t,e){var i;for(i=t.shader.numUsedStreams;i<this._numUsedStreams;i++)this._pContext.setVertexBufferAt(i,null);for(i=t.shader.numUsedTextures;i<this._numUsedTextures;i++)this._pContext.setTextureAt(i,null);var r=t.shader.programData;if(!r.program){r.program=this._pContext.createProgram();var n=(new si).assemble("part vertex 1\n"+r.vertexString+"endpart")["vertex"].data;var s=(new si).assemble("part fragment 1\n"+r.fragmentString+"endpart")["fragment"].data;r.program.upload(n,s)}this._pContext.setProgram(r.program);t._iActivate(e)};r.prototype.deactivatePass=function(t){t._iDeactivate();this._numUsedStreams=t.shader.numUsedStreams;this._numUsedTextures=t.shader.numUsedTextures};Object.defineProperty(r.prototype,"_iBackgroundR",{get:function(){return this._backgroundR},set:function(t){if(this._backgroundR==t)return;this._backgroundR=t;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"_iBackgroundG",{get:function(){return this._backgroundG},set:function(t){if(this._backgroundG==t)return;this._backgroundG=t;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"_iBackgroundB",{get:function(){return this._backgroundB},set:function(t){if(this._backgroundB==t)return;this._backgroundB=t;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"context",{get:function(){return this._pContext},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"stage",{get:function(){return this._pStage},enumerable:true,configurable:true});r.prototype.dispose=function(){this._pStage.removeEventListener(Ci.CONTEXT_CREATED,this._onContextUpdateDelegate);this._pStage.removeEventListener(Ci.CONTEXT_RECREATED,this._onContextUpdateDelegate);this._pStage.removeEventListener(Ci.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate);this._pStage=null;this._pContext=null};r.prototype.render=function(t){this._viewportDirty=false;this._scissorDirty=false};r.prototype._iRender=function(t,e,i,n,s){if(i===void 0){i=null}if(n===void 0){n=null}if(s===void 0){s=0}if(!this._pStage||!this._pContext)return;this._pBlendedRenderableHead=null;this._pOpaqueRenderableHead=null;this._pNumElements=0;this._cameraTransform=t.transform.concatenatedMatrix3D;this._cameraForward=t.transform.forwardVector;this._cullPlanes=this._customCullPlanes?this._customCullPlanes:t.frustumPlanes;this._numCullPlanes=this._cullPlanes?this._cullPlanes.length:0;r._iCollectionMark++;e.traversePartitions(this);if(this.renderableSorter){this._pOpaqueRenderableHead=this.renderableSorter.sortOpaqueRenderables(this._pOpaqueRenderableHead);this._pBlendedRenderableHead=this.renderableSorter.sortBlendedRenderables(this._pBlendedRenderableHead)}this.pExecuteRender(t,e,i,n,s);if(i)i.invalidate();for(var a=0;a<8;++a){this._pContext.setVertexBufferAt(a,null);this._pContext.setTextureAt(a,null)}};r.prototype._iRenderCascades=function(e,i,r,n,s,a){this._pStage.setRenderTarget(r,true,0);this._pContext.clear(1,1,1,1,1,0);this._pContext.setBlendFactors(t.ContextGLBlendFactor.ONE,t.ContextGLBlendFactor.ZERO);this._pContext.setDepthTest(true,t.ContextGLCompareMode.LESS);var o=this._pOpaqueRenderableHead;var h=true;for(var u=n-1;u>=0;--u){this._pStage.scissorRect=s[u];h=false}this._pContext.setDepthTest(false,t.ContextGLCompareMode.LESS_EQUAL);this._pStage.scissorRect=null};r.prototype.pExecuteRender=function(e,i,r,n,s){if(r===void 0){r=null}if(n===void 0){n=null}if(s===void 0){s=0}this._pStage.setRenderTarget(r,true,s);if((r||!this.shareContext)&&!this._depthPrepass)this._pContext.clear(this._backgroundR,this._backgroundG,this._backgroundB,this._backgroundAlpha,1,0);this._pStage.scissorRect=n;this._pContext.setBlendFactors(t.ContextGLBlendFactor.ONE,t.ContextGLBlendFactor.ZERO);this.pDraw(e);if(!this.shareContext){if(this._snapshotRequired&&this._snapshotBitmapImage2D){this._pContext.drawToBitmapImage2D(this._snapshotBitmapImage2D);this._snapshotRequired=false}}this._pStage.scissorRect=null};r.prototype.queueSnapshot=function(t){this._snapshotRequired=true;this._snapshotBitmapImage2D=t};r.prototype.pDraw=function(e){this._pContext.setDepthTest(true,t.ContextGLCompareMode.LESS_EQUAL);if(this._disableColor)this._pContext.setColorMask(false,false,false,false);this.drawRenderables(e,this._pOpaqueRenderableHead);if(this._renderBlended)this.drawRenderables(e,this._pBlendedRenderableHead);if(this._disableColor)this._pContext.setColorMask(true,true,true,true)};r.prototype.drawRenderables=function(e,i){var r;var n;var s;var a;var o;var h;this._pContext.setStencilActions(t.ContextGLTriangleFace.FRONT_AND_BACK,t.ContextGLCompareMode.ALWAYS,t.ContextGLStencilAction.KEEP,t.ContextGLStencilAction.KEEP,t.ContextGLStencilAction.KEEP);this._registeredMasks.length=0;this._pContext.disableStencil();this._maskConfig=0;while(i){a=i.materialGL;o=a.passes;if(this._disableColor&&a._material.alphaThreshold!=0){s=i;do{s=s.next}while(s&&s.materialGL==a)}else{if(this._activeMasksDirty||this._checkMasksConfig(i.masksConfig)){this._activeMasksConfig=i.masksConfig;if(!this._activeMasksConfig.length){this._pContext.disableStencil();this._pContext.setStencilActions(t.ContextGLTriangleFace.FRONT_AND_BACK,t.ContextGLCompareMode.ALWAYS,t.ContextGLStencilAction.KEEP,t.ContextGLStencilAction.KEEP,t.ContextGLStencilAction.KEEP);this._pContext.setStencilReferenceValue(0)}else{this._renderMasks(e,i.sourceEntity._iAssignedMasks())}this._activeMasksDirty=false}n=o.length;for(r=0;r<n;r++){s=i;h=o[r];this.activatePass(h,e);do{if(s.maskId!==-1){if(r==0)this._registerMask(s)}else{s._iRender(h,e)}s=s.next}while(s&&s.materialGL==a&&!(this._activeMasksDirty=this._checkMasksConfig(s.masksConfig)));this.deactivatePass(h)}}i=s}};r.prototype.onContextUpdate=function(t){this._pContext=this._pStage.context};Object.defineProperty(r.prototype,"_iBackgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(t){if(this._backgroundAlpha==t)return;this._backgroundAlpha=t;this._pBackBufferInvalid=true},enumerable:true,configurable:true});r.prototype.notifyScissorUpdate=function(){if(this._scissorDirty)return;this._scissorDirty=true;if(!this._scissorUpdated)this._scissorUpdated=new ps(ps.SCISSOR_UPDATED);this.dispatchEvent(this._scissorUpdated)};r.prototype.notifyViewportUpdate=function(){if(this._viewportDirty)return;this._viewportDirty=true;if(!this._viewPortUpdated)this._viewPortUpdated=new ps(ps.VIEWPORT_UPDATED);this.dispatchEvent(this._viewPortUpdated)};r.prototype.onViewportUpdated=function(t){this._viewPort=this._pStage.viewPort;if(this.shareContext){this._pScissorRect.x=this._globalPos.x-this._pStage.x;this._pScissorRect.y=this._globalPos.y-this._pStage.y;this.notifyScissorUpdate()}this.notifyViewportUpdate()};r.prototype.updateGlobalPos=function(){if(this.shareContext){this._pScissorRect.x=this._globalPos.x-this._viewPort.x;this._pScissorRect.y=this._globalPos.y-this._viewPort.y}else{this._pScissorRect.x=0;this._pScissorRect.y=0;this._viewPort.x=this._globalPos.x;this._viewPort.y=this._globalPos.y}this.notifyScissorUpdate()};r.prototype.enterNode=function(t){var e=t._iCollectionMark!=r._iCollectionMark&&t.isRenderable()&&t.isInFrustum(this._cullPlanes,this._numCullPlanes);t._iCollectionMark=r._iCollectionMark;return e};r.prototype.applyEntity=function(t){this._sourceEntity=t;this._renderablePool=this._materialGroup.getRenderablePool(t);this._zIndex=t.zOffset+this._cameraTransform.position.subtract(t.scenePosition).dotProduct(this._cameraForward);this._renderSceneTransform=t.getRenderSceneTransform(this._cameraTransform);t._acceptTraverser(this)};r.prototype.applyRenderable=function(t){var e=this._renderablePool.getAbstraction(t);e.cascaded=false;e.zIndex=this._zIndex;e.maskId=this._sourceEntity._iAssignedMaskId();e.masksConfig=this._sourceEntity._iMasksConfig();var i=e.materialGL;e.materialID=i.materialID;e.renderOrderId=i.renderOrderId;e.renderSceneTransform=this._renderSceneTransform;if(i.requiresBlending){e.next=this._pBlendedRenderableHead;this._pBlendedRenderableHead=e}else{e.next=this._pOpaqueRenderableHead;this._pOpaqueRenderableHead=e}this._pNumElements+=e.elementsGL.elements.numElements};r.prototype.applyDirectionalLight=function(t){};r.prototype.applyLightProbe=function(t){};r.prototype.applyPointLight=function(t){};r.prototype._registerMask=function(t){this._registeredMasks.push(t)};r.prototype._renderMasks=function(e,i){this._pContext.setColorMask(false,false,false,false);this._pContext.enableStencil();this._maskConfig++;this._pContext.setStencilActions(t.ContextGLTriangleFace.FRONT_AND_BACK,t.ContextGLCompareMode.ALWAYS,t.ContextGLStencilAction.SET,t.ContextGLStencilAction.SET,t.ContextGLStencilAction.SET);this._pContext.setStencilReferenceValue(this._maskConfig);var r=i.length;var n=this._registeredMasks.length;var s;var a;var o;var h;for(var u=0;u<r;++u){if(u!=0){this._pContext.setStencilActions(t.ContextGLTriangleFace.FRONT_AND_BACK,t.ContextGLCompareMode.EQUAL,t.ContextGLStencilAction.INCREMENT_SATURATE,t.ContextGLStencilAction.INCREMENT_SATURATE,t.ContextGLStencilAction.KEEP);this._pContext.setStencilReferenceValue(this._maskConfig);this._maskConfig++}a=i[u];o=a.length;for(var l=0;l<o;++l){h=a[l];for(var p=0;p<n;++p){s=this._registeredMasks[p];if(s.maskId==h.id){this._drawMask(e,s)}}}}this._pContext.setStencilActions(t.ContextGLTriangleFace.FRONT_AND_BACK,t.ContextGLCompareMode.EQUAL,t.ContextGLStencilAction.KEEP,t.ContextGLStencilAction.KEEP,t.ContextGLStencilAction.KEEP);this._pContext.setStencilReferenceValue(this._maskConfig);this._pContext.setColorMask(true,true,true,true);this._pContext.setDepthTest(true,t.ContextGLCompareMode.LESS_EQUAL)};r.prototype._drawMask=function(e,i){var r=i.materialGL;var n=r.passes;var s=n.length;var a=n[s-1];this.activatePass(a,e);this._pContext.setDepthTest(false,t.ContextGLCompareMode.LESS_EQUAL);i._iRender(a,e);this.deactivatePass(a)};r.prototype._checkMasksConfig=function(t){if(this._activeMasksConfig.length!=t.length)return true;var e=t.length;var i;var r;var n;var s;for(var a=0;a<e;a++){r=t[a];i=r.length;s=this._activeMasksConfig[a];n=s.length;if(n!=i)return true;for(var o=0;o<i;o++){if(s[o]!=r[o])return true}}return false};return r}(Ht);_s._iCollectionMark=0;var fs=function(t){e(i,t);function i(e){if(e===void 0){e=null}var r=t.call(this,e)||this;r._materialGroup=new Lr(r._pStage,i._abstractionClassPool);r._iBackgroundR=1;r._iBackgroundG=1;r._iBackgroundB=1;return r}i.prototype.enterNode=function(e){var i=e._iCollectionMark!=_s._iCollectionMark&&e.isCastingShadow();if(!i){e._iCollectionMark=_s._iCollectionMark;return false}return t.prototype.enterNode.call(this,e)};return i}(_s);fs._abstractionClassPool=Object();var ds=function(t){e(i,t);function i(e){if(e===void 0){e=null}var r=t.call(this,e)||this;r._materialGroup=new Lr(r._pStage,i._abstractionClassPool);r._iBackgroundR=1;r._iBackgroundG=1;r._iBackgroundB=1;return r}i.prototype.enterNode=function(e){var i=e._iCollectionMark!=_s._iCollectionMark&&e.isCastingShadow();if(!i){e._iCollectionMark=_s._iCollectionMark;return false}return t.prototype.enterNode.call(this,e)};return i}(_s);ds._abstractionClassPool=Object();var gs=function(t){e(i,t);function i(e){return t.call(this,e,i._abstractionClassPool)||this}i.registerAbstraction=function(t,e){i._abstractionClassPool[e.assetType]=t;fs._abstractionClassPool[e.assetType]=us;ds._abstractionClassPool[e.assetType]=ls};return i}(Lr);gs._abstractionClassPool=new Object;var ms=function(){function e(t){var e=this;this._filterSizesInvalid=true;this._onRTTResizeDelegate=function(t){return e.onRTTResize(t)};this._stage=t;this._rttManager=os.getInstance(t);this._rttManager.addEventListener(as.RESIZE,this._onRTTResizeDelegate);this._sampler=new re(false,false,false);this._renderToTextureRect=new Y}e.prototype.onRTTResize=function(t){this._filterSizesInvalid=true};Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:true,configurable:true});e.prototype.getMainInputTexture=function(t){if(this._filterTasksInvalid)this.updateFilterTasks(t);return this._mainInputTexture};Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(t){this._filters=t;this._filterTasksInvalid=true;this._requireDepthRender=false;if(!this._filters)return;for(var e=0;e<this._filters.length;++e)if(this._filters[e].requireDepthRender)this._requireDepthRender=true;this._filterSizesInvalid=true},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sampler",{get:function(){return this._sampler},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"renderToTextureRect",{get:function(){if(this._filterSizesInvalid)this.updateFilterSizes();return this._renderToTextureRect},enumerable:true,configurable:true});e.prototype.updateFilterTasks=function(t){var e;if(this._filterSizesInvalid)this.updateFilterSizes();if(!this._filters){this._tasks=null;return}this._tasks=new Array;e=this._filters.length-1;var i;for(var r=0;r<=e;++r){i=this._filters[r];i.setRenderTargets(r==e?null:this._filters[r+1].getMainInputTexture(t),t);this._tasks=this._tasks.concat(i.tasks)}this._mainInputTexture=this._filters[0].getMainInputTexture(t)};e.prototype.render=function(e,i,r){var n;var s;var a;var o=e.context;var h=this._rttManager.indexBuffer;var u=this._rttManager.renderToTextureVertexBuffer;if(!this._filters)return;if(this._filterSizesInvalid)this.updateFilterSizes();if(this._filterTasksInvalid)this.updateFilterTasks(e);n=this._filters.length;for(s=0;s<n;++s)this._filters[s].update(e,i);n=this._tasks.length;if(n>1){o.setProgram(this._tasks[0].getProgram(e));o.setVertexBufferAt(this._tasks[0]._positionIndex,u,0,t.ContextGLVertexBufferFormat.FLOAT_2);o.setVertexBufferAt(this._tasks[0]._uvIndex,u,8,t.ContextGLVertexBufferFormat.FLOAT_2)}for(s=0;s<n;++s){a=this._tasks[s];e.setRenderTarget(a.target);o.setProgram(a.getProgram(e));e.getAbstraction(this._sampler).activate(a._inputTextureIndex);e.getAbstraction(a.getMainInputTexture(e)).activate(a._inputTextureIndex,this._sampler.mipmap);if(!a.target){e.scissorRect=null;u=this._rttManager.renderToScreenVertexBuffer;o.setVertexBufferAt(a._positionIndex,u,0,t.ContextGLVertexBufferFormat.FLOAT_2);o.setVertexBufferAt(a._uvIndex,u,8,t.ContextGLVertexBufferFormat.FLOAT_2)}o.clear(0,0,0,0);a.activate(e,i,r);o.setBlendFactors(t.ContextGLBlendFactor.ONE,t.ContextGLBlendFactor.ZERO);o.drawIndices(t.ContextGLDrawMode.TRIANGLES,h,0,6);a.deactivate(e)}o.setTextureAt(0,null);o.setVertexBufferAt(0,null);o.setVertexBufferAt(1,null)};e.prototype.updateFilterSizes=function(){for(var t=0;t<this._filters.length;++t){this._filters[t].textureWidth=this._rttManager.textureWidth;this._filters[t].textureHeight=this._rttManager.textureHeight;this._filters[t].rttManager=this._rttManager}var e=this._filters[0].textureScale;this._renderToTextureRect.x=this._rttManager.renderToTextureRect.x/e;this._renderToTextureRect.y=this._rttManager.renderToTextureRect.y/e;this._renderToTextureRect.width=this._rttManager.renderToTextureRect.width/e;this._renderToTextureRect.height=this._rttManager.renderToTextureRect.height/e;this._filterSizesInvalid=false};e.prototype.dispose=function(){this._rttManager.removeEventListener(as.RESIZE,this._onRTTResizeDelegate);this._rttManager=null;this._stage=null};return e}();var ys=function(i){e(r,i);function r(e,r,n,s){if(e===void 0){e=null}if(r===void 0){r=false}if(n===void 0){n=t.ContextGLProfile.BASELINE}if(s===void 0){s=t.ContextMode.AUTO}var a=i.call(this,e,r,n,s)||this;a._antiAlias=0;a._directionalLights=new Array;a._pointLights=new Array;a._lightProbes=new Array;if(e)a.shareContext=true;a._materialGroup=new gs(a._pStage);a._pRttBufferManager=os.getInstance(a._pStage);a._depthRenderer=new fs(a._pStage);a._distanceRenderer=new ds(a._pStage);if(a._width==0)a.width=window.innerWidth;else a._pRttBufferManager.viewWidth=a._width;if(a._height==0)a.height=window.innerHeight;else a._pRttBufferManager.viewHeight=a._height;return a}Object.defineProperty(r.prototype,"distanceRenderer",{get:function(){return this._distanceRenderer},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"depthRenderer",{get:function(){return this._depthRenderer},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(t){if(this._antiAlias==t)return;this._antiAlias=t;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"depthPrepass",{get:function(){return this._depthPrepass},set:function(t){this._depthPrepass=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"filters3d",{get:function(){return this._pFilter3DRenderer?this._pFilter3DRenderer.filters:null},set:function(t){if(t&&t.length==0)t=null;if(this._pFilter3DRenderer&&!t){this._pFilter3DRenderer.dispose();this._pFilter3DRenderer=null}else if(!this._pFilter3DRenderer&&t){this._pFilter3DRenderer=new ms(this._pStage);this._pFilter3DRenderer.filters=t}if(this._pFilter3DRenderer){this._pFilter3DRenderer.filters=t;this._pRequireDepthRender=this._pFilter3DRenderer.requireDepthRender}else{this._pRequireDepthRender=false;if(this._pDepthRender){this._pDepthRender.dispose();this._pDepthRender=null}}},enumerable:true,configurable:true});r.prototype.enterNode=function(t){var e=i.prototype.enterNode.call(this,t);if(e&&t.debugVisible)t.renderBounds(this);return e};r.prototype.render=function(e){i.prototype.render.call(this,e);if(!this._pStage.recoverFromDisposal()){this._pBackBufferInvalid=true;return}if(this._pBackBufferInvalid)this.pUpdateBackBuffer();if(this.shareContext&&this._pContext)this._pContext.clear(0,0,0,1,1,0,t.ContextGLClearMask.DEPTH);if(this._pFilter3DRenderer){this.textureRatioX=this._pRttBufferManager.textureRatioX;this.textureRatioY=this._pRttBufferManager.textureRatioY}else{this.textureRatioX=1;this.textureRatioY=1}if(this._pRequireDepthRender)this.pRenderSceneDepthToTexture(e);if(this._depthPrepass)this.pRenderDepthPrepass(e);this._directionalLights.length=0;this._pointLights.length=0;this._lightProbes.length=0;if(this._pFilter3DRenderer&&this._pContext){this._iRender(e.camera.projection,e,this._pFilter3DRenderer.getMainInputTexture(this._pStage),this._pFilter3DRenderer.renderToTextureRect);this._pFilter3DRenderer.render(this._pStage,e.camera,this._pDepthRender)}else{if(this.shareContext)this._iRender(e.camera.projection,e,null,this._pScissorRect);else this._iRender(e.camera.projection,e)}if(!this.shareContext&&this._pContext)this._pContext.present();this._pStage.bufferClear=false};r.prototype.pExecuteRender=function(t,e,r,n,s){if(r===void 0){r=null}if(n===void 0){n=null}if(s===void 0){s=0}this.updateLights(t,e);i.prototype.pExecuteRender.call(this,t,e,r,n,s)};r.prototype.updateLights=function(t,e){var i,r;var n;var s;i=this._directionalLights.length;for(r=0;r<i;++r){n=this._directionalLights[r];s=n.shadowMapper;if(n.shadowsEnabled&&(s.autoUpdateShadows||s._iShadowsInvalid))s.iRenderDepthMap(e,this._depthRenderer)}i=this._pointLights.length;for(r=0;r<i;++r){n=this._pointLights[r];s=n.shadowMapper;if(n.shadowsEnabled&&(s.autoUpdateShadows||s._iShadowsInvalid))s.iRenderDepthMap(e,this._distanceRenderer)}};r.prototype.applyDirectionalLight=function(t){this._directionalLights.push(t)};r.prototype.applyLightProbe=function(t){this._lightProbes.push(t)};r.prototype.applyPointLight=function(t){this._pointLights.push(t)};r.prototype.dispose=function(){if(!this.shareContext)this._pStage.dispose();this._pRttBufferManager.dispose();this._pRttBufferManager=null;this._depthRenderer.dispose();this._distanceRenderer.dispose();this._depthRenderer=null;this._distanceRenderer=null;this._pDepthRender=null;i.prototype.dispose.call(this)};r.prototype.pRenderDepthPrepass=function(t){this._depthRenderer.disableColor=true;if(this._pFilter3DRenderer){this._depthRenderer.textureRatioX=this._pRttBufferManager.textureRatioX;this._depthRenderer.textureRatioY=this._pRttBufferManager.textureRatioY;this._depthRenderer._iRender(t.camera.projection,t,this._pFilter3DRenderer.getMainInputTexture(this._pStage),this._pRttBufferManager.renderToTextureRect)}else{this._depthRenderer.textureRatioX=1;this._depthRenderer.textureRatioY=1;this._depthRenderer._iRender(t.camera.projection,t)}this._depthRenderer.disableColor=false};r.prototype.pRenderSceneDepthToTexture=function(t){if(this._pDepthTextureInvalid||!this._pDepthRender)this.initDepthTexture(this._pStage.context);this._depthRenderer.textureRatioX=this._pRttBufferManager.textureRatioX;this._depthRenderer.textureRatioY=this._pRttBufferManager.textureRatioY;this._depthRenderer._iRender(t.camera.projection,t,this._pDepthRender)};r.prototype.pUpdateBackBuffer=function(){if(this._pStage.context&&!this.shareContext){if(this._width&&this._height){this._pStage.configureBackBuffer(this._width,this._height,this._antiAlias,true);this._pBackBufferInvalid=false}}};r.prototype.initDepthTexture=function(t){this._pDepthTextureInvalid=false;if(this._pDepthRender)this._pDepthRender.dispose();this._pDepthRender=new pe(this._pRttBufferManager.textureWidth,this._pRttBufferManager.textureHeight)};return r}(_s);var vs=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._calcMatrix=new M;r._thickness=1.25;r._lineElements=t;return r}Object.defineProperty(r.prototype,"elementsType",{get:function(){return r.elementsType},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"elementsClass",{get:function(){return r},enumerable:true,configurable:true});r._iIncludeDependencies=function(t){t.colorDependencies++};r._iGetVertexCode=function(t,e,i){var r=t.globalPosDependencies>0?i.globalPositionVertex:i.animatedPosition;var n=e.getFreeVertexAttribute();var s=e.getFreeVertexAttribute();var a=e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();t.viewMatrixIndex=a.index*4;e.getFreeVertexConstant();var o=e.getFreeVertexConstant();var h=e.getFreeVertexConstant();var u=e.getFreeVertexConstant();var l=e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();t.sceneMatrixIndex=l.index*4;var p=e.getFreeVertexVectorTemp();e.addVertexTempUsages(p,1);var c=e.getFreeVertexVectorTemp();e.addVertexTempUsages(c,1);var _=e.getFreeVertexVectorTemp();e.addVertexTempUsages(_,1);var f=e.getFreeVertexVectorTemp();e.addVertexTempUsages(f,1);var d=e.getFreeVertexVectorTemp();e.addVertexTempUsages(d,1);var g=e.getFreeVertexVectorTemp();e.addVertexTempUsages(g,1);return"m44 "+p+", "+r+", "+l+"			\n"+"m44 "+c+", "+n+", "+l+"			\n"+"sub "+_+", "+c+", "+p+" 			\n"+"slt "+f+".x, "+p+".z, "+u+".z			\n"+"sub "+f+".y, "+o+".x, "+f+".x			\n"+"add "+g+".x, "+p+".z, "+u+".z			\n"+"sub "+g+".y, "+p+".z, "+c+".z			\n"+"seq "+g+".z, "+g+".y "+h+".x			\n"+"add "+g+".y, "+g+".y, "+g+".z			\n"+"div "+g+".z, "+g+".x, "+g+".y			\n"+"mul "+g+".xyz, "+g+".zzz, "+_+".xyz	\n"+"add "+d+".xyz, "+p+".xyz, "+g+".xyz	\n"+"mov "+d+".w, "+o+".x			\n"+"mul "+p+", "+p+", "+f+".yyyy			\n"+"mul "+d+", "+d+", "+f+".xxxx			\n"+"add "+p+", "+p+", "+d+"				\n"+"nrm "+_+".xyz, "+_+".xyz			\n"+"nrm "+f+".xyz, "+p+".xyz			\n"+"mov "+f+".w, "+o+".x				\n"+"crs "+d+".xyz, "+_+", "+f+"			\n"+"nrm "+d+".xyz, "+d+".xyz			\n"+"mul "+d+".xyz, "+d+".xyz, "+s+".xxx	\n"+"mov "+d+".w, "+o+".x			\n"+"dp3 "+g+".x, "+p+", "+h+"			\n"+"mul "+g+".x, "+g+".x, "+u+".x			\n"+"mul "+d+".xyz, "+d+".xyz, "+g+".xxx	\n"+"add "+p+".xyz, "+p+".xyz, "+d+".xyz	\n"+"m44 op, "+p+", "+a+"			\n"};r._iGetFragmentCode=function(t,e,i){return""};r.prototype.onClear=function(t){i.prototype.onClear.call(this,t);this._lineElements=null};r.prototype._setRenderState=function(t,e,r){i.prototype._setRenderState.call(this,t,e,r);if(e.colorBufferIndex>=0)this.activateVertexBufferVO(e.colorBufferIndex,this._lineElements.colors);this.activateVertexBufferVO(0,this._lineElements.positions,3);this.activateVertexBufferVO(2,this._lineElements.positions,3,12);this.activateVertexBufferVO(3,this._lineElements.thickness);e.vertexConstantData[4+16]=1;e.vertexConstantData[5+16]=1;e.vertexConstantData[6+16]=1;e.vertexConstantData[7+16]=1;e.vertexConstantData[10+16]=-1;e.vertexConstantData[12+16]=this._thickness/(this._stage.scissorRect?Math.min(this._stage.scissorRect.width,this._stage.scissorRect.height):Math.min(this._stage.width,this._stage.height));e.vertexConstantData[13+16]=1/255;e.vertexConstantData[14+16]=r.near;var n=this._stage.context};r.prototype.draw=function(e,i,r,n,s){var a=this._stage.context;i.viewMatrix.copyFrom(r.frustumMatrix3D,true);var o=M.CALCULATION_MATRIX;o.copyFrom(e.sourceEntity.transform.concatenatedMatrix3D);o.append(r.transform.inverseConcatenatedMatrix3D);i.sceneMatrix.copyFrom(o,true);a.setProgramConstantsFromArray(t.ContextGLProgramType.VERTEX,i.vertexConstantData);if(this._indices)this.getIndexBufferGL().draw(t.ContextGLDrawMode.TRIANGLES,s*3,n*3||this.numIndices);else this._stage.context.drawVertices(t.ContextGLDrawMode.TRIANGLES,s,n||this.numVertices)};r.prototype._pGetOverflowElements=function(){return new r(this._lineElements,this._stage)};return r}(wi);vs.elementsType="[elements Line]";var xs=function(i){e(r,i);function r(){var t=i.apply(this,arguments)||this;t._skyboxProjection=new M;return t}Object.defineProperty(r.prototype,"elementsType",{get:function(){return r.elementsType},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"elementsClass",{get:function(){return r},enumerable:true,configurable:true});r._iIncludeDependencies=function(t){};r._iGetVertexCode=function(t,e,i){var r="";var n=t.globalPosDependencies>0?i.globalPositionVertex:i.animatedPosition;var s=e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();t.viewMatrixIndex=s.index*4;var a=e.getFreeVertexConstant();t.scenePositionIndex=a.index*4;var o=e.getFreeVertexConstant();var h=e.getFreeVertexVectorTemp();r+="mul "+h+", "+n+", "+o+"\n"+"add "+h+", "+h+", "+a+"\n";if(t.projectionDependencies>0){i.projectionFragment=e.getFreeVarying();r+="m44 "+h+", "+h+", "+s+"\n"+"mov "+i.projectionFragment+", "+h+"\n"+"mov op, "+h+"\n"}else{r+="m44 op, "+h+", "+s+"\n"}return r};r._iGetFragmentCode=function(t,e,i){return""};r.prototype.draw=function(e,i,r,n,s){var a=i.scenePositionIndex;var o=r.transform.concatenatedMatrix3D.position;i.vertexConstantData[a++]=2*o.x;i.vertexConstantData[a++]=2*o.y;i.vertexConstantData[a++]=2*o.z;i.vertexConstantData[a++]=1;i.vertexConstantData[a++]=i.vertexConstantData[a++]=i.vertexConstantData[a++]=r.far/Math.sqrt(3);i.vertexConstantData[a]=1;var h=new A;this._skyboxProjection.copyFrom(r.viewMatrix3D);this._skyboxProjection.copyRowTo(2,h);var u=h.x;var l=h.y;var p=h.z;var c=-(h.x*o.x+h.y*o.y+h.z*o.z+Math.sqrt(u*u+l*l+p*p));var _=u>=0?1:-1;var f=l>=0?1:-1;var d=new A(_,f,1,1);var g=this._skyboxProjection.clone();g.invert();var m=g.transformVector(d);this._skyboxProjection.copyRowTo(3,d);var y=(m.x*d.x+m.y*d.y+m.z*d.z+m.w*d.w)/(u*m.x+l*m.y+p*m.z+c*m.w);this._skyboxProjection.copyRowFrom(2,new A(u*y,l*y,p*y,c*y));if(i.sceneMatrixIndex>=0)i.sceneMatrix.copyFrom(e.renderSceneTransform,true);i.viewMatrix.copyFrom(this._skyboxProjection,true);var v=this._stage.context;v.setProgramConstantsFromArray(t.ContextGLProgramType.VERTEX,i.vertexConstantData);v.setProgramConstantsFromArray(t.ContextGLProgramType.FRAGMENT,i.fragmentConstantData);if(this._indices)this.getIndexBufferGL().draw(t.ContextGLDrawMode.TRIANGLES,0,this.numIndices);else this._stage.context.drawVertices(t.ContextGLDrawMode.TRIANGLES,s,n||this.numVertices)};return r}(Di);xs.elementsType="[elements Skybox]";var bs=function(t){e(i,t);function i(e){return t.call(this,e)||this}return i}(n);bs.SHADER_INVALIDATED="ShaderInvalidated";var ws=function(){function e(e){if(e===void 0){e=false}this._scaledTextureWidth=-1;this._scaledTextureHeight=-1;this._textureWidth=-1;this._textureHeight=-1;this._textureDimensionsInvalid=true;this._program3DInvalid=true;this._textureScale=1;this._requireDepthRender=e;this._registerCache=new Dr(t.ContextGLProfile.BASELINE)}Object.defineProperty(e.prototype,"textureScale",{get:function(){return this._textureScale},set:function(t){if(this._textureScale==t)return;this._textureScale=t;this._scaledTextureWidth=this._textureWidth/this._textureScale;this._scaledTextureHeight=this._textureHeight/this._textureScale;this._textureDimensionsInvalid=true},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"rttManager",{get:function(){return this._rttManager},set:function(t){if(this._rttManager==t)return;this._rttManager=t;this._textureDimensionsInvalid=true},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(t){if(this._textureWidth==t)return;this._textureWidth=t;this._scaledTextureWidth=this._textureWidth/this._textureScale;this._textureDimensionsInvalid=true},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(t){if(this._textureHeight==t)return;this._textureHeight=t;this._scaledTextureHeight=this._textureHeight/this._textureScale;this._textureDimensionsInvalid=true;

},enumerable:true,configurable:true});e.prototype.getMainInputTexture=function(t){if(this._textureDimensionsInvalid)this.updateTextures(t);return this._mainInputTexture};e.prototype.dispose=function(){if(this._mainInputTexture)this._mainInputTexture.dispose();if(this._program3D)this._program3D.dispose()};e.prototype.invalidateProgram=function(){this._program3DInvalid=true};e.prototype.updateProgram=function(t){if(this._program3D)this._program3D.dispose();this._program3D=t.context.createProgram();this._registerCache.reset();var e=(new si).assemble("part vertex 1\n"+this.getVertexCode()+"endpart")["vertex"].data;var i=(new si).assemble("part fragment 1\n"+this.getFragmentCode()+"endpart")["fragment"].data;this._program3D.upload(e,i);this._program3DInvalid=false};e.prototype.getVertexCode=function(){var t=this._registerCache.getFreeVertexAttribute();this._positionIndex=t.index;var e=this._registerCache.getFreeVertexAttribute();this._uvIndex=e.index;this._uvVarying=this._registerCache.getFreeVarying();var i;i="mov op, "+t+"\n"+"mov "+this._uvVarying+", "+e+"\n";return i};e.prototype.getFragmentCode=function(){throw new r};e.prototype.updateTextures=function(t){if(this._mainInputTexture)this._mainInputTexture.dispose();this._mainInputTexture=new ae(this._scaledTextureWidth,this._scaledTextureHeight);this._textureDimensionsInvalid=false};e.prototype.getProgram=function(t){if(this._program3DInvalid)this.updateProgram(t);return this._program3D};e.prototype.activate=function(t,e,i){};e.prototype.deactivate=function(t){};Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:true,configurable:true});return e}();var Ds=function(i){e(r,i);function r(t,e){if(e===void 0){e=1}var r=i.call(this)||this;r._data=new Float32Array([e,.5,2,-1,0,0,0,0]);r._blendMode=t;return r}Object.defineProperty(r.prototype,"overlayTexture",{get:function(){return this._overlayTexture},set:function(t){this._overlayTexture=t;this._overlayWidth=this._overlayTexture.width;this._overlayHeight=this._overlayTexture.height},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"exposure",{get:function(){return this._data[0]},set:function(t){this._data[0]=t},enumerable:true,configurable:true});r.prototype.getFragmentCode=function(){var t=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(t,1);var e=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(e,1);var i=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(i,1);var r=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(r,1);var n=this._registerCache.getFreeTextureReg();this._inputTextureIndex=n.index;var s=this._registerCache.getFreeTextureReg();this._overlayTextureIndex=s.index;var a=this._registerCache.getFreeFragmentConstant();this._exposureIndex=a.index*4;var o=this._registerCache.getFreeFragmentConstant();this._scalingIndex=o.index*4;var h;h="tex "+t+", "+this._uvVarying+", "+n+" <2d,linear,clamp>\n"+"mul "+e+", "+this._uvVarying+", "+o+".zw\n"+"add "+e+", "+e+", "+o+".xy\n"+"tex "+e+", "+e+", "+s+" <2d,linear,clamp>\n"+"mul "+e+", "+e+", "+a+".xxx\n"+"add "+e+", "+e+", "+a+".xxx\n";switch(this._blendMode){case"multiply":h+="mul oc, "+t+", "+e+"\n";break;case"add":h+="add oc, "+t+", "+e+"\n";break;case"subtract":h+="sub oc, "+t+", "+e+"\n";break;case"overlay":h+="sge "+i+", "+t+", "+a+".yyy\n";h+="sub "+t+", "+i+", "+t+"\n";h+="sub "+e+", "+e+", "+i+"\n";h+="mul "+e+", "+e+", "+t+"\n";h+="sub "+r+", "+i+", "+a+".yyy\n";h+="div "+e+", "+e+", "+r+"\n";h+="add oc, "+e+", "+i+"\n";break;case"normal":h+="mov oc, "+t+"\n";break;default:throw new Error("Unknown blend mode")}return h};r.prototype.activate=function(e,i,r){this._data[4]=-.5*(this._textureWidth-this._overlayWidth)/this._overlayWidth;this._data[5]=-.5*(this._textureHeight-this._overlayHeight)/this._overlayHeight;this._data[6]=this._textureWidth/this._overlayWidth;this._data[7]=this._textureHeight/this._overlayHeight;var n=e.context;n.setProgramConstantsFromArray(t.ContextGLProgramType.FRAGMENT,this._data);e.getAbstraction(this._overlayTexture).activate(this._overlayTextureIndex,false)};r.prototype.deactivate=function(t){t.context.setTextureAt(1,null)};return r}(ws);var Cs=function(i){e(r,i);function r(t,e){if(t===void 0){t=1}if(e===void 0){e=-1}var r=i.call(this)||this;r._stepSize=1;r._data=new Float32Array(20);r._data.set([.299,.587,.114,0],0);r._data.set([.25,.5,.75,1],4);r._data.set([1/1024,1/1024,-1,1],8);r._data.set([1/128,1/8,8,0],12);r._data.set([1/3-.5,2/3-.5,0/3-.5,3/3-.5],16);r.amount=t;r.stepSize=e;return r}Object.defineProperty(r.prototype,"amount",{get:function(){return this._amount},set:function(t){if(this._amount==t)return;this._amount=t;this.invalidateProgram();this.updateBlurData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"stepSize",{get:function(){return this._stepSize},set:function(t){if(this._stepSize==t)return;this._stepSize=t;this.calculateStepSize();this.invalidateProgram();this.updateBlurData()},enumerable:true,configurable:true});r.prototype.getFragmentCode=function(){var t="fc0";var e="fc0.w";var i="fc1.x";var r="fc1.y";var n="fc1.z";var s="fc1.w";var a="fc2.xy";var o="fc2.x";var h="fc2.y";var u="fc2.z";var l="fc2.w";var p="fc3.x";var c="fc3.y";var _="fc3.z";var f="fc4.x";var d="fc4.y";var g="fc4.z";var m="fc4.w";var y="v0";var v="ft0.xy";var x="ft0.x";var b="ft0.y";var w="ft2.x";var D="ft2.y";var C="ft2.z";var A="ft2.w";var T="ft3.x";var P="ft3.y";var S="ft3.z";var E="ft3.w";var M="ft1";var O="ft4";var I="ft4.x";var R="ft4.y";var L="ft4.xy";var N="ft5.x";var F="ft5.y";var B="ft6";var V="ft7";var U="ft5.x";var k="ft5.y";var z="fs0";var j=M;var G=j+".xy";var H=new Array;H.push("tex",M,y,z,"<2d wrap linear>","\n");H.push("dp3",T,M,t,"\n");H.push("mov",v,y,"\n");H.push("sub",v,v,a,"\n");H.push("tex",M,v,z,"<2d wrap linear>","\n");H.push("dp3",w,M,t,"\n");H.push("mov",v,y,"\n");H.push("add",v,v,a,"\n");H.push("tex",M,v,z,"<2d wrap linear>","\n");H.push("dp3",A,M,t,"\n");H.push("mov",v,y,"\n");H.push("sub",b,b,h,"\n");H.push("add",x,x,o,"\n");H.push("tex",M,v,z,"<2d wrap linear>","\n");H.push("dp3",D,M,t,"\n");H.push("mov",v,y,"\n");H.push("add",b,b,h,"\n");H.push("sub",x,x,o,"\n");H.push("tex",M,v,z,"<2d wrap linear>","\n");H.push("dp3",C,M,t,"\n");H.push("add",P,w,D,"\n");H.push("add",S,C,A,"\n");H.push("sub",I,P,S,"\n");H.push("neg",I,I,"\n");H.push("add",P,w,C,"\n");H.push("add",S,D,A,"\n");H.push("sub",R,P,S,"\n");H.push("add",P,P,S,"\n");H.push("mul",P,P,c,"\n");H.push("mul",P,P,i,"\n");H.push("max",N,P,p,"\n");H.push("abs",P,I,"\n");H.push("abs",S,R,"\n");H.push("min",P,P,S,"\n");H.push("add",P,P,N,"\n");H.push("rcp",F,P,"\n");H.push("mul",P,I,F,"\n");H.push("mov",S,_,"\n");H.push("neg",S,S,"\n");H.push("max",P,P,S,"\n");H.push("min",P,_,P,"\n");H.push("mul",I,P,o,"\n");H.push("mul",P,R,F,"\n");H.push("mov",S,_,"\n");H.push("neg",S,S,"\n");H.push("max",P,P,S,"\n");H.push("min",P,_,P,"\n");H.push("mul",R,P,h,"\n");H.push("mul",G,L,f,"\n");H.push("add",v,y,G,"\n");H.push("tex",B,v,z,"<2d wrap linear>","\n");H.push("mul",G,L,d,"\n");H.push("add",v,y,G,"\n");H.push("tex",M,v,z,"<2d wrap linear>","\n");H.push("add",B,B,M,"\n");H.push("mul",B,B,r,"\n");H.push("mul",G,L,g,"\n");H.push("add",v,y,G,"\n");H.push("tex",V,v,z,"<2d wrap linear>","\n");H.push("mul",G,L,m,"\n");H.push("add",v,y,G,"\n");H.push("tex",M,v,z,"<2d wrap linear>","\n");H.push("add",V,V,M,"\n");H.push("mul",V,V,i,"\n");H.push("mul",M,B,r,"\n");H.push("add",V,V,M,"\n");H.push("min",P,C,A,"\n");H.push("min",S,w,D,"\n");H.push("min",P,P,S,"\n");H.push("min",U,P,T,"\n");H.push("max",P,C,A,"\n");H.push("max",S,w,D,"\n");H.push("max",P,P,S,"\n");H.push("max",k,P,T,"\n");H.push("dp3",P,t,V,"\n");H.push("slt",S,P,U,"\n");H.push("sge",E,P,k,"\n");H.push("mul",S,S,E,"\n");H.push("mul",B,B,S,"\n");H.push("sub",S,s,S,"\n");H.push("mul",V,V,S,"\n");H.push("add","oc",B,V,"\n");return H.join(" ")};r.prototype.activate=function(e,i,r){e.context.setProgramConstantsFromArray(t.ContextGLProgramType.FRAGMENT,this._data)};r.prototype.updateTextures=function(t){i.prototype.updateTextures.call(this,t);this.updateBlurData()};r.prototype.updateBlurData=function(){if(this._rttManager){this._data[8]=1/this._textureWidth;this._data[9]=1/this._textureHeight}};r.prototype.calculateStepSize=function(){this._realStepSize=1};return r}(ws);Cs.MAX_AUTO_SAMPLES=15;var As=function(i){e(r,i);function r(t,e){if(e===void 0){e=-1}var r=i.call(this)||this;r._stepSize=1;r._amount=t;r._data=new Float32Array([0,0,0,1]);r.stepSize=e;return r}Object.defineProperty(r.prototype,"amount",{get:function(){return this._amount},set:function(t){if(this._amount==t)return;this._amount=t;this.invalidateProgram();this.updateBlurData();this.calculateStepSize()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"stepSize",{get:function(){return this._stepSize},set:function(t){if(this._stepSize==t)return;this._stepSize=t;this.calculateStepSize();this.invalidateProgram();this.updateBlurData()},enumerable:true,configurable:true});r.prototype.getFragmentCode=function(){var t;var e=1;t="mov ft0, v0	\n"+"sub ft0.x, v0.x, fc0.x\n";t+="tex ft1, ft0, fs0 <2d,linear,clamp>\n";for(var i=this._realStepSize;i<=this._amount;i+=this._realStepSize){t+="add ft0.x, ft0.x, fc0.y\n"+"tex ft2, ft0, fs0 <2d,linear,clamp>\n"+"add ft1, ft1, ft2\n";++e}t+="mul oc, ft1, fc0.z\n";this._data[2]=1/e;return t};r.prototype.activate=function(e,i,r){e.context.setProgramConstantsFromArray(t.ContextGLProgramType.FRAGMENT,this._data)};r.prototype.updateTextures=function(t){i.prototype.updateTextures.call(this,t);this.updateBlurData()};r.prototype.updateBlurData=function(){var t=1/this._textureWidth;this._data[0]=this._amount*.5*t;this._data[1]=this._realStepSize*t};r.prototype.calculateStepSize=function(){this._realStepSize=this._stepSize>0?this._stepSize:this._amount>r.MAX_AUTO_SAMPLES?this._amount/r.MAX_AUTO_SAMPLES:1};return r}(ws);As.MAX_AUTO_SAMPLES=15;var Ts=function(i){e(r,i);function r(t,e){if(e===void 0){e=-1}var r=i.call(this)||this;r._stepSize=1;r._amount=t;r._data=new Float32Array([0,0,0,1]);r.stepSize=e;return r}Object.defineProperty(r.prototype,"amount",{get:function(){return this._amount},set:function(t){if(this._amount==t)return;this._amount=t;this.invalidateProgram();this.updateBlurData()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"stepSize",{get:function(){return this._stepSize},set:function(t){if(this._stepSize==t)return;this._stepSize=t;this.calculateStepSize();this.invalidateProgram();this.updateBlurData()},enumerable:true,configurable:true});r.prototype.getFragmentCode=function(){var t;var e=1;t="mov ft0, v0	\n"+"sub ft0.y, v0.y, fc0.x\n";t+="tex ft1, ft0, fs0 <2d,linear,clamp>\n";for(var i=this._realStepSize;i<=this._amount;i+=this._realStepSize){t+="add ft0.y, ft0.y, fc0.y\n";t+="tex ft2, ft0, fs0 <2d,linear,clamp>\n"+"add ft1, ft1, ft2\n";++e}t+="mul oc, ft1, fc0.z\n";this._data[2]=1/e;return t};r.prototype.activate=function(e,i,r){e.context.setProgramConstantsFromArray(t.ContextGLProgramType.FRAGMENT,this._data)};r.prototype.updateTextures=function(t){i.prototype.updateTextures.call(this,t);this.updateBlurData()};r.prototype.updateBlurData=function(){var t=1/this._textureHeight;this._data[0]=this._amount*.5*t;this._data[1]=this._realStepSize*t};r.prototype.calculateStepSize=function(){this._realStepSize=this._stepSize>0?this._stepSize:this._amount>r.MAX_AUTO_SAMPLES?this._amount/r.MAX_AUTO_SAMPLES:1};return r}(ws);Ts.MAX_AUTO_SAMPLES=15;var Ps=function(){function t(){this._textureScale=1;this._tasks=new Array}Object.defineProperty(t.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:true,configurable:true});t.prototype.addTask=function(t){this._tasks.push(t);if(this._requireDepthRender==null)this._requireDepthRender=t.requireDepthRender};Object.defineProperty(t.prototype,"tasks",{get:function(){return this._tasks},enumerable:true,configurable:true});t.prototype.getMainInputTexture=function(t){return this._tasks[0].getMainInputTexture(t)};Object.defineProperty(t.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(t){this._textureWidth=t;for(var e=0;e<this._tasks.length;++e)this._tasks[e].textureWidth=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"rttManager",{get:function(){return this._rttManager},set:function(t){this._rttManager=t;for(var e=0;e<this._tasks.length;++e)this._tasks[e].rttManager=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(t){this._textureHeight=t;for(var e=0;e<this._tasks.length;++e)this._tasks[e].textureHeight=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"textureScale",{get:function(){return this._textureScale},set:function(t){this._textureScale=t;for(var e=0;e<this._tasks.length;++e)this._tasks[e].textureScale=t},enumerable:true,configurable:true});t.prototype.setRenderTargets=function(t,e){this._tasks[this._tasks.length-1].target=t};t.prototype.dispose=function(){for(var t=0;t<this._tasks.length;++t)this._tasks[t].dispose()};t.prototype.update=function(t,e){};return t}();var Ss=function(t){e(i,t);function i(e,i,r){if(e===void 0){e=3}if(i===void 0){i=3}if(r===void 0){r=-1}var n=t.call(this)||this;n._hBlurTask=new As(e,r);n._vBlurTask=new Ts(i,r);n.addTask(n._hBlurTask);n.addTask(n._vBlurTask);return n}Object.defineProperty(i.prototype,"blurX",{get:function(){return this._hBlurTask.amount},set:function(t){this._hBlurTask.amount=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"blurY",{get:function(){return this._vBlurTask.amount},set:function(t){this._vBlurTask.amount=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"stepSize",{get:function(){return this._hBlurTask.stepSize},set:function(t){this._hBlurTask.stepSize=t;this._vBlurTask.stepSize=t},enumerable:true,configurable:true});i.prototype.setRenderTargets=function(e,i){this._hBlurTask.target=this._vBlurTask.getMainInputTexture(i);t.prototype.setRenderTargets.call(this,e,i)};return i}(Ps);var Es=function(t){e(i,t);function i(e,i){if(i===void 0){i=1}var r=t.call(this)||this;r._compositeTask=new Ds(e,i);r.addTask(r._compositeTask);return r}Object.defineProperty(i.prototype,"exposure",{get:function(){return this._compositeTask.exposure},set:function(t){this._compositeTask.exposure=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"overlayTexture",{get:function(){return this._compositeTask.overlayTexture},set:function(t){this._compositeTask.overlayTexture=t},enumerable:true,configurable:true});return i}(Ps);var Ms=function(t){e(i,t);function i(e,i){if(i===void 0){i=-1}var r=t.call(this)||this;r._fxaaTask=new Cs(e,i);r.addTask(r._fxaaTask);return r}Object.defineProperty(i.prototype,"amount",{get:function(){return this._fxaaTask.amount},set:function(t){this._fxaaTask.amount=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"stepSize",{get:function(){return this._fxaaTask.stepSize},set:function(t){this._fxaaTask.stepSize=t},enumerable:true,configurable:true});return i}(Ps);var Os=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._billboard=e;return r}i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this._billboard=null};i.prototype._pGetElements=function(){var t=this._billboard.material.getTextureAt(0);var e=-1;if(t)e=((this.renderable.style?this.renderable.style.getSamplerAt(t)||t.getSamplerAt(0):t.getSamplerAt(0))||we.getDefaultSampler()).id;this._id=e;var r=i._samplerElements[e];var n=this._billboard.billboardWidth;var s=this._billboard.billboardHeight;var a=this._billboard.billboardRect;if(!r){r=i._samplerElements[e]=new $t(new u(11,4));r.autoDeriveNormals=false;r.autoDeriveTangents=false;r.setIndices(Array(0,1,2,0,2,3));r.setPositions(Array(-a.x,s-a.y,0,n-a.x,s-a.y,0,n-a.x,-a.y,0,-a.x,-a.y,0));r.setNormals(Array(1,0,0,1,0,0,1,0,0,1,0,0));r.setTangents(Array(0,0,-1,0,0,-1,0,0,-1,0,0,-1));r.setUVs(Array(0,0,1,0,1,1,0,1))}else{r.setPositions(Array(-a.x,s-a.y,0,n-a.x,s-a.y,0,n-a.x,-a.y,0,-a.x,-a.y,0))}return this._stage.getAbstraction(r)};i.prototype._pGetMaterial=function(){return this._materialGroup.getMaterialPool(this.elementsGL).getAbstraction(this._billboard.material||we.getDefaultMaterial(this.renderable))};return i}(Nr);Os._samplerElements=new Object;var Is=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._lineSegment=e;return r}i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this._lineSegment=null};i.prototype._pGetElements=function(){var t=i._lineGraphics[this._lineSegment.id]||(i._lineGraphics[this._lineSegment.id]=new ee);var e=this._lineSegment.startPostion;var r=this._lineSegment.endPosition;var n=new Float32Array(6);var s=new Float32Array(1);n[0]=e.x;n[1]=e.y;n[2]=e.z;n[3]=r.x;n[4]=r.y;n[5]=r.z;s[0]=this._lineSegment.thickness;t.setPositions(n);t.setThickness(s);return this._stage.getAbstraction(t)};i.prototype._pGetMaterial=function(){return this._materialGroup.getMaterialPool(this.elementsGL).getAbstraction(this._lineSegment.material||we.getDefaultMaterial(this.renderable))};return i}(Nr);Is._lineGraphics=new Object;var Rs=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._skybox=e;return r}i.prototype._pGetElements=function(){var t=i._elementsGL;if(!t){var e=new $t(new u(11,4));e.autoDeriveNormals=false;e.autoDeriveTangents=false;e.setIndices(Array(0,1,2,2,3,0,6,5,4,4,7,6,2,6,7,7,3,2,4,5,1,1,0,4,4,0,3,3,7,4,2,1,5,5,6,2));e.setPositions(Array(-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1));t=i._elementsGL=new xs(e,this._stage)}return t};i.prototype._pGetMaterial=function(){return this._materialGroup.getMaterialPool(this.elementsGL).getAbstraction(this._skybox)};i._iIncludeDependencies=function(t){};return i}(Nr);var Ls=function(t){e(i,t);function i(e,i,r){var n=t.call(this,e,i,r)||this;n._shaderLightingObject=r;n._lightingPass=i;return n}i.prototype.pCompileDependencies=function(){t.prototype.pCompileDependencies.call(this);if(this._shaderLightingObject.usesShadows)this.pCompileShadowCode();if(this._shaderLightingObject.usesLights){this.initLightRegisters();this.compileLightCode()}if(this._shaderLightingObject.usesProbes)this.compileLightProbeCode();this._pVertexCode+=this._lightingPass._iGetPostLightingVertexCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._lightingPass._iGetPostLightingFragmentCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters)};i.prototype.pCompileShadowCode=function(){if(this._shaderLightingObject.normalDependencies>0){this._pSharedRegisters.shadowTarget=this._pSharedRegisters.normalFragment}else{this._pSharedRegisters.shadowTarget=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadowTarget,1)}};i.prototype.initLightRegisters=function(){var t,e;if(this._dirLightVertexConstants){e=this._dirLightVertexConstants.length;for(t=0;t<e;++t){this._dirLightVertexConstants[t]=this._pRegisterCache.getFreeVertexConstant();if(this._shaderLightingObject.lightVertexConstantIndex==-1)this._shaderLightingObject.lightVertexConstantIndex=this._dirLightVertexConstants[t].index*4}}if(this._pointLightVertexConstants){e=this._pointLightVertexConstants.length;for(t=0;t<e;++t){this._pointLightVertexConstants[t]=this._pRegisterCache.getFreeVertexConstant();if(this._shaderLightingObject.lightVertexConstantIndex==-1)this._shaderLightingObject.lightVertexConstantIndex=this._pointLightVertexConstants[t].index*4}}e=this._dirLightFragmentConstants.length;for(t=0;t<e;++t){this._dirLightFragmentConstants[t]=this._pRegisterCache.getFreeFragmentConstant();if(this._shaderLightingObject.lightFragmentConstantIndex==-1)this._shaderLightingObject.lightFragmentConstantIndex=this._dirLightFragmentConstants[t].index*4}e=this._pointLightFragmentConstants.length;for(t=0;t<e;++t){this._pointLightFragmentConstants[t]=this._pRegisterCache.getFreeFragmentConstant();if(this._shaderLightingObject.lightFragmentConstantIndex==-1)this._shaderLightingObject.lightFragmentConstantIndex=this._pointLightFragmentConstants[t].index*4}};i.prototype.compileLightCode=function(){var t;var e;var i;var r;var n=0;var s=0;var a=this._shaderLightingObject.usesLightsForSpecular;var o=this._shaderLightingObject.usesLightsForDiffuse;for(var h=0;h<this._shaderLightingObject.numDirectionalLights;++h){if(this._shaderLightingObject.usesTangentSpace){r=this._dirLightVertexConstants[n++];var u=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+u+".xyz, "+r+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+u+".w, "+r+".w\n";r=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addVertexTempUsages(r,1);this._pFragmentCode+="nrm "+r+".xyz, "+u+"\n"+"mov "+r+".w, "+u+".w\n"}else{r=this._dirLightFragmentConstants[s++]}t=this._dirLightFragmentConstants[s++];e=this._dirLightFragmentConstants[s++];if(o)this._pFragmentCode+=this._lightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,r,t,this._pRegisterCache,this._pSharedRegisters);if(a)this._pFragmentCode+=this._lightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,r,e,this._pRegisterCache,this._pSharedRegisters);if(this._shaderLightingObject.usesTangentSpace)this._pRegisterCache.removeVertexTempUsage(r)}n=0;s=0;for(var h=0;h<this._shaderLightingObject.numPointLights;++h){if(this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment)i=this._pointLightVertexConstants[n++];else i=this._pointLightFragmentConstants[s++];t=this._pointLightFragmentConstants[s++];e=this._pointLightFragmentConstants[s++];r=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(r,1);var u;if(this._shaderLightingObject.usesTangentSpace){u=this._pRegisterCache.getFreeVarying();var l=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+l+", "+i+", "+this._pSharedRegisters.animatedPosition+"\n"+"m33 "+u+".xyz, "+l+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+u+".w, "+this._pSharedRegisters.animatedPosition+".w\n"}else if(!this._shaderLightingObject.usesGlobalPosFragment){u=this._pRegisterCache.getFreeVarying();this._pVertexCode+="sub "+u+", "+i+", "+this._pSharedRegisters.globalPositionVertex+"\n"}else{u=r;this._pFragmentCode+="sub "+r+", "+i+", "+this._pSharedRegisters.globalPositionVarying+"\n"}if(this._shaderLightingObject.usesLightFallOff){this._pFragmentCode+="dp3 "+r+".w, "+u+", "+u+"\n"+"sub "+r+".w, "+r+".w, "+t+".w\n"+"mul "+r+".w, "+r+".w, "+e+".w\n"+"sat "+r+".w, "+r+".w\n"+"sub "+r+".w, "+this._pSharedRegisters.commons+".w, "+r+".w\n"+"nrm "+r+".xyz, "+u+"\n"}else{this._pFragmentCode+="nrm "+r+".xyz, "+u+"\n"+"mov "+r+".w, "+u+".w\n"}if(this._shaderLightingObject.lightFragmentConstantIndex==-1)this._shaderLightingObject.lightFragmentConstantIndex=i.index*4;if(o)this._pFragmentCode+=this._lightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,r,t,this._pRegisterCache,this._pSharedRegisters);if(a)this._pFragmentCode+=this._lightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,r,e,this._pRegisterCache,this._pSharedRegisters);this._pRegisterCache.removeFragmentTempUsage(r)}};i.prototype.compileLightProbeCode=function(){var t;var e=[".x",".y",".z",".w"];var i=new Array;var r;var n;var s=this._shaderLightingObject.usesProbesForSpecular;var a=this._shaderLightingObject.usesProbesForDiffuse;if(a)this._shaderLightingObject.lightProbeDiffuseIndices=new Array;if(s)this._shaderLightingObject.lightProbeSpecularIndices=new Array;for(r=0;r<this._pNumProbeRegisters;++r){i[r]=this._pRegisterCache.getFreeFragmentConstant();if(r==0)this._shaderLightingObject.probeWeightsIndex=i[r].index*4}for(r=0;r<this._shaderLightingObject.numLightProbes;++r){t=i[Math.floor(r/4)].toString()+e[r%4];if(a){n=this._pRegisterCache.getFreeTextureReg();this._shaderLightingObject.lightProbeDiffuseIndices[r]=n.index;this._pFragmentCode+=this._lightingPass._iGetPerProbeDiffuseFragmentCode(this._shaderLightingObject,n,t,this._pRegisterCache,this._pSharedRegisters)}if(s){n=this._pRegisterCache.getFreeTextureReg();this._shaderLightingObject.lightProbeSpecularIndices[r]=n.index;this._pFragmentCode+=this._lightingPass._iGetPerProbeSpecularFragmentCode(this._shaderLightingObject,n,t,this._pRegisterCache,this._pSharedRegisters)}}};i.prototype.pInitRegisterIndices=function(){t.prototype.pInitRegisterIndices.call(this);this._shaderLightingObject.lightVertexConstantIndex=-1;this._shaderLightingObject.lightFragmentConstantIndex=-1;this._shaderLightingObject.probeWeightsIndex=-1;this._pNumProbeRegisters=Math.ceil(this._shaderLightingObject.numLightProbes/4);if(this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment){this._pointLightVertexConstants=new Array(this._shaderLightingObject.numPointLights);this._pointLightFragmentConstants=new Array(this._shaderLightingObject.numPointLights*2)}else{this._pointLightFragmentConstants=new Array(this._shaderLightingObject.numPointLights*3)}if(this._shaderLightingObject.usesTangentSpace){this._dirLightVertexConstants=new Array(this._shaderLightingObject.numDirectionalLights);this._dirLightFragmentConstants=new Array(this._shaderLightingObject.numDirectionalLights*2)}else{this._dirLightFragmentConstants=new Array(this._shaderLightingObject.numDirectionalLights*3)}};return i}(Ar);var Ns=function(){function t(){}return t}();Ns.REGISTRATION_POINT="registrationPoint";Ns.TRANSFORM_POINT="transformPoint";var Fs=function(){function t(){}return t}();Fs.MOUSE_ENABLED=1;Fs.VISIBLE=2;Fs.MASK_ID=4;Fs.MASKS=8;Fs.COLOR_TRANSFORM=16;Fs.SCENE_TRANSFORM=32;Fs.ALL=63;var Bs=function(){function t(){}return t}();Bs.DEFAULT="default";Bs.CAMERA_PLANE="cameraPlane";Bs.CAMERA_POSITION="cameraPosition";var Vs=function(){function t(){}return t}();Vs.SPHERE="sphere";Vs.AXIS_ALIGNED_BOX="axisAlignedBox";Vs.NULL="null";var Us=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._object=i;return r}Object.defineProperty(i.prototype,"object",{get:function(){return this._object},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._object)};return i}(n);Us.VISIBLITY_UPDATED="visiblityUpdated";Us.SCENETRANSFORM_CHANGED="scenetransformChanged";Us.SCENE_CHANGED="sceneChanged";Us.PARTITION_CHANGED="partitionChanged";Us.INVALIDATE_PARTITION_BOUNDS="invalidatePartitionBounds";var ks=function(t){e(i,t);function i(){var e=t.call(this)||this;e._queuedEvents=new Array;e._boxBoundsInvalid=true;e._sphereBoundsInvalid=true;e._concatenatedMatrix3D=new M;e._pIsEntity=false;e._pIsContainer=false;e._sessionID=-1;e._depthID=-16384;e._scenePosition=new A;e._explicitVisibility=true;e._explicitMaskId=-1;e._pImplicitVisibility=true;e._pImplicitMaskId=-1;e._pImplicitMaskIds=new Array;e._explicitMouseEnabled=true;e._pImplicitMouseEnabled=true;e._orientationMatrix=new M;e._inheritColorTransform=false;e._maskMode=false;e._tempVector3D=new A;e.alignmentMode=Ns.REGISTRATION_POINT;e.castsShadows=true;e.orientationMode=Bs.DEFAULT;e.zOffset=0;e._onInvalidatePropertiesDelegate=function(t){return e._onInvalidateProperties(t)};e._transform=new I(null,e._concatenatedMatrix3D);e._transform.addEventListener(O.INVALIDATE_MATRIX3D,function(t){return e._onInvalidateMatrix3D(t)});e._transform.addEventListener(O.UPDATE_CONCATENATED_MATRIX3D,function(t){return e._onUpdateConcatenatedMatrix3D(t)});e._transform.addEventListener(O.INVALIDATE_COLOR_TRANSFORM,function(t){return e._onInvalidateColorTransform(t)});e._boundsType=Vs.AXIS_ALIGNED_BOX;return e}Object.defineProperty(i.prototype,"traverseName",{get:function(){return i.traverseName},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"adapter",{get:function(){return this._adapter},set:function(t){this._adapter=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"inheritColorTransform",{get:function(){return this._inheritColorTransform},set:function(t){if(this._inheritColorTransform==t)return;this._inheritColorTransform=t;this.pInvalidateHierarchicalProperties(Fs.COLOR_TRANSFORM)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"alpha",{get:function(){return this._transform.colorTransform?this._transform.colorTransform.alphaMultiplier:1},set:function(t){if(!this._transform.colorTransform)this._transform.colorTransform=new C;this._transform.colorTransform.alphaMultiplier=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"boundsType",{get:function(){return this._boundsType},set:function(t){if(this._boundsType==t)return;this._boundsType=t;this.invalidate();this._pInvalidateBounds()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"depth",{get:function(){if(this._registrationMatrix3D)return this.getBox().depth*this.scaleZ*this._registrationMatrix3D[10];return this.getBox().depth*this.scaleZ},set:function(t){if(this._depth==t)return;this._depth=t;this._setScaleZ(t/this.getBox().depth)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"eulers",{get:function(){if(!this._eulers)this._eulers=new A;this._eulers.x=this.rotationX;this._eulers.y=this.rotationY;this._eulers.z=this.rotationZ;return this._eulers},set:function(t){this._transform.rotation.x=t.x;this._transform.rotation.y=t.y;this._transform.rotation.z=t.z;this._transform.invalidateMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"height",{get:function(){if(this._registrationMatrix3D)return this.getBox().height*this.scaleY*this._registrationMatrix3D[5];return this.getBox().height*this.scaleY},set:function(t){if(this._height==t)return;this._height=t;this._setScaleY(t/this.getBox().height)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"index",{get:function(){if(this._pParent)return this._pParent.getChildIndex(this);return 0},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"isEntity",{get:function(){return this._pIsEntity},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"isContainer",{get:function(){return this._pIsContainer},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"loaderInfo",{get:function(){return this._loaderInfo},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"maskMode",{get:function(){return this._maskMode},set:function(t){if(this._maskMode==t)return;this._maskMode=t;this._explicitMaskId=t?this.id:-1;this._updateMaskMode()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"mouseEnabled",{get:function(){return this._explicitMouseEnabled},set:function(t){if(this._explicitMouseEnabled==t)return;this._explicitMouseEnabled=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"mouseX",{get:function(){return this._mouseX},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"mouseY",{get:function(){return this._mouseY},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"name",{get:function(){return this._pName},set:function(t){this._pName=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"parent",{get:function(){return this._pParent},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"isPartition",{get:function(){return this._iIsPartition},set:function(t){if(this._iIsPartition==t)return;this._iIsPartition=t;this._iSetScene(this._pScene,this._pParent?this._pParent._pPartition:null);this.dispatchEvent(new Us(Us.PARTITION_CHANGED,this))},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"registrationPoint",{get:function(){if(this._registrationMatrix3D)return new A(-this._registrationMatrix3D._rawData[12]*this.scaleX,-this._registrationMatrix3D._rawData[13]*this.scaleY,-this._registrationMatrix3D._rawData[14]*this.scaleZ);

return null},set:function(t){if(!t){if(!this._registrationMatrix3D)return;this._registrationMatrix3D._rawData[12]=0;this._registrationMatrix3D._rawData[13]=0;this._registrationMatrix3D._rawData[14]=0;if(this._registrationMatrix3D.isIdentity())this._registrationMatrix3D=null}else{if(!this._registrationMatrix3D)this._registrationMatrix3D=new M;this._registrationMatrix3D._rawData[12]=-t.x/this._transform.scale.x;this._registrationMatrix3D._rawData[13]=-t.y/this._transform.scale.y;this._registrationMatrix3D._rawData[14]=-t.z/this._transform.scale.z}this._registrationMatrix3D.invalidatePosition();this.pInvalidateHierarchicalProperties(Fs.SCENE_TRANSFORM)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"registrationScale",{get:function(){if(this._registrationMatrix3D)return new A(this._registrationMatrix3D._rawData[0],this._registrationMatrix3D._rawData[5],this._registrationMatrix3D._rawData[10]);return null},set:function(t){if(!t){if(!this._registrationMatrix3D)return;this._registrationMatrix3D._rawData[0]=1;this._registrationMatrix3D._rawData[5]=1;this._registrationMatrix3D._rawData[10]=1;if(this._registrationMatrix3D.isIdentity())this._registrationMatrix3D=null}else{if(!this._registrationMatrix3D)this._registrationMatrix3D=new M;this._registrationMatrix3D._rawData[0]=t.x;this._registrationMatrix3D._rawData[5]=t.y;this._registrationMatrix3D._rawData[10]=t.z}this.pInvalidateHierarchicalProperties(Fs.SCENE_TRANSFORM)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"root",{get:function(){return this._root},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"rotationX",{get:function(){return this._transform.rotation.x*P.RADIANS_TO_DEGREES},set:function(t){if(this.rotationX==t)return;this._transform.rotation.x=t*P.DEGREES_TO_RADIANS;this._transform.invalidateMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"rotationY",{get:function(){return this._transform.rotation.y*P.RADIANS_TO_DEGREES},set:function(t){if(this.rotationY==t)return;this._transform.rotation.y=t*P.DEGREES_TO_RADIANS;this._transform.invalidateMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"rotationZ",{get:function(){return this._transform.rotation.z*P.RADIANS_TO_DEGREES},set:function(t){if(this.rotationZ==t)return;this._transform.rotation.z=t*P.DEGREES_TO_RADIANS;this._transform.invalidateMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._transform.scale.x},set:function(t){this._width=null;this._setScaleX(t)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._transform.scale.y},set:function(t){this._height=null;this._setScaleY(t)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"scaleZ",{get:function(){return this._transform.scale.z},set:function(t){this._depth=null;this._setScaleZ(t)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"skewX",{get:function(){return this._transform.skew.x},set:function(t){if(this.skewX==t)return;this._transform.skew.x=t;this._transform.invalidateMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"skewY",{get:function(){return this._transform.skew.y},set:function(t){if(this.skewY==t)return;this._transform.skew.y=t;this._transform.invalidateMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"skewZ",{get:function(){return this._transform.skew.z},set:function(t){if(this.skewZ==t)return;this._transform.skew.z=t;this._transform.invalidateMatrix3D()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"partition",{get:function(){return this._pPartition},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"scene",{get:function(){return this._pScene},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"scenePosition",{get:function(){if(this._scenePositionDirty){if(this._registrationMatrix3D&&this.alignmentMode==Ns.REGISTRATION_POINT){this._scenePosition.x=-this._registrationMatrix3D._rawData[12];this._scenePosition.y=-this._registrationMatrix3D._rawData[13];this._scenePosition.z=-this._registrationMatrix3D._rawData[14];this._scenePosition=this._transform.concatenatedMatrix3D.transformVector(this._scenePosition,this._scenePosition)}else{this._transform.concatenatedMatrix3D.copyColumnTo(3,this._scenePosition)}this._scenePositionDirty=false}return this._scenePosition},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animator",{get:function(){return this._animator},set:function(t){if(this._animator)this._animator.removeOwner(this);this._animator=t;if(this._animator)this._animator.addOwner(this)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"material",{get:function(){return this._material},set:function(t){if(this._material==t)return;if(this._material)this._material.iRemoveOwner(this);this._material=t;if(this._material)this._material.iAddOwner(this);this.invalidateMaterial()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"style",{get:function(){return this._style},set:function(t){if(this._style==t)return;if(this._style)this._style.removeEventListener(kt.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate);this._style=t;if(this._style)this._style.addEventListener(kt.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate);this._onInvalidateProperties()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"shaderPickingDetails",{get:function(){return this._shaderPickingDetails},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"debugVisible",{get:function(){return this._debugVisible},set:function(t){if(t==this._debugVisible)return;this._debugVisible=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"transform",{get:function(){return this._transform},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"visible",{get:function(){return this._explicitVisibility},set:function(t){if(this._explicitVisibility==t)return;this._explicitVisibility=t;this.pInvalidateHierarchicalProperties(Fs.VISIBLE)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"masks",{get:function(){return this._explicitMasks},set:function(t){if(this._explicitMasks==t)return;this._explicitMasks=t;if(t!=null&&t.length){var e=t.length;for(var i=0;i<e;i++)t[i].maskMode=true}this.pInvalidateHierarchicalProperties(Fs.MASKS)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"width",{get:function(){if(this._registrationMatrix3D)return this.getBox().width*this.scaleX*this._registrationMatrix3D[0];return this.getBox().width*this.scaleX},set:function(t){if(this._width==t)return;this._width=t;this._setScaleX(t/this.getBox().width)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"x",{get:function(){return this._transform.position.x},set:function(t){if(this._transform.position.x==t)return;this._transform.matrix3D._rawData[12]=t;this._transform.invalidatePosition()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"y",{get:function(){return this._transform.position.y},set:function(t){if(this._transform.position.y==t)return;this._transform.matrix3D._rawData[13]=t;this._transform.invalidatePosition()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"z",{get:function(){return this._transform.position.z},set:function(t){if(this._transform.position.z==t)return;this._transform.matrix3D._rawData[14]=t;this._transform.invalidatePosition()},enumerable:true,configurable:true});i.prototype.addEventListener=function(e,i){t.prototype.addEventListener.call(this,e,i);switch(e){case Us.SCENE_CHANGED:this._listenToSceneChanged=true;break;case Us.SCENETRANSFORM_CHANGED:this._listenToSceneTransformChanged=true;break}};i.prototype.clone=function(){var t=new i;this.copyTo(t);return t};i.prototype.copyTo=function(t){t.isPartition=this._iIsPartition;t.boundsType=this._boundsType;if(this._registrationMatrix3D)t._registrationMatrix3D=this._registrationMatrix3D.clone();t.name=this._pName;t.mouseEnabled=this._explicitMouseEnabled;t.extra=this.extra;t.maskMode=this._maskMode;t.castsShadows=this.castsShadows;if(this._explicitMasks)t.masks=this._explicitMasks;if(this._adapter)t.adapter=this._adapter.clone(t);this._transform.copyRawDataTo(t._transform)};i.prototype.dispose=function(){this.disposeValues()};i.prototype.disposeValues=function(){if(this._pParent)this._pParent.removeChild(this);this._explicitMasks=null};i.prototype.getBounds=function(t){return this._bounds};i.prototype.getRect=function(t){if(t===void 0){t=null}return this._bounds};i.prototype.getBox=function(t){if(t===void 0){t=null}if(this._iSourcePrefab)this._iSourcePrefab._iValidate();if(this._boxBoundsInvalid){this._pUpdateBoxBounds();if(this._width!=null)this._setScaleX(this._width/this._pBoxBounds.width);if(this._height!=null)this._setScaleY(this._height/this._pBoxBounds.height);if(this._depth!=null)this._setScaleZ(this._depth/this._pBoxBounds.depth)}if(t==null||t==this)return this._pBoxBounds;if(t==this._pParent){if(this._registrationMatrix3D){if(this._tempTransform==null)this._tempTransform=new M;this._tempTransform.copyFrom(this._transform.matrix3D);this._tempTransform.prepend(this._registrationMatrix3D);if(this.alignmentMode!=Ns.REGISTRATION_POINT)this._tempTransform.appendTranslation(-this._registrationMatrix3D._rawData[12]*this._transform.scale.x,-this._registrationMatrix3D._rawData[13]*this._transform.scale.y,-this._registrationMatrix3D._rawData[14]*this._transform.scale.z);return this._tempTransform.transformBox(this._pBoxBounds)}return this._transform.matrix3D.transformBox(this._pBoxBounds)}else return t.transform.inverseConcatenatedMatrix3D.transformBox(this.transform.concatenatedMatrix3D.transformBox(this._pBoxBounds))};i.prototype.getSphere=function(t){if(t===void 0){t=null}if(this._iSourcePrefab)this._iSourcePrefab._iValidate();if(this._sphereBoundsInvalid)this._pUpdateSphereBounds();return this._pSphereBounds};i.prototype.globalToLocal=function(t,e){if(e===void 0){e=null}this._tempVector3D.setTo(t.x,t.y,0);var i=this._transform.inverseConcatenatedMatrix3D.transformVector(this._tempVector3D,this._tempVector3D);if(!e)e=new z;e.x=i.x;e.y=i.y;return e};i.prototype.globalToLocal3D=function(t){return this._transform.inverseConcatenatedMatrix3D.transformVector(t)};i.prototype.hitTestObject=function(t){var e=t.getBox();if(!e)return false;var i=new z(e.x,e.y);var r=new z(e.x,e.y-e.height);var n=new z(e.x+e.width,e.y);var s=new z(e.x+e.width,e.y-e.height);i=this.globalToLocal(t.localToGlobal(i));r=this.globalToLocal(t.localToGlobal(r));n=this.globalToLocal(t.localToGlobal(n));s=this.globalToLocal(t.localToGlobal(s));var a=this.getBox();if(!a)return false;if(i.x<=a.left&&i.x<=a.left&&i.y<=a.top&&i.y>=a.bottom)return true;if(r.x<=a.left&&r.x<=a.left&&r.y<=a.top&&r.y>=a.bottom)return true;if(n.x<=a.left&&n.x<=a.left&&n.y<=a.top&&n.y>=a.bottom)return true;if(s.x<=a.left&&s.x<=a.left&&s.y<=a.top&&s.y>=a.bottom)return true;var o=n.y-i.y;var h=-(n.x-i.x);var u=s.y-n.y;var l=-(s.x-n.x);var p=r.y-s.y;var c=-(r.x-s.x);var _=i.y-r.y;var f=-(i.x-r.x);var d=a.left-i.x;var g=a.top-i.y;var m=a.left-n.x;var y=a.top-n.y;var v=a.left-s.x;var x=a.top-s.y;var b=a.left-r.x;var w=a.top-r.y;var D=o*d+h*g;var C=u*m+l*y;var A=p*v+c*x;var T=_*b+f*w;if(D<0&&C<0&&A<0&&T<0)return true;d=a.right-i.x;g=a.top-i.y;m=a.right-n.x;y=a.top-n.y;v=a.right-s.x;x=a.top-s.y;b=a.right-r.x;w=a.top-r.y;D=o*d+h*g;C=u*m+l*y;A=p*v+c*x;T=_*b+f*w;if(D<0&&C<0&&A<0&&T<0)return true;d=a.left-i.x;g=a.bottom-i.y;m=a.left-n.x;y=a.bottom-n.y;v=a.left-s.x;x=a.bottom-s.y;b=a.left-r.x;w=a.bottom-r.y;D=o*d+h*g;C=u*m+l*y;A=p*v+c*x;T=_*b+f*w;if(D<0&&C<0&&A<0&&T<0)return true;d=a.right-i.x;g=a.bottom-i.y;m=a.right-n.x;y=a.bottom-n.y;v=a.right-s.x;x=a.bottom-s.y;b=a.right-r.x;w=a.bottom-r.y;D=o*d+h*g;C=u*m+l*y;A=p*v+c*x;T=_*b+f*w;if(D<0&&C<0&&A<0&&T<0)return true;return false};i.prototype.hitTestPoint=function(t,e,i,r){if(i===void 0){i=false}if(r===void 0){r=false}if(!this._pImplicitVisibility)return;if(this._pImplicitMaskId!=-1&&!r)return;if(this._explicitMasks){var n=this._explicitMasks.length;var s=false;for(var a=0;a<n;a++){if(this._explicitMasks[a].hitTestPoint(t,e,i,true)){s=true;break}}if(!s)return false}return this._hitTestPointInternal(t,e,i,r)};i.prototype.lookAt=function(t,e){if(e===void 0){e=null}if(e==null)e=A.Y_AXIS;var i=M.getPointAtMatrix(new A,t.subtract(this._transform.position),e,M.CALCULATION_MATRIX);var r=i.decompose()[1];this.rotationX=r.x*P.RADIANS_TO_DEGREES;this.rotationY=r.y*P.RADIANS_TO_DEGREES;this.rotationZ=r.z*P.RADIANS_TO_DEGREES};i.prototype.localToGlobal=function(t,e){if(e===void 0){e=null}this._tempVector3D.setTo(t.x,t.y,0);var i=this._transform.concatenatedMatrix3D.transformVector(this._tempVector3D,this._tempVector3D);if(!e)e=new z;e.x=i.x;e.y=i.y;return e};i.prototype.localToGlobal3D=function(t){return this._transform.concatenatedMatrix3D.transformVector(t)};i.prototype.movePivot=function(t,e,i){if(t==0&&e==0&&i==0)return;if(!this._registrationMatrix3D)this._registrationMatrix3D=new M;this._registrationMatrix3D._rawData[12]-=t/this._transform.scale.x;this._registrationMatrix3D._rawData[13]-=e/this._transform.scale.y;this._registrationMatrix3D._rawData[14]-=i/this._transform.scale.z;this.pInvalidateHierarchicalProperties(Fs.SCENE_TRANSFORM)};i.prototype.reset=function(){this.visible=true;if(this._transform.matrix3D)this._transform.clearMatrix3D();if(this._transform.colorTransform)this._transform.clearColorTransform();this.masks=null;this.maskMode=false};i.prototype.getRenderSceneTransform=function(t){if(this.orientationMode==Bs.CAMERA_PLANE){var e=t.decompose();e[0].copyFrom(this.scenePosition);e[3].copyFrom(this._transform.scale);this._orientationMatrix.recompose(e);if(this._registrationMatrix3D){this._orientationMatrix.prepend(this._registrationMatrix3D);if(this.alignmentMode!=Ns.REGISTRATION_POINT)this._orientationMatrix.appendTranslation(-this._registrationMatrix3D._rawData[12]*this._transform.scale.x,-this._registrationMatrix3D._rawData[13]*this._transform.scale.y,-this._registrationMatrix3D._rawData[14]*this._transform.scale.z)}return this._orientationMatrix}return this._transform.concatenatedMatrix3D};i.prototype.removeEventListener=function(e,i){t.prototype.removeEventListener.call(this,e,i);if(this.hasEventListener(e))return;switch(e){case Us.SCENE_CHANGED:this._listenToSceneChanged=false;break;case Us.SCENETRANSFORM_CHANGED:this._listenToSceneTransformChanged=true;break}};Object.defineProperty(i.prototype,"_iPickingCollision",{get:function(){if(!this._pickingCollision)this._pickingCollision=new He(this);return this._pickingCollision},enumerable:true,configurable:true});i.prototype.iSetParent=function(t){this._pParent=t;if(t)this._iSetScene(t._pScene,t._pPartition);else this._iSetScene(null,null);this.pInvalidateHierarchicalProperties(Fs.ALL)};i.prototype.pInvalidateHierarchicalProperties=function(t){var e=(this._hierarchicalPropsDirty^t)&t;if(!e)return true;this._hierarchicalPropsDirty|=t;if(e&Fs.SCENE_TRANSFORM){this.transform.invalidateConcatenatedMatrix3D();this._scenePositionDirty=true;if(this.isEntity)this.invalidatePartitionBounds();if(this._pParent)this._pParent._pInvalidateBounds();if(this._listenToSceneTransformChanged)this.queueDispatch(this._sceneTransformChanged||(this._sceneTransformChanged=new Us(Us.SCENETRANSFORM_CHANGED,this)))}return false};i.prototype._iSetScene=function(t,e){var i=this._pScene!=t;if(this._pScene){this._pScene._iUnregisterObject(this);this.clear()}this._pPartition=this._iIsPartition?this:e;if(i)this._pScene=t;if(this._pScene){this._pScene._iRegisterObject(this)}if(i&&this._listenToSceneChanged)this.queueDispatch(this._sceneChanged||(this._sceneChanged=new Us(Us.SCENE_CHANGED,this)))};i.prototype._onUpdateConcatenatedMatrix3D=function(t){if(this._iController)this._iController.updateController();this._concatenatedMatrix3D.copyFrom(this._transform.matrix3D);if(this._registrationMatrix3D){this._concatenatedMatrix3D.prepend(this._registrationMatrix3D);if(this.alignmentMode!=Ns.REGISTRATION_POINT)this._concatenatedMatrix3D.appendTranslation(-this._registrationMatrix3D._rawData[12]*this._transform.scale.x,-this._registrationMatrix3D._rawData[13]*this._transform.scale.y,-this._registrationMatrix3D._rawData[14]*this._transform.scale.z)}if(this._pParent&&!this._pParent._iIsRoot)this._concatenatedMatrix3D.append(this._pParent._transform.concatenatedMatrix3D);this._matrix3DDirty=false;this._hierarchicalPropsDirty^=Fs.SCENE_TRANSFORM};i.prototype._iInternalUpdate=function(){if(this._iController)this._iController.update();var t=this._queuedEvents.length;for(var e=0;e<t;++e)this.dispatchEvent(this._queuedEvents[e]);this._queuedEvents.length=0};i.prototype._iIsVisible=function(){if(this._hierarchicalPropsDirty&Fs.VISIBLE)this._updateVisible();return this._pImplicitVisibility};i.prototype._iAssignedMaskId=function(){if(this._hierarchicalPropsDirty&Fs.MASK_ID)this._updateMaskId();return this._pImplicitMaskId};i.prototype._iAssignedMasks=function(){if(this._hierarchicalPropsDirty&Fs.MASKS)this._updateMasks();return this._pImplicitMasks};i.prototype._iMasksConfig=function(){if(this._hierarchicalPropsDirty&Fs.MASKS)this._updateMasks();return this._pImplicitMaskIds};i.prototype._iAssignedColorTransform=function(){if(this._hierarchicalPropsDirty&Fs.COLOR_TRANSFORM)this._updateColorTransform();return this._pImplicitColorTransform};i.prototype._iIsMouseEnabled=function(){if(this._hierarchicalPropsDirty&Fs.MOUSE_ENABLED)this._updateMouseEnabled();return this._pImplicitMouseEnabled&&this._explicitMouseEnabled};i.prototype._acceptTraverser=function(t){};i.prototype._onInvalidateMatrix3D=function(t){if(this._matrix3DDirty)return;this._matrix3DDirty=true;this.pInvalidateHierarchicalProperties(Fs.SCENE_TRANSFORM)};i.prototype._onInvalidateColorTransform=function(t){this.pInvalidateHierarchicalProperties(Fs.COLOR_TRANSFORM)};i.prototype._pInvalidateBounds=function(){this._boxBoundsInvalid=true;this._sphereBoundsInvalid=true;if(this.isEntity)this.invalidatePartitionBounds();if(this._pParent)this._pParent._pInvalidateBounds()};i.prototype._pUpdateBoxBounds=function(){this._boxBoundsInvalid=false;if(this._pBoxBounds==null)this._pBoxBounds=new T};i.prototype._pUpdateSphereBounds=function(){this._sphereBoundsInvalid=false;if(this._pSphereBounds==null)this._pSphereBounds=new q};i.prototype.queueDispatch=function(t){this._queuedEvents.push(t)};i.prototype._setScaleX=function(t){if(this.scaleX==t)return;this._transform.scale.x=t;this._transform.invalidateMatrix3D()};i.prototype._setScaleY=function(t){if(this.scaleY==t)return;this._transform.scale.y=t;this._transform.invalidateMatrix3D()};i.prototype._setScaleZ=function(t){if(this.scaleZ==t)return;this._transform.scale.z=t;this._transform.invalidateMatrix3D()};i.prototype._updateMouseEnabled=function(){this._pImplicitMouseEnabled=this._pParent?this._pParent.mouseChildren&&this._pParent._pImplicitMouseEnabled:true;this._hierarchicalPropsDirty^=Fs.MOUSE_ENABLED};i.prototype._updateVisible=function(){this._pImplicitVisibility=this._pParent?this._explicitVisibility&&this._pParent._iIsVisible():this._explicitVisibility;this._hierarchicalPropsDirty^=Fs.VISIBLE};i.prototype._updateMaskId=function(){this._pImplicitMaskId=this._pParent&&this._pParent._iAssignedMaskId()!=-1?this._pParent._iAssignedMaskId():this._explicitMaskId;this._hierarchicalPropsDirty^=Fs.MASK_ID};i.prototype._updateMasks=function(){this._pImplicitMasks=this._pParent&&this._pParent._iAssignedMasks()?this._explicitMasks!=null?this._pParent._iAssignedMasks().concat([this._explicitMasks]):this._pParent._iAssignedMasks().concat():this._explicitMasks!=null?[this._explicitMasks]:null;this._pImplicitMaskIds.length=0;if(this._pImplicitMasks&&this._pImplicitMasks.length){var t=this._pImplicitMasks.length;var e;var i;var r;for(var n=0;n<t;n++){i=this._pImplicitMasks[n];e=i.length;r=new Array;for(var s=0;s<e;s++)r.push(i[s].id);this._pImplicitMaskIds.push(r)}}this._hierarchicalPropsDirty^=Fs.MASKS};i.prototype._updateColorTransform=function(){if(!this._pImplicitColorTransform)this._pImplicitColorTransform=new C;if(this._inheritColorTransform&&this._pParent&&this._pParent._iAssignedColorTransform()){this._pImplicitColorTransform.copyFrom(this._pParent._iAssignedColorTransform());if(this._transform.colorTransform)this._pImplicitColorTransform.prepend(this._transform.colorTransform)}else{if(this._transform.colorTransform)this._pImplicitColorTransform.copyFrom(this._transform.colorTransform);else this._pImplicitColorTransform.clear()}this._hierarchicalPropsDirty^=Fs.COLOR_TRANSFORM};i.prototype._updateMaskMode=function(){if(this.maskMode)this.mouseEnabled=false;this.pInvalidateHierarchicalProperties(Fs.MASK_ID)};i.prototype.clear=function(){t.prototype.clear.call(this);var e;this._pImplicitColorTransform=null;this._pImplicitMasks=null};i.prototype.invalidatePartitionBounds=function(){this.dispatchEvent(new Us(Us.INVALIDATE_PARTITION_BOUNDS,this))};i.prototype._hitTestPointInternal=function(t,e,i,r){return false};i.prototype.invalidateMaterial=function(){};i.prototype.invalidateElements=function(){};i.prototype._onInvalidateProperties=function(t){if(t===void 0){t=null}this.invalidateMaterial()};return i}(h);ks.traverseName="applyEntity";var zs=function(t){e(i,t);function i(e,i,r){if(i===void 0){i="auto"}if(r===void 0){r=false}var n=t.call(this)||this;n._pIsEntity=true;n._onInvalidateTextureDelegate=function(t){return n._onInvalidateTexture(t)};n.material=e;n._updateDimensions();n._boundsType=Vs.AXIS_ALIGNED_BOX;return n}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"billboardRect",{get:function(){return this._billboardRect},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"billboardHeight",{get:function(){return this._billboardHeight},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"billboardWidth",{get:function(){return this._billboardWidth},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"material",{get:function(){return this._material},set:function(t){if(t==this._material)return;if(this._material){this._material.iRemoveOwner(this);this._material.removeEventListener(de.INVALIDATE_TEXTURE,this._onInvalidateTextureDelegate)}this._material=t;if(this._material){this._material.iAddOwner(this);this._material.addEventListener(de.INVALIDATE_TEXTURE,this._onInvalidateTextureDelegate)}},enumerable:true,configurable:true});i.prototype._pUpdateBoxBounds=function(){t.prototype._pUpdateBoxBounds.call(this);this._pBoxBounds.width=this._billboardRect.width;this._pBoxBounds.height=this._billboardRect.height};i.prototype.clone=function(){var t=new i(this.material);return t};i.prototype._acceptTraverser=function(t){t[i.traverseName](this)};i.prototype._updateDimensions=function(){var t=this.material.getTextureAt(0);var e=t?(this._style?this._style.getImageAt(t):null)||(this.material.style?this.material.style.getImageAt(t):null)||t.getImageAt(0):null;if(e){var i=(this._style?this._style.getSamplerAt(t):null)||(this.material.style?this.material.style.getSamplerAt(t):null)||t.getSamplerAt(0)||we.getDefaultSampler();if(i.imageRect){this._billboardWidth=i.imageRect.width*e.width;this._billboardHeight=i.imageRect.height*e.height}else{this._billboardWidth=e.rect.width;this._billboardHeight=e.rect.height}this._billboardRect=i.frameRect||new Y(0,0,this._billboardWidth,this._billboardHeight)}else{this._billboardWidth=1;this._billboardHeight=1;this._billboardRect=new Y(0,0,1,1)}this._pInvalidateBounds();this.invalidateElements()};i.prototype.invalidateElements=function(){this.dispatchEvent(new Ut(Ut.INVALIDATE_ELEMENTS,this))};i.prototype.invalidateMaterial=function(){this.dispatchEvent(new Ut(Ut.INVALIDATE_MATERIAL,this))};i.prototype._onInvalidateProperties=function(t){if(t===void 0){t=null}this.invalidateMaterial();this._updateDimensions()};i.prototype._onInvalidateTexture=function(t){this._updateDimensions()};return i}(ks);zs.traverseName=Ht.addRenderableName("applyBillboard");zs.assetType="[asset Billboard]";var js=function(){function t(){}t.setInterval=function(t){this._intervalID++;this._active_intervals[this._intervalID]=t;return this._intervalID};t.clearInterval=function(t){delete this._active_intervals[t]};t.execute_intervals=function(){for(var t in this._active_intervals){this._active_intervals[t].call()}};t.add_child_to_dispose=function(t){this._queued_dispose.push(t)};t.add_script_to_queue=function(t,e){var i=this._queued_mcs_pass2.length;while(i--){this._queued_mcs.push(this._queued_mcs_pass2[i]);this._queued_scripts.push(this._queued_scripts_pass2[i])}this._queued_mcs_pass2.length=0;this._queued_scripts_pass2.length=0;this._queued_mcs.push(t);this._queued_scripts.push(e)};t.add_script_to_queue_pass2=function(t,e){this._queued_mcs_pass2.push(t);this._queued_scripts_pass2.push(e)};t.execute_queue=function(){if(this._queued_mcs.length==0&&this._queued_mcs_pass2.length==0)return;var t=this._queued_mcs_pass2.length;while(t--){this._queued_mcs.push(this._queued_mcs_pass2[t]);this._queued_scripts.push(this._queued_scripts_pass2[t])}this._queued_mcs_pass2.length=0;this._queued_scripts_pass2.length=0;var e;for(t=0;t<this._queued_mcs.length;t++){e=this._queued_mcs[t];if(e.scene!=null){var i=e.adapter?e.adapter:e;this._queued_scripts[t].call(i)}}this._queued_mcs.length=0;this._queued_scripts.length=0};t.execute_dispose=function(){var t=this._queued_dispose.length;for(var e=0;e<t;e++)this._queued_dispose[e].dispose();this._queued_dispose.length=0};return t}();js.frameScriptDebug=undefined;js._queued_dispose=new Array;js._queued_mcs=[];js._queued_scripts=[];js._queued_mcs_pass2=[];js._queued_scripts_pass2=[];js._active_intervals=new Object;js._intervalID=0;var Gs=function(){function t(){this._functions=[];this._update_indices=[];this.numKeyFrames=0;this.keyframe_indices=[];this._potentialPrototypes=[];this._labels={};this._framescripts={};this._framescripts_translated={};this._functions[1]=this.update_mtx_all;this._functions[2]=this.update_colortransform;this._functions[3]=this.update_masks;this._functions[4]=this.update_name;this._functions[5]=this.update_button_name;this._functions[6]=this.update_visibility;this._functions[7]=this.update_blendmode;this._functions[8]=this.update_rendermode;this._functions[11]=this.update_mtx_scale_rot;this._functions[12]=this.update_mtx_pos;this._functions[200]=this.enable_maskmode;this._functions[201]=this.remove_masks}t.prototype.init=function(){if(this.frame_command_indices==null||this.frame_recipe==null||this.keyframe_durations==null)return;this.keyframe_firstframes=[];this.keyframe_constructframes=[];var t=0;var e=0;var i=0;var r=0;var n=0;for(e=0;e<this.numKeyFrames;e++){var s=this.keyframe_durations[e];if(this.frame_recipe[e]&1)n=r;this.keyframe_firstframes[r]=t;this.keyframe_constructframes[r++]=n;for(i=0;i<s;i++)this.keyframe_indices[t++]=e}};t.prototype.get_framescript=function(t){if(this._framescripts[t]==null)return"";if(typeof this._framescripts[t]=="string")return this._framescripts[t];else{throw new Error("Framescript is already translated to Function!!!")}};t.prototype.add_framescript=function(t,e){if(js.frameScriptDebug){var i=t.split(/[\r\n]+/g)[0].split("//")[1];if(js.frameScriptDebug[i]){this._framescripts[e]=js.frameScriptDebug[i];this._framescripts_translated[e]=true;return}else{throw new Error("Framescript could not be found on FrameScriptManager.frameScriptDebug.\n the Object set as FrameScriptmanager.frameScriptDebug should contain a function with the name '"+i+"' !!!")}}this._framescripts[e]=t};t.prototype.regexIndexOf=function(t,e,i){var r=t.substring(i||0).search(e);return r>=0?r+(i||0):r};t.prototype.add_script_for_postcontruct=function(t,e,i){if(i===void 0){i=false}if(this._framescripts[e]!=null){if(this._framescripts_translated[e]==null){this._framescripts[e]=t.adapter.evalScript(this._framescripts[e]);this._framescripts_translated[e]=true}if(i)js.add_script_to_queue(t,this._framescripts[e]);else js.add_script_to_queue_pass2(t,this._framescripts[e])}};Object.defineProperty(t.prototype,"numFrames",{get:function(){return this.keyframe_indices.length},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"potentialPrototypes",{get:function(){return this._potentialPrototypes},enumerable:true,configurable:true});t.prototype.getPotentialChildPrototype=function(t){return this._potentialPrototypes[t]};t.prototype.getKeyframeIndexForFrameIndex=function(t){return this.keyframe_indices[t]};t.prototype.getPotentialChildInstance=function(t){var e=this._potentialPrototypes[t].clone();e.name="";if(e.isAsset(zs)){var i=e;i.style=new Gt;i.style.uvMatrix=new j(1,0,0,-1,0,0);i.material.animateUVs=true}return e};t.prototype.registerPotentialChild=function(t){var e=this._potentialPrototypes.length;this._potentialPrototypes[e]=t};t.prototype.jumpToLabel=function(t,e){var i=this._labels[e];if(i>=0)t.currentFrameIndex=this.keyframe_firstframes[i]};t.prototype.gotoFrame=function(t,e,i){if(i===void 0){i=false}var r=t.constructedKeyFrameIndex;var n=this.keyframe_indices[e];if(r==n)return;if(r+1==n){this.constructNextFrame(t,!i,true);return}var s=this.keyframe_constructframes[n];var a=n>r;var o=s>r;var h=a&&!o?r+1:s;var u;var l;if(o)for(u=t.numChildren-1;u>=0;u--)if(t._children[u]._depthID<0)t.removeChildAt(u);if(!a)t.resetSessionIDs();var p=t.getSessionIDDepths();this.pass1(h,n,p);var c;for(u=t.numChildren-1;u>=0;u--){c=t._children[u];if(c._depthID<0){if(p[c._depthID]!=c._sessionID){t.removeChildAt(u)}else if(!a){if(c.adapter){if(!c.adapter.isBlockedByScript()){c.transform.clearMatrix3D();c.transform.clearColorTransform();c.masks=null;c.maskMode=false}if(!c.adapter.isVisibilityByScript()){c.visible=true}}}}}for(var _ in p){c=t.getPotentialChildInstance(this.add_child_stream[p[_]*2]);if(c._sessionID==-1)t._addTimelineChildAt(c,Number(_),p[_])}if(!i&&this.keyframe_firstframes[n]==e)this.add_script_for_postcontruct(t,n,true);this.pass2(t);t.constructedKeyFrameIndex=n};t.prototype.pass1=function(t,e,i){var r;var n;this._update_indices.length=0;var s=0;var a;var o;for(n=t;n<=e;n++){var h=this.frame_command_indices[n];var u=this.frame_recipe[n];if(u&2){a=this.command_index_stream[h];o=a+this.command_length_stream[h++];for(r=a;r<o;r++)delete i[this.remove_child_stream[r]-16383]}if(u&4){a=this.command_index_stream[h];o=a+this.command_length_stream[h++];for(r=o-1;r>=a;r--)i[this.add_child_stream[r*2+1]-16383]=r}if(u&8)this._update_indices[s++]=h}};t.prototype.pass2=function(t){var e;var i=this._update_indices.length;for(e=0;e<i;e++)this.update_childs(t,this._update_indices[e])};t.prototype.constructNextFrame=function(t,e,i){if(e===void 0){e=true}if(i===void 0){i=false}var r=t.currentFrameIndex;var n=this.keyframe_indices[r];if(e&&this.keyframe_firstframes[n]==r)this.add_script_for_postcontruct(t,n,i);if(t.constructedKeyFrameIndex!=n){t.constructedKeyFrameIndex=n;var s=this.frame_command_indices[n];var a=this.frame_recipe[n];if(a&1){for(var o=t.numChildren-1;o>=0;o--)if(t._children[o]._depthID<0)t.removeChildAt(o)}else if(a&2){this.remove_childs_continous(t,s++)}if(a&4)this.add_childs_continous(t,s++);if(a&8)this.update_childs(t,s++)}};t.prototype.remove_childs_continous=function(t,e){var i=this.command_index_stream[e];var r=i+this.command_length_stream[e];for(var n=i;n<r;n++)t.removeChildAt(t.getDepthIndexInternal(this.remove_child_stream[n]-16383))};t.prototype.add_childs_continous=function(t,e){var i;var r=this.command_index_stream[e];var n=r+this.command_length_stream[e];for(var s=n-1;s>=r;s--){i=s*2;t._addTimelineChildAt(t.getPotentialChildInstance(this.add_child_stream[i]),this.add_child_stream[i+1]-16383,s)}};t.prototype.update_childs=function(t,e){var i;var r;var n;
var s=this.command_index_stream[e];var a=s+this.command_length_stream[e];var o;for(var h=s;h<a;h++){o=t.getChildAtSessionID(this.update_child_stream[h]);if(o){this._blocked=Boolean(o.adapter&&o.adapter.isBlockedByScript());r=this.update_child_props_indices_stream[h];n=r+this.update_child_props_length_stream[h];for(i=r;i<n;i++)this._functions[this.property_type_stream[i]].call(this,o,t,this.property_index_stream[i])}}};t.prototype.update_mtx_all=function(t,e,i){if(this._blocked)return;i*=6;var r=t.transform.matrix3D;r._rawData[0]=this.properties_stream_f32_mtx_all[i++];r._rawData[1]=this.properties_stream_f32_mtx_all[i++];r._rawData[4]=this.properties_stream_f32_mtx_all[i++];r._rawData[5]=this.properties_stream_f32_mtx_all[i++];r._rawData[12]=this.properties_stream_f32_mtx_all[i++];r._rawData[13]=this.properties_stream_f32_mtx_all[i];t.transform.invalidateComponents()};t.prototype.update_colortransform=function(t,e,i){if(this._blocked)return;i*=8;var r=t.transform.colorTransform||(t.transform.colorTransform=new C);r._rawData[0]=this.properties_stream_f32_ct[i++];r._rawData[1]=this.properties_stream_f32_ct[i++];r._rawData[2]=this.properties_stream_f32_ct[i++];r._rawData[3]=this.properties_stream_f32_ct[i++];r._rawData[4]=this.properties_stream_f32_ct[i++];r._rawData[5]=this.properties_stream_f32_ct[i++];r._rawData[6]=this.properties_stream_f32_ct[i++];r._rawData[7]=this.properties_stream_f32_ct[i];t.transform.invalidateColorTransform()};t.prototype.update_masks=function(t,e,i){var r;var n=new Array;var s=this.properties_stream_int[i++];for(var a=0;a<s;a++)if(r=e.getChildAtSessionID(this.properties_stream_int[i++]))n.push(r);t.masks=n};t.prototype.update_name=function(t,e,i){t.name=this.properties_stream_strings[i];e.adapter.registerScriptObject(t)};t.prototype.update_button_name=function(t,e,i){t.name=this.properties_stream_strings[i];t.addButtonListeners();e.adapter.registerScriptObject(t)};t.prototype.update_visibility=function(t,e,i){if(!t.adapter||!t.adapter.isVisibilityByScript())t.visible=Boolean(i)};t.prototype.update_mtx_scale_rot=function(t,e,i){if(this._blocked)return;i*=4;var r=t.transform.matrix3D;r._rawData[0]=this.properties_stream_f32_mtx_scale_rot[i++];r._rawData[1]=this.properties_stream_f32_mtx_scale_rot[i++];r._rawData[4]=this.properties_stream_f32_mtx_scale_rot[i++];r._rawData[5]=this.properties_stream_f32_mtx_scale_rot[i];t.transform.invalidateComponents();t.pInvalidateHierarchicalProperties(Fs.SCENE_TRANSFORM)};t.prototype.update_mtx_pos=function(t,e,i){if(this._blocked)return;i*=2;var r=t.transform.matrix3D;r._rawData[12]=this.properties_stream_f32_mtx_pos[i++];r._rawData[13]=this.properties_stream_f32_mtx_pos[i];t.transform.invalidatePosition()};t.prototype.enable_maskmode=function(t,e,i){t.maskMode=true};t.prototype.remove_masks=function(t,e,i){t.masks=null};t.prototype.update_blendmode=function(t,e,i){console.log("update blendmode "+i)};t.prototype.update_rendermode=function(t,e,i){console.log("update rendermode "+i)};return t}();var Hs=function(){function t(t,e,i){this.x=t;this.y=e;this.id=i}return t}();var Xs=function(t){e(i,t);function i(){var e=t.call(this)||this;e._mouseChildren=true;e._depth_childs={};e._nextHighestDepth=0;e._children=new Array;return e}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"mouseChildren",{get:function(){if(this._hierarchicalPropsDirty&Fs.MOUSE_ENABLED)this._updateMouseEnabled();return this._mouseChildren},set:function(t){if(this._mouseChildren==t)return;this._mouseChildren=t;this.pInvalidateHierarchicalProperties(Fs.MOUSE_ENABLED)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numChildren",{get:function(){return this._children.length},enumerable:true,configurable:true});i.prototype.addChild=function(t){return this.addChildAt(t,this._children.length)};i.prototype.addChildAtDepth=function(t,e,i){if(i===void 0){i=true}if(t==null)throw new E("Parameter child cannot be null.");if(t._pParent)t._pParent.removeChildAtInternal(t._pParent.getChildIndex(t));var r=this.getDepthIndexInternal(e);if(r!=-1){if(i){this.removeChildAt(r)}else{this.addChildAtDepth(this._children[r],e+1,false)}}if(this._nextHighestDepth<e+1)this._nextHighestDepth=e+1;this._depth_childs[e]=t;this._children.push(t);t._depthID=e;t.iSetParent(this);this._invalidateChildren();return t};i.prototype.addChildAt=function(t,e){return this.addChildAtDepth(t,e<this._children.length?this._children[e]._depthID:this.getNextHighestDepth(),false)};i.prototype.addChildren=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}var i=t.length;for(var r=0;r<i;r++)this.addChild(t[r])};i.prototype.clone=function(){var t=new i;this.copyTo(t);return t};i.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e);e.mouseChildren=this._mouseChildren;var i=this._children.length;for(var r=0;r<i;++r)e.addChild(this._children[r].clone())};i.prototype.contains=function(t){return this._children.indexOf(t)>=0};i.prototype.disposeValues=function(){for(var e=this._children.length-1;e>=0;e--)this.removeChild(this._children[e]);t.prototype.disposeValues.call(this)};i.prototype.getChildAtDepth=function(t){return this._depth_childs[t]};i.prototype.getChildAt=function(t){var e=this._children[t];if(e==null)throw new N("Index does not exist in the child list of the caller");return e};i.prototype.getChildByName=function(t){var e=this._children.length;for(var i=0;i<e;++i)if(this._children[i].name==t)return this._children[i];return null};i.prototype.getChildIndex=function(t){var e=this._children.indexOf(t);if(e==-1)throw new E("Child parameter is not a child of the caller");return e};i.prototype.getNextHighestDepth=function(){if(this._nextHighestDepthDirty)this._updateNextHighestDepth();return this._nextHighestDepth};i.prototype.getObjectsUnderPoint=function(t){return new Array};i.prototype.removeChild=function(t){if(t==null)throw new E("Parameter child cannot be null");this.removeChildAt(this.getChildIndex(t));return t};i.prototype.removeChildAtDepth=function(t){return this.removeChildAt(this.getDepthIndexInternal(t))};i.prototype.removeChildAt=function(t){var e=this.removeChildAtInternal(t);e.iSetParent(null);this._invalidateChildren();return e};i.prototype.removeChildren=function(t,e){if(t===void 0){t=0}if(e===void 0){e=2147483647}if(t<0)throw new N("beginIndex is out of range of the child list");if(e>this._children.length)throw new N("endIndex is out of range of the child list");for(var i=t;i<e;i++)this.removeChild(this._children[i])};i.prototype.setChildIndex=function(t,e){};i.prototype.swapChildren=function(t,e){this.swapChildrenAt(this.getChildIndex(t),this.getChildIndex(e))};i.prototype.swapChildrenAt=function(t,e){var i=this._children[e]._depthID;var r=this._children[t];this.addChildAtDepth(this._children[e],this._children[t]._depthID);this.addChildAtDepth(r,i)};i.prototype._pUpdateBoxBounds=function(){t.prototype._pUpdateBoxBounds.call(this);var e;var i=this._children.length;if(i>0){var r;var n;var s,a,o;var h,u,l;for(var p=0;p<i;++p){e=this._children[p].getBox(this);if(p==0){h=e.width+(s=e.x);u=e.height+(a=e.y);l=e.depth+(o=e.z)}else{n=e.width+(r=e.x);if(r<s)s=r;if(n>h)h=n;n=e.height+(r=e.y);if(r<a)a=r;if(n>u)u=n;n=e.depth+(r=e.z);if(r<o)o=r;if(n>l)l=n}}this._pBoxBounds.width=h-(this._pBoxBounds.x=s);this._pBoxBounds.height=u-(this._pBoxBounds.y=a);this._pBoxBounds.depth=l-(this._pBoxBounds.z=o)}else{this._pBoxBounds.setBoundIdentity()}};i.prototype.pInvalidateHierarchicalProperties=function(e){if(t.prototype.pInvalidateHierarchicalProperties.call(this,e))return true;var i=this._children.length;for(var r=0;r<i;++r)this._children[r].pInvalidateHierarchicalProperties(e);return false};i.prototype._iSetScene=function(e,i){t.prototype._iSetScene.call(this,e,i);var r=this._children.length;for(var n=0;n<r;++n)this._children[n]._iSetScene(e,this._pPartition)};i.prototype.removeChildAtInternal=function(t){var e=this._children.splice(t,1)[0];if(this._nextHighestDepth==e._depthID+1)this._nextHighestDepthDirty=true;delete this._depth_childs[e._depthID];e._depthID=-16384;return e};i.prototype.getDepthIndexInternal=function(t){if(!this._depth_childs[t])return-1;return this._children.indexOf(this._depth_childs[t])};i.prototype._updateNextHighestDepth=function(){this._nextHighestDepthDirty=false;this._nextHighestDepth=0;var t=this._children.length;for(var e=0;e<t;e++)if(this._nextHighestDepth<this._children[e]._depthID)this._nextHighestDepth=this._children[e]._depthID;this._nextHighestDepth+=1};i.prototype._hitTestPointInternal=function(t,e,i,r){var n=this._children.length;for(var s=0;s<n;s++)if(this._children[s].hitTestPoint(t,e,i,r))return true;return false};i.prototype._updateMaskMode=function(){if(this.maskMode)this.mouseChildren=false;t.prototype._updateMaskMode.call(this)};i.prototype._invalidateChildren=function(){if(this._pIsContainer!=Boolean(this._children.length)){if(this._pScene)this._pScene._iUnregisterObject(this);this._pIsContainer=Boolean(this._children.length);if(this._pScene)this._pScene._iRegisterObject(this)}this._pInvalidateBounds()};return i}(ks);Xs.assetType="[asset DisplayObjectContainer]";var Ws=function(t){e(i,t);function i(e){if(e===void 0){e=null}var i=t.call(this)||this;i._tempPoint=new z;i._onGraphicsInvalidateDelegate=function(t){return i._onGraphicsInvalidate(t)};i._graphics=qe.getGraphics(i);i._graphics.addEventListener(s.INVALIDATE,i._onGraphicsInvalidateDelegate);i.material=e;return i}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"graphics",{get:function(){if(this._iSourcePrefab)this._iSourcePrefab._iValidate();return this._graphics},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animator",{get:function(){return this._graphics.animator},set:function(t){this._graphics.animator=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"material",{get:function(){return this._graphics.material},set:function(t){this._graphics.material=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"style",{get:function(){return this._graphics.style},set:function(t){this._graphics.style=t},enumerable:true,configurable:true});i.prototype.dispose=function(){this.disposeValues();i._sprites.push(this)};i.prototype.disposeValues=function(){t.prototype.disposeValues.call(this);this._graphics.dispose()};i.prototype.clone=function(){var t=i._sprites.length?i._sprites.pop():new i;this.copyTo(t);return t};i.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e);this._graphics.copyTo(e.graphics)};i.prototype._pUpdateBoxBounds=function(){t.prototype._pUpdateBoxBounds.call(this);this._pBoxBounds.union(this._graphics.getBoxBounds(),this._pBoxBounds)};i.prototype._pUpdateSphereBounds=function(){t.prototype._pUpdateSphereBounds.call(this);var e=this.getBox();if(!this._center)this._center=new A;this._center.x=e.x+e.width/2;this._center.y=e.y+e.height/2;this._center.z=e.z+e.depth/2;this._pSphereBounds=this._graphics.getSphereBounds(this._center,this._pSphereBounds)};i.prototype._onGraphicsInvalidate=function(t){if(this._pIsEntity!=Boolean(this._graphics.count)){if(this._pScene)this._pScene._iUnregisterObject(this);this._pIsEntity=Boolean(this._graphics.count);if(this._pScene)this._pScene._iRegisterObject(this)}this._pInvalidateBounds()};i.prototype._acceptTraverser=function(t){this.graphics.acceptTraverser(t)};i.prototype._hitTestPointInternal=function(e,i,r,n){if(this._graphics.count){this._tempPoint.setTo(e,i);var s=this.globalToLocal(this._tempPoint,this._tempPoint);var a;if(!(a=this.getBox()).contains(s.x,s.y,0))return false;if(!r)return true;if(this._graphics._hitTestPointInternal(s.x,s.y))return true}return t.prototype._hitTestPointInternal.call(this,e,i,r,n)};i.prototype.clear=function(){t.prototype.clear.call(this);this._graphics.clear()};i.prototype.bakeTransformations=function(){this._graphics.applyTransformation(this.transform.matrix3D);this.transform.clearMatrix3D()};i.prototype.invalidateElements=function(){this.graphics.invalidateElements()};i.prototype.invalidateMaterial=function(){this.graphics.invalidateMaterials()};return i}(Xs);Ws._sprites=new Array;Ws.assetType="[asset Sprite]";var Ys=function(t){e(i,t);function i(){var e=t.call(this)||this;e._pObjects=new Array;return e}i.prototype.getNewObject=function(){var t=this._pCreateObject();this._pObjects.push(t);return t};i.prototype._pCreateObject=function(){throw new r};i.prototype._iValidate=function(){};return i}(h);var qs=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i="triangle"}var r=t.call(this)||this;r._primitiveDirty=true;r._uvDirty=true;r._scaleU=1;r._scaleV=1;r._material=e;r._elementsType=i;if(r._elementsType==Ne.TRIANGLE){var n=new $t(new u);n.autoDeriveNormals=false;n.autoDeriveTangents=false;r._elements=n}else if(r._elementsType==Ne.LINE){r._elements=new ee(new u)}return r}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"elementsType",{get:function(){return this._elementsType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"material",{get:function(){return this._material},set:function(t){if(t==this._material)return;this._material=t;var e=this._pObjects.length;for(var i=0;i<e;i++)this._pObjects[i].material=this._material},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"scaleU",{get:function(){return this._scaleU},set:function(t){if(this._scaleU=t)return;this._scaleU=t;this._pInvalidateUVs()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"scaleV",{get:function(){return this._scaleV},set:function(t){if(this._scaleV=t)return;this._scaleV=t;this._pInvalidateUVs()},enumerable:true,configurable:true});i.prototype._pBuildGraphics=function(t,e){throw new r};i.prototype._pBuildUVs=function(t,e){throw new r};i.prototype._pInvalidatePrimitive=function(){this._primitiveDirty=true};i.prototype._pInvalidateUVs=function(){this._uvDirty=true};i.prototype.updateGraphics=function(){this._pBuildGraphics(this._elements,this._elementsType);this._primitiveDirty=false};i.prototype.updateUVs=function(){this._pBuildUVs(this._elements,this._elementsType);this._uvDirty=false};i.prototype._iValidate=function(){if(this._primitiveDirty)this.updateGraphics();if(this._uvDirty)this.updateUVs()};i.prototype._pCreateObject=function(){var t=new Ws(this._material);t.graphics.addShape(jt.getShape(this._elements));t._iSourcePrefab=this;return t};return i}(Ys);qs.assetType="[asset PrimitivePrefab]";var Ks=function(t){e(i,t);function i(e,i,r,n,s,a,o,h,u){if(e===void 0){e=null}if(i===void 0){i="triangle"}if(r===void 0){r=100}if(n===void 0){n=100}if(s===void 0){s=100}if(a===void 0){a=1}if(o===void 0){o=1}if(h===void 0){h=1}if(u===void 0){u=true}var l=t.call(this,e,i)||this;l._width=r;l._height=n;l._depth=s;l._segmentsW=a;l._segmentsH=o;l._segmentsD=h;l._tile6=u;return l}Object.defineProperty(i.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"depth",{get:function(){return this._depth},set:function(t){this._depth=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"tile6",{get:function(){return this._tile6},set:function(t){this._tile6=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t;this._pInvalidatePrimitive();this._pInvalidateUVs()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t;this._pInvalidatePrimitive();this._pInvalidateUVs()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentsD",{get:function(){return this._segmentsD},set:function(t){this._segmentsD=t;this._pInvalidatePrimitive();this._pInvalidateUVs()},enumerable:true,configurable:true});i.prototype._pBuildGraphics=function(t,e){var i;var r;var n;var s;var a;var o,h,u,l;var p,c,_=0;var f,d;var g,m,y;var v,x,b;var w;g=this._width/2;m=this._height/2;y=this._depth/2;if(e==Ne.TRIANGLE){var D=t;var C=((this._segmentsW+1)*(this._segmentsH+1)+(this._segmentsW+1)*(this._segmentsD+1)+(this._segmentsH+1)*(this._segmentsD+1))*2;var A=(this._segmentsW*this._segmentsH+this._segmentsW*this._segmentsD+this._segmentsH*this._segmentsD)*12;if(C==D.numVertices&&D.indices!=null){D.invalidateIndices();D.invalidateVertices(D.positions);D.invalidateVertices(D.normals);D.invalidateVertices(D.tangents)}else{D.setIndices(new Uint16Array(A));D.setPositions(new Float32Array(C*3));D.setNormals(new Float32Array(C*3));D.setTangents(new Float32Array(C*3));this._pInvalidateUVs()}i=D.indices.get(D.numElements);r=D.positions.get(C);n=D.normals.get(C);s=D.tangents.get(C);a=D.concatenatedBuffer.stride/4;f=0;d=0;v=this._width/this._segmentsW;x=this._height/this._segmentsH;b=this._depth/this._segmentsD;for(p=0;p<=this._segmentsW;p++){w=-g+p*v;for(c=0;c<=this._segmentsH;c++){r[f]=w;r[f+1]=-m+c*x;r[f+2]=-y;n[f]=0;n[f+1]=0;n[f+2]=-1;s[f]=1;s[f+1]=0;s[f+2]=0;f+=a;r[f]=w;r[f+1]=-m+c*x;r[f+2]=y;n[f]=0;n[f+1]=0;n[f+2]=1;s[f]=-1;s[f+1]=0;s[f+2]=0;f+=a;if(p&&c){o=2*((p-1)*(this._segmentsH+1)+(c-1));h=2*(p*(this._segmentsH+1)+(c-1));u=o+2;l=h+2;i[d++]=o;i[d++]=u;i[d++]=l;i[d++]=o;i[d++]=l;i[d++]=h;i[d++]=h+1;i[d++]=l+1;i[d++]=u+1;i[d++]=h+1;i[d++]=u+1;i[d++]=o+1}}}_+=2*(this._segmentsW+1)*(this._segmentsH+1);for(p=0;p<=this._segmentsW;p++){w=-g+p*v;for(c=0;c<=this._segmentsD;c++){r[f]=w;r[f+1]=m;r[f+2]=-y+c*b;n[f]=0;n[f+1]=1;n[f+2]=0;s[f]=1;s[f+1]=0;s[f+2]=0;f+=a;r[f]=w;r[f+1]=-m;r[f+2]=-y+c*b;n[f]=0;n[f+1]=-1;n[f+2]=0;s[f]=1;s[f+1]=0;s[f+2]=0;f+=a;if(p&&c){o=_+2*((p-1)*(this._segmentsD+1)+(c-1));h=_+2*(p*(this._segmentsD+1)+(c-1));u=o+2;l=h+2;i[d++]=o;i[d++]=u;i[d++]=l;i[d++]=o;i[d++]=l;i[d++]=h;i[d++]=h+1;i[d++]=l+1;i[d++]=u+1;i[d++]=h+1;i[d++]=u+1;i[d++]=o+1}}}_+=2*(this._segmentsW+1)*(this._segmentsD+1);for(p=0;p<=this._segmentsD;p++){w=y-p*b;for(c=0;c<=this._segmentsH;c++){r[f]=-g;r[f+1]=-m+c*x;r[f+2]=w;n[f]=-1;n[f+1]=0;n[f+2]=0;s[f]=0;s[f+1]=0;s[f+2]=-1;f+=a;r[f]=g;r[f+1]=-m+c*x;r[f+2]=w;n[f]=1;n[f+1]=0;n[f+2]=0;s[f]=0;s[f+1]=0;s[f+2]=1;f+=a;if(p&&c){o=_+2*((p-1)*(this._segmentsH+1)+(c-1));h=_+2*(p*(this._segmentsH+1)+(c-1));u=o+2;l=h+2;i[d++]=o;i[d++]=u;i[d++]=l;i[d++]=o;i[d++]=l;i[d++]=h;i[d++]=h+1;i[d++]=l+1;i[d++]=u+1;i[d++]=h+1;i[d++]=u+1;i[d++]=o+1}}}}else if(e==Ne.LINE){var T=t;var P=this._segmentsH*4+this._segmentsW*4+this._segmentsD*4;var S;r=new Float32Array(P*6);S=new Float32Array(P);f=0;d=0;for(p=0;p<this._segmentsH;++p){r[f++]=-g;r[f++]=p*this._height/this._segmentsH-m;r[f++]=-y;r[f++]=g;r[f++]=p*this._height/this._segmentsH-m;r[f++]=-y;S[d++]=1;r[f++]=-g;r[f++]=m-p*this._height/this._segmentsH;r[f++]=y;r[f++]=g;r[f++]=m-p*this._height/this._segmentsH;r[f++]=y;S[d++]=1}for(p=0;p<this._segmentsW;++p){r[f++]=p*this._width/this._segmentsW-g;r[f++]=-m;r[f++]=-y;r[f++]=p*this._width/this._segmentsW-g;r[f++]=m;r[f++]=-y;S[d++]=1;r[f++]=g-p*this._width/this._segmentsW;r[f++]=-m;r[f++]=y;r[f++]=g-p*this._width/this._segmentsW;r[f++]=m;r[f++]=y;S[d++]=1}for(p=0;p<this._segmentsH;++p){r[f++]=-g;r[f++]=p*this._height/this._segmentsH-m;r[f++]=-y;r[f++]=-g;r[f++]=p*this._height/this._segmentsH-m;r[f++]=y;S[d++]=1;r[f++]=g;r[f++]=m-p*this._height/this._segmentsH;r[f++]=-y;r[f++]=g;r[f++]=m-p*this._height/this._segmentsH;r[f++]=y;S[d++]=1}for(p=0;p<this._segmentsD;++p){r[f++]=g;r[f++]=-m;r[f++]=p*this._depth/this._segmentsD-y;r[f++]=g;r[f++]=m;r[f++]=p*this._depth/this._segmentsD-y;S[d++]=1;r[f++]=-g;r[f++]=-m;r[f++]=y-p*this._depth/this._segmentsD;r[f++]=-g;r[f++]=m;r[f++]=y-p*this._depth/this._segmentsD;S[d++]=1}for(p=0;p<this._segmentsD;++p){r[f++]=-g;r[f++]=-m;r[f++]=y-p*this._depth/this._segmentsD;r[f++]=g;r[f++]=-m;r[f++]=y-p*this._depth/this._segmentsD;S[d++]=1;r[f++]=-g;r[f++]=m;r[f++]=p*this._depth/this._segmentsD-y;r[f++]=g;r[f++]=m;r[f++]=p*this._depth/this._segmentsD-y;S[d++]=1}for(p=0;p<this._segmentsW;++p){r[f++]=g-p*this._width/this._segmentsW;r[f++]=-m;r[f++]=-y;r[f++]=g-p*this._width/this._segmentsW;r[f++]=-m;r[f++]=y;S[d++]=1;r[f++]=p*this._width/this._segmentsW-g;r[f++]=m;r[f++]=-y;r[f++]=p*this._width/this._segmentsW-g;r[f++]=m;r[f++]=y;S[d++]=1}T.setPositions(r);T.setThickness(S)}};i.prototype._pBuildUVs=function(t,e){var i,r,n;var s;var a;var o,h;var u,l;var p,c;var _,f;var d,g;var m;if(e==Ne.TRIANGLE){m=((this._segmentsW+1)*(this._segmentsH+1)+(this._segmentsW+1)*(this._segmentsD+1)+(this._segmentsH+1)*(this._segmentsD+1))*2;var y=t;if(y.uvs&&m==y.numVertices){y.invalidateVertices(y.uvs)}else{y.setUVs(new Float32Array(m*2))}s=y.uvs.get(m);a=y.uvs.stride;if(this._tile6){o=u=1/3;h=l=1/2}else{o=h=1;u=l=0}n=0;p=1*u;c=1*l;_=2*u;f=0*l;d=o/this._segmentsW;g=h/this._segmentsH;for(i=0;i<=this._segmentsW;i++){for(r=0;r<=this._segmentsH;r++){s[n]=(p+i*d)*this._scaleU;s[n+1]=(c+(h-r*g))*this._scaleV;n+=a;s[n]=(_+(o-i*d))*this._scaleU;s[n+1]=(f+(h-r*g))*this._scaleV;n+=a}}p=1*u;c=0*l;_=0*u;f=0*l;d=o/this._segmentsW;g=h/this._segmentsD;for(i=0;i<=this._segmentsW;i++){for(r=0;r<=this._segmentsD;r++){s[n]=(p+i*d)*this._scaleU;s[n+1]=(c+(h-r*g))*this._scaleV;n+=a;s[n]=(_+i*d)*this._scaleU;s[n+1]=(f+r*g)*this._scaleV;n+=a}}p=0*u;c=1*l;_=2*u;f=1*l;d=o/this._segmentsD;g=h/this._segmentsH;for(i=0;i<=this._segmentsD;i++){for(r=0;r<=this._segmentsH;r++){s[n]=(p+i*d)*this._scaleU;s[n+1]=(c+(h-r*g))*this._scaleV;n+=a;s[n]=(_+(o-i*d))*this._scaleU;s[n+1]=(f+(h-r*g))*this._scaleV;n+=a}}}else if(e==Ne.LINE){}};return i}(qs);var Zs=function(){function t(t){this._pInvalidated=true;this._entity=t}t.prototype.dispose=function(){this._entity=null;this._pBoundsPrimitive=null};Object.defineProperty(t.prototype,"boundsPrimitive",{get:function(){if(this._pBoundsPrimitive==null){this._pBoundsPrimitive=this._pCreateBoundsPrimitive();this._pInvalidated=true}if(this._pInvalidated)this._pUpdate();return this._pBoundsPrimitive},enumerable:true,configurable:true});t.prototype.nullify=function(){throw new r};t.prototype.isInFrustum=function(t,e){throw new r};t.prototype.clone=function(){throw new r};t.prototype.rayIntersection=function(t,e,i){return-1};t.prototype.classifyToPlane=function(t){throw new r};t.prototype._pUpdate=function(){this._pInvalidated=false};t.prototype.invalidate=function(){this._pInvalidated=true};t.prototype._pCreateBoundsPrimitive=function(){throw new r};return t}();var Qs=function(t){e(i,t);function i(e){var i=t.call(this,e)||this;i._x=0;i._y=0;i._z=0;i._width=0;i._height=0;i._depth=0;i._centerX=0;i._centerY=0;i._centerZ=0;i._halfExtentsX=0;i._halfExtentsY=0;i._halfExtentsZ=0;return i}i.prototype.nullify=function(){this._x=this._y=this._z=0;this._width=this._height=this._depth=0;this._centerX=this._centerY=this._centerZ=0;this._halfExtentsX=this._halfExtentsY=this._halfExtentsZ=0};i.prototype.isInFrustum=function(t,e){if(this._pInvalidated)this._pUpdate();for(var i=0;i<e;++i){var r=t[i];var n=r.a;var s=r.b;var a=r.c;var o=n<0?-this._halfExtentsX:this._halfExtentsX;var h=s<0?-this._halfExtentsY:this._halfExtentsY;var u=a<0?-this._halfExtentsZ:this._halfExtentsZ;var l=n*(this._centerX+o)+s*(this._centerY+h)+a*(this._centerZ+u)-r.d;if(l<0)return false}return true};i.prototype.rayIntersection=function(t,e,i){if(this._pInvalidated)this._pUpdate();return this._box.rayIntersection(t,e,i)};i.prototype.classifyToPlane=function(t){var e=t.a;var i=t.b;var r=t.c;var n=e*this._centerX+i*this._centerY+r*this._centerZ-t.d;if(e<0)e=-e;if(i<0)i=-i;if(r<0)r=-r;var s=e*this._halfExtentsX+i*this._halfExtentsY+r*this._halfExtentsZ;return n>s?G.FRONT:n<-s?G.BACK:G.INTERSECT};i.prototype._pUpdate=function(){t.prototype._pUpdate.call(this);this._box=this._entity.getBox();var e=this._entity.transform.concatenatedMatrix3D;var i=this._box.width/2;var r=this._box.height/2;var n=this._box.depth/2;var s=this._box.x+i;var a=this._box.y+r;var o=this._box.z+n;var h=e._rawData;var u=h[0],l=h[4],p=h[8],c=h[12];var _=h[1],f=h[5],d=h[9],g=h[13];var m=h[2],y=h[6],v=h[10],x=h[14];this._centerX=s*u+a*l+o*p+c;this._centerY=s*_+a*f+o*d+g;this._centerZ=s*m+a*y+o*v+x;this._halfExtentsX=Math.abs(i*u+r*l+n*p);this._halfExtentsY=Math.abs(i*_+r*f+n*d);this._halfExtentsZ=Math.abs(i*m+r*y+n*v);if(this._prefab){this._prefab.width=this._box.width;this._prefab.height=this._box.height;this._prefab.depth=this._box.depth;this._pBoundsPrimitive.transform.matrix3D=e}this._width=this._halfExtentsX*2;this._height=this._halfExtentsY*2;this._depth=this._halfExtentsZ*2;this._x=this._centerX-this._halfExtentsX;this._y=this._centerY-this._halfExtentsY;this._z=this._centerZ-this._halfExtentsZ};i.prototype._pCreateBoundsPrimitive=function(){this._prefab=new Ks(null,Ne.LINE);return this._prefab.getNewObject()};return i}(Zs);var Js=function(t){e(i,t);function i(e){return t.call(this,e)||this}i.prototype.rayIntersection=function(t,e,i){if(this._pInvalidated)this._pUpdate();var r=this._box.width/2;var n=this._box.height/2;var s=this._box.x+r;var a=this._box.y+n;var o=t.x-s;var h=t.y-a;var u=t.z;var l=e.x;var p=e.y;var c=e.z;var _;var f;var d;var g;if(!d&&c<0){g=-u/c;if(g>0){_=o+g*l;f=h+g*p;if(f>-n&&f<n&&_>-r&&_<r){i.x=0;i.y=0;i.z=1;d=true}}}if(!d&&c>0){g=-u/c;if(g>0){_=o+g*l;f=h+g*p;if(f>-n&&f<n&&_>-r&&_<r){i.x=0;i.y=0;i.z=-1;d=true}}}return d?g:-1};return i}(Qs);var $s=function(t){e(i,t);function i(e,i,r,n,s,a){if(e===void 0){e=null}if(i===void 0){i="triangle"}if(r===void 0){r=50}if(n===void 0){n=16}if(s===void 0){s=12}if(a===void 0){a=true}var o=t.call(this,e,i)||this;o._radius=r;o._segmentsW=n;o._segmentsH=s;o._yUp=a;return o}Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t;this._pInvalidatePrimitive();this._pInvalidateUVs()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t;this._pInvalidatePrimitive();this._pInvalidateUVs()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});i.prototype._pBuildGraphics=function(t,e){var i;var r;var n;var s;var a;var o;var h;var u,l;var p;var c;var _;if(e==Ne.TRIANGLE){var f=t;_=(this._segmentsH+1)*(this._segmentsW+1);if(_==f.numVertices&&f.indices!=null){f.invalidateIndices();f.invalidateVertices(f.positions);f.invalidateVertices(f.normals);f.invalidateVertices(f.tangents)}else{f.setIndices(new Uint16Array((this._segmentsH-1)*this._segmentsW*6));f.setPositions(new Float32Array(_*3));f.setNormals(new Float32Array(_*3));f.setTangents(new Float32Array(_*3));this._pInvalidateUVs()}i=f.indices.get(f.numElements);r=f.positions.get(_);n=f.normals.get(_);s=f.tangents.get(_);a=f.concatenatedBuffer.stride/4;u=0;l=0;var d;var g;var m;for(h=0;h<=this._segmentsH;++h){d=u;var y=Math.PI*h/this._segmentsH;var v=-this._radius*Math.cos(y);var x=this._radius*Math.sin(y);for(o=0;o<=this._segmentsW;++o){var b=2*Math.PI*o/this._segmentsW;var w=x*Math.cos(b);var D=x*Math.sin(b);var C=1/Math.sqrt(w*w+D*D+v*v);var A=Math.sqrt(D*D+w*w);if(this._yUp){g=0;m=A>.007?w/A:0;p=-v;c=D}else{g=A>.007?w/A:0;m=0;p=D;c=v}if(o==this._segmentsW){r[u]=r[d];r[u+1]=r[d+1];r[u+2]=r[d+2];n[u]=n[d]+w*C*.5;n[u+1]=n[d+1]+p*C*.5;n[u+2]=n[d+2]+c*C*.5;s[u]=A>.007?-D/A:1;s[u+1]=g;s[u+2]=m}else{r[u]=w;r[u+1]=p;r[u+2]=c;n[u]=w*C;n[u+1]=p*C;n[u+2]=c*C;s[u]=A>.007?-D/A:1;s[u+1]=g;s[u+2]=m}if(o>0&&h>0){var T=(this._segmentsW+1)*h+o;var P=(this._segmentsW+1)*h+o-1;var S=(this._segmentsW+1)*(h-1)+o-1;var E=(this._segmentsW+1)*(h-1)+o;if(h==this._segmentsH){r[u]=r[d];r[u+1]=r[d+1];r[u+2]=r[d+2];i[l++]=T;i[l++]=S;i[l++]=E}else if(h==1){i[l++]=T;i[l++]=P;i[l++]=S}else{i[l++]=T;i[l++]=P;i[l++]=S;i[l++]=T;i[l++]=S;i[l++]=E}}u+=a}}}else if(e==Ne.LINE){var M=t;var O=this._segmentsH*this._segmentsW*2+this._segmentsW;var r=new Float32Array(O*6);var I=new Float32Array(O);u=0;l=0;for(h=0;h<=this._segmentsH;++h){var y=Math.PI*h/this._segmentsH;var v=-this._radius*Math.cos(y);var x=this._radius*Math.sin(y);for(o=0;o<=this._segmentsW;++o){var b=2*Math.PI*o/this._segmentsW;var w=x*Math.cos(b);var D=x*Math.sin(b);if(this._yUp){p=-v;c=D}else{p=D;c=v}if(o>0){r[u++]=w;r[u++]=p;r[u++]=c;I[l++]=1;if(h>0){var R=h==1?3-(6*(this._segmentsW-o)+12*o):3-this._segmentsW*12;r[u]=r[u++ +R];r[u]=r[u++ +R];r[u]=r[u++ +R];r[u++]=w;r[u++]=p;r[u++]=c;I[l++]=1}}if(o<this._segmentsW){r[u++]=w;r[u++]=p;r[u++]=c}}}M.setPositions(r);M.setThickness(I)}};i.prototype._pBuildUVs=function(t,e){var i,r;var n=(this._segmentsH+1)*(this._segmentsW+1);var s;var a;if(e==Ne.TRIANGLE){n=(this._segmentsH+1)*(this._segmentsW+1);var o=t;if(o.uvs&&n==o.numVertices){o.invalidateVertices(o.uvs)}else{o.setUVs(new Float32Array(n*2))}s=o.uvs.get(n);a=o.uvs.stride;var h=0;for(r=0;r<=this._segmentsH;++r){for(i=0;i<=this._segmentsW;++i){s[h]=i/this._segmentsW*this._scaleU;s[h+1]=r/this._segmentsH*this._scaleV;h+=a}}}else if(e==Ne.LINE){}};return i}(qs);var ta=function(t){e(i,t);function i(e){var i=t.call(this,e)||this;i._radius=0;i._centerX=0;i._centerY=0;i._centerZ=0;return i}i.prototype.nullify=function(){this._centerX=this._centerY=this._centerZ=0;this._radius=0};i.prototype.isInFrustum=function(t,e){if(this._pInvalidated)this._pUpdate();for(var i=0;i<e;++i){var r=t[i];var n=r.a<0?-this._radius:this._radius;var s=r.b<0?-this._radius:this._radius;var a=r.c<0?-this._radius:this._radius;var o=r.a*(this._centerX+n)+r.b*(this._centerY+s)+r.c*(this._centerZ+a)-r.d;if(o<0){return false}}return true};i.prototype.rayIntersection=function(t,e,i){if(this._pInvalidated)this._pUpdate();return this._sphere.rayIntersection(t,e,i)};i.prototype.classifyToPlane=function(t){var e=t.a;var i=t.b;var r=t.c;var n=e*this._centerX+i*this._centerY+r*this._centerZ-t.d;if(e<0)e=-e;if(i<0)i=-i;if(r<0)r=-r;var s=(e+i+r)*this._radius;return n>s?G.FRONT:n<-s?G.BACK:G.INTERSECT};i.prototype._pUpdate=function(){t.prototype._pUpdate.call(this);this._sphere=this._entity.getSphere();var e=this._entity.transform.concatenatedMatrix3D;var i=this._sphere.x;var r=this._sphere.y;var n=this._sphere.z;var s=this._sphere.radius;var a=e._rawData;var o=a[0],h=a[4],u=a[8],l=a[12];var p=a[1],c=a[5],_=a[9],f=a[13];var d=a[2],g=a[6],m=a[10],y=a[14];this._centerX=i*o+r*h+n*u+l;this._centerY=i*p+r*c+n*_+f;this._centerZ=i*d+r*g+n*m+y;var v=o+h+u;var x=p+c+_;var b=d+g+m;this._radius=s*Math.sqrt((v*v+x*x+b*b)/3);if(this._prefab){this._prefab.radius=s;this._pBoundsPrimitive.x=i;this._pBoundsPrimitive.y=r;this._pBoundsPrimitive.z=n;this._pBoundsPrimitive.transform.matrix3D=e}};i.prototype._pCreateBoundsPrimitive=function(){this._prefab=new $s(null,Ne.LINE);return this._prefab.getNewObject()};return i}(Zs);var ea=function(t){e(i,t);function i(e){if(e===void 0){e=true}var i=t.call(this,null)||this;i._alwaysIn=e;return i}i.prototype.clone=function(){return new i(this._alwaysIn)};i.prototype.isInFrustum=function(t,e){return this._alwaysIn};i.prototype.classifyToPlane=function(t){return G.INTERSECT};return i}(Zs);var ia=function(){function t(t){if(t===void 0){t=null}this._pAutoUpdate=true;this.targetObject=t}t.prototype.pNotifyUpdate=function(){if(this._pTargetObject)this._pTargetObject.invalidatePartitionBounds()};Object.defineProperty(t.prototype,"targetObject",{get:function(){return this._pTargetObject},set:function(t){if(this._pTargetObject==t)return;

if(this._pTargetObject&&this._pAutoUpdate)this._pTargetObject._iController=null;this._pTargetObject=t;if(this._pTargetObject&&this._pAutoUpdate)this._pTargetObject._iController=this;this.pNotifyUpdate()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._pAutoUpdate},set:function(t){if(this._pAutoUpdate==t)return;this._pAutoUpdate=t;if(this._pTargetObject){if(this._pAutoUpdate)this._pTargetObject._iController=this;else this._pTargetObject._iController=null}},enumerable:true,configurable:true});t.prototype.update=function(t){if(t===void 0){t=true}throw new r};t.prototype.updateController=function(){if(this._pControllerDirty&&this._pAutoUpdate){this._pControllerDirty=false;this.pNotifyUpdate()}};return t}();var ra=function(t){e(i,t);function i(e,i,r,n,s,a,o){if(e===void 0){e=null}if(i===void 0){i=0}if(r===void 0){r=90}if(n===void 0){n=-90}if(s===void 0){s=90}if(a===void 0){a=8}if(o===void 0){o=false}var h=t.call(this,e)||this;h._iCurrentPanAngle=0;h._iCurrentTiltAngle=90;h._panAngle=0;h._tiltAngle=90;h._minTiltAngle=-90;h._maxTiltAngle=90;h._steps=8;h._walkIncrement=0;h._strafeIncrement=0;h._wrapPanAngle=false;h.fly=false;h.panAngle=i;h.tiltAngle=r;h.minTiltAngle=n;h.maxTiltAngle=s;h.steps=a;h.wrapPanAngle=o;h._iCurrentPanAngle=h._panAngle;h._iCurrentTiltAngle=h._tiltAngle;return h}Object.defineProperty(i.prototype,"steps",{get:function(){return this._steps},set:function(t){t=t<1?1:t;if(this._steps==t)return;this._steps=t;this.pNotifyUpdate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"panAngle",{get:function(){return this._panAngle},set:function(t){if(this._panAngle==t)return;this._panAngle=t;this.pNotifyUpdate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(t){t=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,t));if(this._tiltAngle==t)return;this._tiltAngle=t;this.pNotifyUpdate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(t){if(this._minTiltAngle==t)return;this._minTiltAngle=t;this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle))},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(t){if(this._maxTiltAngle==t)return;this._maxTiltAngle=t;this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle))},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(t){if(this._wrapPanAngle==t)return;this._wrapPanAngle=t;this.pNotifyUpdate()},enumerable:true,configurable:true});i.prototype.update=function(t){if(t===void 0){t=true}if(this._tiltAngle!=this._iCurrentTiltAngle||this._panAngle!=this._iCurrentPanAngle){this._pControllerDirty=true;if(this._wrapPanAngle){if(this._panAngle<0){this._iCurrentPanAngle+=this._panAngle%360+360-this._panAngle;this._panAngle=this._panAngle%360+360}else{this._iCurrentPanAngle+=this._panAngle%360-this._panAngle;this._panAngle=this._panAngle%360}while(this._panAngle-this._iCurrentPanAngle<-180)this._iCurrentPanAngle-=360;while(this._panAngle-this._iCurrentPanAngle>180)this._iCurrentPanAngle+=360}if(t){this._iCurrentTiltAngle+=(this._tiltAngle-this._iCurrentTiltAngle)/(this.steps+1);this._iCurrentPanAngle+=(this._panAngle-this._iCurrentPanAngle)/(this.steps+1)}else{this._iCurrentTiltAngle=this._tiltAngle;this._iCurrentPanAngle=this._panAngle}if(Math.abs(this.tiltAngle-this._iCurrentTiltAngle)<.01&&Math.abs(this._panAngle-this._iCurrentPanAngle)<.01){this._iCurrentTiltAngle=this._tiltAngle;this._iCurrentPanAngle=this._panAngle}}this.targetObject.rotationX=this._iCurrentTiltAngle;this.targetObject.rotationY=this._iCurrentPanAngle;if(this._walkIncrement){if(this.fly){this.targetObject.transform.moveForward(this._walkIncrement)}else{this.targetObject.x+=this._walkIncrement*Math.sin(this._panAngle*P.DEGREES_TO_RADIANS);this.targetObject.z+=this._walkIncrement*Math.cos(this._panAngle*P.DEGREES_TO_RADIANS)}this._walkIncrement=0}if(this._strafeIncrement){this.targetObject.transform.moveRight(this._strafeIncrement);this._strafeIncrement=0}};i.prototype.incrementWalk=function(t){if(t==0)return;this._walkIncrement+=t;this.pNotifyUpdate()};i.prototype.incrementStrafe=function(t){if(t==0)return;this._strafeIncrement+=t;this.pNotifyUpdate()};return i}(ia);var na=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i=null}var r=t.call(this,e)||this;r._pOrigin=new A(0,0,0);r._onLookAtObjectChangedDelegate=function(t){return r.onLookAtObjectChanged(t)};if(i)r.lookAtObject=i;else r.lookAtPosition=new A;return r}Object.defineProperty(i.prototype,"lookAtPosition",{get:function(){return this._pLookAtPosition},set:function(t){if(this._pLookAtObject){this._pLookAtObject.removeEventListener(Us.SCENETRANSFORM_CHANGED,this._onLookAtObjectChangedDelegate);this._pLookAtObject=null}this._pLookAtPosition=t;this.pNotifyUpdate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"lookAtObject",{get:function(){return this._pLookAtObject},set:function(t){if(this._pLookAtPosition)this._pLookAtPosition=null;if(this._pLookAtObject==t)return;if(this._pLookAtObject)this._pLookAtObject.removeEventListener(Us.SCENETRANSFORM_CHANGED,this._onLookAtObjectChangedDelegate);this._pLookAtObject=t;if(this._pLookAtObject)this._pLookAtObject.addEventListener(Us.SCENETRANSFORM_CHANGED,this._onLookAtObjectChangedDelegate);this.pNotifyUpdate()},enumerable:true,configurable:true});i.prototype.update=function(t){if(t===void 0){t=true}if(this._pTargetObject){if(this._pLookAtPosition)this._pTargetObject.lookAt(this._pLookAtPosition);else if(this._pLookAtObject)this._pTargetObject.lookAt(this._pLookAtObject.scene?this._pLookAtObject.scenePosition:this._pLookAtObject.transform.position)}};i.prototype.onLookAtObjectChanged=function(t){this.pNotifyUpdate()};return i}(ia);var sa=function(t){e(i,t);function i(e,i,r,n,s,a,o,h,u,l,p,c){if(e===void 0){e=null}if(i===void 0){i=null}if(r===void 0){r=0}if(n===void 0){n=90}if(s===void 0){s=1e3}if(a===void 0){a=-90}if(o===void 0){o=90}if(h===void 0){h=null}if(u===void 0){u=null}if(l===void 0){l=8}if(p===void 0){p=2}if(c===void 0){c=false}var _=t.call(this,e,i)||this;_._iCurrentPanAngle=0;_._iCurrentTiltAngle=90;_._panAngle=0;_._tiltAngle=90;_._distance=1e3;_._minPanAngle=-Infinity;_._maxPanAngle=Infinity;_._minTiltAngle=-90;_._maxTiltAngle=90;_._steps=8;_._yFactor=2;_._wrapPanAngle=false;_._upAxis=new A;_.distance=s;_.panAngle=r;_.tiltAngle=n;_.minPanAngle=h!=null?h:-Infinity;_.maxPanAngle=u!=null?u:Infinity;_.minTiltAngle=a;_.maxTiltAngle=o;_.steps=l;_.yFactor=p;_.wrapPanAngle=c;_._iCurrentPanAngle=_._panAngle;_._iCurrentTiltAngle=_._tiltAngle;return _}Object.defineProperty(i.prototype,"steps",{get:function(){return this._steps},set:function(t){t=t<1?1:t;if(this._steps==t)return;this._steps=t;this.pNotifyUpdate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"panAngle",{get:function(){return this._panAngle},set:function(t){t=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,t));if(this._panAngle==t)return;this._panAngle=t;this.pNotifyUpdate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(t){t=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,t));if(this._tiltAngle==t)return;this._tiltAngle=t;this.pNotifyUpdate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"distance",{get:function(){return this._distance},set:function(t){if(this._distance==t)return;this._distance=t;this.pNotifyUpdate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"minPanAngle",{get:function(){return this._minPanAngle},set:function(t){if(this._minPanAngle==t)return;this._minPanAngle=t;this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle))},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"maxPanAngle",{get:function(){return this._maxPanAngle},set:function(t){if(this._maxPanAngle==t)return;this._maxPanAngle=t;this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle))},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(t){if(this._minTiltAngle==t)return;this._minTiltAngle=t;this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle))},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(t){if(this._maxTiltAngle==t)return;this._maxTiltAngle=t;this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle))},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"yFactor",{get:function(){return this._yFactor},set:function(t){if(this._yFactor==t)return;this._yFactor=t;this.pNotifyUpdate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(t){if(this._wrapPanAngle==t)return;this._wrapPanAngle=t;this.pNotifyUpdate()},enumerable:true,configurable:true});i.prototype.update=function(t){if(t===void 0){t=true}if(this._tiltAngle!=this._iCurrentTiltAngle||this._panAngle!=this._iCurrentPanAngle){this._pControllerDirty=true;if(this._wrapPanAngle){if(this._panAngle<0){this._iCurrentPanAngle+=this._panAngle%360+360-this._panAngle;this._panAngle=this._panAngle%360+360}else{this._iCurrentPanAngle+=this._panAngle%360-this._panAngle;this._panAngle=this._panAngle%360}while(this._panAngle-this._iCurrentPanAngle<-180)this._iCurrentPanAngle-=360;while(this._panAngle-this._iCurrentPanAngle>180)this._iCurrentPanAngle+=360}if(t){this._iCurrentTiltAngle+=(this._tiltAngle-this._iCurrentTiltAngle)/(this.steps+1);this._iCurrentPanAngle+=(this._panAngle-this._iCurrentPanAngle)/(this.steps+1)}else{this._iCurrentPanAngle=this._panAngle;this._iCurrentTiltAngle=this._tiltAngle}if(Math.abs(this.tiltAngle-this._iCurrentTiltAngle)<.01&&Math.abs(this._panAngle-this._iCurrentPanAngle)<.01){this._iCurrentTiltAngle=this._tiltAngle;this._iCurrentPanAngle=this._panAngle}}var e=this.lookAtObject?this.lookAtObject.transform.position:this.lookAtPosition?this.lookAtPosition:this._pOrigin;this.targetObject.x=e.x+this.distance*Math.sin(this._iCurrentPanAngle*P.DEGREES_TO_RADIANS)*Math.cos(this._iCurrentTiltAngle*P.DEGREES_TO_RADIANS);this.targetObject.y=e.y+this.distance*Math.sin(this._iCurrentTiltAngle*P.DEGREES_TO_RADIANS)*this.yFactor;this.targetObject.z=e.z+this.distance*Math.cos(this._iCurrentPanAngle*P.DEGREES_TO_RADIANS)*Math.cos(this._iCurrentTiltAngle*P.DEGREES_TO_RADIANS);this._upAxis.x=-Math.sin(this._iCurrentPanAngle*P.DEGREES_TO_RADIANS)*Math.sin(this._iCurrentTiltAngle*P.DEGREES_TO_RADIANS);this._upAxis.y=Math.cos(this._iCurrentTiltAngle*P.DEGREES_TO_RADIANS);this._upAxis.z=-Math.cos(this._iCurrentPanAngle*P.DEGREES_TO_RADIANS)*Math.sin(this._iCurrentTiltAngle*P.DEGREES_TO_RADIANS);if(this._pTargetObject){if(this._pLookAtPosition)this._pTargetObject.lookAt(this._pLookAtPosition,this._upAxis);else if(this._pLookAtObject)this._pTargetObject.lookAt(this._pLookAtObject.scene?this._pLookAtObject.scenePosition:this._pLookAtObject.transform.position,this._upAxis)}};return i}(na);var aa=function(t){e(i,t);function i(e,i,r,n){if(e===void 0){e=null}if(i===void 0){i=null}if(r===void 0){r=45}if(n===void 0){n=700}return t.call(this,e,i,0,r,n)||this}i.prototype.update=function(e){if(e===void 0){e=true}if(!this.lookAtObject)return;this.panAngle=this._pLookAtObject.rotationY-180;t.prototype.update.call(this)};return i}(sa);var oa=function(t){e(i,t);function i(e,i,r,n,s){if(e===void 0){e=null}if(i===void 0){i=null}if(r===void 0){r=1}if(n===void 0){n=40}if(s===void 0){s=4}var a=t.call(this,e,i)||this;a.positionOffset=new A(0,500,-1e3);a.stiffness=r;a.damping=s;a.mass=n;a._velocity=new A;a._dv=new A;a._stretch=new A;a._force=new A;a._acceleration=new A;a._desiredPosition=new A;return a}i.prototype.update=function(e){if(e===void 0){e=true}var i;if(!this._pLookAtObject||!this._pTargetObject)return;this._pControllerDirty=true;i=this._pLookAtObject.transform.matrix3D.deltaTransformVector(this.positionOffset);this._desiredPosition.x=this._pLookAtObject.x+i.x;this._desiredPosition.y=this._pLookAtObject.y+i.y;this._desiredPosition.z=this._pLookAtObject.z+i.z;this._stretch=this._pTargetObject.transform.position.add(this._desiredPosition);this._stretch.scaleBy(-this.stiffness);this._dv.copyFrom(this._velocity);this._dv.scaleBy(this.damping);this._force.x=this._stretch.x-this._dv.x;this._force.y=this._stretch.y-this._dv.y;this._force.z=this._stretch.z-this._dv.z;this._acceleration.copyFrom(this._force);this._acceleration.scaleBy(1/this.mass);this._velocity.incrementBy(this._acceleration);var r=this._pTargetObject.transform.position.add(this._velocity);this._pTargetObject.transform.moveTo(r.x,r.y,r.z);t.prototype.update.call(this)};return i}(na);var ha=function(t){e(i,t);function i(e,i){var r=t.call(this,e)||this;r._camera=i;return r}Object.defineProperty(i.prototype,"camera",{get:function(){return this._camera},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._camera)};return i}(n);ha.PROJECTION_CHANGED="projectionChanged";var ua=function(t){e(i,t);function i(e){if(e===void 0){e=null}var i=t.call(this)||this;i._pIsEntity=true;i._projection=e||new St;i._projection.transform=i._transform;i.z=-1e3;i._boundsType=Vs.NULL;return i}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"projection",{get:function(){return this._projection},set:function(t){if(this._projection==t)return;if(!t)throw new Error("Projection cannot be null!");this._projection.transform=null;this._projection=t;this._projection.transform=this._transform;this.dispatchEvent(new ha(ha.PROJECTION_CHANGED,this))},enumerable:true,configurable:true});i.prototype.project=function(t){return this._projection.project(t)};i.prototype.unproject=function(t,e,i){return this._projection.unproject(t,e,i)};return i}(Xs);ua.traverseName=Ht.addEntityName("applyCamera");ua.assetType="[asset Camera]";var la=function(t){e(i,t);function i(){var e=t.apply(this,arguments)||this;e._depthMapSize=2048;e._autoUpdateShadows=true;return e}Object.defineProperty(i.prototype,"autoUpdateShadows",{get:function(){return this._autoUpdateShadows},set:function(t){this._autoUpdateShadows=t},enumerable:true,configurable:true});i.prototype.updateShadows=function(){this._iShadowsInvalid=true};i.prototype.iSetDepthMap=function(t){if(this._depthMap&&!this._explicitDepthMap)this._depthMap.dispose();this._depthMap=t};Object.defineProperty(i.prototype,"light",{get:function(){return this._light},set:function(t){this._light=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"depthMap",{get:function(){if(!this._depthMap)this._depthMap=this._createDepthTexture();return this._depthMap},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"depthMapSize",{get:function(){return this._depthMapSize},set:function(t){if(t==this._depthMapSize)return;this._setDepthMapSize(t)},enumerable:true,configurable:true});i.prototype.dispose=function(){if(this._depthMap&&!this._explicitDepthMap)this._depthMap.dispose();this._depthMap=null};i.prototype._createDepthTexture=function(){throw new r};i.prototype.iRenderDepthMap=function(t,e){this._iShadowsInvalid=false;this._updateDepthProjection(t.camera.projection);if(!this._depthMap)this._depthMap=this._createDepthTexture();this._drawDepthMap(t,this._depthMap,e)};i.prototype._updateDepthProjection=function(t){throw new r};i.prototype._drawDepthMap=function(t,e,i){throw new r};i.prototype._setDepthMapSize=function(t){this._depthMapSize=t;if(this._explicitDepthMap){throw Error("Cannot set depth map size for the current renderer.")}else if(this._depthMap){this._depthMap.dispose();this._depthMap=null}};return i}(h);var pa=function(t){e(i,t);function i(){var e=t.call(this)||this;e._lightOffset=1e4;e._snap=64;e._cullPlanes=[];e._overallDepthProjection=new St;e._overallDepthProjection.transform=new I;e._localFrustum=[];e._matrix=new M;return e}Object.defineProperty(i.prototype,"snap",{get:function(){return this._snap},set:function(t){this._snap=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"lightOffset",{get:function(){return this._lightOffset},set:function(t){this._lightOffset=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"iDepthProjection",{get:function(){return this._overallDepthProjection.viewMatrix3D},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"depth",{get:function(){return this._maxZ-this._minZ},enumerable:true,configurable:true});i.prototype.iSetDepthMap=function(e){if(this._depthMap==e)return;t.prototype.iSetDepthMap.call(this,e);if(this._depthMap){this._explicitDepthMap=true;this._depthMapSize=e.image2D.rect.width}else{this._explicitDepthMap=false}};i.prototype._createDepthTexture=function(){return new ve(new ae(this._depthMapSize,this._depthMapSize))};i.prototype._drawDepthMap=function(t,e,i){i.cullPlanes=this._cullPlanes;i._iRender(this._overallDepthProjection,t,e.image2D)};i.prototype._updateCullPlanes=function(t){var e=this._overallDepthProjection.frustumPlanes;var i=t.frustumPlanes;this._cullPlanes.length=4;this._cullPlanes[0]=e[0];this._cullPlanes[1]=e[1];this._cullPlanes[2]=e[2];this._cullPlanes[3]=e[3];var r=this._light;var n=r.sceneDirection;var s=n.x;var a=n.y;var o=n.z;var h=4;for(var u=0;u<6;++u){var l=i[u];if(l.a*s+l.b*a+l.c*o<0)this._cullPlanes[h++]=l}};i.prototype._updateDepthProjection=function(t){this._updateProjectionFromFrustumCorners(t,t.frustumCorners,this._matrix);this._overallDepthProjection.frustumMatrix3D=this._matrix;this._updateCullPlanes(t)};i.prototype._updateProjectionFromFrustumCorners=function(t,e,i){var r;var n,s,a;var o,h;var u,l;var p;var c=t.transform.concatenatedMatrix3D.position;var _=this._light;r=_.sceneDirection;this._overallDepthProjection.transform.matrix3D=this._light.transform.concatenatedMatrix3D;n=Math.floor((c.x-r.x*this._lightOffset)/this._snap)*this._snap;s=Math.floor((c.y-r.y*this._lightOffset)/this._snap)*this._snap;a=Math.floor((c.z-r.z*this._lightOffset)/this._snap)*this._snap;this._overallDepthProjection.transform.moveTo(n,s,a);this._matrix.copyFrom(this._overallDepthProjection.transform.inverseConcatenatedMatrix3D);this._matrix.prepend(t.transform.concatenatedMatrix3D);this._matrix.transformVectors(e,this._localFrustum);o=u=this._localFrustum[0];h=l=this._localFrustum[1];this._maxZ=this._localFrustum[2];p=3;while(p<24){n=this._localFrustum[p];s=this._localFrustum[p+1];a=this._localFrustum[p+2];if(n<o)o=n;if(n>u)u=n;if(s<h)h=s;if(s>l)l=s;if(a>this._maxZ)this._maxZ=a;p+=3}this._minZ=1;var f=u-o;var d=l-h;var g=1/(this._maxZ-this._minZ);if(o<0)o-=this._snap;if(h<0)h-=this._snap;o=Math.floor(o/this._snap)*this._snap;h=Math.floor(h/this._snap)*this._snap;var m=2*this._snap;f=Math.floor(f/m+2)*m;d=Math.floor(d/m+2)*m;u=o+f;l=h+d;f=1/f;d=1/d;var y=i._rawData;y[0]=2*f;y[5]=2*d;y[10]=g;y[12]=-(u+o)*f;y[13]=-(l+h)*d;y[14]=-this._minZ*g;y[15]=1;y[1]=y[2]=y[3]=y[4]=y[6]=y[7]=y[8]=y[9]=y[11]=0;i.invalidatePosition()};return i}(la);var ca=function(t){e(i,t);function i(e){return t.call(this,e)||this}i.prototype.clone=function(){return new i(this.type)};return i}(n);ca.CASTS_SHADOW_CHANGE="castsShadowChange";var _a=function(t){e(i,t);function i(){var e=t.call(this)||this;e._color=16777215;e._colorR=1;e._colorG=1;e._colorB=1;e._ambientColor=16777215;e._ambient=0;e._iAmbientR=0;e._iAmbientG=0;e._iAmbientB=0;e._specular=1;e._iSpecularR=1;e._iSpecularG=1;e._iSpecularB=1;e._diffuse=1;e._iDiffuseR=1;e._iDiffuseG=1;e._iDiffuseB=1;e._shadowsEnabled=false;e.castsShadows=false;return e}Object.defineProperty(i.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(t){if(this._shadowsEnabled==t)return;this._shadowsEnabled=t;if(t){if(this._shadowMapper==null)this._shadowMapper=this.pCreateShadowMapper();this._shadowMapper.light=this}else{this._shadowMapper.dispose();this._shadowMapper=null}this.dispatchEvent(new ca(ca.CASTS_SHADOW_CHANGE))},enumerable:true,configurable:true});i.prototype.pCreateShadowMapper=function(){throw new r};Object.defineProperty(i.prototype,"specular",{get:function(){return this._specular},set:function(t){if(t<0)t=0;this._specular=t;this.updateSpecular()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"diffuse",{get:function(){return this._diffuse},set:function(t){if(t<0)t=0;this._diffuse=t;this.updateDiffuse()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t;this._colorR=(this._color>>16&255)/255;this._colorG=(this._color>>8&255)/255;this._colorB=(this._color&255)/255;this.updateDiffuse();this.updateSpecular()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"ambient",{get:function(){return this._ambient},set:function(t){if(t<0)t=0;else if(t>1)t=1;this._ambient=t;this.updateAmbient()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"ambientColor",{get:function(){return this._ambientColor},set:function(t){this._ambientColor=t;this.updateAmbient()},enumerable:true,configurable:true});i.prototype.updateAmbient=function(){this._iAmbientR=(this._ambientColor>>16&255)/255*this._ambient;this._iAmbientG=(this._ambientColor>>8&255)/255*this._ambient;this._iAmbientB=(this._ambientColor&255)/255*this._ambient};i.prototype.iGetObjectProjectionMatrix=function(t,e,i){if(i===void 0){i=null}throw new r};i.prototype.updateSpecular=function(){this._iSpecularR=this._colorR*this._specular;this._iSpecularG=this._colorG*this._specular;this._iSpecularB=this._colorB*this._specular};i.prototype.updateDiffuse=function(){this._iDiffuseR=this._colorR*this._diffuse;this._iDiffuseG=this._colorG*this._diffuse;this._iDiffuseB=this._colorB*this._diffuse};Object.defineProperty(i.prototype,"shadowMapper",{get:function(){return this._shadowMapper},set:function(t){this._shadowMapper=t;this._shadowMapper.light=this},enumerable:true,configurable:true});return i}(Xs);var fa=function(t){e(i,t);function i(e,i,r){if(e===void 0){e=0}if(i===void 0){i=-1}if(r===void 0){r=1}var n=t.call(this)||this;n._pAabbPoints=new Array(24);n._pIsEntity=true;n.direction=new A(e,i,r);n._sceneDirection=new A;n._boundsType=Vs.NULL;return n}Object.defineProperty(i.prototype,"traverseName",{get:function(){return i.traverseName},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"sceneDirection",{get:function(){if(this._sceneDirectionDirty)this._updateSceneDirection();return this._sceneDirection},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction=t;if(!this._tmpLookAt)this._tmpLookAt=new A;this._tmpLookAt.x=this.x+this._direction.x;this._tmpLookAt.y=this.y+this._direction.y;this._tmpLookAt.z=this.z+this._direction.z;this.lookAt(this._tmpLookAt)},enumerable:true,configurable:true});i.prototype.pInvalidateHierarchicalProperties=function(e){if(t.prototype.pInvalidateHierarchicalProperties.call(this,e))return true;if(this._hierarchicalPropsDirty&Fs.SCENE_TRANSFORM)this._sceneDirectionDirty=true;return false};i.prototype._updateSceneDirection=function(){this._sceneDirectionDirty=false;this.transform.concatenatedMatrix3D.copyColumnTo(2,this._sceneDirection);this._sceneDirection.normalize()};i.prototype.pCreateShadowMapper=function(){return new pa};i.prototype.iGetObjectProjectionMatrix=function(t,e,i){if(i===void 0){i=null}if(!i)i=new M;var r=M.CALCULATION_MATRIX;r.copyFrom(t.getRenderSceneTransform(e));r.append(this.transform.inverseConcatenatedMatrix3D);if(!this._projAABBPoints)this._projAABBPoints=[];r.transformVectors(this._pAabbPoints,this._projAABBPoints);var n=Infinity,s=-Infinity;var a=Infinity,o=-Infinity;var h=Infinity,u=-Infinity;var l;for(var p=0;p<24;){l=this._projAABBPoints[p++];if(l<n)n=l;if(l>s)s=l;l=this._projAABBPoints[p++];if(l<a)a=l;if(l>o)o=l;l=this._projAABBPoints[p++];if(l<h)h=l;if(l>u)u=l}var c=1/(s-n);var _=1/(o-a);var f=1/(u-h);var d=i._rawData;d[0]=2*c;d[5]=2*_;d[10]=f;d[12]=-(s+n)*c;d[13]=-(o+a)*_;d[14]=-h*f;d[1]=d[2]=d[3]=d[4]=d[6]=d[7]=d[8]=d[9]=d[11]=0;d[15]=1;i.prepend(r);return i};i.prototype._pUpdateBoxBounds=function(){t.prototype._pUpdateBoxBounds.call(this);var e=this._pBoxBounds.x;var i=this._pBoxBounds.y-this._pBoxBounds.height;var r=this._pBoxBounds.z;var n=this._pBoxBounds.x+this._pBoxBounds.width;var s=this._pBoxBounds.y;var a=this._pBoxBounds.z+this._pBoxBounds.depth;this._pAabbPoints[0]=e;this._pAabbPoints[1]=i;this._pAabbPoints[2]=r;this._pAabbPoints[3]=n;this._pAabbPoints[4]=i;this._pAabbPoints[5]=r;this._pAabbPoints[6]=e;this._pAabbPoints[7]=s;this._pAabbPoints[8]=r;this._pAabbPoints[9]=n;this._pAabbPoints[10]=s;this._pAabbPoints[11]=r;this._pAabbPoints[12]=e;this._pAabbPoints[13]=i;this._pAabbPoints[14]=a;this._pAabbPoints[15]=n;this._pAabbPoints[16]=i;this._pAabbPoints[17]=a;this._pAabbPoints[18]=e;this._pAabbPoints[19]=s;this._pAabbPoints[20]=a;this._pAabbPoints[21]=n;this._pAabbPoints[22]=s;this._pAabbPoints[23]=a};return i}(_a);fa.traverseName=Ht.addEntityName("applyDirectionalLight");fa.assetType="[light DirectionalLight]";var da=function(t){e(r,t);function r(e,i){if(i===void 0){i=null}var r=t.call(this)||this;r.diffuseSampler=new Ve;r.specularSampler=new Ve;r._pIsEntity=true;r.diffuseMap=e;r.specularMap=i;r._boundsType=Vs.NULL;return r}Object.defineProperty(r.prototype,"traverseName",{get:function(){return r.traverseName},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"assetType",{get:function(){return r.assetType},enumerable:true,configurable:true});r.prototype.iGetObjectProjectionMatrix=function(t,e,r){if(r===void 0){r=null}throw new i("Object projection matrices are not supported for LightProbe objects!")};return r}(_a);da.traverseName=Ht.addEntityName("applyLightProbe");da.assetType="[light LightProbe]";var ga=function(t){e(i,t);function i(e,i,r,n){if(n===void 0){n=1}var s=t.call(this)||this;s._pIsEntity=true;s.material=e;s._startPosition=i;s._endPosition=r;s._halfThickness=n*.5;s._boundsType=Vs.AXIS_ALIGNED_BOX;return s}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"startPostion",{get:function(){return this._startPosition},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"startPosition",{set:function(t){if(this._startPosition==t)return;this._startPosition=t;this.invalidateElements()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"endPosition",{get:function(){return this._endPosition},set:function(t){if(this._endPosition==t)return;this._endPosition=t;this.invalidateElements()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"thickness",{get:function(){return this._halfThickness*2},set:function(t){if(this._halfThickness==t)return;this._halfThickness=t*.5;this.invalidateElements()},enumerable:true,configurable:true});i.prototype._pUpdateBoxBounds=function(){t.prototype._pUpdateBoxBounds.call(this);this._pBoxBounds.x=Math.min(this._startPosition.x,this._endPosition.x);this._pBoxBounds.y=Math.min(this._startPosition.y,this._endPosition.y);this._pBoxBounds.z=Math.min(this._startPosition.z,this._endPosition.z);this._pBoxBounds.width=Math.abs(this._startPosition.x-this._endPosition.x);this._pBoxBounds.height=Math.abs(this._startPosition.y-this._endPosition.y);this._pBoxBounds.depth=Math.abs(this._startPosition.z-this._endPosition.z)};i.prototype._pUpdateSphereBounds=function(){t.prototype._pUpdateSphereBounds.call(this);this._pUpdateBoxBounds();var e=(this._endPosition.x-this._startPosition.x)/2;var i=(this._endPosition.y-this._startPosition.y)/2;var r=(this._endPosition.z-this._startPosition.z)/2;this._pSphereBounds.x=this._startPosition.x+e;this._pSphereBounds.y=this._startPosition.y+i;this._pSphereBounds.z=this._startPosition.z+r;this._pSphereBounds.radius=Math.sqrt(e*e+i*i+r*r)};i.prototype.invalidateElements=function(){this.dispatchEvent(new Ut(Ut.INVALIDATE_ELEMENTS,this))};i.prototype.invalidateMaterial=function(){this.dispatchEvent(new Ut(Ut.INVALIDATE_MATERIAL,this))};i.prototype._acceptTraverser=function(t){t[i.traverseName](this)};return i}(ks);ga.traverseName=Ht.addRenderableName("applyLineSegment");ga.assetType="[asset LineSegment]";var ma=function(t){e(i,t);function i(e,i){if(e===void 0){e=true}if(i===void 0){i=null}var r=t.call(this)||this;r._useAssetLib=e;r._assetLibId=i;r._onAssetCompleteDelegate=function(t){return r.onAssetComplete(t)};r._onTextureSizeErrorDelegate=function(t){return r.onTextureSizeError(t)};r._onLoadCompleteDelegate=function(t){return r.onLoadComplete(t)};r._onLoadErrorDelegate=function(t){return r.onLoadError(t)};r._onParseErrorDelegate=function(t){return r.onParseError(t)};return r}Object.defineProperty(i.prototype,"content",{get:function(){return this._content},enumerable:true,configurable:true});i.prototype.close=function(){if(!this._loader)return;if(this._useAssetLib){var t;t=lt.getInstance(this._assetLibId);t.disposeLoader(this._loader)}this._disposeLoader()};i.prototype.load=function(t,e,i,r){if(e===void 0){e=null}if(i===void 0){i=null}if(r===void 0){r=null}this._getLoader().load(t,e,i,r)};i.prototype.loadData=function(t,e,i,r){if(e===void 0){e=null}if(i===void 0){i=null}if(r===void 0){r=null}this._getLoader().loadData(t,"",e,i,r)};i.prototype._getLoader=function(){if(this._useAssetLib){var t=lt.getInstance(this._assetLibId);this._loader=t.getLoader()}else{this._loader=new rt}this._loader.addEventListener(F.LOAD_COMPLETE,this._onLoadCompleteDelegate);this._loader.addEventListener(s.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate);this._loader.addEventListener(s.ASSET_COMPLETE,this._onAssetCompleteDelegate);this._loader._iAddErrorHandler(this._onLoadErrorDelegate);this._loader._iAddParseErrorHandler(this._onParseErrorDelegate);return this._loader};i.prototype._disposeLoader=function(){this._loader.removeEventListener(F.LOAD_COMPLETE,this._onLoadCompleteDelegate);this._loader.removeEventListener(s.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate);this._loader.removeEventListener(s.ASSET_COMPLETE,this._onAssetCompleteDelegate);if(!this._useAssetLib)this._loader.stop();this._loader=null};i.prototype.unload=function(){};i.enableParser=function(t){rt.enableParser(t)};i.enableParsers=function(t){rt.enableParsers(t)};i.prototype.onAssetComplete=function(t){this.dispatchEvent(t)};i.prototype.onLoadError=function(t){if(this.hasEventListener(k.LOAD_ERROR)){this.dispatchEvent(t);return true}else{return false}};i.prototype.onParseError=function(t){if(this.hasEventListener(B.PARSE_ERROR)){this.dispatchEvent(t);return true}else{return false}};i.prototype.onTextureSizeError=function(t){this.dispatchEvent(t)};i.prototype.onLoadComplete=function(t){this._content=t.content;if(this._content)this.addChild(this._content);this.dispatchEvent(t);this._disposeLoader()};return i}(Xs);var ya=function(t){e(i,t);function i(e){var i=t.call(this,e)||this;i._iAllowedToPropagate=true;return i}Object.defineProperty(i.prototype,"bubbles",{get:function(){var t=this._iAllowedToPropagate;this._iAllowedToPropagate=true;return t},enumerable:true,configurable:true});i.prototype.stopPropagation=function(){this._iAllowedToPropagate=false;if(this._iParentEvent)this._iParentEvent.stopPropagation()};i.prototype.stopImmediatePropagation=function(){
this._iAllowedToPropagate=false;if(this._iParentEvent)this._iParentEvent.stopImmediatePropagation()};i.prototype.clone=function(){var t=new i(this.type);t.screenX=this.screenX;t.screenY=this.screenY;t.view=this.view;t.entity=this.entity;t.renderable=this.renderable;t.material=this.material;t.uv=this.uv;t.position=this.position;t.normal=this.normal;t.elementIndex=this.elementIndex;t.delta=this.delta;t.ctrlKey=this.ctrlKey;t.shiftKey=this.shiftKey;t._iParentEvent=this;t._iAllowedToPropagate=this._iAllowedToPropagate;return t};Object.defineProperty(i.prototype,"scenePosition",{get:function(){return this.entity.transform.concatenatedMatrix3D.transformVector(this.position)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"sceneNormal",{get:function(){var t=this.entity.transform.concatenatedMatrix3D.deltaTransformVector(this.normal);t.normalize();return t},enumerable:true,configurable:true});return i}(n);ya.MOUSE_OVER="mouseOver3d";ya.MOUSE_OUT="mouseOut3d";ya.MOUSE_UP="mouseUp3d";ya.MOUSE_DOWN="mouseDown3d";ya.MOUSE_MOVE="mouseMove3d";ya.CLICK="click3d";ya.DOUBLE_CLICK="doubleClick3d";ya.MOUSE_WHEEL="mouseWheel3d";var va=function(){function t(t,e){if(t===void 0){t=null}if(e===void 0){e=null}this.kerningCharCodes=[];this.kerningValues=[];this.fill_data=t;this.stroke_data=e}return t}();var xa=function(t){e(i,t);function i(e){if(e===void 0){e=null}var i=t.call(this)||this;i._font_chars=[];i._font_chars_dic=new Object;i._current_size=0;i._size_multiply=0;i._ascent=0;i._descent=0;i._usesCurves=false;if(e){i._opentype_font=e;i._font_em_size=72;i._current_size=0;i._size_multiply=0;return i}return i}i.prototype.hasChar=function(t){return this._font_chars_dic[t]!=null};i.prototype.changeOpenTypeFont=function(t,e){if(e===void 0){e=true}if(e&&this._opentype_font){}this._opentype_font=t};i.prototype.initFontSize=function(t){if(this.fallbackTable)this.fallbackTable.initFontSize(t);if(this._current_size==t)return;this._current_size=t;this._size_multiply=t/this._font_em_size};i.prototype.getCharVertCnt=function(t){var e=this._font_chars_dic[t];if(e){return e.fill_data.length}return 0};i.prototype.getCharWidth=function(t){if(t=="32"){return this._whitespace_width*this._size_multiply}var e=this._font_chars_dic[t];if(e){return e.char_width*this._size_multiply}return 0};Object.defineProperty(i.prototype,"usesCurves",{get:function(){return this._usesCurves},enumerable:true,configurable:true});i.prototype.getLineHeight=function(){return this._current_size};Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.dispose=function(){};Object.defineProperty(i.prototype,"ascent",{get:function(){return this._ascent},set:function(t){this._ascent=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"descent",{get:function(){return this._descent},set:function(t){this._descent=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"offset_x",{get:function(){return this._offset_x},set:function(t){this._offset_x=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"offset_y",{get:function(){return this._offset_y},set:function(t){this._offset_y=t},enumerable:true,configurable:true});i.prototype.get_font_chars=function(){return this._font_chars};i.prototype.get_font_em_size=function(){return this._font_em_size};i.prototype.set_whitespace_width=function(t){this._whitespace_width=t};i.prototype.get_whitespace_width=function(){return this._whitespace_width};i.prototype.set_font_em_size=function(t){this._font_em_size=t};i.prototype.getChar=function(t){if(this._font_chars_dic[t]==null){if(this._opentype_font){var e=this._opentype_font.charToGlyph(String.fromCharCode(parseInt(t)));if(e){{var i=e.getPath();var r=new Ee;var n=0;var s=i.commands.length;var a=0;var o=0;for(n=0;n<s;n++){var h=i.commands[n];if(h.type==="M"){r.moveTo(h.x,h.y);a=h.x;o=h.y}else if(h.type==="L"){r.lineTo(h.x,h.y)}else if(h.type==="Q"){r.curveTo(h.x1,h.y1,h.x,h.y)}else if(h.type==="C"){r.cubicCurveTo(h.x1,h.y1,h.x2,h.y2,h.x,h.y)}else if(h.type==="Z"){r.lineTo(a,o)}}r.style=new Pe(16711680,1,1,Ce.MITER,Xt.NONE,100);var u=[];Ae.draw_pathes([r],u);var l=new p(Float32Array,3);l.set(u);var c=l.attributesBuffer;l.dispose();var _=new va(c,null);_.char_width=e.advanceWidth*(1/e.path.unitsPerEm*72);this._font_chars.push(_);this._font_chars_dic[t]=_}}}}return this._font_chars_dic[t]};i.prototype.setChar=function(t,e,i,r,n){if(i===void 0){i=null}if(r===void 0){r=null}if(n===void 0){n=false}if(i==null&&r==null)throw"TesselatedFontTable: trying to create a TesselatedFontChar with no data (fills_data and stroke_data is null)";if(this._font_chars.length>0){if(n!=this._usesCurves){throw"TesselatedFontTable: Can not set different types of graphic-glyphs (curves vs non-cuves) on the same FontTable!"}}else{this._usesCurves=n}var s=new va(i,r);s.char_width=e;this._font_chars.push(s);this._font_chars_dic[t]=s};i.prototype.buildTextRuns=function(t,e){if(t.length*2!=e.length)throw"Invalid data passed to TesselatedFontTable.buildTextRuns(). output_verts.length is not double textRuns.length.";var i=0;var r=0;var n=0;var s=0;var a=0;var o=0;var h=0;var u=0;var l=0;var p=t.length;var c;var _;for(i=0;i<p;i++){c=t[i];r=c[0];n=c[1];o=c[2];u=c.length;for(h=3;h<u;h+=2){s=c[h];a=c[h+1];_=this.getChar(s.toString());if(n==Wt.BOTH||n==Wt.STROKE){if(e[i*2]==null){throw"Trying to render strokes for a textrun, but no output_vert list was set for this textrun strokes"}}if(n==Wt.BOTH||n==Wt.FILL){if(e[i*2+1]==null){throw"Trying to render fills for a textrun, but no output_vert list was set for this textrun fills"}}}}};return i}(h);xa.assetType="[asset TesselatedFontTable]";var ba=function(){function t(t,e,i,r,n,s,a,o,h,u){this.id=t;this.x=e;this.y=i;this.width=r;this.height=n;this.x_offset=s;this.y_offset=a;this.x_advance=o;this.page=h;this.channel=u}return t}();var wa=function(t){e(i,t);function i(){var e=t.call(this)||this;e._font_chars=[];e._materials=[];e._font_chars_dic=new Object;e._ascent=0;e._descent=0;e._current_size=0;e._size_multiply=0;e._init_size=0;e._texture_width=0;e._texture_height=0;e._adjust_size=0;return e}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.initFontSize=function(t){if(this.fallbackTable)this.fallbackTable.initFontSize(t);if(this._adjust_size)t*=this._adjust_size;if(this._current_size==t)return;this._current_size=t;this._size_multiply=t/this._init_size};i.prototype.getCharDataCanvas=function(t){var e=this._font_chars_dic[t];if(e){return[e.x,e.y,e.width,e.height,e.x_offset*this._size_multiply,e.y_offset*this._size_multiply]}return[]};i.prototype.getCharData=function(t){var e=this._font_chars_dic[t];if(e){var i=e.height/this._init_size*this._current_size;var r=e.width/this._init_size*this._current_size;return[e.x/this._texture_width,e.y/this._texture_height,e.width/this._texture_width,e.height/this._texture_height,e.x_offset*this._size_multiply,e.y_offset*this._size_multiply,i,r]}return[]};i.prototype.getCharVertCnt=function(t){return 6*4};Object.defineProperty(i.prototype,"texture_width",{get:function(){return this._texture_width},set:function(t){this._texture_width=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"texture_height",{get:function(){return this._texture_height},set:function(t){this._texture_height=t},enumerable:true,configurable:true});i.prototype.hasChar=function(t){return this._font_chars_dic[t]!=null};i.prototype.getCharWidth=function(t){var e=this._font_chars_dic[t];if(e)return this._size_multiply*e.x_advance;return 0};i.prototype.getLineHeight=function(){return this._current_size};i.prototype.dispose=function(){var t=this._materials.length;for(var e=0;e<t;++e){this._materials[e].dispose()}this._materials.length=0;this._font_chars.length=0;this._font_chars_dic=null};i.prototype.addMaterial=function(t){this._materials.push(t)};i.prototype.getMaterial=function(t){if(t===void 0){t=0}return this._materials[t]};Object.defineProperty(i.prototype,"ascent",{get:function(){return this._ascent},set:function(t){this._ascent=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"descent",{get:function(){return this._descent},set:function(t){this._descent=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"offset_x",{get:function(){return this._offset_x},set:function(t){this._offset_x=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"offset_y",{get:function(){return this._offset_y},set:function(t){this._offset_y=t},enumerable:true,configurable:true});i.prototype.get_font_chars=function(){return this._font_chars};i.prototype.get_font_em_size=function(){return this._font_em_size};i.prototype.set_whitespace_width=function(t){this._whitespace_width=t};i.prototype.get_whitespace_width=function(){return this._whitespace_width};i.prototype.set_font_em_size=function(t){this._font_em_size=t};i.prototype.getChar=function(t){return this._font_chars_dic[t]};i.prototype.setChar=function(t,e,i,r,n,s,a,o,h,u){var l=new ba(t,e,i,r,n,s,a,o,h,u);this._font_chars.push(l);this._font_chars_dic[t]=l};return i}(h);wa.assetType="[asset BitmapFontTable]";var Da=function(){function t(){}return t}();Da.DYNAMIC="dynamic";Da.INPUT="input";Da.STATIC="input";var Ca=function(t){e(i,t);function i(){var e=t.call(this)||this;e._line_indices=[];e._text="";e.type=Da.STATIC;return e}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"bottomScrollV",{get:function(){return this._bottomScrollV},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"caretIndex",{get:function(){return this._caretIndex},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"length",{get:function(){return this._length},enumerable:true,configurable:true});i.prototype.maxScrollH=function(){return this._maxScrollH};i.prototype.maxScrollV=function(){return this._maxScrollV};Object.defineProperty(i.prototype,"numLines",{get:function(){return this._numLines},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"selectionBeginIndex",{get:function(){return this._selectionBeginIndex},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"selectionEndIndex",{get:function(){return this._selectionEndIndex},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"text",{get:function(){return this._text},set:function(t){t=t.toString();if(this._text==t)return;this._text=t;this._textGraphicsDirty=true},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"textFormat",{get:function(){return this._textFormat},set:function(t){if(this._textFormat==t)return;this._textFormat=t;this._textGraphicsDirty=true},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"graphics",{get:function(){if(this._textGraphicsDirty)this.reConstruct();if(this._textFormat&&!(this._textFormat.font_table.isAsset(xa)&&this._textFormat.material)){var t=this.transform.colorTransform||(this.transform.colorTransform=new C);this.transform.colorTransform.color=this.textColor!=null?this.textColor:this._textFormat.color;this.pInvalidateHierarchicalProperties(Fs.COLOR_TRANSFORM)}return this._graphics},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"textColor",{get:function(){return this._textColor},set:function(t){this._textColor=t;this._textFormat.color=t;if(!this.transform.colorTransform)this.transform.colorTransform=new C;this.transform.colorTransform.color=t;this.pInvalidateHierarchicalProperties(Fs.COLOR_TRANSFORM)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"textInteractionMode",{get:function(){return this._textInteractionMode},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"textWidth",{get:function(){return this._textWidth},set:function(t){this._textWidth=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"textHeight",{get:function(){return this._textHeight},set:function(t){this._textHeight=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"isEntity",{get:function(){return true},enumerable:true,configurable:true});i.prototype.clear=function(){t.prototype.clear.call(this);if(this._textElements)this._textElements.clear()};i.prototype.dispose=function(){this.disposeValues();i._textFields.push(this)};i.prototype.disposeValues=function(){t.prototype.disposeValues.call(this);this._textFormat=null;this._textShape=null;this._textShape2=null;if(this._textElements){this._textElements.dispose();this._textElements=null}if(this._textElements2){this._textElements2.dispose();this._textElements2=null}};i.prototype.reConstruct=function(){this._textGraphicsDirty=false;if(this._textFormat==null)return;if(this._textShape){this._graphics.removeShape(this._textShape);jt.storeShape(this._textShape);this._textShape.dispose();this._textShape=null;this._textElements.clear();this._textElements.dispose();this._textElements=null}if(this._textShape2){this._graphics.removeShape(this._textShape2);jt.storeShape(this._textShape2);this._textShape2.dispose();this._textShape2=null;this._textElements2.clear();this._textElements2.dispose();this._textElements2=null}if(this._text=="")return;var t=this._textFormat;t.font_table.initFontSize(t.size);var e=this.text.toString().split("\\n");var i=this.textWidth-(4+this._textFormat.leftMargin+this._textFormat.rightMargin+this._textFormat.indent);var r=[];var n=[];var s=[];var a=[];var o=[];var h=[];var u=[];var l=[];var _=[];var d=0;var g=0;var m=0;var y=0;var v;var x=0;var b=0;var w=0;var D=0;this._line_indices=[];for(y=0;y<e.length;y++){this._line_indices[d]=x;r[d]=[];n[d]=[];s[d]=[];a[d]=[];l[d]=0;_[d]=0;o[d]=0;h[d]=false;u[d]=true;d++;v=e[y].split(" ");for(g=0;g<v.length;g++){if(v[g].length>0){var A=0;var T=[];var P=[];var S=[];var E=0;for(m=0;m<v[g].length;m++){var M=t.font_table.getLineHeight();if(M>E)E=M;b=0;if(t.font_table.hasChar(v[g].charCodeAt(m).toString())){b=t.font_table.getCharWidth(v[g].charCodeAt(m).toString());S[m]=0;w+=t.font_table.getCharVertCnt(v[g].charCodeAt(m).toString())}else if(t.font_table.fallbackTable&&t.font_table.fallbackTable.hasChar(v[g].charCodeAt(m).toString())){S[m]=1;b=t.font_table.fallbackTable.getCharWidth(v[g].charCodeAt(m).toString());D+=t.font_table.fallbackTable.getCharVertCnt(v[g].charCodeAt(m).toString());M=t.font_table.fallbackTable.getLineHeight();if(M>E)E=M}else{S[m]=-1}T[m]=b+this._textFormat.letterSpacing;P[m]=M;A+=b+this._textFormat.letterSpacing;x++}if(l[d-1]+A+t.font_table.getCharWidth("32")<=i){if(l[d-1]!=0){r[d-1].push(32);a[d-1].push(1);n[d-1].push(t.font_table.getCharWidth("32")+this._textFormat.letterSpacing);l[d-1]+=t.font_table.getCharWidth("32")+this._textFormat.letterSpacing}for(m=0;m<v[g].length;m++){a[d-1].push(S[m]);r[d-1].push(v[g].charCodeAt(m));n[d-1].push(T[m])}l[d-1]+=A;o[d-1]+=1;if(_[d-1]<E)_[d-1]=E}else if(l[d-1]==0){for(m=0;m<v[g].length;m++){a[d-1].push(S[m]);r[d-1].push(v[g].charCodeAt(m));n[d-1].push(T[m])}o[d-1]+=1;l[d-1]+=A;if(_[d-1]<E)_[d-1]=E}else{h[d-1]=true;r[d]=[];n[d]=[];a[d]=[];l[d]=0;_[d]=0;o[d]=0;h[d]=false;u[d]=false;d++;for(m=0;m<v[g].length;m++){r[d-1].push(v[g].charCodeAt(m));n[d-1].push(T[m]);a[d-1].push(S[m])}l[d-1]+=A;if(_[d-1]<E)_[d-1]=E}}}}var O=[];for(y=0;y<l.length;y++){var I=this._textFormat.indent;if(!u[y]){I=0}var R=2+this._textFormat.leftMargin+I;var L=0;if(this._textFormat.align=="center"){R=2+this._textFormat.leftMargin+I+(i-l[y])/2}else if(this._textFormat.align=="justify"){if(h[y]){L=(i-l[y])/o[y]}}else if(this._textFormat.align=="right"){R=this._textWidth-l[y]-(2+this._textFormat.rightMargin)}O[y]=[];this.textHeight=0;if(r[y].length==0){_[y]=this._textFormat.font_table.getLineHeight()}for(var m=0;m<r[y].length;m++){this.textHeight+=_[y];O[y][m]=R;R+=n[y][m];if(r[y][m]==32){R+=L}else{}}}if(this._textFormat.font_table.assetType==wa.assetType){var N=this._textFormat.font_table;var F=new Float32Array(w);var B=new Float32Array(D);var V=0;var U=0;var k=2;for(y=0;y<l.length;y++){k+=_[y];for(var m=0;m<r[y].length;m++){if(r[y][m]==32){continue}if(a[y][m]<0){continue}var z;if(a[y][m]==0){z=N.getCharData(r[y][m].toString());F[V++]=O[y][m]+z[4];F[V++]=k-t.font_table.getLineHeight()+z[5];F[V++]=z[0];F[V++]=z[1];F[V++]=O[y][m]+z[4]+z[7];F[V++]=k-t.font_table.getLineHeight()+z[5];F[V++]=z[0]+z[2];F[V++]=z[1];F[V++]=O[y][m]+z[4]+z[7];F[V++]=k-t.font_table.getLineHeight()+z[5]+z[6];F[V++]=z[0]+z[2];F[V++]=z[1]+z[3];F[V++]=O[y][m]+z[4]+z[7];F[V++]=k-t.font_table.getLineHeight()+z[5]+z[6];F[V++]=z[0]+z[2];F[V++]=z[1]+z[3];F[V++]=O[y][m]+z[4];F[V++]=k-t.font_table.getLineHeight()+z[5]+z[6];F[V++]=z[0];F[V++]=z[1]+z[3];F[V++]=O[y][m]+z[4];F[V++]=k-t.font_table.getLineHeight()+z[5];F[V++]=z[0];F[V++]=z[1]}if(a[y][m]==1){z=N.fallbackTable.getCharData(r[y][m].toString());B[U++]=O[y][m]+z[4];B[U++]=k-t.font_table.fallbackTable.getLineHeight()+z[5];B[U++]=z[0];B[U++]=z[1];B[U++]=O[y][m]+n[y][m]+z[4];B[U++]=k-t.font_table.fallbackTable.getLineHeight()+z[5];B[U++]=z[0]+z[2];B[U++]=z[1];B[U++]=O[y][m]+n[y][m]+z[4];B[U++]=k;B[U++]=z[0]+z[2];B[U++]=z[1]+z[3];B[U++]=O[y][m]+n[y][m]+z[4];B[U++]=k;B[U++]=z[0]+z[2];B[U++]=z[1]+z[3];B[U++]=O[y][m]+z[4];B[U++]=k;B[U++]=z[0];B[U++]=z[1]+z[3];B[U++]=O[y][m]+z[4];B[U++]=k-t.font_table.fallbackTable.getLineHeight()+z[5];B[U++]=z[0];B[U++]=z[1]}}if(this._textFormat.leading==5){k+=this._textFormat.leading*1.6}else if(this._textFormat.leading==11){k+=this._textFormat.leading*1.8}else{k+=this._textFormat.leading}}if(V>0){var G=new p(Float32Array,4);G.set(F);var H=G.attributesBuffer;G.dispose();this._textElements=new $t(H);this._textElements.setPositions(new f(H));this._textElements.setUVs(new f(H));this._textShape=this._graphics.addShape(jt.getShape(this._textElements));this._textShape.material=N.getMaterial()}if(U>0){var X=new p(Float32Array,4);X.set(B);var W=X.attributesBuffer;X.dispose();this._textElements2=new $t(W);this._textElements2.setPositions(new f(W));this._textElements2.setUVs(new f(W));this._textShape2=this._graphics.addShape(jt.getShape(this._textElements2));this._textShape2.material=N.fallbackTable.getMaterial()}var Y=this.transform.colorTransform||(this.transform.colorTransform=new C);this.transform.colorTransform.color=t.color;this.pInvalidateHierarchicalProperties(Fs.COLOR_TRANSFORM)}else if(this._textFormat.font_table.assetType==xa.assetType){var q=this._textFormat.font_table;var F=new Float32Array(w);var V=0;var K;var Z;var Q=q._size_multiply;var k=2+(q.ascent-q.get_font_em_size())*Q;R=0;for(y=0;y<l.length;y++){for(var m=0;m<r[y].length;m++){if(r[y][m]==32){continue}if(a[y][m]<0){continue}if(a[y][m]==0){K=q.getChar(r[y][m].toString());if(K){R=O[y][m];Z=K.fill_data;if(Z!=null){var J=new Float32Array(Z.buffer);if(q.usesCurves){for(var $=0;$<Z.count;$++){F[V++]=J[$*3]*Q+R;F[V++]=J[$*3+1]*Q+k;F[V++]=J[$*3+2]}}else{for(var $=0;$<Z.count;$++){F[V++]=J[$*2]*Q+R;F[V++]=J[$*2+1]*Q+k}}}}}}k+=(q.ascent+q.descent)*Q;k+=this._textFormat.leading}if(V>0){var tt=q.usesCurves?3:2;var G=new p(Float32Array,tt);G.set(F);var H=G.attributesBuffer;G.dispose();this._textElements=new $t(H);this._textElements.setPositions(new f(H));if(q.usesCurves){this._textElements.setCustomAttributes("curves",new c(H,false))}this._textShape=this._graphics.addShape(jt.getShape(this._textElements));var et=new re;this._textShape.style=new Gt;if(this._textFormat.material){this._textShape.material=this._textFormat.material;this._textShape.style.addSamplerAt(et,this._textShape.material.getTextureAt(0));this._textShape.material.animateUVs=true;this._textShape.style.uvMatrix=new j(0,0,0,0,this._textFormat.uv_values[0],this._textFormat.uv_values[1])}else{this._textShape.material=we.getDefaultMaterial();this._textShape.material.bothSides=true;if(q.usesCurves){this._textShape.material.curves=true}this._textShape.style.addSamplerAt(et,this._textShape.material.getTextureAt(0));this._textShape.style.uvMatrix=new j(0,0,0,0,.126,0);this._textShape.material.animateUVs=true;var Y=this.transform.colorTransform||(this.transform.colorTransform=new C);this.transform.colorTransform.color=t.color;this.pInvalidateHierarchicalProperties(Fs.COLOR_TRANSFORM)}}if(this._textShape){this.material=this._textShape.material;if(q.usesCurves){this.material.curves=true}}}};i.prototype.appendText=function(t){this._text+=t};i.prototype.closeParagraph=function(){};i.prototype.getCharBoundaries=function(t){return this._charBoundaries};i.prototype.getCharIndexAtPoint=function(t,e){return this._charIndexAtPoint};i.prototype.getFirstCharInParagraph=function(t){return this._firstCharInParagraph};i.prototype.getImageReference=function(t){return this._imageReference};i.prototype.getLineIndexAtPoint=function(t,e){return this._lineIndexAtPoint};i.prototype.getLineIndexOfChar=function(t){return this._lineIndexOfChar};i.prototype.getLineLength=function(t){return this._lineLength};i.prototype.getLineMetrics=function(t){return this._lineMetrics};i.prototype.getLineOffset=function(t){return this._lineOffset};i.prototype.getLineText=function(t){return this._lineText};i.prototype.getParagraphLength=function(t){return this._paragraphLength};i.prototype.getTextFormat=function(t,e){if(t===void 0){t=-1}if(e===void 0){e=-1}return this._textFormat};i.prototype.replaceSelectedText=function(t){};i.prototype.replaceText=function(t,e,i){};i.prototype.setSelection=function(t,e){};i.prototype.setTextFormat=function(t,e,i){if(e===void 0){e=-1}if(i===void 0){i=-1}};i.isFontCompatible=function(t,e){return false};i.prototype.clone=function(){var t=i._textFields.length?i._textFields.pop():new i;this.copyTo(t);return t};i.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e);e.textWidth=this._textWidth;e.textHeight=this._textHeight;e.textFormat=this._textFormat;e.text=this._text};return i}(Ws);Ca._textFields=[];Ca.assetType="[asset TextField]";var Aa=function(t){e(i,t);function i(e){if(e===void 0){e=null}var i=t.call(this)||this;i._isButton=false;i._time=0;i._currentFrameIndex=-1;i._isPlaying=true;i._isInit=true;i._potentialInstances=[];i._depth_sessionIDs={};i._sessionID_childs={};i.loop=true;i.constructedKeyFrameIndex=-1;i._enterFrame=new s(s.ENTER_FRAME,i);i.inheritColorTransform=true;i._onMouseOver=function(t){return i.currentFrameIndex=1};i._onMouseOut=function(t){return i.currentFrameIndex=0};i._onMouseDown=function(t){return i.currentFrameIndex=2};i._onMouseUp=function(t){return i.currentFrameIndex=i.currentFrameIndex==0?0:1};i._timeline=e||new Gs;return i}Object.defineProperty(i.prototype,"adapter",{get:function(){return this._adapter},set:function(t){this._adapter=t},enumerable:true,configurable:true});i.prototype.dispose=function(){this.disposeValues();i._movieClips.push(this)};i.prototype.disposeValues=function(){t.prototype.disposeValues.call(this);this._potentialInstances=[];this._depth_sessionIDs={};this._sessionID_childs={}};i.prototype.reset_textclones=function(){if(this.timeline){var t=this._potentialInstances.length;for(var e=0;e<t;e++){if(this._potentialInstances[e]!=null){if(this._potentialInstances[e].isAsset(Ca))this._potentialInstances[e].text=this.timeline.getPotentialChildPrototype(e).text;else if(this._potentialInstances[e].isAsset(i))this._potentialInstances[e].reset_textclones()}}}};Object.defineProperty(i.prototype,"isInit",{get:function(){return this._isInit},set:function(t){this._isInit=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"timeline",{get:function(){return this._timeline},set:function(t){this._timeline=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numFrames",{get:function(){return this._timeline.numFrames},enumerable:true,configurable:true});i.prototype.jumpToLabel=function(t){this._timeline.jumpToLabel(this,t)};i.prototype.reset=function(){t.prototype.reset.call(this);this._time=0;if(this.adapter)this.adapter.freeFromScript();this.constructedKeyFrameIndex=-1;for(var e=this.numChildren-1;e>=0;e--)this.removeChildAt(e);this._skipAdvance=i._skipAdvance;var r=this._timeline.keyframe_indices.length;this._isPlaying=Boolean(r>1);if(r){this._currentFrameIndex=0;this._timeline.constructNextFrame(this,true,true)}else{this._currentFrameIndex=-1}};i.prototype.resetSessionIDs=function(){this._depth_sessionIDs={}};Object.defineProperty(i.prototype,"currentFrameIndex",{get:function(){return this._currentFrameIndex},set:function(t){var e=false;var r=this._timeline.keyframe_indices.length;if(!r)return;if(t<0){t=0}else if(t>=r){t=r-1;e=true}if(this._currentFrameIndex==t)return;this._currentFrameIndex=t;this._skipAdvance=i._skipAdvance;this._timeline.gotoFrame(this,t,e)},enumerable:true,configurable:true});i.prototype.addButtonListeners=function(){this._isButton=true;this.stop();this.addEventListener(ya.MOUSE_OVER,this._onMouseOver);this.addEventListener(ya.MOUSE_OUT,this._onMouseOut);this.addEventListener(ya.MOUSE_DOWN,this._onMouseDown);this.addEventListener(ya.MOUSE_UP,this._onMouseUp)};i.prototype.removeButtonListeners=function(){this.removeEventListener(ya.MOUSE_OVER,this._onMouseOver);this.removeEventListener(ya.MOUSE_OUT,this._onMouseOut);this.removeEventListener(ya.MOUSE_DOWN,this._onMouseDown);this.removeEventListener(ya.MOUSE_UP,this._onMouseUp)};i.prototype.getChildAtSessionID=function(t){return this._sessionID_childs[t]};i.prototype.getSessionIDDepths=function(){return this._depth_sessionIDs};i.prototype.addChildAtDepth=function(e,i,r){if(r===void 0){r=true}e.inheritColorTransform=true;e.reset();return t.prototype.addChildAtDepth.call(this,e,i,r)};i.prototype._addTimelineChildAt=function(t,e,i){this._depth_sessionIDs[e]=t._sessionID=i;this._sessionID_childs[i]=t;return this.addChildAtDepth(t,e)};i.prototype.removeChildAtInternal=function(e){var i=this._children[e];if(i.adapter)i.adapter.freeFromScript();this.adapter.unregisterScriptObject(i);if(this._depth_sessionIDs[i._depthID]==i._sessionID)delete this._depth_sessionIDs[i._depthID];delete this._sessionID_childs[i._sessionID];i._sessionID=-1;return t.prototype.removeChildAtInternal.call(this,e)};Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.play=function(){if(this._timeline.keyframe_indices.length>1)this._isPlaying=true};i.prototype.update=function(){i._skipAdvance=true;this.advanceFrame();i._skipAdvance=false;js.execute_queue();this.dispatchEvent(this._enterFrame);js.execute_queue();js.execute_intervals();js.execute_queue();js.execute_dispose()};i.prototype.getPotentialChildInstance=function(t){if(!this._potentialInstances[t])this._potentialInstances[t]=this._timeline.getPotentialChildInstance(t);return this._potentialInstances[t]};i.prototype.stop=function(){this._isPlaying=false};i.prototype.clone=function(){var t=i._movieClips.length?i._movieClips.pop():new i(this._timeline);this.copyTo(t);return t};i.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e);e.timeline=this._timeline;e.loop=this.loop};i.prototype.advanceFrame=function(){if(this._isPlaying&&!this._skipAdvance){if(this._currentFrameIndex==this._timeline.keyframe_indices.length-1){if(this.loop)this.currentFrameIndex=0;else this._isPlaying=false}else{this._currentFrameIndex++;this._timeline.constructNextFrame(this)}}var t=this._children.length;var e;for(var r=0;r<t;++r){e=this._children[r];if(e.isAsset(i))e.advanceFrame()}this._skipAdvance=false};i.prototype.logHierarchy=function(t){if(t===void 0){t=0}this.printHierarchyName(t,this);var e=this._children.length;var r;for(var n=0;n<e;n++){r=this._children[n];if(r.isAsset(i))r.logHierarchy(t+1);else this.printHierarchyName(t+1,r)}};i.prototype.printHierarchyName=function(t,e){var i="";for(var r=0;r<t;++r)i+="--";i+=" "+e.name+" = "+e.id;console.log(i)};i.prototype.clear=function(){var e=this._potentialInstances.length;for(var i=0;i<e;i++){var r=this._potentialInstances[i];if(r&&r.name==""){js.add_child_to_dispose(r);delete this._potentialInstances[i]}}t.prototype.clear.call(this)};return i}(Ws);Aa._movieClips=new Array;Aa.assetType="[asset MovieClip]";var Ta=function(t){e(i,t);function i(){var e=t.call(this)||this;e._depthMapSize=512;e._needsRender=new Array;e.initCameras();return e}i.prototype.initCameras=function(){this._depthProjections=new Array;this.addProjection(0,90,0);this.addProjection(0,-90,0);this.addProjection(-90,0,0);this.addProjection(90,0,0);this.addProjection(0,0,0);this.addProjection(0,180,0)};i.prototype.addProjection=function(t,e,i){var r=new St;r.transform.rotateTo(t,e,i);r.near=.01;r.fieldOfView=90;this._depthProjections.push(r)};i.prototype._createDepthTexture=function(){return new be(new ce(this._depthMapSize))};i.prototype._updateDepthProjection=function(t){var e=this._light;var i=e._pFallOff;var r=this._light.scenePosition;for(var n=0;n<6;++n){this._depthProjections[n].far=i;this._depthProjections[n].transform.moveTo(r.x,r.y,r.z);this._needsRender[n]=true}};i.prototype._drawDepthMap=function(t,e,i){for(var r=0;r<6;++r)if(this._needsRender[r])i._iRender(this._depthProjections[r],t,e.imageCube,null,r)};return i}(la);var Pa=function(t){e(i,t);function i(){var e=t.call(this)||this;e._pRadius=9e4;e._pFallOff=1e5;e._pIsEntity=true;e._pFallOffFactor=1/(e._pFallOff*e._pFallOff-e._pRadius*e._pRadius);e._boundsType=Vs.SPHERE;return e}Object.defineProperty(i.prototype,"traverseName",{get:function(){return i.traverseName},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.pCreateShadowMapper=function(){return new Ta};Object.defineProperty(i.prototype,"radius",{get:function(){return this._pRadius},set:function(t){this._pRadius=t;if(this._pRadius<0){this._pRadius=0}else if(this._pRadius>this._pFallOff){this._pFallOff=this._pRadius;this._pInvalidateBounds()}this._pFallOffFactor=1/(this._pFallOff*this._pFallOff-this._pRadius*this._pRadius)},enumerable:true,configurable:true});i.prototype.iFallOffFactor=function(){return this._pFallOffFactor};Object.defineProperty(i.prototype,"fallOff",{get:function(){return this._pFallOff},set:function(t){this._pFallOff=t;if(this._pFallOff<0)this._pFallOff=0;if(this._pFallOff<this._pRadius)this._pRadius=this._pFallOff;this._pFallOffFactor=1/(this._pFallOff*this._pFallOff-this._pRadius*this._pRadius);this._pInvalidateBounds()},enumerable:true,configurable:true});i.prototype._pUpdateSphereBounds=function(){t.prototype._pUpdateSphereBounds.call(this);this._pSphereBounds.radius=this._pFallOff};i.prototype.iGetObjectProjectionMatrix=function(t,e,i){if(i===void 0){i=null}if(!i)i=new M;var r=M.CALCULATION_MATRIX;r.copyFrom(t.getRenderSceneTransform(e));r.append(this._pParent.transform.inverseConcatenatedMatrix3D);this.lookAt(r.position);r.copyFrom(t.getRenderSceneTransform(e));r.append(this.transform.inverseConcatenatedMatrix3D);var n=t.getBox();var s=r.deltaTransformVector(new A(n.left,n.bottom,n.front));var a=r.deltaTransformVector(new A(n.right,n.top,n.back));var o=s.x*s.x+s.y*s.y+s.z*s.z;var h=a.x*a.x+a.y*a.y+a.z*a.z;var u=Math.sqrt(o>h?o:h);var l;var p;var c=r._rawData[14];l=c-u;p=c+u;var _=i._rawData;_[5]=_[0]=l/u;_[10]=p/(p-l);_[11]=1;_[1]=_[2]=_[3]=_[4]=_[6]=_[7]=_[8]=_[9]=_[12]=_[13]=_[15]=0;_[14]=-l*_[10];i.prepend(r);return i};return i}(_a);Pa.traverseName=Ht.addEntityName("applyPointLight");Pa.assetType="[light PointLight]";var Sa=function(t){e(i,t);function i(e){if(e===void 0){e=null}var i=t.call(this)||this;i._textures=new Array;i._pAlphaThreshold=0;i._pBlendMode=fe.NORMAL;i._curves=false;i._imageRect=false;i._onTextureInvalidateDelegate=function(t){return i.onTextureInvalidate(t)};i._pIsEntity=true;i._owners=new Array(i);i.style=new Gt;i.style.image=e;i.texture=new be;i._boundsType=Vs.NULL;return i}Object.defineProperty(i.prototype,"bothSides",{get:function(){return false},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"traverseName",{get:function(){return i.traverseName;

},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"alphaThreshold",{get:function(){return this._pAlphaThreshold},set:function(t){if(t<0)t=0;else if(t>1)t=1;if(this._pAlphaThreshold==t)return;this._pAlphaThreshold=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"curves",{get:function(){return this._curves},set:function(t){if(this._curves==t)return;this._curves=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"imageRect",{get:function(){return this._imageRect},set:function(t){if(this._imageRect==t)return;this._imageRect=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"lightPicker",{get:function(){return this._pLightPicker},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"animationSet",{get:function(){return this._animationSet},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._pBlendMode},set:function(t){if(this._pBlendMode==t)return;this._pBlendMode=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"iOwners",{get:function(){return this._owners},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.removeTexture(this._texture);this._texture=t;if(this._texture)this.addTexture(this._texture);this.invalidatePasses()},enumerable:true,configurable:true});i.prototype.getNumTextures=function(){return this._textures.length};i.prototype.getTextureAt=function(t){return this._textures[t]};Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.invalidatePasses=function(){this.dispatchEvent(new de(de.INVALIDATE_PASSES,this))};i.prototype.invalidateElements=function(){this.dispatchEvent(new Ut(Ut.INVALIDATE_ELEMENTS,this))};i.prototype.invalidateMaterial=function(){this.dispatchEvent(new Ut(Ut.INVALIDATE_MATERIAL,this))};i.prototype.addTexture=function(t){this._textures.push(t);t.addEventListener(s.INVALIDATE,this._onTextureInvalidateDelegate);this.onTextureInvalidate()};i.prototype.removeTexture=function(t){this._textures.splice(this._textures.indexOf(t),1);t.removeEventListener(s.INVALIDATE,this._onTextureInvalidateDelegate);this.onTextureInvalidate()};i.prototype.onTextureInvalidate=function(t){if(t===void 0){t=null}this.invalidate()};i.prototype._onInvalidateProperties=function(t){this.invalidateMaterial();this.invalidatePasses()};i.prototype._acceptTraverser=function(t){t.applyRenderable(this)};i.prototype.iAddOwner=function(t){};i.prototype.iRemoveOwner=function(t){};return i}(ks);Sa.traverseName=Ht.addEntityName("applySkybox");Sa.assetType="[asset Skybox]";var Ea=function(t){e(i,t);function i(e){return t.call(this,e)||this}i.prototype.clone=function(){return new i(this.type)};return i}(n);Ea.TEXTURE_CHANGE="textureChange";var Ma=function(t){e(i,t);function i(e){var i=t.call(this)||this;i._projection=new St;i._projection.transform=i._transform;i._texture=e;var r=e.getImageAt(0).width;var n=e.getImageAt(0).height;i._projection.setViewRect(0,0,r,n);i._projection.setStageRect(0,0,r,n);return i}Object.defineProperty(i.prototype,"projection",{get:function(){return this._projection},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"traverseName",{get:function(){return i.traverseName},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){if(t==this._texture)return;this._texture=t;var e=t.getImageAt(0).width;var i=t.getImageAt(0).height;this._projection.setViewRect(0,0,e,i);this._projection.setStageRect(0,0,e,i);this.dispatchEvent(new Ea(Ea.TEXTURE_CHANGE))},enumerable:true,configurable:true});return i}(Xs);Ma.traverseName=Ht.addEntityName("applyTextureProjector");Ma.assetType="[asset TextureProjector]";var Oa=function(t){e(i,t);function i(e){return t.call(this,e)||this}return i}(i);var Ia=function(t){e(i,t);function i(e,i,r){if(i===void 0){i=NaN}if(r===void 0){r=NaN}var n=t.call(this,e)||this;n._oldHeight=i;n._oldWidth=r;return n}Object.defineProperty(i.prototype,"oldHeight",{get:function(){return this._oldHeight},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"oldWidth",{get:function(){return this._oldWidth},enumerable:true,configurable:true});i.prototype.clone=function(){return new i(this.type,this._oldHeight,this._oldWidth)};return i}(n);Ia.RESIZE="resize";var Ra=function(t){e(i,t);function i(e){var i=t.call(this,e)||this;i._iAllowedToPropagate=true;return i}Object.defineProperty(i.prototype,"bubbles",{get:function(){var t=this._iAllowedToPropagate;this._iAllowedToPropagate=true;return t},enumerable:true,configurable:true});i.prototype.stopPropagation=function(){this._iAllowedToPropagate=false;if(this._iParentEvent)this._iParentEvent.stopPropagation()};i.prototype.stopImmediatePropagation=function(){this._iAllowedToPropagate=false;if(this._iParentEvent)this._iParentEvent.stopImmediatePropagation()};i.prototype.clone=function(){var t=new i(this.type);t.screenX=this.screenX;t.screenY=this.screenY;t.view=this.view;t.entity=this.entity;t.renderable=this.renderable;t.material=this.material;t.uv=this.uv;t.position=this.position;t.normal=this.normal;t.elementIndex=this.elementIndex;t.ctrlKey=this.ctrlKey;t.shiftKey=this.shiftKey;t._iParentEvent=this;return t};Object.defineProperty(i.prototype,"scenePosition",{get:function(){return this.entity.transform.concatenatedMatrix3D.transformVector(this.position)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"sceneNormal",{get:function(){var t=this.entity.transform.concatenatedMatrix3D.deltaTransformVector(this.normal);t.normalize();return t},enumerable:true,configurable:true});return i}(n);Ra.TOUCH_END="touchEnd3d";Ra.TOUCH_BEGIN="touchBegin3d";Ra.TOUCH_MOVE="touchMove3d";Ra.TOUCH_OUT="touchOut3d";Ra.TOUCH_OVER="touchOver3d";var La=function(t){e(i,t);function i(){var e=t.call(this)||this;e._pNumPointLights=0;e._pNumDirectionalLights=0;e._pNumCastingPointLights=0;e._pNumCastingDirectionalLights=0;e._pNumLightProbes=0;return e}i.prototype.dispose=function(){};Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numDirectionalLights",{get:function(){return this._pNumDirectionalLights},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numPointLights",{get:function(){return this._pNumPointLights},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numCastingDirectionalLights",{get:function(){return this._pNumCastingDirectionalLights},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numCastingPointLights",{get:function(){return this._pNumCastingPointLights},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"numLightProbes",{get:function(){return this._pNumLightProbes},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"pointLights",{get:function(){return this._pPointLights},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"directionalLights",{get:function(){return this._pDirectionalLights},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"castingPointLights",{get:function(){return this._pCastingPointLights},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"castingDirectionalLights",{get:function(){return this._pCastingDirectionalLights},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"lightProbes",{get:function(){return this._pLightProbes},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"lightProbeWeights",{get:function(){return this._pLightProbeWeights},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"allPickedLights",{get:function(){return this._pAllPickedLights},enumerable:true,configurable:true});i.prototype.collectLights=function(t){this.updateProbeWeights(t)};i.prototype.updateProbeWeights=function(t){var e=t.scenePosition;var i;var r=e.x,n=e.y,s=e.z;var a,o,h;var u,l=0;var p;for(p=0;p<this._pNumLightProbes;++p){i=this._pLightProbes[p].scenePosition;a=r-i.x;o=n-i.y;h=s-i.z;u=a*a+o*o+h*h;u=u>1e-5?1/u:5e7;this._pLightProbeWeights[p]=u;l+=u}l=1/l;for(p=0;p<this._pNumLightProbes;++p)this._pLightProbeWeights[p]*=l};return i}(h);La.assetType="[asset LightPicker]";var Na=function(){function t(){}return t}();Na.LIGHTS=1;Na.PROBES=2;Na.ALL=3;var Fa=function(t){e(i,t);function i(e){var i=t.call(this)||this;i._onCastShadowChangeDelegate=function(t){return i.onCastShadowChange(t)};i.lights=e;return i}Object.defineProperty(i.prototype,"lights",{get:function(){return this._lights},set:function(t){var e=0;var i=0;var r=0;var n=0;var a=0;var o;if(this._lights)this.clearListeners();this._lights=t;this._pAllPickedLights=t;this._pPointLights=new Array;this._pCastingPointLights=new Array;this._pDirectionalLights=new Array;this._pCastingDirectionalLights=new Array;this._pLightProbes=new Array;var h=t.length;for(var u=0;u<h;++u){o=t[u];o.addEventListener(ca.CASTS_SHADOW_CHANGE,this._onCastShadowChangeDelegate);if(o instanceof Pa){if(o.shadowsEnabled)this._pCastingPointLights[r++]=o;else this._pPointLights[e++]=o}else if(o instanceof fa){if(o.shadowsEnabled)this._pCastingDirectionalLights[n++]=o;else this._pDirectionalLights[i++]=o}else if(o instanceof da){this._pLightProbes[a++]=o}}if(this._pNumDirectionalLights==i&&this._pNumPointLights==e&&this._pNumLightProbes==a&&this._pNumCastingPointLights==r&&this._pNumCastingDirectionalLights==n)return;this._pNumDirectionalLights=i;this._pNumCastingDirectionalLights=n;this._pNumPointLights=e;this._pNumCastingPointLights=r;this._pNumLightProbes=a;this._pLightProbeWeights=new Array(Math.ceil(a/4)*4);this.dispatchEvent(new s(s.INVALIDATE,this))},enumerable:true,configurable:true});i.prototype.clearListeners=function(){var t=this._lights.length;for(var e=0;e<t;++e)this._lights[e].removeEventListener(ca.CASTS_SHADOW_CHANGE,this._onCastShadowChangeDelegate)};i.prototype.onCastShadowChange=function(t){var e=t.target;if(e instanceof Pa)this.updatePointCasting(e);else if(e instanceof fa)this.updateDirectionalCasting(e);this.dispatchEvent(new s(s.INVALIDATE,this))};i.prototype.updateDirectionalCasting=function(t){var e=t;if(t.shadowsEnabled){--this._pNumDirectionalLights;++this._pNumCastingDirectionalLights;this._pDirectionalLights.splice(this._pDirectionalLights.indexOf(e),1);this._pCastingDirectionalLights.push(t)}else{++this._pNumDirectionalLights;--this._pNumCastingDirectionalLights;this._pCastingDirectionalLights.splice(this._pCastingDirectionalLights.indexOf(e),1);this._pDirectionalLights.push(t)}};i.prototype.updatePointCasting=function(t){var e=t;if(t.shadowsEnabled){--this._pNumPointLights;++this._pNumCastingPointLights;this._pPointLights.splice(this._pPointLights.indexOf(e),1);this._pCastingPointLights.push(t)}else{++this._pNumPointLights;--this._pNumCastingPointLights;this._pCastingPointLights.splice(this._pCastingPointLights.indexOf(e),1);this._pPointLights.push(t)}};return i}(La);var Ba=function(t){e(i,t);function i(e){if(e===void 0){e=3}var i=t.call(this)||this;i._scissorRectsInvalid=true;if(e<1||e>4)throw new Error("numCascades must be an integer between 1 and 4");i._numCascades=e;i.init();return i}i.prototype.getSplitRatio=function(t){return this._splitRatios[t]};i.prototype.setSplitRatio=function(t,e){if(e<0)e=0;else if(e>1)e=1;if(t>=this._numCascades)throw new Error("index must be smaller than the number of cascades!");this._splitRatios[t]=e};i.prototype.getDepthProjections=function(t){return this._depthProjections[t].viewMatrix3D};i.prototype.init=function(){this._splitRatios=new Array(this._numCascades);this._nearPlaneDistances=new Array(this._numCascades);var t=1;for(var e=this._numCascades-1;e>=0;--e){this._splitRatios[e]=t;t*=.4}this._texOffsetsX=Array(-1,1,-1,1);this._texOffsetsY=Array(1,1,-1,-1);this._pScissorRects=new Array(4);this._depthProjections=new Array;for(e=0;e<this._numCascades;++e)this._depthProjections[e]=new St};i.prototype._setDepthMapSize=function(e){t.prototype._setDepthMapSize.call(this,e);this.invalidateScissorRects()};i.prototype.invalidateScissorRects=function(){this._scissorRectsInvalid=true};Object.defineProperty(i.prototype,"numCascades",{get:function(){return this._numCascades},set:function(t){if(t==this._numCascades)return;if(t<1||t>4)throw new Error("numCascades must be an integer between 1 and 4");this._numCascades=t;this.invalidateScissorRects();this.init();this.dispatchEvent(new s(s.INVALIDATE,this))},enumerable:true,configurable:true});i.prototype._drawDepthMap=function(t,e,i){if(this._scissorRectsInvalid)this.updateScissorRects();i.cullPlanes=this._cullPlanes;i._iRenderCascades(this._overallDepthProjection,t,e.image2D,this._numCascades,this._pScissorRects,this._depthProjections)};i.prototype.updateScissorRects=function(){var t=this._depthMapSize*.5;this._pScissorRects[0]=new Y(0,0,t,t);this._pScissorRects[1]=new Y(t,0,t,t);this._pScissorRects[2]=new Y(0,t,t,t);this._pScissorRects[3]=new Y(t,t,t,t);this._scissorRectsInvalid=false};i.prototype._updateDepthProjection=function(t){var e;var i=t.near;var r=t.far-i;this._updateProjectionFromFrustumCorners(t,t.frustumCorners,this._matrix);this._matrix.appendScale(.96,.96,1);this._overallDepthProjection.frustumMatrix3D=this._matrix;this._updateCullPlanes(t);for(var n=0;n<this._numCascades;++n){e=this._depthProjections[n].frustumMatrix3D;this._nearPlaneDistances[n]=i+this._splitRatios[n]*r;this._depthProjections[n].transform.matrix3D=this._overallDepthProjection.transform.matrix3D;this.updateProjectionPartition(e,this._splitRatios[n],this._texOffsetsX[n],this._texOffsetsY[n]);this._depthProjections[n].frustumMatrix3D=e}};i.prototype.updateProjectionPartition=function(t,e,i,r){var n,s,a;var o,h,u;var l=Number.POSITIVE_INFINITY,p=Number.POSITIVE_INFINITY,c;var _=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY,d=Number.NEGATIVE_INFINITY;var g=0;while(g<12){n=this._localFrustum[g];s=this._localFrustum[g+1];a=this._localFrustum[g+2];o=n+(this._localFrustum[g+12]-n)*e;h=s+(this._localFrustum[g+13]-s)*e;u=a+(this._localFrustum[g+14]-a)*e;if(n<l)l=n;if(n>_)_=n;if(s<p)p=s;if(s>f)f=s;if(a>d)d=a;if(o<l)l=o;if(o>_)_=o;if(h<p)p=h;if(h>f)f=h;if(u>d)d=u;g+=3}c=1;var m=_-l;var y=f-p;var v=1/(d-c);if(l<0)l-=this._snap;if(p<0)p-=this._snap;l=Math.floor(l/this._snap)*this._snap;p=Math.floor(p/this._snap)*this._snap;var x=2*this._snap;m=Math.floor(m/x+1)*x;y=Math.floor(y/x+1)*x;_=l+m;f=p+y;m=1/m;y=1/y;var b=t._rawData;b[0]=2*m;b[5]=2*y;b[10]=v;b[12]=-(_+l)*m;b[13]=-(f+p)*y;b[14]=-c*v;b[15]=1;b[1]=b[2]=b[3]=b[4]=b[6]=b[7]=b[8]=b[9]=b[11]=0;t.appendScale(.96,.96,1);t.appendTranslation(i,r,0);t.appendScale(.5,.5,1)};Object.defineProperty(i.prototype,"_iNearPlaneDistances",{get:function(){return this._nearPlaneDistances},enumerable:true,configurable:true});return i}(pa);var Va=function(t){e(i,t);function i(e){if(e===void 0){e=.5}var i=t.call(this)||this;i.coverageRatio=e;return i}Object.defineProperty(i.prototype,"coverageRatio",{get:function(){return this._coverageRatio},set:function(t){if(t>1)t=1;else if(t<0)t=0;this._coverageRatio=t},enumerable:true,configurable:true});i.prototype._updateDepthProjection=function(t){var e=t.frustumCorners;for(var i=0;i<12;++i){var r=e[i];this._localFrustum[i]=r;this._localFrustum[i+12]=r+(e[i+12]-r)*this._coverageRatio}this._updateProjectionFromFrustumCorners(t,this._localFrustum,this._matrix);this._overallDepthProjection.frustumMatrix3D=this._matrix};return i}(pa);var Ua=function(t){e(i,t);function i(e,i,r,n,s,a,o){if(e===void 0){e=null}if(i===void 0){i="triangle"}if(r===void 0){r=50}if(n===void 0){n=100}if(s===void 0){s=16}if(a===void 0){a=15}if(o===void 0){o=true}var h=t.call(this,e,i)||this;h._numVertices=0;h._radius=r;h._height=n;h._segmentsW=s;h._segmentsH=a%2==0?a+1:a;h._yUp=o;return h}Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t;this._pInvalidatePrimitive();this._pInvalidateUVs()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t%2==0?t+1:t;this._pInvalidatePrimitive();this._pInvalidateUVs()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});i.prototype._pBuildGraphics=function(t,e){var i;var r;var n;var s;var a;var o;var h;var u=0;var l=0;var p;var c,_,f,d;var g=0;if(e==Ne.TRIANGLE){var m=t;this._numVertices=(this._segmentsH+1)*(this._segmentsW+1);g=(this._segmentsH-1)*this._segmentsW*6;if(this._numVertices==m.numVertices){m.invalidateIndices();m.invalidateVertices(m.positions);m.invalidateVertices(m.normals);m.invalidateVertices(m.tangents)}else{m.setIndices(new Uint16Array(g));m.setPositions(new Float32Array(this._numVertices*3));m.setNormals(new Float32Array(this._numVertices*3));m.setTangents(new Float32Array(this._numVertices*3));this._pInvalidateUVs()}i=m.indices.get(m.numElements);r=m.positions.get(this._numVertices);n=m.normals.get(this._numVertices);s=m.tangents.get(this._numVertices);a=m.concatenatedBuffer.stride/4;for(h=0;h<=this._segmentsH;++h){var y=Math.PI*h/this._segmentsH;var v=-this._radius*Math.cos(y);var x=this._radius*Math.sin(y);p=l;for(o=0;o<=this._segmentsW;++o){var b=2*Math.PI*o/this._segmentsW;var w=x*Math.cos(b);var D=h>this._segmentsH/2?this._height/2:-this._height/2;var C=x*Math.sin(b);var A=1/Math.sqrt(w*w+C*C+v*v);var T=Math.sqrt(C*C+w*w);if(this._yUp){f=0;d=T>.007?w/T:0;c=-v;_=C}else{f=T>.007?w/T:0;d=0;c=C;_=v}if(o==this._segmentsW){r[l]=r[p];r[l+1]=r[p+1];r[l+2]=r[p+2];n[l]=(n[p]+w*A)*.5;n[l+1]=(n[p+1]+c*A)*.5;n[l+2]=(n[p+2]+_*A)*.5;s[l]=(s[p]+(T>.007?-C/T:1))*.5;s[l+1]=(s[p+1]+f)*.5;s[l+2]=(s[p+2]+d)*.5}else{r[l]=w;r[l+1]=this._yUp?c-D:c;r[l+2]=this._yUp?_:_+D;n[l]=w*A;n[l+1]=c*A;n[l+2]=_*A;s[l]=T>.007?-C/T:1;s[l+1]=f;s[l+2]=d}if(o>0&&h>0){var P=(this._segmentsW+1)*h+o;var S=(this._segmentsW+1)*h+o-1;var E=(this._segmentsW+1)*(h-1)+o-1;var M=(this._segmentsW+1)*(h-1)+o;if(h==this._segmentsH){r[l]=r[p];r[l+1]=r[p+1];r[l+2]=r[p+2];i[u++]=P;i[u++]=E;i[u++]=M}else if(h==1){i[u++]=P;i[u++]=S;i[u++]=E}else{i[u++]=P;i[u++]=S;i[u++]=E;i[u++]=P;i[u++]=E;i[u++]=M}}l+=a}}}else if(e==Ne.LINE){}};i.prototype._pBuildUVs=function(t,e){var i,r;var n;var s;if(e==Ne.TRIANGLE){var a=t;if(a.uvs&&this._numVertices==a.numVertices){a.invalidateVertices(a.uvs)}else{a.setUVs(new Float32Array(this._numVertices*2))}n=a.uvs.get(this._numVertices);s=a.uvs.stride;var o=0;for(r=0;r<=this._segmentsH;++r){for(i=0;i<=this._segmentsW;++i){n[o]=i/this._segmentsW*this._scaleU;n[o+1]=r/this._segmentsH*this._scaleV;o+=s}}}else if(e==Ne.LINE){}};return i}(qs);var ka=function(t){e(i,t);function i(e,i,r,n,s,a,o,h,u,l,p){if(e===void 0){e=null}if(i===void 0){i="triangle"}if(r===void 0){r=50}if(n===void 0){n=50}if(s===void 0){s=100}if(a===void 0){a=16}if(o===void 0){o=1}if(h===void 0){h=true}if(u===void 0){u=true}if(l===void 0){l=true}if(p===void 0){p=true}var c=t.call(this,e,i)||this;c._numVertices=0;c._topRadius=r;c._pBottomRadius=n;c._height=s;c._pSegmentsW=a;c._pSegmentsH=o;c._topClosed=h;c._bottomClosed=u;c._surfaceClosed=l;c._yUp=p;return c}Object.defineProperty(i.prototype,"topRadius",{get:function(){return this._topRadius},set:function(t){this._topRadius=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"bottomRadius",{get:function(){return this._pBottomRadius},set:function(t){this._pBottomRadius=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentsW",{get:function(){return this._pSegmentsW},set:function(t){this.setSegmentsW(t)},enumerable:true,configurable:true});i.prototype.setSegmentsW=function(t){this._pSegmentsW=t;this._pInvalidatePrimitive();this._pInvalidateUVs()};Object.defineProperty(i.prototype,"segmentsH",{get:function(){return this._pSegmentsH},set:function(t){this.setSegmentsH(t)},enumerable:true,configurable:true});i.prototype.setSegmentsH=function(t){this._pSegmentsH=t;this._pInvalidatePrimitive();this._pInvalidateUVs()};Object.defineProperty(i.prototype,"topClosed",{get:function(){return this._topClosed},set:function(t){this._topClosed=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"bottomClosed",{get:function(){return this._bottomClosed},set:function(t){this._bottomClosed=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});i.prototype._pBuildGraphics=function(t,e){var i;var r;var n;var s;var a;var o;var h;var u;var l;var p;var c;var _;var f;var d;var g;var m;var y;var v=0;var x;var b;var w=0;var D=0;var C=0;var A;var T;this._numVertices=0;var P=2*Math.PI/this._pSegmentsW;if(e==Ne.TRIANGLE){var S=t;if(this._surfaceClosed){this._numVertices+=(this._pSegmentsH+1)*(this._pSegmentsW+1);v+=this._pSegmentsH*this._pSegmentsW*6}if(this._topClosed){this._numVertices+=2*(this._pSegmentsW+1);v+=this._pSegmentsW*3}if(this._bottomClosed){this._numVertices+=2*(this._pSegmentsW+1);v+=this._pSegmentsW*3}if(this._numVertices==S.numVertices){S.invalidateIndices();S.invalidateVertices(S.positions);S.invalidateVertices(S.normals);S.invalidateVertices(S.tangents)}else{S.setIndices(new Uint16Array(v));S.setPositions(new Float32Array(this._numVertices*3));S.setNormals(new Float32Array(this._numVertices*3));S.setTangents(new Float32Array(this._numVertices*3));this._pInvalidateUVs()}i=S.indices.get(S.numElements);r=S.positions.get(this._numVertices);n=S.normals.get(this._numVertices);s=S.tangents.get(this._numVertices);a=S.concatenatedBuffer.stride/4;c=0;_=0;if(this._topClosed&&this._topRadius>0){p=-.5*this._height;if(this._yUp){A=1;T=0;x=-p;b=0}else{A=0;T=-1;x=0;b=p}r[c]=0;r[c+1]=x;r[c+2]=b;n[c]=0;n[c+1]=A;n[c+2]=T;s[c]=1;s[c+1]=0;s[c+2]=0;c+=a;D++;for(o=0;o<=this._pSegmentsW;++o){d=o*P;u=this._topRadius*Math.cos(d);l=this._topRadius*Math.sin(d);if(this._yUp){x=-p;b=l}else{x=l;b=p}if(o==this._pSegmentsW){r[c]=r[w+a];r[c+1]=r[w+a+1];r[c+2]=r[w+a+2]}else{r[c]=u;r[c+1]=x;r[c+2]=b}n[c]=0;n[c+1]=A;n[c+2]=T;s[c]=1;s[c+1]=0;s[c+2]=0;c+=a;if(o>0){i[_++]=D-1;i[_++]=C;i[_++]=D}D++}}if(this._bottomClosed&&this._pBottomRadius>0){p=.5*this._height;w=D*a;C=D;if(this._yUp){A=-1;T=0;x=-p;b=0}else{A=0;T=1;x=0;b=p}if(o>0){r[c]=0;r[c+1]=x;r[c+2]=b;n[c]=0;n[c+1]=A;n[c+2]=T;s[c]=1;s[c+1]=0;s[c+2]=0;c+=a}D++;for(o=0;o<=this._pSegmentsW;++o){d=o*P;u=this._pBottomRadius*Math.cos(d);l=this._pBottomRadius*Math.sin(d);if(this._yUp){x=-p;b=l}else{x=l;b=p}if(o==this._pSegmentsW){r[c]=r[w+a];r[c+1]=r[w+a+1];r[c+2]=r[w+a+2]}else{r[c]=u;r[c+1]=x;r[c+2]=b}n[c]=0;n[c+1]=A;n[c+2]=T;s[c]=1;s[c+1]=0;s[c+2]=0;c+=a;if(o>0){i[_++]=D-1;i[_++]=D;i[_++]=C}D++}}g=this._pBottomRadius-this._topRadius;m=g/this._height;y=m==0?1:this._height/g;if(this._surfaceClosed){var E;var M;var O;var I;var R,L,N,F;for(h=0;h<=this._pSegmentsH;++h){f=this._topRadius-h/this._pSegmentsH*(this._topRadius-this._pBottomRadius);p=-(this._height/2)+h/this._pSegmentsH*this._height;w=D*a;for(o=0;o<=this._pSegmentsW;++o){d=o*P;u=f*Math.cos(d);l=f*Math.sin(d);R=y*Math.cos(d);L=y*Math.sin(d);if(this._yUp){A=0;T=-R;x=-p;b=l;N=m;F=L}else{A=-R;T=0;x=l;b=p;N=L;F=m}if(o==this._pSegmentsW){r[c]=r[w];r[c+1]=r[w+1];r[c+2]=r[w+2];n[c]=R;n[c+1]=m;n[c+2]=L;s[c]=L;s[c+1]=A;s[c+2]=T}else{r[c]=u;r[c+1]=x;r[c+2]=b;n[c]=R;n[c+1]=N;n[c+2]=F;s[c]=-L;s[c+1]=A;s[c+2]=T}c+=a;if(o>0&&h>0){E=D;M=D-1;O=M-this._pSegmentsW-1;I=E-this._pSegmentsW-1;i[_++]=E;i[_++]=M;i[_++]=O;i[_++]=E;i[_++]=O;i[_++]=I}D++}}}}else if(e==Ne.LINE){var B=t;var V=this._pSegmentsH*this._pSegmentsW*2+this._pSegmentsW;r=new Float32Array(V*6);var U=new Float32Array(V);c=0;_=0;var k=50;for(h=0;h<=this._pSegmentsH;++h){f=this._topRadius-h/this._pSegmentsH*(this._topRadius-this._pBottomRadius);p=-(this._height/2)+h/this._pSegmentsH*this._height;for(o=0;o<=this._pSegmentsW;++o){d=o*P;u=f*Math.cos(d);l=f*Math.sin(d);if(this._yUp){x=-p;b=l}else{x=l;b=p}if(o>0){r[c++]=u;r[c++]=x;r[c++]=b;U[_++]=1;if(h>0){var z=h==1?3-(6*(this._pSegmentsW-o)+12*o):3-this._pSegmentsW*12;r[c]=r[c++ +z];r[c]=r[c++ +z];r[c]=r[c++ +z];r[c++]=u;r[c++]=x;r[c++]=b;U[_++]=1}}if(o<this._pSegmentsW){r[c++]=u;r[c++]=x;r[c++]=b}}}B.setPositions(r);B.setThickness(U)}};i.prototype._pBuildUVs=function(t,e){var i;var r;var n;var s;var a;var o;var h;if(e==Ne.TRIANGLE){var u=t;if(u.uvs&&this._numVertices==u.numVertices){u.invalidateVertices(u.uvs)}else{u.setUVs(new Float32Array(this._numVertices*2))}o=u.uvs.get(this._numVertices);h=u.uvs.stride;var l=2*Math.PI/this._pSegmentsW;var p=0;if(this._topClosed){o[p]=.5*this._scaleU;o[p+1]=.5*this._scaleV;p+=h;for(i=0;i<=this._pSegmentsW;++i){a=i*l;n=.5+.5*-Math.cos(a);s=.5+.5*Math.sin(a);o[p]=n*this._scaleU;o[p+1]=s*this._scaleV;p+=h}}if(this._bottomClosed){o[p]=.5*this._scaleU;o[p+1]=.5*this._scaleV;p+=h;for(i=0;i<=this._pSegmentsW;++i){a=i*l;n=.5+.5*Math.cos(a);s=.5+.5*Math.sin(a);o[p]=n*this._scaleU;o[p+1]=s*this._scaleV;p+=h}}if(this._surfaceClosed){for(r=0;r<=this._pSegmentsH;++r){for(i=0;i<=this._pSegmentsW;++i){o[p]=i/this._pSegmentsW*this._scaleU;o[p+1]=r/this._pSegmentsH*this._scaleV;p+=h}}}}else if(e==Ne.LINE){}};return i}(qs);var za=function(t){e(i,t);function i(e,i,r,n,s,a,o,h){if(e===void 0){e=null}if(i===void 0){i="triangle"}if(r===void 0){r=50}if(n===void 0){n=100}if(s===void 0){s=16}if(a===void 0){a=1}if(o===void 0){o=true}if(h===void 0){h=true}return t.call(this,e,i,0,r,n,s,a,false,o,true,h)||this}Object.defineProperty(i.prototype,"radius",{get:function(){return this._pBottomRadius},set:function(t){this._pBottomRadius=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});return i}(ka);var ja=function(t){e(i,t);function i(e,i,r,n,s,a,o,h){if(e===void 0){e=null}if(i===void 0){i="triangle"}if(r===void 0){r=100}if(n===void 0){n=100}if(s===void 0){s=1}if(a===void 0){a=1}if(o===void 0){o=true}if(h===void 0){h=false}var u=t.call(this,e,i)||this;u._segmentsW=s;u._segmentsH=a;u._yUp=o;u._width=r;u._height=n;u._doubleSided=h;return u}Object.defineProperty(i.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t;this._pInvalidatePrimitive();this._pInvalidateUVs()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t;this._pInvalidatePrimitive();this._pInvalidateUVs()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"doubleSided",{get:function(){return this._doubleSided},set:function(t){this._doubleSided=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});i.prototype._pBuildGraphics=function(t,e){var i;var r,n;var s;var a;var o;var h=this._segmentsW+1;var u,l;var p;var c;if(e==Ne.TRIANGLE){var _=t;var f=(this._segmentsH+1)*h;var d;var g;var m;if(this._doubleSided)f*=2;s=this._segmentsH*this._segmentsW*6;if(this._doubleSided)s*=2;if(_.indices!=null&&s==_.indices.length){_.invalidateIndices()}else{_.setIndices(new Uint16Array(s));this._pInvalidateUVs()}i=_.indices.get(_.numElements);if(f==_.numVertices){_.invalidateVertices(_.positions);_.invalidateVertices(_.normals);_.invalidateVertices(_.tangents)}else{_.setPositions(new Float32Array(f*3));_.setNormals(new Float32Array(f*3));_.setTangents(new Float32Array(f*3));this._pInvalidateUVs()}d=_.positions.get(f);g=_.normals.get(f);m=_.tangents.get(f);a=_.concatenatedBuffer.stride/4;l=0;u=0;for(c=0;c<=this._segmentsH;++c){for(p=0;p<=this._segmentsW;++p){r=(p/this._segmentsW-.5)*this._width;n=(c/this._segmentsH-.5)*this._height;d[u]=r;if(this._yUp){d[u+1]=0;d[u+2]=n}else{d[u+1]=n;d[u+2]=0}g[u]=0;if(this._yUp){g[u+1]=1;g[u+2]=0}else{g[u+1]=0;g[u+2]=-1}m[u]=1;m[u+1]=0;m[u+2]=0;u+=a;if(this._doubleSided){for(var y=u;y<u+3;++y){d[y]=d[y-3];g[y]=-g[y-3];m[y]=-m[y-3]}u+=a}if(p!=this._segmentsW&&c!=this._segmentsH){o=p+c*h;var v=this._doubleSided?2:1;i[l++]=o*v;i[l++]=(o+h)*v;i[l++]=(o+h+1)*v;i[l++]=o*v;i[l++]=(o+h+1)*v;i[l++]=(o+1)*v;if(this._doubleSided){i[l++]=(o+h+1)*v+1;i[l++]=(o+h)*v+1;i[l++]=o*v+1;i[l++]=(o+1)*v+1;i[l++]=(o+h+1)*v+1;i[l++]=o*v+1}}}}}else if(e==Ne.LINE){var x=t;var b=this._segmentsH+1+h;var d;var w;var D=this._width/2;var C=this._height/2;d=new Float32Array(b*6);w=new Float32Array(b);l=0;u=0;for(c=0;c<=this._segmentsH;++c){d[u++]=-D;d[u++]=0;d[u++]=c*this._height-C;d[u++]=D;d[u++]=0;d[u++]=c*this._height-C;w[l++]=1}for(p=0;p<=this._segmentsW;++p){d[u++]=p*this._width-D;d[u++]=0;d[u++]=-C;d[u++]=p*this._width-D;d[u++]=0;d[u++]=C;w[l++]=1}x.setPositions(d);x.setThickness(w)}};i.prototype._pBuildUVs=function(t,e){var i;var r;var n;if(e==Ne.TRIANGLE){n=(this._segmentsH+1)*(this._segmentsW+1);if(this._doubleSided)n*=2;var s=t;if(s.uvs&&n==s.numVertices){s.invalidateVertices(s.uvs)}else{s.setUVs(new Float32Array(n*2))}i=s.uvs.get(n);r=s.uvs.stride;var a=0;for(var o=0;o<=this._segmentsH;++o){for(var h=0;h<=this._segmentsW;++h){i[a]=h/this._segmentsW*this._scaleU;i[a+1]=(1-o/this._segmentsH)*this._scaleV;a+=r;if(this._doubleSided){i[a]=h/this._segmentsW*this._scaleU;i[a+1]=(1-o/this._segmentsH)*this._scaleV;a+=r}}}}else if(e==Ne.LINE){}};return i}(qs);var Ga=function(t){e(i,t);function i(e,i,r,n,s){if(e===void 0){e=null}if(i===void 0){i="triangle"}if(r===void 0){r=100}if(n===void 0){n=16}if(s===void 0){s=true}return t.call(this,e,i,r,0,0,n,1,true,false,false,s)||this}Object.defineProperty(i.prototype,"radius",{get:function(){return this._pBottomRadius},set:function(t){this._pBottomRadius=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"sides",{get:function(){return this._pSegmentsW},set:function(t){this.setSegmentsW(t)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"subdivisions",{get:function(){return this._pSegmentsH},set:function(t){this.setSegmentsH(t)},enumerable:true,configurable:true});return i}(ka);var Ha=function(t){e(i,t);function i(e,i,r,n,s,a,o){if(e===void 0){e=null}if(i===void 0){i="triangle"}if(r===void 0){r=50}if(n===void 0){n=50}if(s===void 0){s=16}if(a===void 0){a=8}if(o===void 0){o=true}var h=t.call(this,e,i)||this;h._numVertices=0;h._radius=r;h._tubeRadius=n;h._segmentsR=s;h._segmentsT=a;h._yUp=o;return h}Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t;this._pInvalidatePrimitive()},enumerable:true,
configurable:true});Object.defineProperty(i.prototype,"tubeRadius",{get:function(){return this._tubeRadius},set:function(t){this._tubeRadius=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentsR",{get:function(){return this._segmentsR},set:function(t){this._segmentsR=t;this._pInvalidatePrimitive();this._pInvalidateUVs()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"segmentsT",{get:function(){return this._segmentsT},set:function(t){this._segmentsT=t;this._pInvalidatePrimitive();this._pInvalidateUVs()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t;this._pInvalidatePrimitive()},enumerable:true,configurable:true});i.prototype._pBuildGraphics=function(t,e){var i;var r;var n;var s;var a;var o,h;var u,l,p,c,_,f,d,g;var m;var y;var v=0;if(e==Ne.TRIANGLE){var x=t;this._numVertices=(this._segmentsT+1)*(this._segmentsR+1);v=this._segmentsT*this._segmentsR*6;if(this._numVertices==x.numVertices){x.invalidateIndices();x.invalidateVertices(x.positions);x.invalidateVertices(x.normals);x.invalidateVertices(x.tangents)}else{x.setIndices(new Uint16Array(v));x.setPositions(new Float32Array(this._numVertices*3));x.setNormals(new Float32Array(this._numVertices*3));x.setTangents(new Float32Array(this._numVertices*3));this._pInvalidateUVs()}i=x.indices.get(x.numElements);r=x.positions.get(this._numVertices);n=x.normals.get(this._numVertices);s=x.tangents.get(this._numVertices);a=x.concatenatedBuffer.stride/4;m=0;y=0;var b=2*Math.PI/this._segmentsR;var w=2*Math.PI/this._segmentsT;var D,C;var A,T,P,S;var E=0;var M=0;var O,I,R,L,N;for(h=0;h<=this._segmentsT;++h){E=m;for(o=0;o<=this._segmentsR;++o){d=o*b;g=h*w;N=Math.cos(g);c=N*Math.cos(d);_=N*Math.sin(d);f=Math.sin(g);u=this._radius*Math.cos(d)+this._tubeRadius*c;l=this._radius*Math.sin(d)+this._tubeRadius*_;p=h==this._segmentsT?0:this._tubeRadius*f;if(this._yUp){P=-f;S=_;A=0;T=N?c/N:u/this._radius;D=-p;C=l}else{P=_;S=f;A=N?c/N:u/this._radius;T=0;D=l;C=p}if(o==this._segmentsR){r[m]=u;r[m+1]=r[E+1];r[m+2]=r[E+2]}else{r[m]=u;r[m+1]=D;r[m+2]=C}n[m]=c;n[m+1]=P;n[m+2]=S;s[m]=-(N?_/N:l/this._radius);s[m+1]=A;s[m+2]=T;m+=a;if(o>0&&h>0){O=M;I=M-1;R=I-this._segmentsR-1;L=O-this._segmentsR-1;i[y++]=O;i[y++]=I;i[y++]=R;i[y++]=O;i[y++]=R;i[y++]=L}M++}}}else if(e==Ne.LINE){}};i.prototype._pBuildUVs=function(t,e){var i,r;var n;var s;if(e==Ne.TRIANGLE){var a=t;if(a.uvs&&this._numVertices==a.numVertices){a.invalidateVertices(a.uvs)}else{a.setUVs(new Float32Array(this._numVertices*2))}n=a.uvs.get(this._numVertices);s=a.uvs.stride;var o=0;for(r=0;r<=this._segmentsT;++r){for(i=0;i<=this._segmentsR;++i){n[o]=i/this._segmentsR*this._scaleU;n[o+1]=r/this._segmentsT*this._scaleV;o+=s}}}else if(e==Ne.LINE){}};return i}(qs);var Xa=function(){function t(){}return t}();Xa.ADVANCED="advanced";Xa.NORMAL="normal";var Wa=function(t){e(i,t);function i(){var e=t.call(this)||this;e._font_styles=[];return e}Object.defineProperty(i.prototype,"font_styles",{get:function(){return this._font_styles},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.dispose=function(){var t=this._font_styles.length;for(var e=0;e<t;++e){this._font_styles[e].dispose()}this._font_styles.length=0};i.prototype.get_font_table=function(t,e,i){if(e===void 0){e=xa.assetType}if(i===void 0){i=null}var r=this._font_styles.length;for(var n=0;n<r;++n){if(this._font_styles[n].assetType==e&&this._font_styles[n].name==t){return this._font_styles[n]}}var s=null;if(e==xa.assetType){s=new xa(i)}else if(e==wa.assetType){s=new wa}s.name=t;this._font_styles.push(s);return s};return i}(h);Wa.assetType="[asset Font]";var Ya=function(){function t(){}return t}();Ya.NONE="none";Ya.PIXEL="pixel";Ya.SUBPIXEL="subpixel";var qa=function(){function t(){}return t}();qa.CENTER="center";qa.LEFT="left";qa.NONE="none";qa.RIGHT="right";var Ka=function(t){e(i,t);function i(e,i,r,n,s,a,o,h,u,l,p,c,_){if(e===void 0){e="Times New Roman"}if(i===void 0){i=12}if(r===void 0){r=0}if(n===void 0){n=false}if(s===void 0){s=false}if(a===void 0){a=false}if(o===void 0){o=""}if(h===void 0){h=""}if(u===void 0){u="left"}if(l===void 0){l=0}if(p===void 0){p=0}if(c===void 0){c=0}if(_===void 0){_=0}var f=t.call(this)||this;f.tabStops=[];f.font_name=e;f.size=i;f.bold=n;f.italic=s;f.underline=a;f.url=o;f.link_target=h;f.align=u;f.leftMargin=l;f.rightMargin=p;f.indent=c;f.leading=_;return f}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});return i}(h);Ka.assetType="[asset TextFormat]";var Za=function(){function t(){this.CENTER="center";this.JUSTIFY="justify";this.LEFT="left";this.RIGHT="right"}return t}();var Qa=function(){function t(){}return t}();Qa.NORMAL="normal";Qa.SELECTION="selection";var Ja=function(){function t(t,e,i,r,n,s){if(t===void 0){t=NaN}if(e===void 0){e=NaN}if(i===void 0){i=NaN}if(r===void 0){r=NaN}if(n===void 0){n=NaN}if(s===void 0){s=NaN}}return t}();var $a=function(){function t(t,e,i){if(t===void 0){t=false}if(e===void 0){e=false}if(i===void 0){i=false}this._keepMaterial=t;this._disposeSources=e;this._objectSpace=i}Object.defineProperty(t.prototype,"disposeSources",{get:function(){return this._disposeSources},set:function(t){this._disposeSources=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"keepMaterial",{get:function(){return this._keepMaterial},set:function(t){this._keepMaterial=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"objectSpace",{get:function(){return this._objectSpace},set:function(t){this._objectSpace=t},enumerable:true,configurable:true});t.prototype.applyToContainer=function(t,e){this.reset();this.parseContainer(t,e);this.collect(t,false);this.merge(t,this._disposeSources)};t.prototype.applyToSprites=function(t,e){this.reset();if(!e.length)return;for(var i=0;i<e.length;i++)if(e[i]!=t)this.collect(e[i],this._disposeSources);this.collect(t,false);this.merge(t,this._disposeSources)};t.prototype.apply=function(t,e){this.reset();this.collect(e,this._disposeSources);this.collect(t,false);this.merge(t,this._disposeSources)};t.prototype.reset=function(){this._toDispose=new Array;this._shapeVOs=new Array};t.prototype.merge=function(t,e){var i;var r;var n;r=t.graphics;n=this._shapeVOs.length>1;for(i=0;i<this._shapeVOs.length;i++){var s=new $t(new u);s.autoDeriveNormals=false;s.autoDeriveTangents=false;var a=this._shapeVOs[i];s.setIndices(a.indices);s.setPositions(a.vertices);s.setNormals(a.normals);s.setTangents(a.tangents);s.setUVs(a.uvs);if(this._keepMaterial&&n)r.addShape(jt.getShape(s,a.material));else r.addShape(jt.getShape(s))}if(this._keepMaterial&&!n&&this._shapeVOs.length)t.material=this._shapeVOs[0].material;if(e){var o=this._toDispose.length;for(var i;i<o;i++)this._toDispose[i].dispose()}this._toDispose=null};t.prototype.collect=function(t,e){var i;var r;for(i=0;i<t.graphics.count;i++){var n;var s;var a,o,h,u,l;var p;var c;var _;var f;var d;var g;var m;c=t.graphics.getShapeAt(i).elements;_=this.getShapeData(t.graphics.getShapeAt(i).material);f=this._objectSpace?_.vertices:new Array;d=this._objectSpace?_.normals:new Array;g=this._objectSpace?_.tangents:new Array;o=f.length;h=d.length;u=g.length;l=_.uvs.length;this.copyAttributes(c.positions,f,c.numVertices,o);this.copyAttributes(c.normals,d,c.numVertices,h);this.copyAttributes(c.tangents,g,c.numVertices,u);this.copyAttributes(c.uvs,_.uvs,c.numVertices,l);p=!this._objectSpace?_.vertices.length/3:0;a=_.indices.length;s=c.numElements;m=c.indices.get(s);for(n=0;n<s;n++){r=n*3;_.indices[a++]=m[r]+p;_.indices[a++]=m[r+1]+p;_.indices[a++]=m[r+2]+p}if(!this._objectSpace){t.transform.concatenatedMatrix3D.transformVectors(f,f);t.transform.concatenatedMatrix3D.deltaTransformVectors(d,d);t.transform.concatenatedMatrix3D.deltaTransformVectors(g,g);o=_.vertices.length;h=_.normals.length;u=_.tangents.length;s=f.length;for(n=0;n<s;n++){_.vertices[o++]=f[n];_.normals[h++]=d[n];_.tangents[u++]=g[n]}}}if(e)this._toDispose.push(t)};t.prototype.copyAttributes=function(t,e,i,r){var n=t.get(i);var s=t.dimensions;var a=t.stride;var o=i*a;for(var h=0;h<o;h+=a)for(var u=0;u<s;u++)e[r++]=n[h+u]};t.prototype.getShapeData=function(t){var e;if(this._keepMaterial){var i;var r;r=this._shapeVOs.length;for(i=0;i<r;i++){if(this._shapeVOs[i].material==t){e=this._shapeVOs[i];break}}}else if(this._shapeVOs.length){e=this._shapeVOs[0]}if(!e){e=new to;e.vertices=new Array;e.normals=new Array;e.tangents=new Array;e.uvs=new Array;e.indices=new Array;e.material=t;this._shapeVOs.push(e)}return e};t.prototype.parseContainer=function(t,e){var i;var r;if(e instanceof Ws&&e!=t)this.collect(e,this._disposeSources);for(r=0;r<e.numChildren;++r){i=e.getChildAt(r);this.parseContainer(t,i)}};return t}();var to=function(){function t(){}return t}();var eo=function(){function t(){}t.string=function(t){if(typeof t=="function")t=new t;if(typeof t=="string")return t;return t};t.byteArray=function(t){if(typeof t=="function")t=new t;if(t instanceof mt)return t;return t};t.isHex=function(t){var e=t.length;for(var i=0;i<e;++i){if(this._hexChars.indexOf(t.charAt(i))==-1)return false}return true};t.tryColor=function(t){if(typeof t=="number")return Math.floor(t);if(typeof t=="string"){if(t=="random")return Math.floor(Math.random()*16777216);if(this._colorNames==null){this._colorNames=new Object;this._colorNames["steelblue"]=4620980;this._colorNames["royalblue"]=267920;this._colorNames["cornflowerblue"]=6591981;this._colorNames["lightsteelblue"]=11584734;this._colorNames["mediumslateblue"]=8087790;this._colorNames["slateblue"]=6970061;this._colorNames["darkslateblue"]=4734347;this._colorNames["midnightblue"]=1644912;this._colorNames["navy"]=128;this._colorNames["darkblue"]=139;this._colorNames["mediumblue"]=205;this._colorNames["blue"]=255;this._colorNames["dodgerblue"]=2003199;this._colorNames["deepskyblue"]=49151;this._colorNames["lightskyblue"]=8900346;this._colorNames["skyblue"]=8900331;this._colorNames["lightblue"]=11393254;this._colorNames["powderblue"]=11591910;this._colorNames["azure"]=15794175;this._colorNames["lightcyan"]=14745599;this._colorNames["paleturquoise"]=11529966;this._colorNames["mediumturquoise"]=4772300;this._colorNames["lightseagreen"]=2142890;this._colorNames["darkcyan"]=35723;this._colorNames["teal"]=32896;this._colorNames["cadetblue"]=6266528;this._colorNames["darkturquoise"]=52945;this._colorNames["aqua"]=65535;this._colorNames["cyan"]=65535;this._colorNames["turquoise"]=4251856;this._colorNames["aquamarine"]=8388564;this._colorNames["mediumaquamarine"]=6737322;this._colorNames["darkseagreen"]=9419919;this._colorNames["mediumseagreen"]=3978097;this._colorNames["seagreen"]=3050327;this._colorNames["darkgreen"]=25600;this._colorNames["green"]=32768;this._colorNames["forestgreen"]=2263842;this._colorNames["limegreen"]=3329330;this._colorNames["lime"]=65280;this._colorNames["chartreuse"]=8388352;this._colorNames["lawngreen"]=8190976;this._colorNames["greenyellow"]=11403055;this._colorNames["yellowgreen"]=10145074;this._colorNames["palegreen"]=10025880;this._colorNames["lightgreen"]=9498256;this._colorNames["springgreen"]=65407;this._colorNames["mediumspringgreen"]=64154;this._colorNames["darkolivegreen"]=5597999;this._colorNames["olivedrab"]=7048739;this._colorNames["olive"]=8421376;this._colorNames["darkkhaki"]=12433259;this._colorNames["darkgoldenrod"]=12092939;this._colorNames["goldenrod"]=14329120;this._colorNames["gold"]=16766720;this._colorNames["yellow"]=16776960;this._colorNames["khaki"]=15787660;this._colorNames["palegoldenrod"]=15657130;this._colorNames["blanchedalmond"]=16772045;this._colorNames["moccasin"]=16770229;this._colorNames["wheat"]=16113331;this._colorNames["navajowhite"]=16768685;this._colorNames["burlywood"]=14596231;this._colorNames["tan"]=13808780;this._colorNames["rosybrown"]=12357519;this._colorNames["sienna"]=10506797;this._colorNames["saddlebrown"]=9127187;this._colorNames["chocolate"]=13789470;this._colorNames["peru"]=13468991;this._colorNames["sandybrown"]=16032864;this._colorNames["darkred"]=9109504;this._colorNames["maroon"]=8388608;this._colorNames["brown"]=10824234;this._colorNames["firebrick"]=11674146;this._colorNames["indianred"]=13458524;this._colorNames["lightcoral"]=15761536;this._colorNames["salmon"]=16416882;this._colorNames["darksalmon"]=15308410;this._colorNames["lightsalmon"]=16752762;this._colorNames["coral"]=16744272;this._colorNames["tomato"]=16737095;this._colorNames["darkorange"]=16747520;this._colorNames["orange"]=16753920;this._colorNames["orangered"]=16729344;this._colorNames["crimson"]=14423100;this._colorNames["red"]=16711680;this._colorNames["deeppink"]=16716947;this._colorNames["fuchsia"]=16711935;this._colorNames["magenta"]=16711935;this._colorNames["hotpink"]=16738740;this._colorNames["lightpink"]=16758465;this._colorNames["pink"]=16761035;this._colorNames["palevioletred"]=14381203;this._colorNames["mediumvioletred"]=13047173;this._colorNames["purple"]=8388736;this._colorNames["darkmagenta"]=9109643;this._colorNames["mediumpurple"]=9662683;this._colorNames["blueviolet"]=9055202;this._colorNames["indigo"]=4915330;this._colorNames["darkviolet"]=9699539;this._colorNames["darkorchid"]=10040012;this._colorNames["mediumorchid"]=12211667;this._colorNames["orchid"]=14315734;this._colorNames["violet"]=15631086;this._colorNames["plum"]=14524637;this._colorNames["thistle"]=14204888;this._colorNames["lavender"]=15132410;this._colorNames["ghostwhite"]=16316671;this._colorNames["aliceblue"]=15792383;this._colorNames["mintcream"]=16121850;this._colorNames["honeydew"]=15794160;this._colorNames["lightgoldenrodyellow"]=16448210;this._colorNames["lemonchiffon"]=16775885;this._colorNames["cornsilk"]=16775388;this._colorNames["lightyellow"]=16777184;this._colorNames["ivory"]=16777200;this._colorNames["floralwhite"]=16775920;this._colorNames["linen"]=16445670;this._colorNames["oldlace"]=16643558;this._colorNames["antiquewhite"]=16444375;this._colorNames["bisque"]=16770244;this._colorNames["peachpuff"]=16767673;this._colorNames["papayawhip"]=16773077;this._colorNames["beige"]=16119260;this._colorNames["seashell"]=16774638;this._colorNames["lavenderblush"]=16773365;this._colorNames["mistyrose"]=16770273;this._colorNames["snow"]=16775930;this._colorNames["white"]=16777215;this._colorNames["whitesmoke"]=16119285;this._colorNames["gainsboro"]=14474460;this._colorNames["lightgrey"]=13882323;this._colorNames["silver"]=12632256;this._colorNames["darkgrey"]=11119017;this._colorNames["grey"]=8421504;this._colorNames["lightslategrey"]=7833753;this._colorNames["slategrey"]=7372944;this._colorNames["dimgrey"]=6908265;this._colorNames["darkslategrey"]=3100495;this._colorNames["black"]=0;this._colorNames["transparent"]=4278190080}if(this._colorNames[t]!=null)return this._colorNames[t];if(t.length==6&&this.isHex(t))return parseInt("0x"+t)}return null};t.color=function(t){var e=this.tryColor(t);if(e==null)throw new Oa("Can't cast to color: "+t);return e};t.tryClass=function(t){if(this._notClasses[t])return t;var e=this._classes[t];if(e!=null)return e;try{e=window[t];this._classes[t]=e;return e}catch(i){}this._notClasses[t]=true;return t};t.image2D=function(t){if(t==null)return null;if(typeof t=="string")t=this.tryClass(t);if(typeof t=="function"){try{t=new t}catch(e){t=new t(0,0)}}if(t instanceof ae)return t;if(t instanceof ve)t=t.image2D;throw new Oa("Can't cast to BitmapImage2D: "+t)};t.bitmapTexture=function(e){if(e==null)return null;if(typeof e=="string")e=this.tryClass(e);if(typeof e=="function"){try{e=new e}catch(i){e=new e(0,0)}}if(e instanceof ve)return e;try{var r=t.image2D(e);return new ve(r)}catch(i){}throw new Oa("Can't cast to Single2DTexture: "+e)};return t}();eo._hexChars="0123456789abcdefABCDEF";eo._notClasses=new Object;eo._classes=new Object;var io=function(t){e(i,t);function i(){var e=t.call(this)||this;e._objects=new Array;e._views=new Array;e._iCollectionMark=0;e._iIsRoot=true;e._iIsPartition=true;e._pScene=e;e._pPartition=e;return e}Object.defineProperty(i.prototype,"objects",{get:function(){return this._objects},enumerable:true,configurable:true});i.prototype._iRegisterObject=function(t){this._objects.push(t);var e=this._views.length;for(var i=0;i<e;i++)this._views[i].registerObject(t)};i.prototype._iUnregisterObject=function(t){this._objects.splice(this._objects.indexOf(t),1);var e=this._views.length;for(var i=0;i<e;i++)this._views[i].unRegisterObject(t)};i.prototype._iRegisterView=function(t){this._views.push(t);var e=this._objects.length;for(var i=0;i<e;i++)t.registerObject(this._objects[i])};i.prototype._iUnregisterView=function(t){this._views.splice(this._views.indexOf(t),1);var e=this._objects.length;for(var i=0;i<e;i++)t.unRegisterObject(this._objects[i])};return i}(Xs);var ro=function(i){e(r,i);function r(t,e,r){var n=i.call(this,t,e,r)||this;n._includeCasters=true;n._lightingPass=e;return n}r.prototype._iIncludeDependencies=function(){this.numPointLights=this._lightingPass.numPointLights;this.numDirectionalLights=this._lightingPass.numDirectionalLights;this.numLightProbes=this._lightingPass.numLightProbes;var e=this._lightingPass.numPointLights+this._lightingPass.numDirectionalLights;var r=this._lightingPass.numLightProbes;var n=this._lightingPass._iUsesDiffuse(this)?this._lightingPass.diffuseLightSources:0;var s=this._lightingPass._iUsesSpecular(this)?this._lightingPass.specularLightSources:0;var a=n|s;this.usesLightFallOff=this._lightingPass.enableLightFallOff&&this.profile!=t.ContextGLProfile.BASELINE_CONSTRAINED;this.usesCommonData=this.usesLightFallOff||this.usesCommonData;this.numLights=e+r;this.usesLights=e>0&&(a&Na.LIGHTS)!=0;this.usesProbes=r>0&&(a&Na.PROBES)!=0;this.usesLightsForSpecular=e>0&&(s&Na.LIGHTS)!=0;this.usesProbesForSpecular=r>0&&(s&Na.PROBES)!=0;this.usesLightsForDiffuse=e>0&&(n&Na.LIGHTS)!=0;this.usesProbesForDiffuse=r>0&&(n&Na.PROBES)!=0;this.usesShadows=this._lightingPass._iUsesShadows(this);i.prototype._iIncludeDependencies.call(this)};r.prototype.createCompiler=function(t,e){return new Ls(t,e,this)};r.prototype._setRenderState=function(t,e){i.prototype._setRenderState.call(this,t,e);if(this._lightingPass.lightPicker)this._lightingPass.lightPicker.collectLights(t.sourceEntity);if(this.usesLights)this.updateLights();if(this.usesProbes)this.updateProbes()};r.prototype.updateLights=function(){var t;var e;var i=0;var r=0;var n;var s;var a=0;var o=this.usesShadows?2:1;var h;var u;this.ambientR=this.ambientG=this.ambientB=0;h=this.lightVertexConstantIndex;r=this.lightFragmentConstantIndex;var l=0;var p=this._lightingPass.lightPicker.directionalLights;u=this._lightingPass.directionalLightsOffset;n=this._lightingPass.lightPicker.directionalLights.length;if(u>n){l=1;u-=n}for(;l<o;++l){if(l)p=this._lightingPass.lightPicker.castingDirectionalLights;n=p.length;if(n>this.numDirectionalLights)n=this.numDirectionalLights;for(i=0;i<n;++i){t=p[u+i];s=t.sceneDirection;this.ambientR+=t._iAmbientR;this.ambientG+=t._iAmbientG;this.ambientB+=t._iAmbientB;if(this.usesTangentSpace){var c=-s.x;var _=-s.y;var f=-s.z;this.vertexConstantData[h++]=this._pInverseSceneMatrix[0]*c+this._pInverseSceneMatrix[4]*_+this._pInverseSceneMatrix[8]*f;this.vertexConstantData[h++]=this._pInverseSceneMatrix[1]*c+this._pInverseSceneMatrix[5]*_+this._pInverseSceneMatrix[9]*f;this.vertexConstantData[h++]=this._pInverseSceneMatrix[2]*c+this._pInverseSceneMatrix[6]*_+this._pInverseSceneMatrix[10]*f;this.vertexConstantData[h++]=1}else{this.fragmentConstantData[r++]=-s.x;this.fragmentConstantData[r++]=-s.y;this.fragmentConstantData[r++]=-s.z;this.fragmentConstantData[r++]=1}this.fragmentConstantData[r++]=t._iDiffuseR;this.fragmentConstantData[r++]=t._iDiffuseG;this.fragmentConstantData[r++]=t._iDiffuseB;this.fragmentConstantData[r++]=1;this.fragmentConstantData[r++]=t._iSpecularR;this.fragmentConstantData[r++]=t._iSpecularG;this.fragmentConstantData[r++]=t._iSpecularB;this.fragmentConstantData[r++]=1;if(++a==this.numDirectionalLights){i=n;l=o}}}if(this.numDirectionalLights>a){i=r+(this.numDirectionalLights-a)*12;while(r<i)this.fragmentConstantData[r++]=0}a=0;var d=this._lightingPass.lightPicker.pointLights;u=this._lightingPass.pointLightsOffset;n=this._lightingPass.lightPicker.pointLights.length;if(u>n){l=1;u-=n}else{l=0}for(;l<o;++l){if(l)d=this._lightingPass.lightPicker.castingPointLights;n=d.length;for(i=0;i<n;++i){e=d[u+i];s=e.scenePosition;this.ambientR+=e._iAmbientR;this.ambientG+=e._iAmbientG;this.ambientB+=e._iAmbientB;if(this.usesTangentSpace){c=s.x;_=s.y;f=s.z;this.vertexConstantData[h++]=this._pInverseSceneMatrix[0]*c+this._pInverseSceneMatrix[4]*_+this._pInverseSceneMatrix[8]*f+this._pInverseSceneMatrix[12];this.vertexConstantData[h++]=this._pInverseSceneMatrix[1]*c+this._pInverseSceneMatrix[5]*_+this._pInverseSceneMatrix[9]*f+this._pInverseSceneMatrix[13];this.vertexConstantData[h++]=this._pInverseSceneMatrix[2]*c+this._pInverseSceneMatrix[6]*_+this._pInverseSceneMatrix[10]*f+this._pInverseSceneMatrix[14];this.vertexConstantData[h++]=1}else if(!this.usesGlobalPosFragment){this.vertexConstantData[h++]=s.x;this.vertexConstantData[h++]=s.y;this.vertexConstantData[h++]=s.z;this.vertexConstantData[h++]=1}else{this.fragmentConstantData[r++]=s.x;this.fragmentConstantData[r++]=s.y;this.fragmentConstantData[r++]=s.z;this.fragmentConstantData[r++]=1}this.fragmentConstantData[r++]=e._iDiffuseR;this.fragmentConstantData[r++]=e._iDiffuseG;this.fragmentConstantData[r++]=e._iDiffuseB;var g=e._pRadius;this.fragmentConstantData[r++]=g*g;this.fragmentConstantData[r++]=e._iSpecularR;this.fragmentConstantData[r++]=e._iSpecularG;this.fragmentConstantData[r++]=e._iSpecularB;this.fragmentConstantData[r++]=e._pFallOffFactor;if(++a==this.numPointLights){i=n;l=o}}}if(this.numPointLights>a){i=r+(a-this.numPointLights)*12;for(;r<i;++r)this.fragmentConstantData[r]=0}};r.prototype.updateProbes=function(){var t;var e=this._lightingPass.lightPicker.lightProbes;var i=this._lightingPass.lightPicker.lightProbeWeights;var r=e.length-this._lightingPass.lightProbesOffset;var n=this.usesProbesForDiffuse;var s=this.usesProbesForSpecular;if(!(n||s))return;if(r>this.numLightProbes)r=this.numLightProbes;for(var a=0;a<r;++a){t=e[this._lightingPass.lightProbesOffset+a];if(n)this._stage.getAbstraction(t.diffuseMap).activate(this.lightProbeDiffuseIndices[a],t.diffuseSampler.mipmap);if(s)this._stage.getAbstraction(t.specularMap).activate(this.lightProbeSpecularIndices[a],t.diffuseSampler.mipmap)}for(a=0;a<r;++a)this.fragmentConstantData[this.probeWeightsIndex+a]=i[this._lightingPass.lightProbesOffset+a]};return r}(Tr);var no=function(){function t(){}t.prototype.sortBlendedRenderables=function(t){return t};t.prototype.sortOpaqueRenderables=function(t){return t};return t}();var so=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._skybox=t;r._shader=new Tr(e.elementsClass,r,r._stage);r._texture=r._shader.getAbstraction(r._skybox.texture);r._pAddPass(r);return r}r.prototype.onClear=function(t){i.prototype.onClear.call(this,t);this._texture.onClear(new s(s.CLEAR,this._skybox.texture));this._texture=null;this._skybox=null};r.prototype._pUpdateRender=function(){i.prototype._pUpdateRender.call(this);this._pRequiresBlending=this._material.blendMode!=fe.NORMAL;this.shader.setBlendMode(this._material.blendMode==fe.NORMAL&&this._pRequiresBlending?fe.LAYER:this._material.blendMode)};r.prototype._iIncludeDependencies=function(t){i.prototype._iIncludeDependencies.call(this,t);t.usesPositionFragment=true};r.prototype._iGetFragmentCode=function(t,e,i){return this._texture._iGetFragmentCode(i.shadedTarget,e,i,i.positionVarying)};r.prototype._setRenderState=function(t,e){i.prototype._setRenderState.call(this,t,e);this._texture._setRenderState(t)};r.prototype._iActivate=function(e){i.prototype._iActivate.call(this,e);this._stage.context.setDepthTest(false,t.ContextGLCompareMode.LESS);this._texture.activate(this)};return r}(Or);var ao=function(){function t(){}t.generateGraphics=function(e,i,r){if(r===void 0){r=null}var n=new Array;var s=new Array;var a=new Array;var o=new Array;var h=new Array;var l=new Array;var p=new Array;var c=new Array;var _=i.length;var f;var d;var g;var m;var y;var v;var x;var b;var w;var D;var C;var T;var P=new Array;var S=new A;var E=new A;var M=new A;var O=new z;for(C=0;C<_;C++){f=i[C];g=f.count;for(var I=0;I<g;I++){if(P.length<=I){P.push(c.length);n.push(new Array);s.push(new Array);a.push(new Array);o.push(new Array);h.push(new Array);c.push(new $t(new u));l.push(0)}d=f.getShapeAt(I).elements;if(d.numVertices+l[P[I]]>t.MAX_VERTEX){P[I]=c.length;n.push(new Array);s.push(new Array);a.push(new Array);o.push(new Array);h.push(new Array);c.push(new $t(new u));l.push(0)}T=P[I];m=n[T];y=s[T];v=a[T];x=o[T];b=h[T];w=l[T];D=c[T];var R=new Bt;R.numVertices=d.numVertices;R.startVertexIndex=w;R.particleIndex=C;R.elements=D;p.push(R);l[T]+=d.numVertices;var L;var N;var F;var B;var V;var U;var k;var j=d;var G;var H;var X;var W;var Y;var q;var K;var Z;if(j){k=j.numVertices;G=j.positions.get(k);H=j.positions.stride;X=j.normals.get(k);W=j.normals.stride;Y=j.tangents.get(k);q=j.tangents.stride;K=j.uvs.get(k);Z=j.uvs.stride;if(r){var Q=r[C];var J=Q.vertexTransform;var $=Q.invVertexTransform;var tt=Q.UVTransform;for(L=0;L<k;L++){F=L*H;S.x=G[F];S.y=G[F+1];S.z=G[F+2];B=L*W;E.x=X[B];E.y=X[B+1];E.z=X[B+2];V=L*q;M.x=Y[V];M.y=Y[V+1];M.z=Y[V+2];U=L*Z;O.x=K[U];O.y=K[U+1];if(J){S=J.transformVector(S);E=$.deltaTransformVector(E);M=$.deltaTransformVector(E)}if(tt)O=tt.transformPoint(O);y.push(S.x,S.y,S.z);v.push(E.x,E.y,E.z);x.push(M.x,M.y,M.z);b.push(O.x,O.y)}}else{for(L=0;L<k;L++){F=L*H;B=L*W;V=L*q;U=L*Z;y.push(G[F],G[F+1],G[F+2]);v.push(X[B],X[B+1],X[B+2]);x.push(Y[V],Y[V+1],Y[V+2]);b.push(K[U],K[U+1])}}}else{}k=d.numElements;var et=d.indices.get(k);for(L=0;L<k;L++){N=L*3;m.push(et[N]+w,et[N+1]+w,et[N+2]+w)}}}e.particles=p;e.numParticles=_;_=c.length;for(C=0;C<_;C++){D=c[C];D.autoDeriveNormals=false;D.autoDeriveTangents=false;D.setIndices(n[C]);D.setPositions(s[C]);D.setNormals(a[C]);D.setTangents(o[C]);D.setUVs(h[C]);e.addShape(jt.getShape(D))}};return t}();ao.MAX_VERTEX=65535;var oo=function(){function t(){}Object.defineProperty(t.prototype,"vertexTransform",{get:function(){return this._defaultVertexTransform},set:function(t){this._defaultVertexTransform=t;this._defaultInvVertexTransform=t.clone();this._defaultInvVertexTransform.invert();this._defaultInvVertexTransform.transpose()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"UVTransform",{get:function(){return this._defaultUVTransform},set:function(t){this._defaultUVTransform=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"invVertexTransform",{get:function(){return this._defaultInvVertexTransform},enumerable:true,configurable:true});return t}();var ho=function(t){e(i,t);function i(){var e=t.call(this)||this;e._textures=new Array;e._owners=new Array;e._counts=new Array;return e}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.iIsUsed=function(t){return true};i.prototype.iInitVO=function(t,e){};i.prototype.iInitConstants=function(t,e){};i.prototype.iUsesTangentSpace=function(){return true};i.prototype.dispose=function(){};i.prototype.iAddOwner=function(t){var e=this._owners.indexOf(t);if(e!=-1){this._counts[e]++}else{this._owners.push(t);this._counts.push(1);var i=this._textures.length;for(var r=0;r<i;r++)t.addTexture(this._textures[r])}};i.prototype.iRemoveOwner=function(t){var e=this._owners.indexOf(t);if(this._counts[e]!=1){this._counts[e]--}else{this._owners.splice(e,1);this._counts.splice(e,1);var i=this._textures.length;for(var r=0;r<i;r++)t.removeTexture(this._textures[r])}};i.prototype.iAddTexture=function(t){this._textures.push(t);var e=this._owners.length;for(var i=0;i<e;i++)this._owners[i].addTexture(t)};i.prototype.iRemoveTexture=function(t){this._textures.splice(this._textures.indexOf(t),1);var e=this._owners.length;for(var i=0;i<e;i++)this._owners[i].removeTexture(t)};i.prototype.iReset=function(){this.iCleanCompilationData()};i.prototype.iCleanCompilationData=function(){};i.prototype.iGetVertexCode=function(t,e,i,r){return""};i.prototype.iGetFragmentCode=function(t,e,i,r,n){return null};i.prototype.iActivate=function(t,e,i){};i.prototype.iSetRenderState=function(t,e,i,r,n){};i.prototype.iDeactivate=function(t,e,i){};i.prototype.iInvalidateShaderProgram=function(){this.dispatchEvent(new bs(bs.SHADER_INVALIDATED))};i.prototype.copyFrom=function(t){};return i}(h);ho.assetType="[asset ShadingMethod]";var uo=function(t){e(i,t);function i(){var e=t.call(this)||this;e._alpha=1;e._colorR=1;e._colorG=1;e._colorB=1;e._strength=1;return e}i.prototype.iInitVO=function(t,e){if(this._texture){e.textureGL=t.getAbstraction(this._texture);t.uvDependencies++}else if(e.textureGL){e.textureGL.onClear(new s(s.CLEAR,this._texture));e.textureGL=null}};i.prototype.iInitConstants=function(t,e){if(!e.textureGL){this._color=t.numLights?16777215:e.pass._material.style.color;this.updateColor()}};Object.defineProperty(i.prototype,"strength",{get:function(){return this._strength},set:function(t){if(this._strength==t)return;this._strength=t;this.updateColor()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"alpha",{get:function(){return this._alpha},set:function(t){if(this._alpha==t)return;this._alpha=t;this.updateColor()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.iRemoveTexture(this._texture);this._texture=t;if(this._texture)this.iAddTexture(this._texture);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.copyFrom=function(t){var e=t;var i=e};i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s="";if(e.textureGL){s+=e.textureGL._iGetFragmentCode(i,r,n,n.uvVarying);if(t.alphaThreshold>0){var a=r.getFreeFragmentConstant();e.fragmentConstantsIndex=a.index*4;s+="sub "+i+".w, "+i+".w, "+a+".x\n"+"kil "+i+".w\n"+"add "+i+".w, "+i+".w, "+a+".x\n"}}else{var o=r.getFreeFragmentConstant();e.fragmentConstantsIndex=o.index*4;s+="mov "+i+", "+o+"\n"}return s};i.prototype.iActivate=function(t,e,i){if(e.textureGL){e.textureGL.activate(e.pass._render);if(t.alphaThreshold>0)t.fragmentConstantData[e.fragmentConstantsIndex]=t.alphaThreshold}else{var r=e.fragmentConstantsIndex;var n=t.fragmentConstantData;n[r]=this._colorR;n[r+1]=this._colorG;n[r+2]=this._colorB;n[r+3]=this._alpha}};i.prototype.iSetRenderState=function(t,e,i,r,n){if(e.textureGL)e.textureGL._setRenderState(i)};i.prototype.updateColor=function(){this._colorR=(this._color>>16&255)/255*this._strength;this._colorG=(this._color>>8&255)/255*this._strength;this._colorB=(this._color&255)/255*this._strength};return i}(ho);var lo=function(t){e(i,t);function i(){return t.call(this)||this}i.prototype.iGetFragmentPreLightingCode=function(t,e,i,r){return""};i.prototype.iGetFragmentCodePerLight=function(t,e,i,r,n,s){return""};i.prototype.iGetFragmentCodePerProbe=function(t,e,i,r,n,s){return""};i.prototype.iGetFragmentPostLightingCode=function(t,e,i,r,n){return""};return i}(ho);var po=function(t){e(i,t);function i(){var e=t.call(this)||this;e._multiply=true;e._ambientColorR=1;e._ambientColorG=1;e._ambientColorB=1;e._color=16777215;e._colorR=1;e._colorG=1;e._colorB=1;return e}i.prototype.iIsUsed=function(t){if(!t.numLights)return false;return true};Object.defineProperty(i.prototype,"multiply",{get:function(){return this._multiply},set:function(t){if(this._multiply==t)return;this._multiply=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.iInitVO=function(t,e){if(this._texture){e.textureGL=t.getAbstraction(this._texture);t.uvDependencies++}else if(e.textureGL){e.textureGL.onClear(new s(s.CLEAR,null));e.textureGL=null;

}if(t.numLights>0){t.usesCommonData=true;e.needsNormals=true}};i.prototype.iInitConstants=function(t,e){if(t.numLights>0){this._ambientColor=e.pass._material.style.color;this.updateAmbientColor()}else{this._ambientColor=null}};Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){if(this._color==t)return;this._color=t;this.updateColor()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.iRemoveTexture(this._texture);this._texture=t;if(this._texture)this.iAddTexture(this._texture);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.dispose=function(){this._texture=null};i.prototype.copyFrom=function(t){var e=t;this.texture=e.texture;this.multiply=e.multiply;this.color=e.color};i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._pTotalLightColorReg=null};i.prototype.iGetFragmentPreLightingCode=function(t,e,i,r){var n="";this._pIsFirstLight=true;i.addFragmentTempUsages(this._pTotalLightColorReg=i.getFreeFragmentVectorTemp(),1);return n};i.prototype.iGetFragmentCodePerLight=function(t,e,i,r,n,s){var a="";var o;if(this._pIsFirstLight){o=this._pTotalLightColorReg}else{o=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(o,1)}a+="dp3 "+o+".x, "+i+", "+s.normalFragment+"\n"+"max "+o+".w, "+o+".x, "+s.commons+".y\n";if(t.usesLightFallOff)a+="mul "+o+".w, "+o+".w, "+i+".w\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(t,e,o,n,s);a+="mul "+o+", "+o+".w, "+r+"\n";if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+o+"\n";n.removeFragmentTempUsage(o)}this._pIsFirstLight=false;return a};i.prototype.iGetFragmentCodePerProbe=function(t,e,i,r,n,s){var a="";var o;if(this._pIsFirstLight){o=this._pTotalLightColorReg}else{o=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(o,1)}a+="tex "+o+", "+s.normalFragment+", "+i+" <cube,linear,miplinear>\n"+"mul "+o+".xyz, "+o+".xyz, "+r+"\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(t,e,o,n,s);if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+o+"\n";n.removeFragmentTempUsage(o)}this._pIsFirstLight=false;return a};i.prototype.iGetFragmentPostLightingCode=function(t,e,i,r,n){var s="";var a;var o;if(n.shadowTarget)s+=this.pApplyShadow(t,e,r,n);r.addFragmentTempUsages(a=r.getFreeFragmentVectorTemp(),1);var h=r.getFreeFragmentConstant();e.fragmentConstantsIndex=h.index*4;if(this._texture){s+=e.textureGL._iGetFragmentCode(a,r,n,n.uvVarying)}else{var u=r.getFreeFragmentConstant();s+="mov "+a+", "+u+"\n"}s+="sat "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+"\n"+"mul "+a+".xyz, "+a+", "+this._pTotalLightColorReg+"\n";if(this._multiply){s+="add "+a+".xyz, "+a+", "+h+"\n"+"mul "+i+".xyz, "+i+", "+a+"\n"}else if(this._texture){s+="mul "+i+".xyz, "+i+", "+h+"\n"+"mul "+this._pTotalLightColorReg+".xyz, "+i+", "+this._pTotalLightColorReg+"\n"+"sub "+i+".xyz, "+i+", "+this._pTotalLightColorReg+"\n"+"add "+i+".xyz, "+i+", "+a+"\n"}else{s+="mul "+this._pTotalLightColorReg+".xyz, "+h+", "+this._pTotalLightColorReg+"\n"+"sub "+this._pTotalLightColorReg+".xyz, "+h+", "+this._pTotalLightColorReg+"\n"+"add "+a+".xyz, "+a+", "+this._pTotalLightColorReg+"\n"+"mul "+i+".xyz, "+i+", "+a+"\n"}r.removeFragmentTempUsage(this._pTotalLightColorReg);r.removeFragmentTempUsage(a);return s};i.prototype.pApplyShadow=function(t,e,i,r){return"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+r.shadowTarget+".w\n"};i.prototype.iActivate=function(t,e,i){if(this._texture){e.textureGL.activate(e.pass._render)}else{var r=e.fragmentConstantsIndex;var n=t.fragmentConstantData;if(this._multiply){n[r+4]=this._colorR*this._ambientColorR;n[r+5]=this._colorG*this._ambientColorG;n[r+6]=this._colorB*this._ambientColorB}else{n[r+4]=this._colorR;n[r+5]=this._colorG;n[r+6]=this._colorB}n[r+7]=1}};i.prototype.updateColor=function(){this._colorR=(this._color>>16&255)/255;this._colorG=(this._color>>8&255)/255;this._colorB=(this._color&255)/255};i.prototype.updateAmbientColor=function(){this._ambientColorR=(this._ambientColor>>16&255)/255;this._ambientColorG=(this._ambientColor>>8&255)/255;this._ambientColorB=(this._ambientColor&255)/255};i.prototype.iSetRenderState=function(t,e,i,r,n){if(this._texture)e.textureGL._setRenderState(i);var s=e.fragmentConstantsIndex;var a=t.fragmentConstantData;a[s]=t.ambientR*this._ambientColorR;a[s+1]=t.ambientG*this._ambientColorG;a[s+2]=t.ambientB*this._ambientColorB;a[s+3]=1};return i}(lo);var co=function(t){e(i,t);function i(e){if(e===void 0){e=null}var i=t.call(this)||this;i._texture=e;if(i._texture)i.iAddTexture(i._texture);return i}i.prototype.iIsUsed=function(t){if(this._texture&&t.normalDependencies)return true;return false};i.prototype.iInitVO=function(t,e){if(this._texture){e.textureGL=t.getAbstraction(this._texture);t.uvDependencies++}};i.prototype.iOutputsTangentNormals=function(){return true};i.prototype.copyFrom=function(t){var e=t;var i=t;if(i.texture!=null)this.texture=i.texture};Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.iRemoveTexture(this._texture);this._texture=t;if(this._texture)this.iAddTexture(this._texture);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.dispose=function(){if(this._texture)this._texture=null};i.prototype.iActivate=function(t,e,i){if(this._texture)e.textureGL.activate(e.pass._render)};i.prototype.iSetRenderState=function(t,e,i,r,n){if(this._texture)e.textureGL._setRenderState(i)};i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s="";if(this._texture)s+=e.textureGL._iGetFragmentCode(i,r,n,n.uvVarying);s+="sub "+i+".xyz, "+i+".xyz, "+n.commons+".xxx\n"+"nrm "+i+".xyz, "+i+"\n";return s};return i}(ho);var _o=function(t){e(i,t);function i(){var e=t.call(this)||this;e._gloss=50;e._strength=1;e._color=16777215;e._iSpecularR=1;e._iSpecularG=1;e._iSpecularB=1;return e}i.prototype.iIsUsed=function(t){if(!t.numLights)return false;return true};i.prototype.iInitVO=function(t,e){e.needsNormals=t.numLights>0;e.needsView=t.numLights>0;if(this._texture){e.textureGL=t.getAbstraction(this._texture);t.uvDependencies++}else if(e.textureGL){e.textureGL.onClear(new s(s.CLEAR,null));e.textureGL=null}};Object.defineProperty(i.prototype,"gloss",{get:function(){return this._gloss},set:function(t){this._gloss=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"strength",{get:function(){return this._strength},set:function(t){if(t==this._strength)return;this._strength=t;this.updateSpecular()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){if(this._color==t)return;if(this._color==0||t==0)this.iInvalidateShaderProgram();this._color=t;this.updateSpecular()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.iRemoveTexture(this._texture);this._texture=t;if(this._texture)this.iAddTexture(this._texture);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.copyFrom=function(t){var e=t;var i=t;var r=i;this.texture=r.texture;this.strength=r.strength;this.color=r.color;this.gloss=r.gloss};i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._pTotalLightColorReg=null;this._pSpecularTexData=null;this._pSpecularDataRegister=null};i.prototype.iGetFragmentPreLightingCode=function(t,e,i,r){var n="";this._pIsFirstLight=true;this._pSpecularDataRegister=i.getFreeFragmentConstant();e.fragmentConstantsIndex=this._pSpecularDataRegister.index*4;if(this._texture){this._pSpecularTexData=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(this._pSpecularTexData,1);n+=e.textureGL._iGetFragmentCode(this._pSpecularTexData,i,r,r.uvVarying)}this._pTotalLightColorReg=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(this._pTotalLightColorReg,1);return n};i.prototype.iGetFragmentCodePerLight=function(t,e,i,r,n,s){var a="";var o;if(this._pIsFirstLight){o=this._pTotalLightColorReg}else{o=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(o,1)}var h=s.viewDirFragment;var u=s.normalFragment;a+="add "+o+", "+i+", "+h+"\n"+"nrm "+o+".xyz, "+o+"\n"+"dp3 "+o+".w, "+u+", "+o+"\n"+"sat "+o+".w, "+o+".w\n";if(this._texture){a+="mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\n"+"pow "+o+".w, "+o+".w, "+this._pSpecularTexData+".w\n"}else{a+="pow "+o+".w, "+o+".w, "+this._pSpecularDataRegister+".w\n"}if(t.usesLightFallOff)a+="mul "+o+".w, "+o+".w, "+i+".w\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(t,e,o,n,s);a+="mul "+o+".xyz, "+r+", "+o+".w\n";if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+o+"\n";n.removeFragmentTempUsage(o)}this._pIsFirstLight=false;return a};i.prototype.iGetFragmentCodePerProbe=function(t,e,i,r,n,s){var a="";var o;if(this._pIsFirstLight){o=this._pTotalLightColorReg}else{o=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(o,1)}var h=s.normalFragment;var u=s.viewDirFragment;a+="dp3 "+o+".w, "+h+", "+u+"\n"+"add "+o+".w, "+o+".w, "+o+".w\n"+"mul "+o+", "+o+".w, "+h+"\n"+"sub "+o+", "+o+", "+u+"\n"+"tex "+o+", "+o+", "+i+" <cube,"+"linear"+",miplinear>\n"+"mul "+o+".xyz, "+o+", "+r+"\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(t,e,o,n,s);if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+o+"\n";n.removeFragmentTempUsage(o)}this._pIsFirstLight=false;return a};i.prototype.iGetFragmentPostLightingCode=function(t,e,i,r,n){var s="";if(n.shadowTarget)s+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n.shadowTarget+".w\n";if(this._texture){s+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularTexData+".x\n";r.removeFragmentTempUsage(this._pSpecularTexData)}s+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularDataRegister+"\n"+"add "+i+".xyz, "+i+", "+this._pTotalLightColorReg+"\n";r.removeFragmentTempUsage(this._pTotalLightColorReg);return s};i.prototype.iActivate=function(t,e,i){if(this._texture)e.textureGL.activate(e.pass._render);var r=e.fragmentConstantsIndex;var n=t.fragmentConstantData;n[r]=this._iSpecularR;n[r+1]=this._iSpecularG;n[r+2]=this._iSpecularB;n[r+3]=this._gloss};i.prototype.iSetRenderState=function(t,e,i,r,n){if(this._texture)e.textureGL._setRenderState(i)};i.prototype.updateSpecular=function(){this._iSpecularR=(this._color>>16&255)/255*this._strength;this._iSpecularG=(this._color>>8&255)/255*this._strength;this._iSpecularB=(this._color&255)/255*this._strength};return i}(lo);var fo=function(){function t(){}return t}();fo.SINGLE_PASS="singlePass";fo.MULTI_PASS="multiPass";var go=function(i){e(r,i);function r(e,r){if(e===void 0){e=null}if(r===void 0){r=1}var n=i.call(this,e,r)||this;n._effectMethods=new Array;n._enableLightFallOff=true;n._specularLightSources=1;n._diffuseLightSources=3;n._ambientMethod=new uo;n._diffuseMethod=new po;n._normalMethod=new co;n._specularMethod=new _o;n._depthCompareMode=t.ContextGLCompareMode.LESS_EQUAL;n._mode=fo.SINGLE_PASS;n._ambientMethod.iAddOwner(n);n._diffuseMethod.iAddOwner(n);n._normalMethod.iAddOwner(n);n._specularMethod.iAddOwner(n);n._onLightChangeDelegate=function(t){return n.onLightsChange(t)};if(e instanceof ae)n._ambientMethod.texture=new ve;return n}Object.defineProperty(r.prototype,"assetType",{get:function(){return r.assetType},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"lightPicker",{get:function(){return this._pLightPicker},set:function(t){if(this._pLightPicker==t)return;if(this._pLightPicker)this._pLightPicker.removeEventListener(s.INVALIDATE,this._onLightChangeDelegate);this._pLightPicker=t;if(this._pLightPicker)this._pLightPicker.addEventListener(s.INVALIDATE,this._onLightChangeDelegate);this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"enableLightFallOff",{get:function(){return this._enableLightFallOff},set:function(t){if(this._enableLightFallOff==t)return;this._enableLightFallOff=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"diffuseLightSources",{get:function(){return this._diffuseLightSources},set:function(t){if(this._diffuseLightSources==t)return;this._diffuseLightSources=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"specularLightSources",{get:function(){return this._specularLightSources},set:function(t){if(this._specularLightSources==t)return;this._specularLightSources=t;this.invalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"mode",{get:function(){return this._mode},set:function(t){if(this._mode==t)return;this._mode=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(t){if(this._depthCompareMode==t)return;this._depthCompareMode=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"diffuseTexture",{get:function(){return this._diffuseMethod.texture},set:function(t){this._diffuseMethod.texture=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"ambientMethod",{get:function(){return this._ambientMethod},set:function(t){if(this._ambientMethod==t)return;if(this._ambientMethod)this._ambientMethod.iRemoveOwner(this);this._ambientMethod=t;if(this._ambientMethod)this._ambientMethod.iAddOwner(this);this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"shadowMethod",{get:function(){return this._shadowMethod},set:function(t){if(this._shadowMethod==t)return;if(this._shadowMethod)this._shadowMethod.iRemoveOwner(this);this._shadowMethod=t;if(this._shadowMethod)this._shadowMethod.iAddOwner(this);this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"diffuseMethod",{get:function(){return this._diffuseMethod},set:function(t){if(this._diffuseMethod==t)return;if(this._diffuseMethod)this._diffuseMethod.iRemoveOwner(this);this._diffuseMethod=t;if(this._diffuseMethod)this._diffuseMethod.iAddOwner(this);this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"specularMethod",{get:function(){return this._specularMethod},set:function(t){if(this._specularMethod==t)return;if(this._specularMethod)this._specularMethod.iRemoveOwner(this);this._specularMethod=t;if(this._specularMethod)this._specularMethod.iAddOwner(this);this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"normalMethod",{get:function(){return this._normalMethod},set:function(t){if(this._normalMethod==t)return;if(this._normalMethod)this._normalMethod.iRemoveOwner(this);this._normalMethod=t;if(this._normalMethod)this._normalMethod.iAddOwner(this);this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"numEffectMethods",{get:function(){return this._effectMethods.length},enumerable:true,configurable:true});r.prototype.addEffectMethod=function(t){t.iAddOwner(this);this._effectMethods.push(t);this.invalidate()};r.prototype.getEffectMethodAt=function(t){return this._effectMethods[t]};r.prototype.addEffectMethodAt=function(t,e){t.iAddOwner(this);this._effectMethods.splice(e,0,t);this.invalidate()};r.prototype.removeEffectMethod=function(t){t.iRemoveOwner(this);this._effectMethods.splice(this._effectMethods.indexOf(t),1);this.invalidate()};r.prototype.onLightsChange=function(t){this.invalidate()};return r}(ge);go.assetType="[materials MethodMaterial]";var mo=function(t){e(i,t);function i(){return t.call(this)||this}i.prototype.iInitVO=function(t,e){e.needsNormals=true;if(this._texture){e.textureGL=t.getAbstraction(this._texture);t.uvDependencies++}else if(e.textureGL){e.textureGL.onClear(new s(s.CLEAR,this._texture));e.textureGL=null}};i.prototype.iGetFragmentCode=function(t,e,i,r,n){return this._texture?e.textureGL._iGetFragmentCode(i,r,n,n.normalFragment):""};return i}(uo);var yo=function(t){e(i,t);function i(e,i){if(i===void 0){i=null}var r=t.call(this)||this;r._onShaderInvalidatedDelegate=function(t){return r.onShaderInvalidated(t)};r.pBaseMethod=i||new po;r.pBaseMethod._iModulateMethod=e;r.pBaseMethod.addEventListener(bs.SHADER_INVALIDATED,r._onShaderInvalidatedDelegate);return r}Object.defineProperty(i.prototype,"baseMethod",{get:function(){return this.pBaseMethod},set:function(t){if(this.pBaseMethod==t)return;this.pBaseMethod.removeEventListener(bs.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.pBaseMethod=t;this.pBaseMethod.addEventListener(bs.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.iInitVO=function(t,e){this.pBaseMethod.iInitVO(t,e)};i.prototype.iInitConstants=function(t,e){this.pBaseMethod.iInitConstants(t,e)};i.prototype.iAddOwner=function(e){t.prototype.iAddOwner.call(this,e);this.pBaseMethod.iAddOwner(e)};i.prototype.iRemoveOwner=function(e){t.prototype.iRemoveOwner.call(this,e);this.pBaseMethod.iRemoveOwner(e)};i.prototype.dispose=function(){this.pBaseMethod.removeEventListener(bs.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.pBaseMethod.dispose()};Object.defineProperty(i.prototype,"texture",{get:function(){return this.pBaseMethod.texture},set:function(t){this.pBaseMethod.texture=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"color",{get:function(){return this.pBaseMethod.color},set:function(t){this.pBaseMethod.color=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"multiply",{get:function(){return this.pBaseMethod.multiply},set:function(t){this.pBaseMethod.multiply=t},enumerable:true,configurable:true});i.prototype.iGetFragmentPreLightingCode=function(t,e,i,r){return this.pBaseMethod.iGetFragmentPreLightingCode(t,e,i,r)};i.prototype.iGetFragmentCodePerLight=function(t,e,i,r,n,s){var a=this.pBaseMethod.iGetFragmentCodePerLight(t,e,i,r,n,s);this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg;return a};i.prototype.iGetFragmentCodePerProbe=function(t,e,i,r,n,s){var a=this.pBaseMethod.iGetFragmentCodePerProbe(t,e,i,r,n,s);this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg;return a};i.prototype.iActivate=function(t,e,i){this.pBaseMethod.iActivate(t,e,i)};i.prototype.iSetRenderState=function(t,e,i,r,n){this.pBaseMethod.iSetRenderState(t,e,i,r,n)};i.prototype.iDeactivate=function(t,e,i){this.pBaseMethod.iDeactivate(t,e,i)};i.prototype.iGetVertexCode=function(t,e,i,r){return this.pBaseMethod.iGetVertexCode(t,e,i,r)};i.prototype.iGetFragmentPostLightingCode=function(t,e,i,r,n){return this.pBaseMethod.iGetFragmentPostLightingCode(t,e,i,r,n)};i.prototype.iReset=function(){this.pBaseMethod.iReset()};i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this.pBaseMethod.iCleanCompilationData()};i.prototype.onShaderInvalidated=function(t){this.iInvalidateShaderProgram()};return i}(po);var vo=function(t){e(i,t);function i(e,i){if(e===void 0){e=3}if(i===void 0){i=null}var r=t.call(this,null,i)||this;r._smoothness=.1;r.baseMethod._iModulateMethod=function(t,e,i,n,s){return r.clampDiffuse(t,e,i,n,s)};r._levels=e;return r}i.prototype.iInitConstants=function(e,i){var r=e.fragmentConstantData;var n=i.secondaryFragmentConstantsIndex;t.prototype.iInitConstants.call(this,e,i);r[n+1]=1;r[n+2]=0};Object.defineProperty(i.prototype,"levels",{get:function(){return this._levels},set:function(t){this._levels=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"smoothness",{get:function(){return this._smoothness},set:function(t){this._smoothness=t},enumerable:true,configurable:true});i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._dataReg=null};i.prototype.iGetFragmentPreLightingCode=function(e,i,r,n){this._dataReg=r.getFreeFragmentConstant();i.secondaryFragmentConstantsIndex=this._dataReg.index*4;return t.prototype.iGetFragmentPreLightingCode.call(this,e,i,r,n)};i.prototype.iActivate=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);var n=e.fragmentConstantData;var s=i.secondaryFragmentConstantsIndex;n[s]=this._levels;n[s+3]=this._smoothness};i.prototype.clampDiffuse=function(t,e,i,r,n){return"mul "+i+".w, "+i+".w, "+this._dataReg+".x\n"+"frc "+i+".z, "+i+".w\n"+"sub "+i+".y, "+i+".w, "+i+".z\n"+"mov "+i+".x, "+this._dataReg+".x\n"+"sub "+i+".x, "+i+".x, "+this._dataReg+".y\n"+"rcp "+i+".x,"+i+".x\n"+"mul "+i+".w, "+i+".y, "+i+".x\n"+"sub "+i+".y, "+i+".w, "+i+".x\n"+"div "+i+".z, "+i+".z, "+this._dataReg+".w\n"+"sat "+i+".z, "+i+".z\n"+"mul "+i+".w, "+i+".w, "+i+".z\n"+"sub "+i+".z, "+this._dataReg+".y, "+i+".z\n"+"mul "+i+".y, "+i+".y, "+i+".z\n"+"add "+i+".w, "+i+".w, "+i+".y\n"+"sat "+i+".w, "+i+".w\n"};return i}(yo);var xo=function(t){e(i,t);function i(){return t.call(this)||this}i.prototype.iInitConstants=function(t,e){var i=t.fragmentConstantData;var r=e.fragmentConstantsIndex;i[r]=1;i[r+1]=1/255;i[r+2]=1/65025;i[r+3]=1/16581375};i.prototype.iGetFragmentPostLightingCode=function(t,e,i,r,n){var s="";var a;var o;if(!this._texture)throw new Error("DiffuseDepthMethod requires texture!");if(t.numLights>0){if(n.shadowTarget)s+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+n.shadowTarget+".w\n";s+="add "+i+".xyz, "+this._pTotalLightColorReg+".xyz, "+i+".xyz\n"+"sat "+i+".xyz, "+i+".xyz\n";r.removeFragmentTempUsage(this._pTotalLightColorReg);r.addFragmentTempUsages(a=r.getFreeFragmentVectorTemp(),1)}else{a=i}o=r.getFreeFragmentConstant();e.fragmentConstantsIndex=o.index*4;s+=e.textureGL._iGetFragmentCode(a,r,n,n.uvVarying)+"dp4 "+a+".x, "+a+", "+o+"\n"+"mov "+a+".yz, "+a+".xx			\n"+"mov "+a+".w, "+o+".x\n"+"sub "+a+".xyz, "+o+".xxx, "+a+".xyz\n";if(t.numLights==0)return s;s+="mul "+i+".xyz, "+a+".xyz, "+i+".xyz\n"+"mov "+i+".w, "+a+".w\n";if(t.numLights>0)r.removeFragmentTempUsage(a);return s};return i}(po);var bo=function(t){e(i,t);function i(e){var i=t.call(this)||this;i._gradient=e;if(i._gradient)i.iAddTexture(i._gradient);return i}i.prototype.iInitVO=function(e,i){t.prototype.iInitVO.call(this,e,i);i.secondaryTextureGL=e.getAbstraction(this._gradient)};Object.defineProperty(i.prototype,"gradient",{get:function(){return this._gradient},set:function(t){if(this._gradient==t)return;if(this._gradient)this.iRemoveTexture(this._gradient);this._gradient=t;if(this._gradient)this.iAddTexture(this._gradient);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this)};i.prototype.iGetFragmentPreLightingCode=function(e,i,r,n){var s=t.prototype.iGetFragmentPreLightingCode.call(this,e,i,r,n);this._pIsFirstLight=true;return s};i.prototype.iGetFragmentCodePerLight=function(t,e,i,r,n,s){var a="";var o;if(this._pIsFirstLight)o=this._pTotalLightColorReg;else{o=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(o,1)}a+="dp3 "+o+".w, "+i+".xyz, "+s.normalFragment+".xyz\n"+"mul "+o+".w, "+o+".w, "+s.commons+".x\n"+"add "+o+".w, "+o+".w, "+s.commons+".x\n"+"mul "+o+".xyz, "+o+".w, "+i+".w\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(t,e,o,n,s);a+=e.secondaryTextureGL._iGetFragmentCode(o,n,s,o)+"mul "+o+".xyz, "+o+".xyz, "+r+".xyz\n";if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+o+".xyz\n";n.removeFragmentTempUsage(o)}this._pIsFirstLight=false;return a};i.prototype.pApplyShadow=function(t,e,i,r){var n=i.getFreeFragmentVectorTemp();return"mov "+n+", "+r.shadowTarget+".wwww\n"+e.secondaryTextureGL._iGetFragmentCode(n,i,r,r.uvVarying)+"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n"};i.prototype.iActivate=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);i.secondaryTextureGL.activate(i.pass._render)};i.prototype.iSetRenderState=function(e,i,r,n,s){t.prototype.iSetRenderState.call(this,e,i,r,n,s);if(e.numLights>0)i.secondaryTextureGL._setRenderState(r)};return i}(po);var wo=function(t){e(i,t);function i(e,i,r,n){if(i===void 0){i="multiply"}if(r===void 0){r=false}if(n===void 0){n=null}var s=t.call(this,null,n)||this;s._useSecondaryUV=r;s._lightMap=e;s.blendMode=i;if(s._lightMap)s.iAddTexture(s._lightMap);return s}i.prototype.iInitVO=function(t,e){e.secondaryTextureGL=t.getAbstraction(this._lightMap);if(this._useSecondaryUV)t.secondaryUVDependencies++;else t.uvDependencies++};Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){if(t!=i.ADD&&t!=i.MULTIPLY)throw new Error("Unknown blendmode!");if(this._blendMode==t)return;this._blendMode=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"lightMap",{get:function(){return this._lightMap},set:function(t){if(this._lightMap==t)return;if(this._lightMap)this.iRemoveTexture(this._lightMap);this._lightMap=t;if(this._lightMap)this.iAddTexture(this._lightMap);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(t){if(this._useSecondaryUV==t)return;this._useSecondaryUV=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.iGetFragmentPostLightingCode=function(e,r,n,s,a){var o;var h=s.getFreeFragmentVectorTemp();o=r.secondaryTextureGL._iGetFragmentCode(h,s,a,this._useSecondaryUV?a.secondaryUVVarying:a.uvVarying);switch(this._blendMode){case i.MULTIPLY:o+="mul "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+h+"\n";break;case i.ADD:o+="add "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+h+"\n";break}o+=t.prototype.iGetFragmentPostLightingCode.call(this,e,r,n,s,a);return o};i.prototype.iActivate=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);i.secondaryTextureGL.activate(i.pass._render)};i.prototype.iSetRenderState=function(e,i,r,n,s){t.prototype.iSetRenderState.call(this,e,i,r,n,s);i.secondaryTextureGL._setRenderState(r)};return i}(yo);wo.MULTIPLY="multiply";wo.ADD="add";var Do=function(t){e(i,t);function i(e,i,r){if(e===void 0){e=512}if(i===void 0){i=15}if(r===void 0){r=null}var n=t.call(this,null,r)||this;n._translucency=1;n._scatterColor=16777215;n._scatterR=1;n._scatterG=1;n._scatterB=1;n.pBaseMethod._iModulateMethod=function(t,e,i,r,s){return n.scatterLight(t,e,i,r,s)};n._scattering=.2;n._translucency=1;return n}i.prototype.iInitConstants=function(e,i){t.prototype.iInitConstants.call(this,e,i);var r=e.vertexConstantData;var n=i.secondaryVertexConstantsIndex;r[n]=.5;r[n+1]=-.5;r[n+2]=0;r[n+3]=1;r=e.fragmentConstantData;n=i.secondaryFragmentConstantsIndex;r[n+3]=1;r[n+4]=1;r[n+5]=1/255;r[n+6]=1/65025;r[n+7]=1/16581375;r[n+10]=.5;r[n+11]=-.1;i.vertexMatrices[0]=new M(new Float32Array(e.vertexConstantData.buffer,(i.secondaryVertexConstantsIndex+4)*4,16))};i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._lightProjVarying=null;this._propReg=null;this._lightColorReg=null;this._colorReg=null;this._decReg=null;this._targetReg=null};Object.defineProperty(i.prototype,"scattering",{get:function(){return this._scattering},set:function(t){this._scattering=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"translucency",{get:function(){return this._translucency},set:function(t){this._translucency=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"scatterColor",{get:function(){return this._scatterColor},set:function(t){this._scatterColor=t;this._scatterR=(t>>16&255)/255;this._scatterG=(t>>8&255)/255;this._scatterB=(t&255)/255},enumerable:true,configurable:true});i.prototype.iGetVertexCode=function(e,i,r,n){var s=t.prototype.iGetVertexCode.call(this,e,i,r,n);var a;var o;var h=r.getFreeVertexVectorTemp();o=r.getFreeVertexConstant();i.secondaryVertexConstantsIndex=o.index*4;this._lightProjVarying=r.getFreeVarying();a=r.getFreeVertexConstant();r.getFreeVertexConstant();r.getFreeVertexConstant();r.getFreeVertexConstant();s+="m44 "+h+", vt0, "+a+"\n"+"div "+h+".xyz, "+h+".xyz, "+h+".w\n"+"mul "+h+".xy, "+h+".xy, "+o+".xy\n"+"add "+h+".xy, "+h+".xy, "+o+".xx\n"+"mov "+this._lightProjVarying+".xyz, "+h+".xyz\n"+"mov "+this._lightProjVarying+".w, va0.w\n";return s};i.prototype.iGetFragmentPreLightingCode=function(e,i,r,n){this._colorReg=r.getFreeFragmentConstant();this._decReg=r.getFreeFragmentConstant();this._propReg=r.getFreeFragmentConstant();i.secondaryFragmentConstantsIndex=this._colorReg.index*4;return t.prototype.iGetFragmentPreLightingCode.call(this,e,i,r,n)};i.prototype.iGetFragmentCodePerLight=function(e,i,r,n,s,a){this._pIsFirstLight=true;this._lightColorReg=n;return t.prototype.iGetFragmentCodePerLight.call(this,e,i,r,n,s,a)};i.prototype.iGetFragmentPostLightingCode=function(e,i,r,n,s){var a=t.prototype.iGetFragmentPostLightingCode.call(this,e,i,r,n,s);var o=n.getFreeFragmentVectorTemp();a+="mul "+o+".xyz, "+this._lightColorReg+".xyz, "+this._targetReg+".w\n"+"mul "+o+".xyz, "+o+".xyz, "+this._colorReg+".xyz\n"+"add "+r+".xyz, "+r+".xyz, "+o+".xyz\n";if(this._targetReg!=s.viewDirFragment)n.removeFragmentTempUsage(r);return a};i.prototype.iActivate=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);var n=i.secondaryFragmentConstantsIndex;var s=e.fragmentConstantData;s[n]=this._scatterR;s[n+1]=this._scatterG;s[n+2]=this._scatterB;s[n+8]=this._scattering;s[n+9]=this._translucency};i.prototype.iSetRenderState=function(t,e,i,r,n){e.secondaryTextureGL=t.getAbstraction(this._depthPass._iGetDepthMap(i));e.secondaryTextureGL._setRenderState(i);e.vertexMatrices[0].copyFrom(this._depthPass._iGetProjection(i),true)};i.prototype.scatterLight=function(t,e,i,r,n){if(!this._pIsFirstLight)return"";this._pIsFirstLight=false;var s="";if(n.viewDirFragment)this._targetReg=n.viewDirFragment;else r.addFragmentTempUsages(this._targetReg=r.getFreeFragmentVectorTemp(),1);var a=r.getFreeFragmentVectorTemp();s+=e.secondaryTextureGL._iGetFragmentCode(a,r,n,this._lightProjVarying)+"dp4 "+i+".z, "+a+", "+this._decReg+"\n";s+="sub "+i+".z, "+this._lightProjVarying+".z, "+i+".z\n"+"sub "+i+".z, "+this._propReg+".x, "+i+".z\n"+"mul "+i+".z, "+this._propReg+".y, "+i+".z\n"+"sat "+i+".z, "+i+".z\n"+"neg "+i+".y, "+i+".x\n"+"mul "+i+".y, "+i+".y, "+this._propReg+".z\n"+"add "+i+".y, "+i+".y, "+this._propReg+".z\n"+"mul "+this._targetReg+".w, "+i+".z, "+i+".y\n"+"sub "+i+".y, "+this._colorReg+".w, "+this._targetReg+".w\n"+"mul "+i+".w, "+i+".w, "+i+".y\n";return s};return i}(yo);var Co=function(t){e(i,t);function i(e){if(e===void 0){e=.5}var i=t.call(this)||this;i.wrapFactor=e;return i}i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._wrapDataRegister=null};Object.defineProperty(i.prototype,"wrapFactor",{get:function(){return this._wrapFactor},set:function(t){this._wrapFactor=t;this._wrapFactor=1/(t+1)},enumerable:true,configurable:true});i.prototype.iGetFragmentPreLightingCode=function(e,i,r,n){var s=t.prototype.iGetFragmentPreLightingCode.call(this,e,i,r,n);this._pIsFirstLight=true;this._wrapDataRegister=r.getFreeFragmentConstant();i.secondaryFragmentConstantsIndex=this._wrapDataRegister.index*4;return s};i.prototype.iGetFragmentCodePerLight=function(t,e,i,r,n,s){var a="";var o;if(this._pIsFirstLight){o=this._pTotalLightColorReg}else{o=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(o,1)}a+="dp3 "+o+".x, "+i+".xyz, "+s.normalFragment+".xyz\n"+"add "+o+".y, "+o+".x, "+this._wrapDataRegister+".x\n"+"mul "+o+".y, "+o+".y, "+this._wrapDataRegister+".y\n"+"sat "+o+".w, "+o+".y\n"+"mul "+o+".xz, "+o+".w, "+i+".wz\n";

if(this._iModulateMethod!=null)a+=this._iModulateMethod(t,e,i,n,s);a+="mul "+o+", "+o+".x, "+r+"\n";if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+o+".xyz\n";n.removeFragmentTempUsage(o)}this._pIsFirstLight=false;return a};i.prototype.iActivate=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);var n=i.secondaryFragmentConstantsIndex;var s=e.fragmentConstantData;s[n]=this._wrapFactor;s[n+1]=1/(this._wrapFactor+1)};return i}(po);var Ao=function(t){e(i,t);function i(){return t.call(this)||this}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});i.prototype.iGetFragmentCode=function(t,e,i,n,s){throw new r};return i}(ho);Ao.assetType="[asset EffectMethod]";var To=function(t){e(i,t);function i(e,i){if(i===void 0){i=false}var r=t.call(this)||this;r._texture=e;r._useSecondaryUV=i;if(r._texture)r.iAddTexture(r._texture);return r}i.prototype.iInitVO=function(t,e){e.textureGL=t.getAbstraction(this._texture);if(this._useSecondaryUV)t.secondaryUVDependencies++;else t.uvDependencies++};Object.defineProperty(i.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(t){if(this._useSecondaryUV==t)return;this._useSecondaryUV=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.iRemoveTexture(this._texture);this._texture=t;if(this._texture)this.iAddTexture(this._texture);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s=r.getFreeFragmentVectorTemp();return e.textureGL._iGetFragmentCode(s,r,n,this._useSecondaryUV?n.secondaryUVVarying:n.uvVarying)+"mul "+i+", "+i+", "+s+".x\n"};i.prototype.iActivate=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);i.textureGL.activate(i.pass._render)};i.prototype.iSetRenderState=function(t,e,i,r,n){e.textureGL._setRenderState(i)};return i}(Ao);var Po=function(t){e(i,t);function i(e){var i=t.call(this)||this;if(e.length!=20)throw new Error("Matrix length must be 20!");i._matrix=e;return i}Object.defineProperty(i.prototype,"colorMatrix",{get:function(){return this._matrix},set:function(t){this._matrix=t},enumerable:true,configurable:true});i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s="";var a=r.getFreeFragmentConstant();r.getFreeFragmentConstant();r.getFreeFragmentConstant();r.getFreeFragmentConstant();var o=r.getFreeFragmentConstant();e.fragmentConstantsIndex=a.index*4;var h=r.getFreeFragmentVectorTemp();s+="m44 "+h+", "+i+", "+a+"\n"+"add "+i+", "+h+", "+o+"\n";return s};i.prototype.iActivate=function(t,e,i){var r=this._matrix;var n=e.fragmentConstantsIndex;var s=t.fragmentConstantData;s[n]=r[0];s[n+1]=r[1];s[n+2]=r[2];s[n+3]=r[3];s[n+4]=r[5];s[n+5]=r[6];s[n+6]=r[7];s[n+7]=r[8];s[n+8]=r[10];s[n+9]=r[11];s[n+10]=r[12];s[n+11]=r[13];s[n+12]=r[15];s[n+13]=r[16];s[n+14]=r[17];s[n+15]=r[18];s[n+16]=r[4];s[n+17]=r[9];s[n+18]=r[14];s[n+19]=r[19]};return i}(Ao);var So=function(t){e(i,t);function i(){return t.call(this)||this}Object.defineProperty(i.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(t){this._colorTransform=t},enumerable:true,configurable:true});i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s="";var a=r.getFreeFragmentConstant();var o=r.getFreeFragmentConstant();e.fragmentConstantsIndex=a.index*4;s+="mul "+i+", "+i+", "+a+"\n"+"add "+i+", "+i+", "+o+"\n";return s};i.prototype.iActivate=function(t,e,i){var r=1/255;var n=e.fragmentConstantsIndex;var s=t.fragmentConstantData;s[n]=this._colorTransform.redMultiplier;s[n+1]=this._colorTransform.greenMultiplier;s[n+2]=this._colorTransform.blueMultiplier;s[n+3]=this._colorTransform.alphaMultiplier;s[n+4]=this._colorTransform.redOffset*r;s[n+5]=this._colorTransform.greenOffset*r;s[n+6]=this._colorTransform.blueOffset*r;s[n+7]=this._colorTransform.alphaOffset*r};return i}(Ao);var Eo=function(t){e(i,t);function i(e,i){if(i===void 0){i=1}var r=t.call(this)||this;r._envMap=e;r._alpha=i;if(r._envMap)r.iAddTexture(r._envMap);return r}Object.defineProperty(i.prototype,"mask",{get:function(){return this._mask},set:function(t){if(t==this._mask)return;if(this._mask)this.iRemoveTexture(this._mask);this._mask=t;if(this._mask)this.iAddTexture(this._mask);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.iInitVO=function(t,e){e.needsNormals=true;e.needsView=true;if(this._envMap)e.textureGL=t.getAbstraction(this._envMap);if(this._mask){e.secondaryTextureGL=t.getAbstraction(this._mask);t.uvDependencies++}};Object.defineProperty(i.prototype,"envMap",{get:function(){return this._envMap},set:function(t){if(this._envMap==t)return;if(this._envMap)this.iRemoveTexture(this._envMap);this._envMap=t;if(this._envMap)this.iAddTexture(this._envMap);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.dispose=function(){};Object.defineProperty(i.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:true,configurable:true});i.prototype.iActivate=function(t,e,i){t.fragmentConstantData[e.fragmentConstantsIndex]=this._alpha;e.textureGL.activate(e.pass._render);if(this._mask)e.secondaryTextureGL.activate(e.pass._render)};i.prototype.iSetRenderState=function(t,e,i,r,n){e.textureGL._setRenderState(i);if(this._mask)e.secondaryTextureGL._setRenderState(i)};i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s=r.getFreeFragmentConstant();var a="";e.fragmentConstantsIndex=s.index*4;var o=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(o,1);var h=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(h,1);a+="dp3 "+o+".w, "+n.viewDirFragment+".xyz, "+n.normalFragment+".xyz\n"+"add "+o+".w, "+o+".w, "+o+".w\n"+"mul "+o+".xyz, "+n.normalFragment+".xyz, "+o+".w\n"+"sub "+o+".xyz, "+o+".xyz, "+n.viewDirFragment+".xyz\n"+e.textureGL._iGetFragmentCode(o,r,n,o)+"sub "+h+".w, "+o+".w, fc0.x\n"+"kil "+h+".w\n"+"sub "+o+", "+o+", "+i+"\n";if(this._mask){a+=e.secondaryTextureGL._iGetFragmentCode(h,r,n,n.uvVarying)+"mul "+o+", "+h+", "+o+"\n"}a+="mul "+o+", "+o+", "+s+".x\n"+"add "+i+", "+i+", "+o+"\n";r.removeFragmentTempUsage(o);r.removeFragmentTempUsage(h);return a};return i}(Ao);var Mo=function(t){e(i,t);function i(e,i,r){if(r===void 0){r=8421504}var n=t.call(this)||this;n._minDistance=0;n._maxDistance=1e3;n.minDistance=e;n.maxDistance=i;n.fogColor=r;return n}i.prototype.iInitVO=function(t,e){e.needsProjection=true};i.prototype.iInitConstants=function(t,e){var i=t.fragmentConstantData;var r=e.fragmentConstantsIndex;i[r+3]=1;i[r+6]=0;i[r+7]=0};Object.defineProperty(i.prototype,"minDistance",{get:function(){return this._minDistance},set:function(t){this._minDistance=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"fogColor",{get:function(){return this._fogColor},set:function(t){this._fogColor=t;this._fogR=(t>>16&255)/255;this._fogG=(t>>8&255)/255;this._fogB=(t&255)/255},enumerable:true,configurable:true});i.prototype.iActivate=function(t,e,i){var r=t.fragmentConstantData;var n=e.fragmentConstantsIndex;r[n]=this._fogR;r[n+1]=this._fogG;r[n+2]=this._fogB;r[n+4]=this._minDistance;r[n+5]=1/(this._maxDistance-this._minDistance)};i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s=r.getFreeFragmentConstant();var a=r.getFreeFragmentConstant();var o=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(o,1);var h=r.getFreeFragmentVectorTemp();var u="";e.fragmentConstantsIndex=s.index*4;u+="sub "+h+".w, "+n.projectionFragment+".z, "+a+".x\n"+"mul "+h+".w, "+h+".w, "+a+".y\n"+"sat "+h+".w, "+h+".w\n"+"sub "+o+", "+s+", "+i+"\n"+"mul "+o+", "+o+", "+h+".w\n"+"add "+i+", "+i+", "+o+"\n";r.removeFragmentTempUsage(o);return u};return i}(Ao);var Oo=function(t){e(i,t);function i(e,i){if(i===void 0){i=1}var r=t.call(this)||this;r._fresnelPower=5;r._normalReflectance=0;r._envMap=e;r._alpha=i;if(r._envMap)r.iAddTexture(r._envMap);return r}i.prototype.iInitVO=function(t,e){e.needsNormals=true;e.needsView=true;e.textureGL=t.getAbstraction(this._envMap);if(this._mask!=null){e.secondaryTextureGL=t.getAbstraction(this._mask);t.uvDependencies++}};i.prototype.iInitConstants=function(t,e){t.fragmentConstantData[e.fragmentConstantsIndex+3]=1};Object.defineProperty(i.prototype,"mask",{get:function(){return this._mask},set:function(t){if(this._mask==t)return;if(this._mask)this.iRemoveTexture(this._mask);this._mask=t;if(this._mask)this.iAddTexture(this._mask);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(t){this._fresnelPower=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"envMap",{get:function(){return this._envMap},set:function(t){if(this._envMap==t)return;if(this._envMap)this.iRemoveTexture(this._envMap);this._envMap=t;if(this._envMap)this.iAddTexture(this._envMap)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(t){this._normalReflectance=t},enumerable:true,configurable:true});i.prototype.iActivate=function(t,e,i){var r=t.fragmentConstantData;var n=e.fragmentConstantsIndex;r[n]=this._alpha;r[n+1]=this._normalReflectance;r[n+2]=this._fresnelPower;e.textureGL.activate(e.pass._render);if(this._mask)e.secondaryTextureGL.activate(e.pass._render)};i.prototype.iSetRenderState=function(t,e,i,r,n){e.textureGL._setRenderState(i);if(this._mask)e.secondaryTextureGL._setRenderState(i)};i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s=r.getFreeFragmentConstant();var a="";var o=n.viewDirFragment;var h=n.normalFragment;e.fragmentConstantsIndex=s.index*4;var u=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(u,1);var l=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(l,1);a+="dp3 "+u+".w, "+o+".xyz, "+h+".xyz\n"+"add "+u+".w, "+u+".w, "+u+".w\n"+"mul "+u+".xyz, "+h+".xyz, "+u+".w\n"+"sub "+u+".xyz, "+u+".xyz, "+o+".xyz\n"+e.textureGL._iGetFragmentCode(u,r,n,u)+"sub "+l+".w, "+u+".w, fc0.x\n"+"kil "+l+".w\n"+"sub "+u+", "+u+", "+i+"\n";a+="dp3 "+o+".w, "+o+".xyz, "+h+".xyz\n"+"sub "+o+".w, "+s+".w, "+o+".w\n"+"pow "+o+".w, "+o+".w, "+s+".z\n"+"sub "+h+".w, "+s+".w, "+o+".w\n"+"mul "+h+".w, "+s+".y, "+h+".w\n"+"add "+o+".w, "+o+".w, "+h+".w\n"+"mul "+o+".w, "+s+".x, "+o+".w\n";if(this._mask){a+=e.secondaryTextureGL._iGetFragmentCode(l,r,n,n.uvVarying)+"mul "+o+".w, "+l+".x, "+o+".w\n"}a+="mul "+u+", "+u+", "+o+".w\n"+"add "+i+", "+i+", "+u+"\n";r.removeFragmentTempUsage(u);r.removeFragmentTempUsage(l);return a};return i}(Ao);var Io=function(t){e(i,t);function i(e,r,n){if(r===void 0){r="multiply"}if(n===void 0){n=false}var s=t.call(this)||this;if(r!=i.ADD&&r!=i.MULTIPLY)throw new Error("Unknown blendmode!");s._lightMap=e;s._blendMode=r;s._useSecondaryUV=n;if(s._lightMap)s.iAddTexture(s._lightMap);return s}i.prototype.iInitVO=function(t,e){e.textureGL=t.getAbstraction(this._lightMap);if(this._useSecondaryUV)t.secondaryUVDependencies++;else t.uvDependencies++};Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){if(this._blendMode==t)return;if(t!=i.ADD&&t!=i.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"lightMap",{get:function(){return this._lightMap},set:function(t){if(this._lightMap==t)return;if(this._lightMap)this.iRemoveTexture(this._lightMap);this._lightMap=t;if(this._lightMap)this.iAddTexture(this._lightMap);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(t){if(this._useSecondaryUV==t)return;this._useSecondaryUV=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.iGetFragmentCode=function(t,e,r,n,s){var a;var o=n.getFreeFragmentVectorTemp();a=e.secondaryTextureGL._iGetFragmentCode(o,n,s,this._useSecondaryUV?s.secondaryUVVarying:s.uvVarying);switch(this._blendMode){case i.MULTIPLY:a+="mul "+r+", "+r+", "+o+"\n";break;case i.ADD:a+="add "+r+", "+r+", "+o+"\n";break}return a};i.prototype.iActivate=function(t,e,i){e.textureGL.activate(e.pass._render)};i.prototype.iSetRenderState=function(t,e,i,r,n){e.textureGL._setRenderState(i)};return i}(Ao);Io.MULTIPLY="multiply";Io.ADD="add";var Ro=function(t){e(r,t);function r(e,i,r){if(i===void 0){i="multiply"}if(r===void 0){r=1}var n=t.call(this)||this;n._onTextureChangedDelegate=function(t){return n._onTextureChanged(t)};n.projector=e;n._exposure=r;n._mode=i;return n}r.prototype.iInitVO=function(t,e){if(this._projector.texture)e.textureGL=t.getAbstraction(this._projector.texture)};r.prototype.iInitConstants=function(t,e){var i=e.fragmentConstantsIndex;var r=t.fragmentConstantData;r[i]=this._exposure;r[i+1]=.5;r[i+2]=4;r[i+3]=-1;e.vertexMatrices[0]=new M(new Float32Array(t.vertexConstantData.buffer,e.vertexConstantsIndex*4,16))};r.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._uvVarying=null};Object.defineProperty(r.prototype,"mode",{get:function(){return this._mode},set:function(t){if(this._mode==t)return;this._mode=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"projector",{get:function(){return this._projector},set:function(t){if(this._projector==t)return;if(this._projector)this._projector.removeEventListener(Ea.TEXTURE_CHANGE,this._onTextureChangedDelegate);this._projector=t;if(this._projector)this._projector.addEventListener(Ea.TEXTURE_CHANGE,this._onTextureChangedDelegate);this.updateTexture();this.iInvalidateShaderProgram()},enumerable:true,configurable:true});r.prototype.iGetVertexCode=function(t,e,i,r){var n="";var s=i.getFreeVertexConstant();i.getFreeVertexConstant();i.getFreeVertexConstant();i.getFreeVertexConstant();e.vertexConstantsIndex=s.index*4;this._uvVarying=i.getFreeVarying();n+="m44 "+this._uvVarying+", "+r.animatedPosition+", "+s+"\n";return n};r.prototype.iGetFragmentCode=function(t,e,n,s,a){var o="";var h=s.getFreeFragmentVectorTemp();s.addFragmentTempUsages(h,1);var u=s.getFreeFragmentVectorTemp();var l=s.getFreeFragmentConstant();e.fragmentConstantsIndex=l.index*4;o+=e.textureGL._iGetFragmentCode(h,s,a,this._uvVarying);o+="mul "+h+", "+h+", "+l+".xxx\n"+"add "+h+", "+h+", "+l+".xxx\n";if(this._mode==r.MULTIPLY)o+="mul "+n+".xyz, "+n+".xyz, "+h+".xyz			\n";else if(this._mode==r.ADD)o+="add "+n+".xyz, "+n+".xyz, "+h+".xyz			\n";else if(this._mode==r.MIX){o+="sub "+h+".xyz, "+h+".xyz, "+n+".xyz				\n"+"mul "+h+".xyz, "+h+".xyz, "+h+".w						\n"+"add "+n+".xyz, "+n+".xyz, "+h+".xyz			\n"}else if(this._mode==r.OVERLAY){o+="sge "+u+", "+n+", "+l+".yyy\n";o+="sub "+n+", "+n+", "+u+"\n";o+="sub "+h+", "+h+", "+u+"\n";o+="mul "+h+", "+h+", "+n+"\n";o+="sub "+n+", "+l+".yyy, "+u+"\n";o+="mul "+n+", "+l+".zzz, "+n+"\n";o+="mul "+h+", "+h+", "+n+"\n";o+="add "+n+", "+h+", "+u+"\n"}else throw new i('Unknown mode "'+this._mode+'"');s.removeFragmentTempUsage(h);return o};r.prototype.iSetRenderState=function(t,e,i,r,n){var s=M.CALCULATION_MATRIX;s.copyFrom(this._projector.projection.viewMatrix3D);s.prepend(i.renderSceneTransform);e.vertexMatrices[0].copyFrom(s,true);e.textureGL._setRenderState(i)};r.prototype.iActivate=function(t,e,i){e.textureGL.activate(e.pass._render)};r.prototype._onTextureChanged=function(t){this.updateTexture()};r.prototype.updateTexture=function(){if(this._texture)this.iRemoveTexture(this._texture);this._texture=this._projector?this._projector.texture:null;if(this._texture)this.iAddTexture(this._texture)};return r}(Ao);Ro.OVERLAY="overlay";Ro.MULTIPLY="multiply";Ro.ADD="add";Ro.MIX="mix";var Lo=function(t){e(i,t);function i(e,i,r,n,s){if(i===void 0){i=.1}if(r===void 0){r=0}if(n===void 0){n=0}if(s===void 0){s=0}var a=t.call(this)||this;a._dispersionR=0;a._dispersionG=0;a._dispersionB=0;a._alpha=1;a._envMap=e;a._dispersionR=r;a._dispersionG=n;a._dispersionB=s;a._useDispersion=!(a._dispersionR==a._dispersionB&&a._dispersionR==a._dispersionG);a._refractionIndex=i;if(a._envMap)a.iAddTexture(a._envMap);return a}i.prototype.iInitConstants=function(t,e){var i=e.fragmentConstantsIndex;var r=t.fragmentConstantData;r[i+4]=1;r[i+5]=0;r[i+7]=1};i.prototype.iInitVO=function(t,e){e.needsNormals=true;e.needsView=true;e.textureGL=t.getAbstraction(this._envMap)};Object.defineProperty(i.prototype,"envMap",{get:function(){return this._envMap},set:function(t){if(this._envMap==t)return;if(this._envMap)this.iRemoveTexture(this._envMap);this._envMap=t;if(this._envMap)this.iAddTexture(this._envMap)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"refractionIndex",{get:function(){return this._refractionIndex},set:function(t){this._refractionIndex=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"dispersionR",{get:function(){return this._dispersionR},set:function(t){this._dispersionR=t;var e=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);if(this._useDispersion!=e){this.iInvalidateShaderProgram();this._useDispersion=e}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"dispersionG",{get:function(){return this._dispersionG},set:function(t){this._dispersionG=t;var e=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);if(this._useDispersion!=e){this.iInvalidateShaderProgram();this._useDispersion=e}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"dispersionB",{get:function(){return this._dispersionB},set:function(t){this._dispersionB=t;var e=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);if(this._useDispersion!=e){this.iInvalidateShaderProgram();this._useDispersion=e}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:true,configurable:true});i.prototype.iActivate=function(t,e,i){var r=e.fragmentConstantsIndex;var n=t.fragmentConstantData;n[r]=this._dispersionR+this._refractionIndex;if(this._useDispersion){n[r+1]=this._dispersionG+this._refractionIndex;n[r+2]=this._dispersionB+this._refractionIndex}n[r+3]=this._alpha;e.textureGL.activate(e.pass._render)};i.prototype.iSetRenderState=function(t,e,i,r,n){e.textureGL._setRenderState(i)};i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s=r.getFreeFragmentConstant();var a=r.getFreeFragmentConstant();var o="";var h;var u;var l;e.fragmentConstantsIndex=s.index*4;h=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(h,1);u=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(u,1);l=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(l,1);var p=n.viewDirFragment;var c=n.normalFragment;o+="neg "+p+".xyz, "+p+".xyz\n";o+="dp3 "+l+".x, "+p+".xyz, "+c+".xyz\n"+"mul "+l+".w, "+l+".x, "+l+".x\n"+"sub "+l+".w, "+a+".x, "+l+".w\n"+"mul "+l+".w, "+s+".x, "+l+".w\n"+"mul "+l+".w, "+s+".x, "+l+".w\n"+"sub "+l+".w, "+a+".x, "+l+".w\n"+"sqt "+l+".y, "+l+".w\n"+"mul "+l+".x, "+s+".x, "+l+".x\n"+"add "+l+".x, "+l+".x, "+l+".y\n"+"mul "+l+".xyz, "+l+".x, "+c+".xyz\n"+"mul "+h+", "+s+".x, "+p+"\n"+"sub "+h+".xyz, "+h+".xyz, "+l+".xyz\n"+"nrm "+h+".xyz, "+h+".xyz\n"+e.textureGL._iGetFragmentCode(u,r,n,h)+"sub "+u+".w, "+u+".w, fc0.x	\n"+"kil "+u+".w\n";if(this._useDispersion){o+="dp3 "+l+".x, "+p+".xyz, "+c+".xyz\n"+"mul "+l+".w, "+l+".x, "+l+".x\n"+"sub "+l+".w, "+a+".x, "+l+".w\n"+"mul "+l+".w, "+s+".y, "+l+".w\n"+"mul "+l+".w, "+s+".y, "+l+".w\n"+"sub "+l+".w, "+a+".x, "+l+".w\n"+"sqt "+l+".y, "+l+".w\n"+"mul "+l+".x, "+s+".y, "+l+".x\n"+"add "+l+".x, "+l+".x, "+l+".y\n"+"mul "+l+".xyz, "+l+".x, "+c+".xyz\n"+"mul "+h+", "+s+".y, "+p+"\n"+"sub "+h+".xyz, "+h+".xyz, "+l+".xyz\n"+"nrm "+h+".xyz, "+h+".xyz\n"+e.textureGL._iGetFragmentCode(l,r,n,h)+"mov "+u+".y, "+l+".y\n";o+="dp3 "+l+".x, "+p+".xyz, "+c+".xyz\n"+"mul "+l+".w, "+l+".x, "+l+".x\n"+"sub "+l+".w, "+a+".x, "+l+".w\n"+"mul "+l+".w, "+s+".z, "+l+".w\n"+"mul "+l+".w, "+s+".z, "+l+".w\n"+"sub "+l+".w, "+a+".x, "+l+".w\n"+"sqt "+l+".y, "+l+".w\n"+"mul "+l+".x, "+s+".z, "+l+".x\n"+"add "+l+".x, "+l+".x, "+l+".y\n"+"mul "+l+".xyz, "+l+".x, "+c+".xyz\n"+"mul "+h+", "+s+".z, "+p+"\n"+"sub "+h+".xyz, "+h+".xyz, "+l+".xyz\n"+"nrm "+h+".xyz, "+h+".xyz\n"+e.textureGL._iGetFragmentCode(l,r,n,h)+"mov "+u+".z, "+l+".z\n"}o+="sub "+u+".xyz, "+u+".xyz, "+i+".xyz\n"+"mul "+u+".xyz, "+u+".xyz, "+s+".w\n"+"add "+i+".xyz, "+i+".xyz, "+u+".xyz\n";r.removeFragmentTempUsage(l);r.removeFragmentTempUsage(h);r.removeFragmentTempUsage(u);o+="neg "+p+".xyz, "+p+".xyz\n";return o};return i}(Ao);var No=function(t){e(i,t);function i(e,i,r,n){if(e===void 0){e=16777215}if(i===void 0){i=.4}if(r===void 0){r=2}if(n===void 0){n="mix"}var s=t.call(this)||this;s._blendMode=n;s._strength=i;s._power=r;s.color=e;return s}i.prototype.iInitConstants=function(t,e){t.fragmentConstantData[e.fragmentConstantsIndex+3]=1};i.prototype.iInitVO=function(t,e){e.needsNormals=true;e.needsView=true};Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){if(this._blendMode==t)return;this._blendMode=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t;this._colorR=(t>>16&255)/255;this._colorG=(t>>8&255)/255;this._colorB=(t&255)/255},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"strength",{get:function(){return this._strength},set:function(t){this._strength=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"power",{get:function(){return this._power},set:function(t){this._power=t},enumerable:true,configurable:true});i.prototype.iActivate=function(t,e,i){var r=e.fragmentConstantsIndex;var n=t.fragmentConstantData;n[r]=this._colorR;n[r+1]=this._colorG;n[r+2]=this._colorB;n[r+4]=this._strength;n[r+5]=this._power};i.prototype.iGetFragmentCode=function(t,e,r,n,s){var a=n.getFreeFragmentConstant();var o=n.getFreeFragmentConstant();var h=n.getFreeFragmentVectorTemp();var u="";e.fragmentConstantsIndex=a.index*4;u+="dp3 "+h+".x, "+s.viewDirFragment+".xyz, "+s.normalFragment+".xyz\n"+"sat "+h+".x, "+h+".x\n"+"sub "+h+".x, "+a+".w, "+h+".x\n"+"pow "+h+".x, "+h+".x, "+o+".y\n"+"mul "+h+".x, "+h+".x, "+o+".x\n"+"sub "+h+".x, "+a+".w, "+h+".x\n"+"mul "+r+".xyz, "+r+".xyz, "+h+".x\n"+"sub "+h+".w, "+a+".w, "+h+".x\n";if(this._blendMode==i.ADD){u+="mul "+h+".xyz, "+h+".w, "+a+".xyz\n"+"add "+r+".xyz, "+r+".xyz, "+h+".xyz\n"}else if(this._blendMode==i.MULTIPLY){u+="mul "+h+".xyz, "+h+".w, "+a+".xyz\n"+"mul "+r+".xyz, "+r+".xyz, "+h+".xyz\n"}else{u+="sub "+h+".xyz, "+a+".xyz, "+r+".xyz\n"+"mul "+h+".xyz, "+h+".xyz, "+h+".w\n"+"add "+r+".xyz, "+r+".xyz, "+h+".xyz\n"}return u};return i}(Ao);No.ADD="add";No.MULTIPLY="multiply";No.MIX="mix";var Fo=function(t){e(i,t);function i(e,i,r,n){var s=t.call(this)||this;s.texture=e;s._worldXYRatio=i/r;s._worldXZRatio=n/r;return s}i.prototype.iInitConstants=function(t,e){var i=e.fragmentConstantsIndex;var r=t.fragmentConstantData;r[i]=1/this.texture.image2D.width;r[i+1]=1/this.texture.image2D.height;r[i+2]=0;r[i+3]=1;r[i+4]=this._worldXYRatio;r[i+5]=this._worldXZRatio};Object.defineProperty(i.prototype,"tangentSpace",{get:function(){return false},enumerable:true,configurable:true});i.prototype.copyFrom=function(e){t.prototype.copyFrom.call(this,e);this._worldXYRatio=e._worldXYRatio;this._worldXZRatio=e._worldXZRatio};i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s="";var a=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(a,1);var o=r.getFreeFragmentConstant();var h=r.getFreeFragmentConstant();e.fragmentConstantsIndex=o.index*4;s+=e.textureGL._iGetFragmentCode(i,r,n,n.uvVarying)+"add "+a+", "+n.uvVarying+", "+o+".xzzz\n"+e.textureGL._iGetFragmentCode(a,r,n,a)+"sub "+i+".x, "+i+".x, "+a+".x\n"+"add "+a+", "+n.uvVarying+", "+o+".zyzz\n"+e.textureGL._iGetFragmentCode(a,r,n,a)+"sub "+i+".z, "+i+".z, "+a+".x\n"+"mov "+i+".y, "+o+".w\n"+"mul "+i+".xz, "+i+".xz, "+h+".xy\n"+"nrm "+i+".xyz, "+i+".xyz\n";r.removeFragmentTempUsage(a);return s};return i}(co);var Bo=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i=null}var r=t.call(this,e)||this;r._water1OffsetX=0;r._water1OffsetY=0;r._water2OffsetX=0;r._water2OffsetY=0;r._secondaryNormalMap=i;if(r._secondaryNormalMap)r.iAddTexture(r._secondaryNormalMap);return r}i.prototype.iInitConstants=function(t,e){var i=e.fragmentConstantsIndex;var r=t.fragmentConstantData;r[i]=.5;r[i+1]=0;r[i+2]=0;r[i+3]=1};i.prototype.iInitVO=function(e,i){t.prototype.iInitVO.call(this,e,i);if(this._secondaryNormalMap){i.secondaryTextureGL=e.getAbstraction(this._secondaryNormalMap);e.uvDependencies++}};Object.defineProperty(i.prototype,"water1OffsetX",{get:function(){return this._water1OffsetX},set:function(t){this._water1OffsetX=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"water1OffsetY",{get:function(){return this._water1OffsetY},set:function(t){this._water1OffsetY=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"water2OffsetX",{get:function(){return this._water2OffsetX},set:function(t){this._water2OffsetX=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"water2OffsetY",{get:function(){return this._water2OffsetY},set:function(t){this._water2OffsetY=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"secondaryNormalMap",{get:function(){return this._secondaryNormalMap},set:function(t){if(this._secondaryNormalMap==t)return;if(this._secondaryNormalMap)this.iRemoveTexture(this._secondaryNormalMap);this._secondaryNormalMap=t;if(this._secondaryNormalMap)this.iAddTexture(this._secondaryNormalMap);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.dispose=function(){t.prototype.dispose.call(this);this._secondaryNormalMap=null};i.prototype.iActivate=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);var n=e.fragmentConstantData;var s=i.fragmentConstantsIndex;n[s+4]=this._water1OffsetX;n[s+5]=this._water1OffsetY;n[s+6]=this._water2OffsetX;n[s+7]=this._water2OffsetY;if(this._secondaryNormalMap)i.secondaryTextureGL.activate(i.pass._render)};i.prototype.iSetRenderState=function(e,i,r,n,s){t.prototype.iSetRenderState.call(this,e,i,r,n,s);if(this._secondaryNormalMap)i.secondaryTextureGL._setRenderState(r)};i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s="";var a=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(a,1);var o=r.getFreeFragmentConstant();var h=r.getFreeFragmentConstant();e.fragmentConstantsIndex=o.index*4;s+="add "+a+", "+n.uvVarying+", "+h+".xyxy\n";if(this.texture)s+=e.textureGL._iGetFragmentCode(i,r,n,a);s+="add "+a+", "+n.uvVarying+", "+h+".zwzw\n";if(this._secondaryNormalMap)s+=e.secondaryTextureGL._iGetFragmentCode(a,r,n,a);s+="add "+i+", "+i+", "+a+"		\n"+"mul "+i+", "+i+", "+o+".x	\n"+"sub "+i+".xyz, "+i+".xyz, "+n.commons+".xxx	\n"+"nrm "+i+".xyz, "+i+".xyz							\n";return s};return i}(co);var Vo=function(t){e(i,t);function i(e){var i=t.call(this)||this;i._pEpsilon=.02;i._pAlpha=1;i._pCastingLight=e;e.shadowsEnabled=true;i._pShadowMapper=e.shadowMapper;i.iAddTexture(e.shadowMapper.depthMap);return i}Object.defineProperty(i.prototype,"assetType",{get:function(){return i.assetType},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"alpha",{get:function(){return this._pAlpha},set:function(t){this._pAlpha=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"castingLight",{get:function(){return this._pCastingLight},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"epsilon",{get:function(){return this._pEpsilon},set:function(t){this._pEpsilon=t},enumerable:true,configurable:true});return i}(ho);Vo.assetType="[asset ShadowMapMethod]";var Uo=function(t){e(i,t);function i(e){var i=t.call(this,e.castingLight)||this;i._baseMethod=e;if(!(i._pCastingLight instanceof fa))throw new Error("ShadowCascadeMethod is only compatible with DirectionalLight");i._cascadeShadowMapper=i._pCastingLight.shadowMapper;if(!i._cascadeShadowMapper)throw new Error("ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.");i._cascadeShadowMapper.addEventListener(s.INVALIDATE,function(t){return i.onCascadeChange(t)});i._baseMethod.addEventListener(bs.SHADER_INVALIDATED,function(t){return i.onShaderInvalidated(t)});return i}Object.defineProperty(i.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(t){var e=this;if(this._baseMethod==t)return;this._baseMethod.removeEventListener(bs.SHADER_INVALIDATED,function(t){return e.onShaderInvalidated(t)});this._baseMethod=t;this._baseMethod.addEventListener(bs.SHADER_INVALIDATED,function(t){return e.onShaderInvalidated(t)});this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.iInitVO=function(t,e){var i=new Ke(this._baseMethod,e.pass);this._baseMethod.iInitVO(t,i);e.needsGlobalVertexPos=true;e.needsProjection=true;e.textureGL=t.getAbstraction(this._pCastingLight.shadowMapper.depthMap)};i.prototype.iInitConstants=function(t,e){var i=t.fragmentConstantData;var r=t.vertexConstantData;var n=e.fragmentConstantsIndex;i[n]=1;i[n+1]=1/255;i[n+2]=1/65025;i[n+3]=1/16581375;i[n+6]=.5;i[n+7]=-.5;n=e.vertexConstantsIndex;r[n]=.5;r[n+1]=-.5;r[n+2]=0;var s=this._cascadeShadowMapper.numCascades;for(var a=0;a<s;++a)e.vertexMatrices[a]=new M(new Float32Array(t.vertexConstantData.buffer,(e.vertexConstantsIndex+4+a*16)*4,16))};i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._cascadeProjections=null;this._depthMapCoordVaryings=null};i.prototype.iGetVertexCode=function(t,e,i,r){var n="";var s=i.getFreeVertexConstant();e.vertexConstantsIndex=s.index*4;this.initProjectionsRegs(i);var a=i.getFreeVertexVectorTemp();for(var o=0;o<this._cascadeShadowMapper.numCascades;++o){n+="m44 "+a+", "+r.globalPositionVertex+", "+this._cascadeProjections[o]+"\n"+"add "+this._depthMapCoordVaryings[o]+", "+a+", "+s+".zzwz\n"}return n};i.prototype.initProjectionsRegs=function(t){this._cascadeProjections=new Array(this._cascadeShadowMapper.numCascades);this._depthMapCoordVaryings=new Array(this._cascadeShadowMapper.numCascades);for(var e=0;e<this._cascadeShadowMapper.numCascades;++e){this._depthMapCoordVaryings[e]=t.getFreeVarying();this._cascadeProjections[e]=t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant()}};i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s=this._cascadeShadowMapper.numCascades;var a=r.getFreeFragmentConstant();var o=r.getFreeFragmentConstant();var h=r.getFreeFragmentConstant();var u=Array(h+".x",h+".y",h+".z",h+".w");var l;e.fragmentConstantsIndex=a.index*4;var p=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(p,1);var c=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(c,1);l="mov "+c+", "+this._depthMapCoordVaryings[s-1]+"\n";for(var _=s-2;_>=0;--_){var f=this._depthMapCoordVaryings[_];l+="slt "+p+".z, "+n.projectionFragment+".z, "+u[_]+"\n";var d=r.getFreeFragmentVectorTemp();l+="sub "+d+", "+f+", "+c+"\n"+"mul "+d+", "+d+", "+p+".z\n"+"add "+c+", "+c+", "+d+"\n"}r.removeFragmentTempUsage(p);l+="div "+c+", "+c+", "+c+".w\n"+"mul "+c+".xy, "+c+".xy, "+o+".zw\n"+"add "+c+".xy, "+c+".xy, "+o+".zz\n";l+=this._baseMethod._iGetCascadeFragmentCode(t,e,a,c,i,r,n)+"add "+i+".w, "+i+".w, "+o+".y\n";r.removeFragmentTempUsage(c);

return l};i.prototype.iActivate=function(t,e,i){e.textureGL.activate(e.pass._render);t.vertexConstantData[e.vertexConstantsIndex+3]=-1/(this._cascadeShadowMapper.depth*this._pEpsilon);var r=this._cascadeShadowMapper.numCascades;for(var n=0;n<r;++n)e.vertexMatrices[n].copyFrom(this._cascadeShadowMapper.getDepthProjections(n),true);var s=t.fragmentConstantData;var a=e.fragmentConstantsIndex;s[a+5]=1-this._pAlpha;var o=this._cascadeShadowMapper._iNearPlaneDistances;a+=8;for(var h=0;h<r;++h)s[a+h]=o[h];this._baseMethod.iActivateForCascade(t,e,i)};i.prototype.iSetRenderState=function(t,e,i,r,n){};i.prototype.onCascadeChange=function(t){this.iInvalidateShaderProgram()};i.prototype.onShaderInvalidated=function(t){this.iInvalidateShaderProgram()};return i}(Vo);var ko=function(t){e(i,t);function i(e){var i=t.call(this,e)||this;i._pUsePoint=e instanceof Pa;return i}i.prototype.iInitVO=function(t,e){e.needsView=true;e.needsGlobalVertexPos=true;e.needsGlobalFragmentPos=this._pUsePoint;e.needsNormals=t.numLights>0;e.textureGL=t.getAbstraction(this._pCastingLight.shadowMapper.depthMap)};i.prototype.iInitConstants=function(t,e){var i=t.fragmentConstantData;var r=t.vertexConstantData;var n=e.fragmentConstantsIndex;i[n]=1;i[n+1]=1/255;i[n+2]=1/65025;i[n+3]=1/16581375;i[n+6]=0;i[n+7]=1;if(this._pUsePoint){i[n+8]=0;i[n+9]=0;i[n+10]=0;i[n+11]=1}n=e.vertexConstantsIndex;if(n!=-1){r[n]=.5;r[n+1]=.5;r[n+2]=0;r[n+3]=1}e.vertexMatrices[0]=new M(new Float32Array(t.vertexConstantData.buffer,(e.vertexConstantsIndex+4)*4,16))};Object.defineProperty(i.prototype,"_iDepthMapCoordReg",{get:function(){return this._pDepthMapCoordReg},set:function(t){this._pDepthMapCoordReg=t},enumerable:true,configurable:true});i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._pDepthMapCoordReg=null};i.prototype.iGetVertexCode=function(t,e,i,r){return this._pUsePoint?this._pGetPointVertexCode(e,i,r):this.pGetPlanarVertexCode(e,i,r)};i.prototype._pGetPointVertexCode=function(t,e,i){t.vertexConstantsIndex=-1;return""};i.prototype.pGetPlanarVertexCode=function(t,e,i){var r="";var n=e.getFreeVertexVectorTemp();var s=e.getFreeVertexConstant();t.vertexConstantsIndex=s.index*4;var a=e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();this._pDepthMapCoordReg=e.getFreeVarying();r+="m44 "+n+", "+i.globalPositionVertex+", "+a+"\n"+"div "+n+", "+n+", "+n+".w\n"+"mul "+n+".xy, "+n+".xy, "+s+".xy\n"+"add "+this._pDepthMapCoordReg+", "+n+", "+s+".xxwz\n";return r};i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s=this._pUsePoint?this._pGetPointFragmentCode(t,e,i,r,n):this._pGetPlanarFragmentCode(t,e,i,r,n);s+="add "+i+".w, "+i+".w, fc"+(e.fragmentConstantsIndex/4+1)+".y\n"+"sat "+i+".w, "+i+".w\n";return s};i.prototype._pGetPlanarFragmentCode=function(t,e,i,n,s){throw new r};i.prototype._pGetPointFragmentCode=function(t,e,i,n,s){throw new r};i.prototype.iSetRenderState=function(t,e,i,r,n){if(!this._pUsePoint)e.vertexMatrices[0].copyFrom(this._pShadowMapper.iDepthProjection,true);e.textureGL._setRenderState(i)};i.prototype._iGetCascadeFragmentCode=function(t,e,i,r,n,s,a){throw new Error("This shadow method is incompatible with cascade shadows")};i.prototype.iActivate=function(t,e,i){var r=t.fragmentConstantData;var n=e.fragmentConstantsIndex;if(this._pUsePoint)r[n+4]=-Math.pow(1/(this._pCastingLight.fallOff*this._pEpsilon),2);else t.vertexConstantData[e.vertexConstantsIndex+3]=-1/(this._pShadowMapper.depth*this._pEpsilon);r[n+5]=1-this._pAlpha;if(this._pUsePoint){var s=this._pCastingLight.scenePosition;r[n+8]=s.x;r[n+9]=s.y;r[n+10]=s.z;var a=this._pCastingLight.fallOff;r[n+11]=1/(2*a*a)}e.textureGL.activate(e.pass._render)};i.prototype.iActivateForCascade=function(t,e,i){throw new Error("This shadow method is incompatible with cascade shadows")};return i}(Vo);var zo=function(t){e(i,t);function i(e,r,n){if(r===void 0){r=4}if(n===void 0){n=1}var s=t.call(this,e)||this;s._depthMapSize=s._pCastingLight.shadowMapper.depthMapSize;s.numSamples=r;s.range=n;++i._grainUsages;if(!i._grainTexture)s.initGrainTexture();return s}Object.defineProperty(i.prototype,"numSamples",{get:function(){return this._numSamples},set:function(t){if(t<1)t=1;else if(t>24)t=24;if(this._numSamples==t)return;this._numSamples=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.iInitVO=function(e,r){t.prototype.iInitVO.call(this,e,r);r.needsProjection=true;r.secondaryTextureGL=e.getAbstraction(i._grainTexture)};i.prototype.iInitConstants=function(e,i){t.prototype.iInitConstants.call(this,e,i);var r=e.fragmentConstantData;var n=i.fragmentConstantsIndex;r[n+8]=1/this._numSamples};Object.defineProperty(i.prototype,"range",{get:function(){return this._range*2},set:function(t){this._range=t/2},enumerable:true,configurable:true});i.prototype.initGrainTexture=function(){i._grainBitmapImage2D=new pe(64,64,false);var t=new Array;var e=4096;var r=1/(this._depthMapSize*this._range);var n,s;for(var a=0;a<e;++a){n=2*(Math.random()-.5);s=2*(Math.random()-.5);if(n<0)n-=r;else n+=r;if(s<0)s-=r;else s+=r;if(n>1)n=1;else if(n<-1)n=-1;if(s>1)s=1;else if(s<-1)s=-1;t[a]=Math.floor((n*.5+.5)*255)<<16|Math.floor((s*.5+.5)*255)<<8}i._grainBitmapImage2D.setArray(i._grainBitmapImage2D.rect,t);i._grainTexture=new ve(i._grainBitmapImage2D)};i.prototype.dispose=function(){if(--i._grainUsages==0){i._grainTexture.dispose();i._grainBitmapImage2D.dispose();i._grainTexture=null}};i.prototype.iActivate=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);var n=e.fragmentConstantData;var s=i.fragmentConstantsIndex;n[s+9]=(r.width-1)/63;n[s+10]=(r.height-1)/63;n[s+11]=2*this._range/this._depthMapSize;i.secondaryTextureGL.activate(i.pass._render)};i.prototype.iSetRenderState=function(e,i,r,n,s){t.prototype.iSetRenderState.call(this,e,i,r,n,s);i.secondaryTextureGL._setRenderState(r)};i.prototype._pGetPlanarFragmentCode=function(t,e,i,r,n){var s=r.getFreeFragmentConstant();var a=r.getFreeFragmentConstant();var o=r.getFreeFragmentConstant();e.fragmentConstantsIndex=s.index*4;return this.getSampleCode(t,e,o,s,i,r,n)};i.prototype.getSampleCode=function(t,e,i,r,n,s,a){var o="";var h=this._numSamples;var u=s.getFreeFragmentVectorTemp();s.addFragmentTempUsages(u,1);var l=s.getFreeFragmentVectorTemp();s.addFragmentTempUsages(l,1);var p=a.projectionFragment;o+="div "+u+", "+p+", "+p+".w\n"+"mul "+u+".xy, "+u+".xy, "+i+".yz\n";while(h>0){if(h==this._numSamples){o+=e.secondaryTextureGL._iGetFragmentCode(u,s,a,u)}else{o+="mov "+l+", "+u+".zwxy \n"+e.secondaryTextureGL._iGetFragmentCode(u,s,a,l)}o+="sub "+u+".zw, "+u+".xy, fc0.xx\n"+"mul "+u+".zw, "+u+".zw, "+i+".w\n";if(h==this._numSamples){o+="add "+u+".xy, "+u+".zw, "+this._pDepthMapCoordReg+".xy\n"+e.textureGL._iGetFragmentCode(l,s,a,u)+"dp4 "+l+".z, "+l+", "+r+"\n"+"slt "+n+".w, "+this._pDepthMapCoordReg+".z, "+l+".z\n"}else{o+=this.addSample(t,e,u,r,n,s,a)}if(h>4)o+="add "+u+".xy, "+u+".xy, "+u+".zw\n"+this.addSample(t,e,u,r,n,s,a);if(h>1)o+="sub "+u+".xy, "+this._pDepthMapCoordReg+".xy, "+u+".zw\n"+this.addSample(t,e,u,r,n,s,a);if(h>5)o+="sub "+u+".xy, "+u+".xy, "+u+".zw\n"+this.addSample(t,e,u,r,n,s,a);if(h>2){o+="neg "+u+".w, "+u+".w\n";o+="add "+u+".xy, "+u+".wz, "+this._pDepthMapCoordReg+".xy\n"+this.addSample(t,e,u,r,n,s,a)}if(h>6)o+="add "+u+".xy, "+u+".xy, "+u+".wz\n"+this.addSample(t,e,u,r,n,s,a);if(h>3)o+="sub "+u+".xy, "+this._pDepthMapCoordReg+".xy, "+u+".wz\n"+this.addSample(t,e,u,r,n,s,a);if(h>7)o+="sub "+u+".xy, "+u+".xy, "+u+".wz\n"+this.addSample(t,e,u,r,n,s,a);h-=8}s.removeFragmentTempUsage(l);s.removeFragmentTempUsage(u);o+="mul "+n+".w, "+n+".w, "+i+".x\n";return o};i.prototype.addSample=function(t,e,i,r,n,s,a){var o=s.getFreeFragmentVectorTemp();return e.textureGL._iGetFragmentCode(o,s,a,i)+"dp4 "+o+".z, "+o+", "+r+"\n"+"slt "+o+".z, "+this._pDepthMapCoordReg+".z, "+o+".z\n"+"add "+n+".w, "+n+".w, "+o+".z\n"};i.prototype.iActivateForCascade=function(t,e,i){var r=t.fragmentConstantData;var n=e.secondaryFragmentConstantsIndex;r[n]=1/this._numSamples;r[n+1]=(i.width-1)/63;r[n+2]=(i.height-1)/63;r[n+3]=2*this._range/this._depthMapSize;e.secondaryTextureGL.activate(e.pass._render)};i.prototype._iGetCascadeFragmentCode=function(t,e,i,r,n,s,a){this._pDepthMapCoordReg=r;var o=s.getFreeFragmentConstant();e.secondaryFragmentConstantsIndex=o.index*4;return this.getSampleCode(t,e,o,i,n,s,a)};return i}(ko);var jo=function(t){e(i,t);function i(e){return t.call(this,e)||this}i.prototype.iInitConstants=function(e,i){t.prototype.iInitConstants.call(this,e,i);var r=e.fragmentConstantData;var n=i.fragmentConstantsIndex;r[n+8]=.5;var s=this.castingLight.shadowMapper.depthMapSize;r[n+9]=s;r[n+10]=1/s};i.prototype._pGetPlanarFragmentCode=function(t,e,i,r,n){var s="";var a=r.getFreeFragmentConstant();r.getFreeFragmentConstant();var o=r.getFreeFragmentConstant();e.fragmentConstantsIndex=a.index*4;var h=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(h,1);var u=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(u,1);s+="mov "+u+", "+this._pDepthMapCoordReg+"\n"+e.textureGL._iGetFragmentCode(h,r,n,this._pDepthMapCoordReg)+"dp4 "+h+".z, "+h+", "+a+"\n"+"slt "+u+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"add "+u+".x, "+this._pDepthMapCoordReg+".x, "+o+".z\n"+e.textureGL._iGetFragmentCode(h,r,n,u)+"dp4 "+h+".z, "+h+", "+a+"\n"+"slt "+u+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"mul "+h+".x, "+this._pDepthMapCoordReg+".x, "+o+".y\n"+"frc "+h+".x, "+h+".x\n"+"sub "+u+".w, "+u+".w, "+u+".z\n"+"mul "+u+".w, "+u+".w, "+h+".x\n"+"add "+i+".w, "+u+".z, "+u+".w\n"+"mov "+u+".x, "+this._pDepthMapCoordReg+".x\n"+"add "+u+".y, "+this._pDepthMapCoordReg+".y, "+o+".z\n"+e.textureGL._iGetFragmentCode(h,r,n,u)+"dp4 "+h+".z, "+h+", "+a+"\n"+"slt "+u+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"add "+u+".x, "+this._pDepthMapCoordReg+".x, "+o+".z\n"+e.textureGL._iGetFragmentCode(h,r,n,u)+"dp4 "+h+".z, "+h+", "+a+"\n"+"slt "+u+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"mul "+h+".x, "+this._pDepthMapCoordReg+".x, "+o+".y\n"+"frc "+h+".x, "+h+".x\n"+"sub "+u+".w, "+u+".w, "+u+".z\n"+"mul "+u+".w, "+u+".w, "+h+".x\n"+"add "+u+".w, "+u+".z, "+u+".w\n"+"mul "+h+".x, "+this._pDepthMapCoordReg+".y, "+o+".y\n"+"frc "+h+".x, "+h+".x\n"+"sub "+u+".w, "+u+".w, "+i+".w\n"+"mul "+u+".w, "+u+".w, "+h+".x\n"+"add "+i+".w, "+i+".w, "+u+".w\n";r.removeFragmentTempUsage(h);r.removeFragmentTempUsage(u);return s};i.prototype.iActivateForCascade=function(t,e,i){var r=this.castingLight.shadowMapper.depthMapSize;var n=e.secondaryFragmentConstantsIndex;var s=t.fragmentConstantData;s[n]=r;s[n+1]=1/r};i.prototype._iGetCascadeFragmentCode=function(t,e,i,r,n,s,a){var o;var h=s.getFreeFragmentConstant();e.secondaryFragmentConstantsIndex=h.index*4;var u=s.getFreeFragmentVectorTemp();s.addFragmentTempUsages(u,1);var l=s.getFreeFragmentVectorTemp();s.addFragmentTempUsages(l,1);o=e.textureGL._iGetFragmentCode(u,s,a,r)+"dp4 "+u+".z, "+u+", "+i+"\n"+"slt "+l+".x, "+r+".z, "+u+".z\n"+"add "+r+".x, "+r+".x, "+h+".y\n"+e.textureGL._iGetFragmentCode(u,s,a,r)+"dp4 "+u+".z, "+u+", "+i+"\n"+"slt "+l+".z, "+r+".z, "+u+".z\n"+"add "+r+".y, "+r+".y, "+h+".y\n"+e.textureGL._iGetFragmentCode(u,s,a,r)+"dp4 "+u+".z, "+u+", "+i+"\n"+"slt "+l+".w, "+r+".z, "+u+".z\n"+"sub "+r+".x, "+r+".x, "+h+".y\n"+e.textureGL._iGetFragmentCode(u,s,a,r)+"dp4 "+u+".z, "+u+", "+i+"\n"+"slt "+l+".y, "+r+".z, "+u+".z\n"+"mul "+u+".xy, "+r+".xy, "+h+".x\n"+"frc "+u+".xy, "+u+".xy\n"+"sub "+r+", "+l+".xyzw, "+l+".zwxy\n"+"mul "+r+", "+r+", "+u+".x\n"+"add "+l+".xy, "+l+".xy, "+r+".zw\n"+"sub "+l+".y, "+l+".y, "+l+".x\n"+"mul "+l+".y, "+l+".y, "+u+".y\n"+"add "+n+".w, "+l+".x, "+l+".y\n";s.removeFragmentTempUsage(u);s.removeFragmentTempUsage(l);return o};return i}(ko);var Go=function(t){e(i,t);function i(e){return t.call(this,e)||this}i.prototype._pGetPlanarFragmentCode=function(t,e,i,r,n){var s="";var a=r.getFreeFragmentConstant();r.getFreeFragmentConstant();var o=r.getFreeFragmentVectorTemp();e.fragmentConstantsIndex=a.index*4;s+=e.textureGL._iGetFragmentCode(o,r,n,this._pDepthMapCoordReg)+"dp4 "+o+".z, "+o+", "+a+"\n"+"slt "+i+".w, "+this._pDepthMapCoordReg+".z, "+o+".z\n";return s};i.prototype._pGetPointFragmentCode=function(t,e,i,r,n){var s="";var a=r.getFreeFragmentConstant();var o=r.getFreeFragmentConstant();var h=r.getFreeFragmentConstant();var u=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(u,1);var l=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(l,1);e.fragmentConstantsIndex=a.index*4;s+="sub "+l+", "+n.globalPositionVarying+", "+h+"\n"+"dp3 "+l+".w, "+l+".xyz, "+l+".xyz\n"+"mul "+l+".w, "+l+".w, "+h+".w\n"+"nrm "+l+".xyz, "+l+".xyz\n"+e.textureGL._iGetFragmentCode(u,r,n,l)+"dp4 "+u+".z, "+u+", "+a+"\n"+"add "+i+".w, "+l+".w, "+o+".x\n"+"slt "+i+".w, "+i+".w, "+u+".z\n";r.removeFragmentTempUsage(l);r.removeFragmentTempUsage(u);return s};i.prototype._iGetCascadeFragmentCode=function(t,e,i,r,n,s,a){var o=s.getFreeFragmentVectorTemp();return e.textureGL._iGetFragmentCode(o,s,a,r)+"dp4 "+o+".z, "+o+", "+i+"\n"+"slt "+n+".w, "+r+".z, "+o+".z\n"};i.prototype.iActivateForCascade=function(t,e,i){};return i}(ko);var Ho=function(t){e(i,t);function i(e,i){if(i===void 0){i=.1}var r=t.call(this,e.castingLight)||this;r._onShaderInvalidatedDelegate=function(t){return r.onShaderInvalidated(t)};r._baseMethod=e;r._fadeRatio=i;r._nearShadowMapper=r._pCastingLight.shadowMapper;if(!r._nearShadowMapper)throw new Error("ShadowNearMethod requires a light that has a NearDirectionalShadowMapper instance assigned to shadowMapper.");r._baseMethod.addEventListener(bs.SHADER_INVALIDATED,r._onShaderInvalidatedDelegate);return r}Object.defineProperty(i.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(t){if(this._baseMethod==t)return;this._baseMethod.removeEventListener(bs.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this._baseMethod=t;this._baseMethod.addEventListener(bs.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});i.prototype.iInitConstants=function(e,i){t.prototype.iInitConstants.call(this,e,i);this._baseMethod.iInitConstants(e,i);var r=e.fragmentConstantData;var n=i.secondaryFragmentConstantsIndex;r[n+2]=0;r[n+3]=1};i.prototype.iInitVO=function(t,e){this._baseMethod.iInitVO(t,e);e.needsProjection=true};i.prototype.dispose=function(){this._baseMethod.removeEventListener(bs.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)};Object.defineProperty(i.prototype,"alpha",{get:function(){return this._baseMethod.alpha},set:function(t){this._baseMethod.alpha=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"epsilon",{get:function(){return this._baseMethod.epsilon},set:function(t){this._baseMethod.epsilon=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"fadeRatio",{get:function(){return this._fadeRatio},set:function(t){this._fadeRatio=t},enumerable:true,configurable:true});i.prototype.iGetFragmentCode=function(t,e,i,r,n){var s=this._baseMethod.iGetFragmentCode(t,e,i,r,n);var a=r.getFreeFragmentConstant();var o=r.getFreeFragmentSingleTemp();e.secondaryFragmentConstantsIndex=a.index*4;s+="abs "+o+", "+n.projectionFragment+".w\n"+"sub "+o+", "+o+", "+a+".x\n"+"mul "+o+", "+o+", "+a+".y\n"+"sat "+o+", "+o+"\n"+"sub "+o+", "+a+".w,"+o+"\n"+"sub "+i+".w, "+a+".w,"+i+".w\n"+"mul "+i+".w, "+i+".w, "+o+"\n"+"sub "+i+".w, "+a+".w,"+i+".w\n";return s};i.prototype.iActivate=function(t,e,i){this._baseMethod.iActivate(t,e,i)};i.prototype.iDeactivate=function(t,e,i){this._baseMethod.iDeactivate(t,e,i)};i.prototype.iSetRenderState=function(t,e,i,r,n){var s=n.near;var a=n.far-s;var o=this._nearShadowMapper.coverageRatio;var h=o*(1-this._fadeRatio);o=s+o*a;h=s+h*a;var u=t.fragmentConstantData;var l=e.secondaryFragmentConstantsIndex;u[l]=h;u[l+1]=1/(o-h);this._baseMethod.iSetRenderState(t,e,i,r,n)};i.prototype.iGetVertexCode=function(t,e,i,r){return this._baseMethod.iGetVertexCode(t,e,i,r)};i.prototype.iReset=function(){this._baseMethod.iReset()};i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._baseMethod.iCleanCompilationData()};i.prototype.onShaderInvalidated=function(t){this.iInvalidateShaderProgram()};return i}(ko);var Xo=function(t){e(i,t);function i(e,i,r){if(i===void 0){i=5}if(r===void 0){r=1}var n=t.call(this,e)||this;n._range=1;n.numSamples=i;n.range=r;return n}Object.defineProperty(i.prototype,"numSamples",{get:function(){return this._numSamples},set:function(t){this._numSamples=t;if(this._numSamples<1)this._numSamples=1;else if(this._numSamples>32)this._numSamples=32;this._offsets=X.getDistribution(this._numSamples);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"range",{get:function(){return this._range},set:function(t){this._range=t},enumerable:true,configurable:true});i.prototype.iInitConstants=function(e,i){t.prototype.iInitConstants.call(this,e,i);e.fragmentConstantData[i.fragmentConstantsIndex+8]=1/this._numSamples;e.fragmentConstantData[i.fragmentConstantsIndex+9]=0};i.prototype.iActivate=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);var n=.5*this._range/this._pCastingLight.shadowMapper.depthMapSize;var s=e.fragmentConstantData;var a=i.fragmentConstantsIndex+10;var o=this._numSamples<<1;for(var h=0;h<o;++h)s[a+h]=this._offsets[h]*n};i.prototype._pGetPlanarFragmentCode=function(t,e,i,r,n){var s=r.getFreeFragmentConstant();r.getFreeFragmentConstant();var a=r.getFreeFragmentConstant();e.fragmentConstantsIndex=s.index*4;return this.getSampleCode(t,e,s,i,r,n,a)};i.prototype.addSample=function(t,e,i,r,n,s,a){var o=n.getFreeFragmentVectorTemp();return e.textureGL._iGetFragmentCode(o,n,s,a)+"dp4 "+o+".z, "+o+", "+i+"\n"+"slt "+a+".w, "+this._pDepthMapCoordReg+".z, "+o+".z\n"+"add "+r+".w, "+r+".w, "+a+".w\n"};i.prototype.iActivateForCascade=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);var n=this._range/this._pCastingLight.shadowMapper.depthMapSize;var s=e.fragmentConstantData;var a=i.secondaryFragmentConstantsIndex;var o=this._numSamples<<1;s[a]=1/this._numSamples;s[a+1]=0;a+=2;for(var h=0;h<o;++h)s[a+h]=this._offsets[h]*n;if(o%4==0){s[a+o]=0;s[a+o+1]=0}};i.prototype._iGetCascadeFragmentCode=function(t,e,i,r,n,s,a){this._pDepthMapCoordReg=r;var o=s.getFreeFragmentConstant();e.secondaryFragmentConstantsIndex=o.index*4;return this.getSampleCode(t,e,i,n,s,a,o)};i.prototype.getSampleCode=function(t,e,i,r,n,s,a){var o;var h=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(h,1);var u=new Array(a+".zw");var l=this._numSamples>>1;for(var p=0;p<l;++p){var c=n.getFreeFragmentConstant();u.push(c+".xy");u.push(c+".zw")}for(p=0;p<this._numSamples;++p){if(p==0){var _=n.getFreeFragmentVectorTemp();o="add "+h+", "+this._pDepthMapCoordReg+", "+a+".zwyy\n"+e.textureGL._iGetFragmentCode(_,n,s,h)+"dp4 "+_+".z, "+_+", "+i+"\n"+"slt "+r+".w, "+this._pDepthMapCoordReg+".z, "+_+".z\n"}else{o+="add "+h+".xy, "+this._pDepthMapCoordReg+".xy, "+u[p]+"\n"+this.addSample(t,e,i,r,n,s,h)}}n.removeFragmentTempUsage(h);o+="mul "+r+".w, "+r+".w, "+a+".x\n";return o};return i}(ko);var Wo=function(t){e(i,t);function i(){return t.call(this)||this}i.prototype.iInitVO=function(t,e){e.needsTangents=true;e.needsView=true};i.prototype.iGetFragmentCodePerLight=function(t,e,i,r,n,s){var a="";var o;if(this._pIsFirstLight)o=this._pTotalLightColorReg;else{o=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(o,1)}a+="nrm "+o+".xyz, "+s.tangentVarying+".xyz\n"+"dp3 "+o+".w, "+o+".xyz, "+i+".xyz\n"+"dp3 "+o+".z, "+o+".xyz, "+s.viewDirFragment+".xyz\n";a+="sin "+o+".x, "+o+".w\n"+"sin "+o+".y, "+o+".z\n"+"mul "+o+".x, "+o+".x, "+o+".y\n"+"cos "+o+".z, "+o+".z\n"+"cos "+o+".w, "+o+".w\n"+"mul "+o+".w, "+o+".w, "+o+".z\n"+"sub "+o+".w, "+o+".x, "+o+".w\n";if(this.texture){a+="mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\n"+"pow "+o+".w, "+o+".w, "+this._pSpecularTexData+".w\n"}else a+="pow "+o+".w, "+o+".w, "+this._pSpecularDataRegister+".w\n";a+="mul "+o+".w, "+o+".w, "+i+".w\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(t,e,o,n,s);a+="mul "+o+".xyz, "+r+".xyz, "+o+".w\n";if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+o+".xyz\n";n.removeFragmentTempUsage(o)}this._pIsFirstLight=false;return a};return i}(_o);var Yo=function(t){e(i,t);function i(e,i){if(i===void 0){i=null}var r=t.call(this)||this;r._onShaderInvalidatedDelegate=function(t){return r.onShaderInvalidated(t)};r._baseMethod=i||new _o;r._baseMethod._iModulateMethod=e;r._baseMethod.addEventListener(bs.SHADER_INVALIDATED,r._onShaderInvalidatedDelegate);return r}i.prototype.iInitVO=function(t,e){this._baseMethod.iInitVO(t,e)};i.prototype.iInitConstants=function(t,e){this._baseMethod.iInitConstants(t,e)};i.prototype.iAddOwner=function(e){t.prototype.iAddOwner.call(this,e);this._baseMethod.iAddOwner(e)};i.prototype.iRemoveOwner=function(e){t.prototype.iRemoveOwner.call(this,e);this._baseMethod.iRemoveOwner(e)};Object.defineProperty(i.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(t){if(this._baseMethod==t)return;this._baseMethod.removeEventListener(bs.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this._baseMethod=t;this._baseMethod.addEventListener(bs.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"gloss",{get:function(){return this._baseMethod.gloss},set:function(t){this._baseMethod.gloss=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"strength",{get:function(){return this._baseMethod.strength},set:function(t){this._baseMethod.strength=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"color",{get:function(){return this._baseMethod.color},set:function(t){this._baseMethod.color=t},enumerable:true,configurable:true});i.prototype.dispose=function(){this._baseMethod.removeEventListener(bs.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this._baseMethod.dispose()};Object.defineProperty(i.prototype,"texture",{get:function(){return this._baseMethod.texture},set:function(t){this._baseMethod.texture=t},enumerable:true,configurable:true});i.prototype.iActivate=function(t,e,i){this._baseMethod.iActivate(t,e,i)};i.prototype.iSetRenderState=function(t,e,i,r,n){this._baseMethod.iSetRenderState(t,e,i,r,n)};i.prototype.iDeactivate=function(t,e,i){this._baseMethod.iDeactivate(t,e,i)};i.prototype.iGetVertexCode=function(t,e,i,r){return this._baseMethod.iGetVertexCode(t,e,i,r)};i.prototype.iGetFragmentPreLightingCode=function(t,e,i,r){return this._baseMethod.iGetFragmentPreLightingCode(t,e,i,r)};i.prototype.iGetFragmentCodePerLight=function(t,e,i,r,n,s){return this._baseMethod.iGetFragmentCodePerLight(t,e,i,r,n,s)};i.prototype.iGetFragmentCodePerProbe=function(t,e,i,r,n,s){return this._baseMethod.iGetFragmentCodePerProbe(t,e,i,r,n,s)};i.prototype.iGetFragmentPostLightingCode=function(t,e,i,r,n){return this._baseMethod.iGetFragmentPostLightingCode(t,e,i,r,n)};i.prototype.iReset=function(){this._baseMethod.iReset()};i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._baseMethod.iCleanCompilationData()};i.prototype.onShaderInvalidated=function(t){this.iInvalidateShaderProgram()};return i}(_o);var qo=function(t){e(i,t);function i(e,i){if(e===void 0){e=.5}if(i===void 0){i=null}var r=t.call(this,null,i)||this;r._smoothness=.1;r._specularCutOff=.1;r.baseMethod._iModulateMethod=function(t,e,i,n,s){return r.clampSpecular(t,e,i,n,s)};r._specularCutOff=e;return r}Object.defineProperty(i.prototype,"smoothness",{get:function(){return this._smoothness},set:function(t){this._smoothness=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"specularCutOff",{get:function(){return this._specularCutOff},set:function(t){this._specularCutOff=t},enumerable:true,configurable:true});i.prototype.iActivate=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);var n=i.secondaryFragmentConstantsIndex;var s=e.fragmentConstantData;s[n]=this._smoothness;s[n+1]=this._specularCutOff};i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._dataReg=null};i.prototype.clampSpecular=function(t,e,i,r,n){return"sub "+i+".y, "+i+".w, "+this._dataReg+".y\n"+"div "+i+".y, "+i+".y, "+this._dataReg+".x\n"+"sat "+i+".y, "+i+".y\n"+"sge "+i+".w, "+i+".w, "+this._dataReg+".y\n"+"mul "+i+".w, "+i+".w, "+i+".y\n"};i.prototype.iGetFragmentPreLightingCode=function(e,i,r,n){this._dataReg=r.getFreeFragmentConstant();i.secondaryFragmentConstantsIndex=this._dataReg.index*4;return t.prototype.iGetFragmentPreLightingCode.call(this,e,i,r,n)};return i}(Yo);var Ko=function(t){e(i,t);function i(e,i){if(e===void 0){e=true}if(i===void 0){i=null}var r=t.call(this,null,i)||this;r._fresnelPower=5;r._normalReflectance=.028;r.baseMethod._iModulateMethod=function(t,e,i,n,s){return r.modulateSpecular(t,e,i,n,s)};r._incidentLight=!e;return r}i.prototype.iInitConstants=function(t,e){var i=e.secondaryFragmentConstantsIndex;t.fragmentConstantData[i+2]=1;t.fragmentConstantData[i+3]=0};Object.defineProperty(i.prototype,"basedOnSurface",{get:function(){return!this._incidentLight},set:function(t){if(this._incidentLight!=t)return;this._incidentLight=!t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(t){this._fresnelPower=t},enumerable:true,configurable:true});i.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._dataReg=null};Object.defineProperty(i.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(t){this._normalReflectance=t},enumerable:true,configurable:true});i.prototype.iActivate=function(e,i,r){t.prototype.iActivate.call(this,e,i,r);var n=e.fragmentConstantData;var s=i.secondaryFragmentConstantsIndex;n[s]=this._normalReflectance;n[s+1]=this._fresnelPower};i.prototype.iGetFragmentPreLightingCode=function(e,i,r,n){this._dataReg=r.getFreeFragmentConstant();i.secondaryFragmentConstantsIndex=this._dataReg.index*4;return t.prototype.iGetFragmentPreLightingCode.call(this,e,i,r,n)};i.prototype.modulateSpecular=function(t,e,i,r,n){var s;s="dp3 "+i+".y, "+n.viewDirFragment+".xyz, "+(this._incidentLight?i:n.normalFragment)+".xyz\n"+"sub "+i+".y, "+this._dataReg+".z, "+i+".y\n"+"pow "+i+".x, "+i+".y, "+this._dataReg+".y\n"+"sub "+i+".y, "+this._dataReg+".z, "+i+".y\n"+"mul "+i+".y, "+this._dataReg+".x, "+i+".y\n"+"add "+i+".y, "+i+".x, "+i+".y\n"+"mul "+i+".w, "+i+".w, "+i+".y\n";return s};return i}(Yo);var Zo=function(t){e(i,t);function i(){return t.call(this)||this}i.prototype.iGetFragmentCodePerLight=function(t,e,i,r,n,s){var a="";var o;if(this._pIsFirstLight){o=this._pTotalLightColorReg}else{o=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(o,1)}var h=s.viewDirFragment;var u=s.normalFragment;a+="dp3 "+o+".w, "+i+", "+u+"\n"+"add "+o+".w, "+o+".w, "+o+".w\n"+"mul "+o+".xyz, "+u+", "+o+".w\n"+"sub "+o+".xyz, "+o+", "+i+"\n"+"add "+o+".w, "+o+".w, "+s.commons+".w\n"+"sat "+o+".w, "+o+".w\n"+"mul "+o+".xyz, "+o+", "+o+".w\n"+"dp3 "+o+".w, "+o+", "+h+"\n"+"sat "+o+".w, "+o+".w\n";if(this.texture){a+="mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\n"+"pow "+o+".w, "+o+".w, "+this._pSpecularTexData+".w\n"}else a+="pow "+o+".w, "+o+".w, "+this._pSpecularDataRegister+".w\n";if(t.usesLightFallOff)a+="mul "+o+".w, "+o+".w, "+i+".w\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(t,e,o,n,s);a+="mul "+o+".xyz, "+r+".xyz, "+o+".w\n";if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+o+".xyz\n";n.removeFragmentTempUsage(o)}this._pIsFirstLight=false;return a};return i}(_o);var Qo=function(){function t(){}return t}();Qo.EFFECTS=1;Qo.LIGHTING=2;Qo.SUPER_SHADER=3;var Jo=function(t){e(i,t);function i(e,i,r,n){var s=t.call(this,i,r,n)||this;s._maxLights=3;s._mode=3;s._includeCasters=true;s._iMethodVOs=new Array;s._numEffectDependencies=0;s.numDirectionalLights=0;s.numPointLights=0;s.numLightProbes=0;s.pointLightsOffset=0;s.directionalLightsOffset=0;s.lightProbesOffset=0;s._mode=e;s._methodMaterial=r;s._onLightsChangeDelegate=function(t){return s.onLightsChange(t)};s._onMethodInvalidatedDelegate=function(t){return s.onMethodInvalidated(t)};s.lightPicker=r.lightPicker;if(s._shader==null)s._updateShader();return s}Object.defineProperty(i.prototype,"mode",{get:function(){return this._mode},set:function(t){if(this._mode==t)return;this._mode=t;this._updateLights()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"includeCasters",{get:function(){return this._includeCasters},set:function(t){if(this._includeCasters==t)return;this._includeCasters=t;this._updateLights()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"lightPicker",{get:function(){return this._lightPicker},set:function(t){if(this._lightPicker)this._lightPicker.removeEventListener(s.INVALIDATE,this._onLightsChangeDelegate);this._lightPicker=t;if(this._lightPicker)this._lightPicker.addEventListener(s.INVALIDATE,this._onLightsChangeDelegate);this._updateLights()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"enableLightFallOff",{get:function(){return this._methodMaterial.enableLightFallOff},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"diffuseLightSources",{get:function(){return this._methodMaterial.diffuseLightSources},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"specularLightSources",{get:function(){return this._methodMaterial.specularLightSources},enumerable:true,configurable:true});i.prototype._updateShader=function(){if((this.numDirectionalLights||this.numPointLights||this.numLightProbes)&&!(this._shader instanceof ro)){if(this._shader!=null){this._shader.dispose();this._shader=null}this._shader=new ro(this._elementsClass,this,this._stage)}else if(this._shader==null){if(this._shader!=null){this._shader.dispose();this._shader=null}this._shader=new Tr(this._elementsClass,this,this._stage)}};i.prototype._iInitConstantData=function(e){t.prototype._iInitConstantData.call(this,e);var i=this._iMethodVOs.length;for(var r=0;r<i;++r)this._iMethodVOs[r].method.iInitConstants(e,this._iMethodVOs[r])};Object.defineProperty(i.prototype,"colorTransform",{get:function(){return this.colorTransformMethod?this.colorTransformMethod.colorTransform:null},set:function(t){if(t){if(this.colorTransformMethod==null)this.colorTransformMethod=new So;this.colorTransformMethod.colorTransform=t}else if(!t){if(this.colorTransformMethod)this.colorTransformMethod=null}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"colorTransformMethod",{get:function(){return this._iColorTransformMethodVO?this._iColorTransformMethodVO.method:null},set:function(t){if(this._iColorTransformMethodVO&&this._iColorTransformMethodVO.method==t)return;if(this._iColorTransformMethodVO){this._removeDependency(this._iColorTransformMethodVO);this._iColorTransformMethodVO=null}if(t){this._iColorTransformMethodVO=new Ke(t,this);this._addDependency(this._iColorTransformMethodVO)}},enumerable:true,configurable:true});i.prototype._removeDependency=function(t,e){if(e===void 0){e=false}var i=this._iMethodVOs.indexOf(t);if(!e)this._numEffectDependencies--;t.method.removeEventListener(bs.SHADER_INVALIDATED,this._onMethodInvalidatedDelegate);this._iMethodVOs.splice(i,1);this.invalidate()};i.prototype._addDependency=function(t,e,i){if(e===void 0){e=false}if(i===void 0){i=-1}t.method.addEventListener(bs.SHADER_INVALIDATED,this._onMethodInvalidatedDelegate);if(e){if(i!=-1)this._iMethodVOs.splice(i+this._iMethodVOs.length-this._numEffectDependencies,0,t);else this._iMethodVOs.push(t);this._numEffectDependencies++;

}else{this._iMethodVOs.splice(this._iMethodVOs.length-this._numEffectDependencies,0,t)}this.invalidate()};i.prototype.addEffectMethod=function(t){this._addDependency(new Ke(t,this),true)};Object.defineProperty(i.prototype,"numEffectMethods",{get:function(){return this._numEffectDependencies},enumerable:true,configurable:true});i.prototype.hasEffectMethod=function(t){return this.getDependencyForMethod(t)!=null};i.prototype.getEffectMethodAt=function(t){if(t<0||t>this._numEffectDependencies-1)return null;return this._iMethodVOs[t+this._iMethodVOs.length-this._numEffectDependencies].method};i.prototype.addEffectMethodAt=function(t,e){this._addDependency(new Ke(t,this),true,e)};i.prototype.removeEffectMethod=function(t){var e=this.getDependencyForMethod(t);if(e!=null)this._removeDependency(e,true)};i.prototype.removeEffectMethodAt=function(t){if(t<0||t>this._numEffectDependencies-1)return;var e=this._iMethodVOs[t+this._iMethodVOs.length-this._numEffectDependencies];if(e!=null)this._removeDependency(e,true)};i.prototype.getDependencyForMethod=function(t){var e=this._iMethodVOs.length;for(var i=0;i<e;++i)if(this._iMethodVOs[i].method==t)return this._iMethodVOs[i];return null};Object.defineProperty(i.prototype,"normalMethod",{get:function(){return this._iNormalMethodVO?this._iNormalMethodVO.method:null},set:function(t){if(this._iNormalMethodVO&&this._iNormalMethodVO.method==t)return;if(this._iNormalMethodVO){this._removeDependency(this._iNormalMethodVO);this._iNormalMethodVO=null}if(t){this._iNormalMethodVO=new Ke(t,this);this._addDependency(this._iNormalMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"ambientMethod",{get:function(){return this._iAmbientMethodVO?this._iAmbientMethodVO.method:null},set:function(t){if(this._iAmbientMethodVO&&this._iAmbientMethodVO.method==t)return;if(this._iAmbientMethodVO){this._removeDependency(this._iAmbientMethodVO);this._iAmbientMethodVO=null}if(t){this._iAmbientMethodVO=new Ke(t,this);this._addDependency(this._iAmbientMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"shadowMethod",{get:function(){return this._iShadowMethodVO?this._iShadowMethodVO.method:null},set:function(t){if(this._iShadowMethodVO&&this._iShadowMethodVO.method==t)return;if(this._iShadowMethodVO){this._removeDependency(this._iShadowMethodVO);this._iShadowMethodVO=null}if(t){this._iShadowMethodVO=new Ke(t,this);this._addDependency(this._iShadowMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"diffuseMethod",{get:function(){return this._iDiffuseMethodVO?this._iDiffuseMethodVO.method:null},set:function(t){if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.method==t)return;if(this._iDiffuseMethodVO){this._removeDependency(this._iDiffuseMethodVO);this._iDiffuseMethodVO=null}if(t){this._iDiffuseMethodVO=new Ke(t,this);this._addDependency(this._iDiffuseMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"specularMethod",{get:function(){return this._iSpecularMethodVO?this._iSpecularMethodVO.method:null},set:function(t){if(this._iSpecularMethodVO&&this._iSpecularMethodVO.method==t)return;if(this._iSpecularMethodVO){this._removeDependency(this._iSpecularMethodVO);this._iSpecularMethodVO=null}if(t){this._iSpecularMethodVO=new Ke(t,this);this._addDependency(this._iSpecularMethodVO)}},enumerable:true,configurable:true});i.prototype.dispose=function(){if(this._lightPicker)this._lightPicker.removeEventListener(s.INVALIDATE,this._onLightsChangeDelegate);while(this._iMethodVOs.length)this._removeDependency(this._iMethodVOs[0]);t.prototype.dispose.call(this);this._iMethodVOs=null};i.prototype.onMethodInvalidated=function(t){this.invalidate()};i.prototype._iActivate=function(e){t.prototype._iActivate.call(this,e);var i;var r=this._iMethodVOs.length;for(var n=0;n<r;++n){i=this._iMethodVOs[n];if(i.useMethod)i.method.iActivate(this._shader,i,this._stage)}};i.prototype._setRenderState=function(e,i){t.prototype._setRenderState.call(this,e,i);var r;var n=this._iMethodVOs.length;for(var s=0;s<n;++s){r=this._iMethodVOs[s];if(r.useMethod)r.method.iSetRenderState(this._shader,r,e,this._stage,i)}};i.prototype._iDeactivate=function(){t.prototype._iDeactivate.call(this);var e;var i=this._iMethodVOs.length;for(var r=0;r<i;++r){e=this._iMethodVOs[r];if(e.useMethod)e.method.iDeactivate(this._shader,e,this._stage)}};i.prototype._iIncludeDependencies=function(e){t.prototype._iIncludeDependencies.call(this,e);e.usesFragmentAnimation=Boolean(this._mode==Qo.SUPER_SHADER);if(e.useAlphaPremultiplied&&e.usesBlending)e.usesCommonData=true;var i;var r=this._iMethodVOs.length;for(i=0;i<r;++i)this.setupAndCountDependencies(e,this._iMethodVOs[i]);var n=true;var s;for(i=0;i<r;++i){s=this._iMethodVOs[i];if((s.useMethod=s.method.iIsUsed(e))&&!s.method.iUsesTangentSpace())n=false}e.outputsNormals=this._iNormalMethodVO&&this._iNormalMethodVO.useMethod;e.outputsTangentNormals=e.outputsNormals&&this._iNormalMethodVO.method.iOutputsTangentNormals();e.usesTangentSpace=e.outputsTangentNormals&&!e.usesProbes&&n;if(!e.usesTangentSpace){if(e.viewDirDependencies>0){e.globalPosDependencies++}else if(this.numPointLights>0&&e.usesLights){e.globalPosDependencies++;if(Boolean(this._mode&Qo.EFFECTS))e.usesGlobalPosFragment=true}}};i.prototype.setupAndCountDependencies=function(t,e){e.reset();e.method.iInitVO(t,e);if(e.needsProjection)t.projectionDependencies++;if(e.needsGlobalVertexPos||e.needsGlobalFragmentPos){t.globalPosDependencies++;if(e.needsGlobalFragmentPos)t.usesGlobalPosFragment=true}if(e.needsNormals)t.normalDependencies++;if(e.needsTangents)t.tangentDependencies++;if(e.needsView)t.viewDirDependencies++};i.prototype._iGetPreLightingVertexCode=function(t,e,i){var r="";if(this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod)r+=this._iAmbientMethodVO.method.iGetVertexCode(t,this._iAmbientMethodVO,e,i);if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod)r+=this._iDiffuseMethodVO.method.iGetVertexCode(t,this._iDiffuseMethodVO,e,i);if(this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod)r+=this._iSpecularMethodVO.method.iGetVertexCode(t,this._iSpecularMethodVO,e,i);return r};i.prototype._iGetPreLightingFragmentCode=function(t,e,i){var r="";if(this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod){r+=this._iAmbientMethodVO.method.iGetFragmentCode(t,this._iAmbientMethodVO,i.shadedTarget,e,i);if(this._iAmbientMethodVO.needsNormals)e.removeFragmentTempUsage(i.normalFragment);if(this._iAmbientMethodVO.needsView)e.removeFragmentTempUsage(i.viewDirFragment)}if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod)r+=this._iDiffuseMethodVO.method.iGetFragmentPreLightingCode(t,this._iDiffuseMethodVO,e,i);if(this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod)r+=this._iSpecularMethodVO.method.iGetFragmentPreLightingCode(t,this._iSpecularMethodVO,e,i);return r};i.prototype._iGetPerLightDiffuseFragmentCode=function(t,e,i,r,n){return this._iDiffuseMethodVO.method.iGetFragmentCodePerLight(t,this._iDiffuseMethodVO,e,i,r,n)};i.prototype._iGetPerLightSpecularFragmentCode=function(t,e,i,r,n){return this._iSpecularMethodVO.method.iGetFragmentCodePerLight(t,this._iSpecularMethodVO,e,i,r,n)};i.prototype._iGetPerProbeDiffuseFragmentCode=function(t,e,i,r,n){return this._iDiffuseMethodVO.method.iGetFragmentCodePerProbe(t,this._iDiffuseMethodVO,e,i,r,n)};i.prototype._iGetPerProbeSpecularFragmentCode=function(t,e,i,r,n){return this._iSpecularMethodVO.method.iGetFragmentCodePerProbe(t,this._iSpecularMethodVO,e,i,r,n)};i.prototype._iGetPostLightingVertexCode=function(t,e,i){var r="";if(this._iShadowMethodVO)r+=this._iShadowMethodVO.method.iGetVertexCode(t,this._iShadowMethodVO,e,i);return r};i.prototype._iGetPostLightingFragmentCode=function(t,e,i){var r="";if(t.useAlphaPremultiplied&&t.usesBlending){r+="add "+i.shadedTarget+".w, "+i.shadedTarget+".w, "+i.commons+".z\n"+"div "+i.shadedTarget+".xyz, "+i.shadedTarget+", "+i.shadedTarget+".w\n"+"sub "+i.shadedTarget+".w, "+i.shadedTarget+".w, "+i.commons+".z\n"+"sat "+i.shadedTarget+".xyz, "+i.shadedTarget+"\n"}if(this._iShadowMethodVO)r+=this._iShadowMethodVO.method.iGetFragmentCode(t,this._iShadowMethodVO,i.shadowTarget,e,i);if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod){r+=this._iDiffuseMethodVO.method.iGetFragmentPostLightingCode(t,this._iDiffuseMethodVO,i.shadedTarget,e,i);if(this._iDiffuseMethodVO.needsNormals)e.removeFragmentTempUsage(i.normalFragment);if(this._iDiffuseMethodVO.needsView)e.removeFragmentTempUsage(i.viewDirFragment)}if(this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod){r+=this._iSpecularMethodVO.method.iGetFragmentPostLightingCode(t,this._iSpecularMethodVO,i.shadedTarget,e,i);if(this._iSpecularMethodVO.needsNormals)e.removeFragmentTempUsage(i.normalFragment);if(this._iSpecularMethodVO.needsView)e.removeFragmentTempUsage(i.viewDirFragment)}if(this._iShadowMethodVO)e.removeFragmentTempUsage(i.shadowTarget);return r};i.prototype._iGetNormalVertexCode=function(t,e,i){return this._iNormalMethodVO.method.iGetVertexCode(t,this._iNormalMethodVO,e,i)};i.prototype._iGetNormalFragmentCode=function(t,e,i){var r=this._iNormalMethodVO.method.iGetFragmentCode(t,this._iNormalMethodVO,i.normalFragment,e,i);if(this._iNormalMethodVO.needsView)e.removeFragmentTempUsage(i.viewDirFragment);if(this._iNormalMethodVO.needsGlobalFragmentPos||this._iNormalMethodVO.needsGlobalVertexPos)e.removeVertexTempUsage(i.globalPositionVertex);return r};i.prototype._iGetVertexCode=function(t,e,i){var r="";var n;var s=this._iMethodVOs.length;for(var a=s-this._numEffectDependencies;a<s;a++){n=this._iMethodVOs[a];if(n.useMethod){r+=n.method.iGetVertexCode(t,n,e,i);if(n.needsGlobalVertexPos||n.needsGlobalFragmentPos)e.removeVertexTempUsage(i.globalPositionVertex)}}if(this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod)r+=this._iColorTransformMethodVO.method.iGetVertexCode(t,this._iColorTransformMethodVO,e,i);return r};i.prototype._iGetFragmentCode=function(t,e,i){var r="";var n;if(this.preserveAlpha&&this._numEffectDependencies>0){n=e.getFreeFragmentSingleTemp();e.addFragmentTempUsages(n,1);r+="mov "+n+", "+i.shadedTarget+".w\n"}var s;var a=this._iMethodVOs.length;for(var o=a-this._numEffectDependencies;o<a;o++){s=this._iMethodVOs[o];if(s.useMethod){r+=s.method.iGetFragmentCode(t,s,i.shadedTarget,e,i);if(s.needsNormals)e.removeFragmentTempUsage(i.normalFragment);if(s.needsView)e.removeFragmentTempUsage(i.viewDirFragment)}}if(this.preserveAlpha&&this._numEffectDependencies>0){r+="mov "+i.shadedTarget+".w, "+n+"\n";e.removeFragmentTempUsage(n)}if(this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod)r+=this._iColorTransformMethodVO.method.iGetFragmentCode(t,this._iColorTransformMethodVO,i.shadedTarget,e,i);return r};i.prototype._iUsesShadows=function(t){return Boolean(this._iShadowMethodVO&&(this._lightPicker.castingDirectionalLights.length>0||this._lightPicker.castingPointLights.length>0))};i.prototype._iUsesSpecular=function(t){return Boolean(this._iSpecularMethodVO)};i.prototype._iUsesDiffuse=function(t){return Boolean(this._iDiffuseMethodVO)};i.prototype.onLightsChange=function(t){this._updateLights()};i.prototype._updateLights=function(){var t=this.numDirectionalLights;var e=this.numPointLights;var i=this.numLightProbes;if(this._lightPicker&&this._mode&Qo.LIGHTING){this.numDirectionalLights=this.calculateNumDirectionalLights(this._lightPicker.numDirectionalLights);this.numPointLights=this.calculateNumPointLights(this._lightPicker.numPointLights);this.numLightProbes=this.calculateNumProbes(this._lightPicker.numLightProbes);if(this._includeCasters){this.numDirectionalLights+=this._lightPicker.numCastingDirectionalLights;this.numPointLights+=this._lightPicker.numCastingPointLights}}else{this.numDirectionalLights=0;this.numPointLights=0;this.numLightProbes=0}if(t!=this.numDirectionalLights||e!=this.numPointLights||i!=this.numLightProbes){this._updateShader();this.invalidate()}};i.prototype.calculateNumDirectionalLights=function(t){return Math.min(t-this.directionalLightsOffset,this._maxLights)};i.prototype.calculateNumPointLights=function(t){var e=this._maxLights-this.numDirectionalLights;return Math.min(t-this.pointLightsOffset,e)};i.prototype.calculateNumProbes=function(t){var e=0;if((this.specularLightSources&Na.PROBES)!=0)++e;if((this.diffuseLightSources&Na.PROBES)!=0)++e;return Math.min(t-this.lightProbesOffset,4/e|0)};return i}(Pr);var $o=function(t){e(i,t);function i(e,i,r){var n=t.call(this,e,i,r)||this;n._textureSize=512;n._polyOffset=new Float32Array([15,0,0,0]);n._projectionTexturesInvalid=true;n._methodMaterial=i;return n}Object.defineProperty(i.prototype,"textureSize",{get:function(){return this._textureSize},set:function(t){this._textureSize=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"polyOffset",{get:function(){return this._polyOffset[0]},set:function(t){this._polyOffset[0]=t},enumerable:true,configurable:true});i.prototype.dispose=function(){if(this._textures){for(var t in this._textures){var e=this._textures[t];e.dispose()}this._textures=null}};i.prototype.updateProjectionTextures=function(){if(this._textures){for(var t in this._textures){var e=this._textures[t];e.dispose()}}this._textures=new Object;this._projections=new Object;this._projectionTexturesInvalid=false};i.prototype._iGetVertexCode=function(){var t;t="mul vt7, vt1, vc4.x	\n"+"add vt7, vt7, vt0\n"+"mov vt7.w, vt0.w\n";t+="m44 vt2, vt7, vc0\n"+"mov op, vt2\n";t+="div v0, vt2, vt2.w\n";return t};i.prototype._iGetFragmentCode=function(t,e,i){var r="";r+="mul ft0, fc0, v0.z\n"+"frc ft0, ft0\n"+"mul ft1, ft0.yzww, fc1\n"+"sub ft0, ft0, ft1\n"+"mov oc, ft0\n";return r};i.prototype._iGetDepthMap=function(t){return this._textures[t.renderable.id]};i.prototype._iGetProjection=function(t){return this._projections[t.renderable.id]};i.prototype._iRender=function(t,e){var i;var r=this._stage.context;var n;var s;var a=this._methodMaterial.lightPicker.allPickedLights;var o=t.renderable.id;if(!this._textures[o])this._textures[o]=new ve(new ae(this._textureSize,this._textureSize));if(!this._projections[o])this._projections[o]=new M;n=a.length;s=a[0];i=s.iGetObjectProjectionMatrix(t.sourceEntity,e.transform.concatenatedMatrix3D,this._projections[o]);this._stage.setRenderTarget(this._textures[o],true);r.clear(1,1,1);var h=t.elementsGL};i.prototype._iActivate=function(e){if(this._projectionTexturesInvalid)this.updateProjectionTextures();t.prototype._iActivate.call(this,e)};return i}(Pr);var th=function(i){e(r,i);function r(t,e){var r=i.call(this,t,e)||this;r._methodMaterial=t;r._materialPool=e;return r}Object.defineProperty(r.prototype,"numLights",{get:function(){return this._methodMaterial.lightPicker?this._methodMaterial.lightPicker.numLightProbes+this._methodMaterial.lightPicker.numDirectionalLights+this._methodMaterial.lightPicker.numPointLights+this._methodMaterial.lightPicker.numCastingDirectionalLights+this._methodMaterial.lightPicker.numCastingPointLights:0},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"numNonCasters",{get:function(){return this._methodMaterial.lightPicker?this._methodMaterial.lightPicker.numLightProbes+this._methodMaterial.lightPicker.numDirectionalLights+this._methodMaterial.lightPicker.numPointLights:0},enumerable:true,configurable:true});r.prototype._pUpdateRender=function(){i.prototype._pUpdateRender.call(this);this.initPasses();this.setBlendAndCompareModes();this._pClearPasses();if(this._methodMaterial.mode==fo.MULTI_PASS){if(this._casterLightPass)this._pAddPass(this._casterLightPass);if(this._nonCasterLightPasses)for(var t=0;t<this._nonCasterLightPasses.length;++t)this._pAddPass(this._nonCasterLightPasses[t])}if(this._pass)this._pAddPass(this._pass)};r.prototype.initPasses=function(){if(this.numLights==0||this._methodMaterial.numEffectMethods>0||this._methodMaterial.mode==fo.SINGLE_PASS)this.initEffectPass();else if(this._pass)this.removeEffectPass();if(this._methodMaterial.shadowMethod&&this._methodMaterial.mode==fo.MULTI_PASS)this.initCasterLightPass();else if(this._casterLightPass)this.removeCasterLightPass();if(this.numNonCasters>0&&this._methodMaterial.mode==fo.MULTI_PASS)this.initNonCasterLightPasses();else if(this._nonCasterLightPasses)this.removeNonCasterLightPasses()};r.prototype.setBlendAndCompareModes=function(){var e=Boolean(this._casterLightPass||this._pass);if(this._casterLightPass){this._casterLightPass.forceSeparateMVP=e;this._casterLightPass.shader.setBlendMode(fe.NORMAL);this._casterLightPass.shader.depthCompareMode=this._methodMaterial.depthCompareMode}if(this._nonCasterLightPasses){var i=0;if(!this._casterLightPass){this._nonCasterLightPasses[0].forceSeparateMVP=e;this._nonCasterLightPasses[0].shader.setBlendMode(fe.NORMAL);this._nonCasterLightPasses[0].shader.depthCompareMode=this._methodMaterial.depthCompareMode;i=1}for(var r=i;r<this._nonCasterLightPasses.length;++r){this._nonCasterLightPasses[r].forceSeparateMVP=e;this._nonCasterLightPasses[r].shader.setBlendMode(fe.ADD);this._nonCasterLightPasses[r].shader.depthCompareMode=t.ContextGLCompareMode.LESS_EQUAL}}if(this._casterLightPass||this._nonCasterLightPasses){this._pRequiresBlending=false;if(this._pass){this._pass.mode=Qo.EFFECTS;this._pass.forceSeparateMVP=e;this._pass.shader.depthCompareMode=t.ContextGLCompareMode.LESS_EQUAL;this._pass.shader.setBlendMode(fe.LAYER)}}else if(this._pass){this._pRequiresBlending=this._methodMaterial.blendMode!=fe.NORMAL||this._methodMaterial.alphaBlending||this._methodMaterial.colorTransform&&this._methodMaterial.colorTransform.alphaMultiplier<1;this._pass.mode=Qo.SUPER_SHADER;this._pass.preserveAlpha=this._pRequiresBlending;this._pass.forceSeparateMVP=false;this._pass.colorTransform=this._methodMaterial.colorTransform;this._pass.shader.setBlendMode(this._methodMaterial.blendMode==fe.NORMAL&&this._pRequiresBlending?fe.LAYER:this._methodMaterial.blendMode);this._pass.shader.depthCompareMode=this._methodMaterial.depthCompareMode}};r.prototype.initCasterLightPass=function(){if(this._casterLightPass==null)this._casterLightPass=new Jo(Qo.LIGHTING,this,this._methodMaterial,this._materialPool);this._casterLightPass.lightPicker=new Fa([this._methodMaterial.shadowMethod.castingLight]);this._casterLightPass.shadowMethod=this._methodMaterial.shadowMethod;this._casterLightPass.diffuseMethod=this._methodMaterial.diffuseMethod;this._casterLightPass.ambientMethod=this._methodMaterial.ambientMethod;this._casterLightPass.normalMethod=this._methodMaterial.normalMethod;this._casterLightPass.specularMethod=this._methodMaterial.specularMethod};r.prototype.removeCasterLightPass=function(){this._casterLightPass.dispose();this._pRemovePass(this._casterLightPass);this._casterLightPass=null};r.prototype.initNonCasterLightPasses=function(){this.removeNonCasterLightPasses();var t;var e=this._methodMaterial.lightPicker.numDirectionalLights;var i=this._methodMaterial.lightPicker.numPointLights;var r=this._methodMaterial.lightPicker.numLightProbes;var n=0;var s=0;var a=0;if(!this._casterLightPass){e+=this._methodMaterial.lightPicker.numCastingDirectionalLights;i+=this._methodMaterial.lightPicker.numCastingPointLights}this._nonCasterLightPasses=new Array;while(n<e||s<i||a<r){t=new Jo(Qo.LIGHTING,this,this._methodMaterial,this._materialPool);t.includeCasters=this._methodMaterial.shadowMethod==null;t.directionalLightsOffset=n;t.pointLightsOffset=s;t.lightProbesOffset=a;t.lightPicker=this._methodMaterial.lightPicker;t.diffuseMethod=this._methodMaterial.diffuseMethod;t.ambientMethod=this._methodMaterial.ambientMethod;t.normalMethod=this._methodMaterial.normalMethod;t.specularMethod=this._methodMaterial.specularMethod;this._nonCasterLightPasses.push(t);n+=t.numDirectionalLights;s+=t.numPointLights;a+=t.numLightProbes}};r.prototype.removeNonCasterLightPasses=function(){if(!this._nonCasterLightPasses)return;for(var t=0;t<this._nonCasterLightPasses.length;++t)this._pRemovePass(this._nonCasterLightPasses[t]);this._nonCasterLightPasses=null};r.prototype.removeEffectPass=function(){if(this._pass.ambientMethod!=this._methodMaterial.ambientMethod)this._pass.ambientMethod.dispose();if(this._pass.diffuseMethod!=this._methodMaterial.diffuseMethod)this._pass.diffuseMethod.dispose();if(this._pass.specularMethod!=this._methodMaterial.specularMethod)this._pass.specularMethod.dispose();if(this._pass.normalMethod!=this._methodMaterial.normalMethod)this._pass.normalMethod.dispose();this._pRemovePass(this._pass);this._pass=null};r.prototype.initEffectPass=function(){if(this._pass==null)this._pass=new Jo(Qo.SUPER_SHADER,this,this._methodMaterial,this._materialPool);if(this._methodMaterial.mode==fo.SINGLE_PASS){this._pass.ambientMethod=this._methodMaterial.ambientMethod;this._pass.diffuseMethod=this._methodMaterial.diffuseMethod;this._pass.specularMethod=this._methodMaterial.specularMethod;this._pass.normalMethod=this._methodMaterial.normalMethod;this._pass.shadowMethod=this._methodMaterial.shadowMethod}else if(this._methodMaterial.mode==fo.MULTI_PASS){if(this.numLights==0){this._pass.ambientMethod=this._methodMaterial.ambientMethod}else{this._pass.ambientMethod=null}this._pass.preserveAlpha=false;this._pass.normalMethod=this._methodMaterial.normalMethod}var t=0;var e;var i=Math.max(this._methodMaterial.numEffectMethods,this._pass.numEffectMethods);while(t<i){e=this._methodMaterial.getEffectMethodAt(t);if(e!=this._pass.getEffectMethodAt(t)){this._pass.removeEffectMethodAt(t);if(e!=null){if(t<this._pass.numEffectMethods)this._pass.addEffectMethodAt(e,t);else this._pass.addEffectMethod(e)}}t++}};r.prototype.onClear=function(t){i.prototype.onClear.call(this,t)};return r}(Er);var eh=function(){function t(t){this._rgb=16777215;this._symbol=t;this._symbol._blockedByScript=true;this._target=t.adaptee.transform.colorTransform||(t.adaptee.transform.colorTransform=new C);this._transform={ra:100,rb:0,ga:100,gb:0,ba:100,bb:0,aa:100,ab:0}}t.prototype.getRGB=function(){return this._rgb};t.prototype.setRGB=function(t){this._rgb=t;var e=t>>16&255;var i=t>>8&255;var r=t&255;this.setTransform({ra:e/255*100,ga:i/255*100,ba:r/255*100,aa:100,rb:0,gb:0,bb:0,ab:0})};t.prototype.getTransform=function(){return this._transform};t.prototype.setTransform=function(t){this._transform=t;var e=this._target;e.redMultiplier=t.ra===undefined?1:t.ra/100;e.greenMultiplier=t.ga===undefined?1:t.ga/100;e.blueMultiplier=t.ba===undefined?1:t.ba/100;e.alphaMultiplier=t.aa===undefined?1:t.aa/100;e.redOffset=t.rb||0;e.greenOffset=t.gb||0;e.blueOffset=t.bb||0;e.alphaOffset=t.ab||0;this._symbol.adaptee.pInvalidateHierarchicalProperties(Fs.COLOR_TRANSFORM)};return t}();var ih=function(){function t(){}t.addListener=function(e){t._listeners.push(e)};t.removeListener=function(e){var i=t._listeners;var r=i.indexOf(e);if(r!=-1)i.splice(r,1)};t.isDown=function(e){return t._keys[e]};t.getCode=function(){return t._key};t.getAscii=function(){return t._char};t._onKeyDown=function(e){t._key=e.keyCode;t._char=e.charCode;t._keys[e.keyCode]=true;var i=t._listeners.length;for(var r=0;r<i;r++)if(t._listeners[r].onKeyDown)t._listeners[r].onKeyDown()};t._onKeyUp=function(e){t._keys[e.keyCode]=false;var i=t._listeners.length;for(var r=0;r<i;r++)if(t._listeners[r].onKeyUp)t._listeners[r].onKeyUp()};return t}();ih._keys=new Array;ih._listeners=new Array;ih._addListeners=function(){if(typeof document!=="undefined"){document.onkeydown=function(t){return ih._onKeyDown(t)};document.onkeyup=function(t){return ih._onKeyUp(t)}}}();ih.BACKSPACE=8;ih.CAPSLOCK=20;ih.CONTROL=17;ih.DELETEKEY=46;ih.DOWN=40;ih.END=35;ih.ENTER=13;ih.ESCAPE=27;ih.HOME=36;ih.INSERT=45;ih.LEFT=37;ih.PGDN=34;ih.PGUP=33;ih.RIGHT=39;ih.SHIFT=16;ih.SPACE=32;ih.TAB=9;ih.UP=38;var rh=function(t){e(i,t);function i(){var e=t.call(this)||this;e._volume=1;e._pan=1;e._changeEvent=new s(s.INVALIDATE,e);return e}i.prototype.dispose=function(){this._audio=null;this._changeEvent=null};Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(t){if(this._volume!=t){this._volume=t;this.dispatchEvent(this._changeEvent)}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"pan",{get:function(){return this._pan},set:function(t){if(this._pan!=t){this._pan=t;this.dispatchEvent(this._changeEvent)}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"audio",{get:function(){return this._audio},set:function(t){if(this._audio)this._audio.stop();this._audio=t},enumerable:true,configurable:true});return i}(h);var nh=function(){function t(){}t.addListener=function(e){t._globalListeners.push(e)};return t}();nh._globalListeners=[];var sh=function(){function t(e,i){this.__quality="high";this._adaptee=e;this._view=i;this._blockedByScript=false;if(t.REFERENCE_TIME===-1)t.REFERENCE_TIME=(new Date).getTime()}t.prototype.isBlockedByScript=function(){return this._blockedByScript};t.prototype.isVisibilityByScript=function(){return this._visibilityByScript};t.prototype.freeFromScript=function(){this._blockedByScript=false;this._visibilityByScript=false};t.prototype.dispose=function(){this._adaptee=null;this._view=null};t.prototype.getVersion=function(){return 0};Object.defineProperty(t.prototype,"adaptee",{get:function(){return this._adaptee},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_height",{get:function(){return this._adaptee.height},set:function(t){this._adaptee.height=t;this._blockedByScript=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_name",{get:function(){return this._adaptee.name},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_rotation",{get:function(){return this._adaptee.rotationZ},set:function(t){this._adaptee.rotationZ=t;this._blockedByScript=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_x",{get:function(){return this._adaptee.x},set:function(t){this._adaptee.x=t;this._blockedByScript=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_xmouse",{get:function(){return this._view.getLocalMouseX(this._adaptee)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_y",{get:function(){return this._adaptee.y},set:function(t){this._adaptee.y=t;this._blockedByScript=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_ymouse",{get:function(){return this._view.getLocalMouseY(this._adaptee)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_xscale",{get:function(){return this._adaptee.scaleX*100},set:function(t){this._adaptee.scaleX=t/100;this._blockedByScript=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_yscale",{get:function(){return this._adaptee.scaleY*100},set:function(t){this._adaptee.scaleY=t/100;this._blockedByScript=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_visible",{get:function(){return this._adaptee.visible},set:function(t){this._adaptee.visible=t;this._visibilityByScript=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_width",{get:function(){return this._adaptee.width},set:function(t){this._adaptee.width=t;this._blockedByScript=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_touchpoints",{get:function(){return this._view.getLocalTouchPoints(this._adaptee)},enumerable:true,configurable:true});t.prototype.getDepth=function(){return this._adaptee.z};Object.defineProperty(t.prototype,"_quality",{get:function(){return this.__quality},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"quality",{set:function(t){this.__quality=t},enumerable:true,configurable:true});t.prototype.trace=function(t){console.log(t)};t.prototype.getTimer=function(){return(new Date).getTime()-t.REFERENCE_TIME};Object.defineProperty(t.prototype,"_alpha",{get:function(){return this.adaptee.transform.colorTransform?this.adaptee.transform.colorTransform.alphaMultiplier*100:100},set:function(t){if(!this.adaptee.transform.colorTransform)this.adaptee.transform.colorTransform=new C;this.adaptee.transform.colorTransform.alphaMultiplier=t/100;this.adaptee.pInvalidateHierarchicalProperties(Fs.COLOR_TRANSFORM);this._blockedByScript=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_url",{get:function(){return document.URL},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_global",{get:function(){return null},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_level0",{get:function(){return this._root},enumerable:true,configurable:true});t.prototype.clearInterval=function(t){js.clearInterval(t);return};t.prototype.setInterval=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}var i;var r;if(typeof t[0]=="function"){i=this;r=t[0]}else{i=t.shift();r=i[t[0]]}t[0]=function(){r.apply(i,arguments)};return js.setInterval(t[0])};Object.defineProperty(t.prototype,"_level10301",{get:function(){return this._root},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_root",{get:function(){if(!this.__root){var t=this._parent;this.__root=t?t._root:this}return this.__root},enumerable:true,configurable:true});t.prototype.random=function(t){return Math.floor(Math.random()*t)};Object.defineProperty(t.prototype,"_parent",{get:function(){var t=this.adaptee.parent;return t?t.adapter:null},enumerable:true,configurable:true});return t}();sh.REFERENCE_TIME=-1;var ah=function(){function t(){}return t}();ah.security=null;ah.capabilities={version:6};var oh=function(){function t(e){var i=this;this._loop=false;this._name="";this._id=-1;this._playing=false;this._volume=0;this._id=t._soundIDCnt++;this._target=e;this._soundProps=e!=null&&e.__pSoundProps?this._target.__pSoundProps:t._globalSoundProps;this._onGlobalChangeDelegate=function(t){return i.onGlobalChange(t)};t._globalSoundProps.addEventListener(s.INVALIDATE,this._onGlobalChangeDelegate)}t.prototype.attachSound=function(t){this._name=t;var e=pt.getAsset(t);if(e)this._soundProps.audio=e.clone();this.updateVolume()};t.prototype.getPan=function(){return this._soundProps.pan};t.prototype.setPan=function(t){this._soundProps.pan=t};t.prototype.getVolume=function(){return this._soundProps.volume*100};t.prototype.setVolume=function(t){this._soundProps.volume=t/100;this.updateVolume()};t.prototype.start=function(t,e){if(t===void 0){t=0}if(e===void 0){e=0}this._playing=true;this._loop=Boolean(e>0);if(b.getExternalSoundInterface()){b.getExternalSoundInterface().startSound(this._name,this._id,this._volume,this._loop);return}if(this._soundProps.audio){this._soundProps.audio.play(t,this._loop);return}};t.prototype.stop=function(t){if(t===void 0){t=null}if(!this._playing)return;this._playing=false;if(b.getExternalSoundInterface()){b.getExternalSoundInterface().stopSound(this._id);return}else if(this._soundProps.audio){this._soundProps.audio.stop();return}};Object.defineProperty(t.prototype,"position",{get:function(){if(this._soundProps.audio)return this._soundProps.audio.currentTime;return 0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"duration",{get:function(){if(this._soundProps.audio)return this._soundProps.audio.duration;return 0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"id3",{get:function(){return{}},enumerable:true,configurable:true});t.prototype.onGlobalChange=function(t){this.updateVolume()};t.prototype.updateVolume=function(){var e=this._soundProps.volume*t._globalSoundProps.volume;if(e>1)e=1;if(e<0)e=0;e=Math.round(e*100)/100;if(this._volume==e)return;this._volume=e;if(b.getExternalSoundInterface()){if(this._playing)b.getExternalSoundInterface().updateSound(this._id,this._volume,this._loop)}else if(this._soundProps.audio)this._soundProps.audio.volume=this._volume};return t}();oh._globalSoundProps=new rh;oh._soundIDCnt=0;var hh=function(){function t(){}return t}();hh.showMenu=true;var uh=function(){function t(t){this._object_name=t;if(typeof Storage!=="undefined"){this.data=JSON.parse(localStorage.getItem(t));

}if(this.data==null){console.log("no shared object found");this.data={}}}t.getLocal=function(e,i,r){return new t(e)};t.prototype.flush=function(){if(typeof Storage!=="undefined"){localStorage.setItem(this._object_name,JSON.stringify(this.data))}else{console.log("no local storage available")}};return t}();var lh="var Color			= this._includes.Color;\n"+"var System				= this._includes.System;\n"+"var Sound				= this._includes.Sound;\n"+"var Key				= this._includes.Key;\n"+"var Mouse				= this._includes.Mouse;\n"+"var Stage				= this._includes.Stage;\n"+"var SharedObject		= this._includes.SharedObject;\n"+"var int = function(value) {return Math.floor(value) | 0;}\n"+"var string = function(value) {return value.toString();}\n"+"var getURL = function(value) {return value;}\n\n";var ph=function(t){e(i,t);function i(e,i){var r=t.call(this,e||new Aa,i)||this;r._includes={Color:eh,System:ah,Sound:oh,Key:ih,Mouse:nh,Stage:hh,SharedObject:uh};r.__pSoundProps=new rh;return r}i.prototype.dispose=function(){t.prototype.dispose.call(this);this.__pSoundProps.dispose();this.__pSoundProps=null};Object.defineProperty(i.prototype,"_framesloaded",{get:function(){return this.adaptee.numFrames},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"_currentframe",{get:function(){return this.adaptee.currentFrameIndex+1},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"_totalframes",{get:function(){return this.adaptee.numFrames},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"enabled",{get:function(){return this.adaptee.mouseEnabled},enumerable:true,configurable:true});i.prototype.evalScript=function(t){var e=document.createElement("script");e.text="var __framescript__ = function() {\n"+lh+t+"\n}";var i=document.scripts[0];i.parentNode.insertBefore(e,i).parentNode.removeChild(e);var r=__framescript__;window["__framescript__"]=null;return r};i.prototype.attachMovie=function(t,e,r,n){if(n===void 0){n=null}var s=pt.getAsset(t);var a=s.clone();var o=new i(a,this._view);this.adaptee.addChildAtDepth(o.adaptee,r);o.adaptee.name=e;this.registerScriptObject(o.adaptee);return s};i.prototype.createEmptyMovieClip=function(t,e){var r=new Aa;r.adapter=new i(r,this._view);r.name=t;this.adaptee.addChildAtDepth(r,e);this.registerScriptObject(r);return r.adapter};i.prototype.duplicateMovieClip=function(t,e,i){var r=this.adaptee.clone().adapter;r.adaptee.name=t;if(i)for(var n in i)if(r.hasOwnProperty(n))r[n]=i[n];this.adaptee.parent.addChildAtDepth(r.adaptee,e);return r};i.prototype.getBytesLoaded=function(){return 1};i.prototype.getBytesTotal=function(){return 1};i.prototype.getInstanceAtDepth=function(t){return this.adaptee.getChildAtDepth(t)};i.prototype.getNextHighestDepth=function(){return this.adaptee.getNextHighestDepth()};i.prototype.globalToLocal=function(t){var e=this.adaptee.globalToLocal(new z(t.x,t.y));t.x=e.x;t.y=e.y};i.prototype.gotoAndPlay=function(t){if(t==null)return;this.play();this._gotoFrame(t)};i.prototype.gotoAndStop=function(t){if(t==null)return;this.stop();this._gotoFrame(t)};i.prototype.play=function(){this.adaptee.play()};i.prototype.stop=function(){this.adaptee.stop()};i.prototype.hitTest=function(t,e,i){if(i===void 0){i=false}return this.adaptee.hitTestPoint(t,e,i)};i.prototype.localToGlobal=function(t){var e=this.adaptee.localToGlobal(new z(t.x,t.y));t.x=e.x;t.y=e.y};i.prototype.nextFrame=function(){++this.adaptee.currentFrameIndex};i.prototype.prevFrame=function(){--this.adaptee.currentFrameIndex};i.prototype.setMask=function(t){this.adaptee.masks=[t]};i.prototype.swapDepths=function(t){var e=this.adaptee.parent;if(e!=null&&t.parent==e)e.swapChildren(this.adaptee,t)};i.prototype.clone=function(t){return new i(t,this._view)};Object.defineProperty(i.prototype,"onEnterFrame",{get:function(){return this._onEnterFrame},set:function(t){this._onEnterFrame=this._replaceEventListener(s.ENTER_FRAME,this._onEnterFrame,t)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"onRollOut",{get:function(){return this._onRollOut},set:function(t){this._onRollOut=this._replaceEventListener(ya.MOUSE_OUT,this._onRollOut,t)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"onRollOver",{get:function(){return this._onRollOver},set:function(t){this._onRollOver=this._replaceEventListener(ya.MOUSE_OVER,this._onRollOver,t)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"onRelease",{get:function(){return this._onRelease},set:function(t){this._onRelease=this._replaceEventListener(ya.MOUSE_UP,this._onRelease,t)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"onPress",{get:function(){return this._onPress},set:function(t){this._onPress=this._replaceEventListener(ya.MOUSE_DOWN,this._onPress,t)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"onMouseDown",{get:function(){return this._onMouseDown},set:function(t){this._onMouseDown=this._replaceEventListener(ya.MOUSE_DOWN,this._onMouseDown,t)},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"onMouseUp",{get:function(){return this._onMouseUp},set:function(t){this._onMouseUp=this._replaceEventListener(ya.MOUSE_UP,this._onMouseUp,t)},enumerable:true,configurable:true});i.prototype.registerScriptObject=function(t){if(t.name)this[t.name]=t.adapter?t.adapter:t};i.prototype.unregisterScriptObject=function(t){delete this[t.name];if(t.isAsset(Aa))t.removeButtonListeners()};i.prototype._gotoFrame=function(t){var e=this.adaptee;if(typeof t==="string")e.jumpToLabel(t);else e.currentFrameIndex=t-1};i.prototype._replaceEventListener=function(t,e,i){var r=this.adaptee;if(e)r.removeEventListener(t,e);if(i){var n=this;var s=function(){return i.call(n)};r.addEventListener(t,s)}return s};return i}(sh);var ch=function(t){e(i,t);function i(e,i){return t.call(this,e||new Ca,i)||this}i.prototype.clone=function(t){return new i(t,this._view)};Object.defineProperty(i.prototype,"textColor",{get:function(){return this.adaptee.textColor},set:function(t){this.adaptee.textColor=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"embedFonts",{get:function(){return this._embedFonts},set:function(t){this._embedFonts=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"text",{get:function(){return this.adaptee.text},set:function(t){this.adaptee.text=t},enumerable:true,configurable:true});return i}(sh);var _h=function(){function t(t){this._view=t}t.prototype.createMovieClip=function(t){var e=new Aa(t);e.adapter=new ph(e,this._view);return e};t.prototype.createTextField=function(){var t=new Ca;t.adapter=new ch(t,this._view);return t};return t}();var fh=function(){function t(){}return t}();fh.BLOCKSTATE_FINALIZE=0;fh.BLOCKSTATE_INVALID=1;fh.BLOCKSTATE_LOAD_DEPENDENICES=2;fh.BLOCKSTATE_NO_ASSET=3;fh.COMPRESSIONMODE_LZMA="lzma";fh.UNCOMPRESSED=0;fh.DEFLATE=1;fh.LZMA=2;fh.INT8=1;fh.INT16=2;fh.INT32=3;fh.UINT8=4;fh.UINT16=5;fh.UINT32=6;fh.FLOAT32=7;fh.FLOAT64=8;fh.BOOL=21;fh.COLOR=22;fh.BADDR=23;fh.AWDSTRING=31;fh.AWDBYTEARRAY=32;fh.VECTOR2x1=41;fh.VECTOR3x1=42;fh.VECTOR4x1=43;fh.MTX3x2=44;fh.MTX3x3=45;fh.MTX4x3=46;fh.MTX4x4=47;var dh=function(){function t(t,e){this.type=e;this.id=t;this.state=fh.BLOCKSTATE_FINALIZE;this.dependencies_data=Array();this.dependencies_urls=Array();if(e==83){this.loaded_dependencies=Array(6)}this.loaded_dependencies_cnt=0}t.prototype.dispose=function(){this.id=null;this.bytes=null;this.errorMessages=null;this.uvsForVertexAnimation=null};t.prototype.addError=function(t){if(!this.errorMessages)this.errorMessages=new Array;this.errorMessages.push(t)};return t}();var gh=function(t){e(i,t);function i(e){if(e===void 0){e=null}var r=t.call(this,J.ARRAY_BUFFER)||this;r._debug=false;r._debugTimers=true;r._startedParsing=false;r._texture_users={};r._parsed_header=false;r._time_all=0;r._time_graphics=0;r._time_graphics_bytes=0;r._time_timeline=0;r._time_fonts=0;r._time_textfields=0;r._time_sounds=0;r._time_textures=0;r._time_materials=0;r._time_sprites=0;r._num_graphics=0;r._num_timeline=0;r._num_fonts=0;r._num_textfields=0;r._num_sounds=0;r._num_textures=0;r._num_materials=0;r._num_sprites=0;r.shadowMethodListProperties={1:i.BADDR,2:i.BADDR,3:i.BADDR,101:i.PROPERTY_NUMBER,102:i.PROPERTY_NUMBER,103:i.PROPERTY_NUMBER,201:i.UINT32,202:i.UINT32,301:i.UINT16,302:i.UINT16,401:i.UINT8,402:i.UINT8,601:i.COLOR,602:i.COLOR,701:i.BOOL,702:i.BOOL,801:i.MTX4x4};r.spritePoseAnimationProperties={1:i.BOOL,2:i.BOOL};r.sharedMethodListProperties={1:i.BADDR,2:i.BADDR,3:i.BADDR,101:i.PROPERTY_NUMBER,102:i.PROPERTY_NUMBER,103:i.PROPERTY_NUMBER,104:i.PROPERTY_NUMBER,105:i.PROPERTY_NUMBER,106:i.PROPERTY_NUMBER,107:i.PROPERTY_NUMBER,201:i.UINT32,202:i.UINT32,301:i.UINT16,302:i.UINT16,401:i.UINT8,402:i.UINT8,601:i.COLOR,602:i.COLOR,701:i.BOOL,702:i.BOOL};r._view=e;r._blocks=new Array;r._blocks[0]=new dh(0,255);r._blocks[0].data=null;r.blendModeDic=new Array;r.blendModeDic.push(fe.NORMAL);r.blendModeDic.push(fe.ADD);r.blendModeDic.push(fe.ALPHA);r.blendModeDic.push(fe.DARKEN);r.blendModeDic.push(fe.DIFFERENCE);r.blendModeDic.push(fe.ERASE);r.blendModeDic.push(fe.HARDLIGHT);r.blendModeDic.push(fe.INVERT);r.blendModeDic.push(fe.LAYER);r.blendModeDic.push(fe.LIGHTEN);r.blendModeDic.push(fe.MULTIPLY);r.blendModeDic.push(fe.NORMAL);r.blendModeDic.push(fe.OVERLAY);r.blendModeDic.push(fe.SCREEN);r.blendModeDic.push(fe.SHADER);r.blendModeDic.push(fe.OVERLAY);r._depthSizeDic=new Array;r._depthSizeDic.push(256);r._depthSizeDic.push(512);r._depthSizeDic.push(2048);r._depthSizeDic.push(1024);r._version=Array();return r}i.supportsType=function(t){t=t.toLowerCase();return t=="awd"};i.supportsData=function(t){return yt.toString(t,3)=="AWD"};i.prototype._iResolveDependency=function(t){if(t.assets.length==1){var e=this._blocks[parseInt(t.id)];if(e.type==82){var i=t.assets[0];e.data=i;this._pFinalizeAsset(i,e.name);if(this._debug)console.log("Parsed Texture: Name = "+e.name)}else if(e.type==44){var r=t.assets[0];e.data=r;this._pFinalizeAsset(r,e.name);if(this._debug)console.log("Parsed WaveAudio: Name = "+e.name)}else if(e.type==83){e.loaded_dependencies[t.sub_id]=t.assets[0];e.loaded_dependencies_cnt++;if(this._debug)console.log("Successfully loaded Bitmap "+t.sub_id+" / 6 for Cubetexture");if(e.loaded_dependencies_cnt==6){var n=new _e(e.loaded_dependencies[0].width);for(var s=0;s<6;s++)n.draw(s,e.loaded_dependencies[s]);e.data=n;this._pFinalizeAsset(n,e.name);if(this._debug)console.log("Parsed CubeTexture: Name = "+e.name)}}if(this._debugTimers&&!this._isParsing)this.updateTimers(e.type)}};i.prototype._iResolveDependencyFailure=function(t){};i.prototype._iResolveDependencyName=function(t,e){var i=e.name;if(e){var r=this._blocks[parseInt(t.id)];e.resetAssetPath(r.name,null,true)}var n=e.name;e.name=i;return n};i.prototype._pProceedParsing=function(){if(!this._startedParsing){this._byteData=this._pGetByteData();this._startedParsing=true}if(!this._parsed_header){this.parseHeader();switch(this._compression){case i.DEFLATE:case i.LZMA:this._pDieWithError("Compressed AWD formats not yet supported");break;case i.UNCOMPRESSED:this._body=this._byteData;break}this._parsed_header=true}if(this._body){while(this._body.getBytesAvailable()>0&&!this.parsingPaused)this.parseNextBlock();if(this._body.getBytesAvailable()==0){this.dispose();if(this._debugTimers)console.log("Parsing total: "+(this._time_all|0)+"ms"," | graphics: "+this._num_graphics+", "+(this._time_graphics|0)+"ms"," | graphics bytes: "+this._num_graphics+", "+(this._time_graphics_bytes|0)+"ms"," | timelines: "+this._num_timeline+", "+(this._time_timeline|0)+"ms"," | fonts: "+this._num_fonts+", "+(this._time_fonts|0)+"ms"," | sounds: "+this._num_sounds+", "+(this._time_sounds|0)+"ms"," | mats: "+this._num_materials+", "+(this._time_materials|0)+"ms"," | textures: "+this._num_textures+", "+(this._time_textures|0)+"ms"," | sprites: "+this._num_sprites+", "+(this._time_sprites|0)+"ms");return bt.PARSING_DONE}else{return bt.MORE_TO_PARSE}}else{switch(this._compression){case i.DEFLATE:case i.LZMA:if(this._debug)console.log("(!) AWDParser Error: Compressed AWD formats not yet supported (!)");break}return bt.PARSING_DONE}};i.prototype._pStartParsing=function(e){this._pContent=new Xs;t.prototype._pStartParsing.call(this,e)};i.prototype.dispose=function(){for(var t in this._blocks){var e=this._blocks[t];e.dispose()}};i.prototype.parseNextBlock=function(){var t;var e=false;var i;var r;var n;var s;if(this._debugTimers)this.start_timeing=performance.now();this._cur_block_id=this._body.readUnsignedInt();i=this._body.readUnsignedByte();r=this._body.readUnsignedByte();n=this._body.readUnsignedByte();s=this._body.readUnsignedInt();var a=vh.test(n,vh.FLAG4);var o=vh.test(n,vh.FLAG5);if(this._accuracyOnBlocks){this._accuracyMatrix=vh.test(n,vh.FLAG1);this._accuracyGeo=vh.test(n,vh.FLAG2);this._accuracyProps=vh.test(n,vh.FLAG3)}var h=this._body.position+s;if(s>this._body.getBytesAvailable()){this._pDieWithError("AWD2 block length is bigger than the bytes that are available!");this._body.position+=this._body.getBytesAvailable();return}if(a){this._pDieWithError("Compressed AWD formats not yet supported");this._newBlockBytes=new mt;this._body.readBytes(this._newBlockBytes,0,s);this._newBlockBytes.position=0}else{this._newBlockBytes=this._body}t=new dh(this._cur_block_id,r);t.len=s;var u=this._newBlockBytes.position+s;if(a){this._pDieWithError("Compressed AWD formats not yet supported")}if(this._debug)console.log("AWDBlock:  ID = "+this._cur_block_id+" | TypeID = "+r+" | Compression = "+a+" | Matrix-Precision = "+this._accuracyMatrix+" | Graphics-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps);this._blocks[this._cur_block_id]=t;if(this._version[0]==3&&this._version[1]==0){var l=new _h(this._view);switch(r){case 24:this.parseSpriteLibraryBlock(this._cur_block_id);e=true;break;case 25:this.parseBillBoardLibraryBlock(this._cur_block_id);e=true;break;case 44:this.parseAudioBlock(this._cur_block_id,l);e=true;break;case 133:this.parseMovieClip(this._cur_block_id,l);e=true;break;case 134:this.parseTextField(this._cur_block_id,l);e=true;break;case 135:this.parseTesselatedFont(this._cur_block_id);e=true;break;case 136:this.parseTextFormat(this._cur_block_id);e=true;break}}if(this._version[0]>2||this._version[0]>=2&&this._version[1]>=1){switch(r){case 11:this.parsePrimitves(this._cur_block_id);e=true;break;case 31:this.parseSkyboxInstance(this._cur_block_id);e=true;break;case 41:this.parseLight(this._cur_block_id);e=true;break;case 42:this.parseCamera(this._cur_block_id);e=true;break;case 51:this.parseLightPicker(this._cur_block_id);e=true;break;case 81:this.parseMaterial_v1(this._cur_block_id);e=true;break;case 83:this.parseCubeTexture(this._cur_block_id);e=true;break;case 91:this.parseSharedMethodBlock(this._cur_block_id);e=true;break;case 92:this.parseShadowMethodBlock(this._cur_block_id);e=true;break;case 111:this.parseSpritePoseAnimation(this._cur_block_id,true);e=true;break;case 112:this.parseSpritePoseAnimation(this._cur_block_id);e=true;break;case 113:this.parseVertexAnimationSet(this._cur_block_id);e=true;break;case 122:this.parseAnimatorSet(this._cur_block_id);e=true;break;case 253:this.parseCommand(this._cur_block_id);e=true;break}}if(e==false){switch(r){case 1:this.parseGraphics(this._cur_block_id);break;case 22:this.parseContainer(this._cur_block_id);break;case 23:this.parseSpriteInstance(this._cur_block_id);break;case 81:this.parseMaterial(this._cur_block_id);break;case 82:this.parseTexture(this._cur_block_id);break;case 101:this.parseSkeleton(this._cur_block_id);break;case 102:this.parseSkeletonPose(this._cur_block_id);break;case 103:this.parseSkeletonAnimation(this._cur_block_id);break;case 121:case 254:this.parseNameSpace(this._cur_block_id);break;case 255:this.parseMetaData(this._cur_block_id);break;default:if(this._debug)console.log("AWDBlock:   Unknown BlockType  (BlockID = "+this._cur_block_id+") - Skip "+s+" bytes");this._newBlockBytes.position+=s;break}}if(this._debug){if(this._newBlockBytes.position!=u)console.log("  (!)(!)(!) Error while reading AWDBlock ID "+this._cur_block_id+" = skip to next block");if(t.errorMessages){var s=t.errorMessages.length;for(var p=0;p<s;p++)console.log("        (!) Error: "+t.errorMessages[p]+" (!)")}console.log("\n")}if(this._debugTimers&&!this.parsingPaused)this.updateTimers(r);this._body.position=h;this._newBlockBytes=null};i.prototype.updateTimers=function(t){var e=performance.now();var i=e-this.start_timeing;this._time_all+=i;if(t==1){this._time_graphics+=i;this._num_graphics++}else if(t==133){this._time_timeline+=i;this._num_timeline++}else if(t==135){this._time_fonts+=i;this._num_fonts++}else if(t==134){this._time_textfields+=i;this._num_textfields++}else if(t==44){this._time_sounds+=i;this._num_sounds++}else if(t==82){this._time_textures+=i;this._num_textures++}else if(t==81){this._time_materials+=i;this._num_materials++}else if(t==24){this._time_sprites+=i;this._num_sprites++}};i.prototype.parseTesselatedFont=function(t){var e=this.parseVarStr();this._blocks[t].name=e;var i=pt.getAsset(this._blocks[t].name);var r=false;if(i==undefined){i=new Wa;r=true}var n=this._newBlockBytes.readUnsignedInt();var s;var a;var o;var h;var l=0;var p;var c;var _,f,d,g;for(var m=0;m<n;++m){a=this.parseVarStr();o=i.get_font_table(a,xa.assetType);o.set_font_em_size(this._newBlockBytes.readUnsignedInt());o.set_whitespace_width(this._newBlockBytes.readUnsignedInt());o.ascent=this._newBlockBytes.readFloat();o.descent=this._newBlockBytes.readFloat();s=this._newBlockBytes.readUnsignedInt();for(var y=0;y<s;++y){h=this._newBlockBytes.readUnsignedInt();var v=this._newBlockBytes.readFloat();p=this._newBlockBytes.readUnsignedInt();c=this._newBlockBytes.position+p;while(this._newBlockBytes.position<c){f=this._newBlockBytes.readUnsignedByte();_=this._newBlockBytes.readUnsignedByte();d=this._newBlockBytes.readUnsignedInt();g=this._newBlockBytes.position+d;if(f==12){l=12;var x=new mt(d);this._newBlockBytes.readBytes(x,0,d)}else if(f==16){l=8;var x=new mt(d);this._newBlockBytes.readBytes(x,0,d)}else{this._newBlockBytes.position=g}}if(x){var b=new u(l,d/l);b.bufferView=new Uint8Array(x.arraybytes);o.setChar(h.toString(),v,b,null,l!=8)}}}this.parseProperties(null);this.parseUserAttributes();if(r){this._pFinalizeAsset(i,e)}this._blocks[t].data=i;if(this._debug)console.log("Parsed a font: Name = '"+e)};i.prototype.parseTextFormat=function(t){var e=this.parseVarStr();this._blocks[t].name=e;var r=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var n=this.parseVarStr();var s=new Ka;s.font_name=r.name;var a=r.get_font_table(n);if(a!=null){s.font_style=n;s.font_table=a}var o=this._blocks[this._newBlockBytes.readUnsignedInt()].data;o.bothSides=true;var h=this._newBlockBytes.readUnsignedByte();var u=[];for(var l=0;l<h;l++)u[l]=this._newBlockBytes.readFloat();s.uv_values=u;var p=this.parseProperties(i.textFormatProperties);s.size=p.get(1,12);s.letterSpacing=p.get(2,0);s.kerning=p.get(4,true);var c=p.get(6,0);if(c==1){s.align="right"}else if(c==2){s.align="center"}else if(c==3){s.align="justify"}s.indent=p.get(7,0);s.leftMargin=p.get(8,0);s.rightMargin=p.get(9,0);s.leading=p.get(10,0);s.color=p.get(11,0);s.material=o;this.parseUserAttributes();this._pFinalizeAsset(s,e);this._blocks[t].data=s;if(this._debug)console.log("Parsed a TextFormat: Name = '"+e+" font: "+r.name)};i.prototype.parseTextField=function(t,e){var r=this.parseVarStr();this._blocks[t].name=r;var n=e.createTextField();var s=this._newBlockBytes.readUnsignedByte();n.type=i.textFieldTypes[s];if(s==3)n.displayAsPassword=true;n.textWidth=Math.abs(this._newBlockBytes.readFloat());n.textHeight=Math.abs(this._newBlockBytes.readFloat());var a=this._newBlockBytes.readUnsignedInt();var o="";for(var h=0;h<a;h++){var u=this._newBlockBytes.readUnsignedInt();for(var l=0;l<u;l++){var p=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var c=this._newBlockBytes.readUnsignedInt();if(c>0){var _=this._newBlockBytes.readUTFBytes(c);o+=_}}}n.textFormat=p;n.text=o;var f=this.parseProperties(i.textFieldProperties);n.selectable=f.get(1,false);n.border=f.get(3,false);n.extra=this.parseUserAttributes();this._pFinalizeAsset(n,r);this._blocks[t].data=n;if(this._debug)console.log("Parsed a TextField: Name = '"+r+"| text  = "+o)};i.prototype.parseBillBoardLibraryBlock=function(t){var e=this.parseVarStr();var i=this._blocks[this._newBlockBytes.readUnsignedInt()].data;i.bothSides=true;var r=new zs(i);this.parseProperties(null);r.extra=this.parseUserAttributes();this._pFinalizeAsset(r,e);this._blocks[t].data=r;if(this._debug)console.log("Parsed a Library-Billboard: Name = '"+e+"| Material-Name = "+i.name)};i.prototype.parseSpriteLibraryBlock=function(t){var e=this.parseVarStr();var r=this._newBlockBytes.readUnsignedInt();var n=this._blocks[r].data;this._blocks[t].geoID=r;var s=this._newBlockBytes.readUnsignedShort();var a=new Array;var o=new Array;var h;for(var u=0;u<s;u++){h=this._blocks[this._newBlockBytes.readUnsignedInt()].data||we.getDefaultMaterial();h.useColorTransform=true;a[u]=h;o[u]=h.name}var l=performance.now();var p=new Ws;n.copyTo(p.graphics);var c=performance.now();var _=c-l;this._time_graphics_bytes+=_;if(a.length>=1&&p.graphics.count==1){p.material=a[0]}else if(a.length>1){for(var f=0;f<p.graphics.count;f++)p.graphics.getShapeAt(f).material=a[Math.min(a.length-1,f)]}var d;var g;var m;var y=this._newBlockBytes.readUnsignedShort();for(var f=0;f<y;f++){var v=this._newBlockBytes.readUnsignedByte();d=new re;g=p.graphics.getShapeAt(f);m=g.material||p.material;if(g){g.style=new Gt;g.style.addSamplerAt(d,m.getTextureAt(0))}if(v==3){var x=this._newBlockBytes.readFloat();var b=this._newBlockBytes.readFloat();if(g){m.animateUVs=true;g.style.uvMatrix=new j(0,0,0,0,x,b)}}else if(v==4){var w=this.parseMatrix32RawData();if(g){m.animateUVs=true;g.style.uvMatrix=new j(w)}}else if(v==5){var D=new j(this._newBlockBytes.readFloat(),this._newBlockBytes.readFloat(),0,0,this._newBlockBytes.readFloat(),this._newBlockBytes.readFloat());if(g){m.animateUVs=true;g.style.uvMatrix=D}}else if(v==6){var C=this._newBlockBytes.readFloat();var T=this._newBlockBytes.readFloat();var P=this._newBlockBytes.readFloat();var S=this._newBlockBytes.readFloat();var w=this.parseMatrix32RawData();if(g){d.imageRect=new Y(C,T,P,S);m.imageRect=true;m.animateUVs=true;g.style.uvMatrix=new j(w)}}if(g){if(g.elements.getCustomAtributes("curves"))m.curves=true}this._newBlockBytes.readUnsignedInt()}var E=this.parseProperties(i.spriteLibraryProperties);p.registrationPoint=new A(E.get(1,0),E.get(2,0),0);p.registrationScale=new A(E.get(3,1),E.get(4,1),1);p.extra=this.parseUserAttributes();this._pFinalizeAsset(p,e);this._blocks[t].data=p;if(this._debug)console.log("Parsed a Library-Sprite: Name = '"+e+"| Graphics-Name = "+n.name+" | Graphics-Count = "+p.graphics.count+" | Mat-Names = "+o)};i.prototype.parseAudioBlock=function(t,e){this._blocks[t].name=this.parseVarStr();var i=this._newBlockBytes.readUnsignedByte();var r;if(i==0){r=this._newBlockBytes.readUnsignedInt();var n;n=this._newBlockBytes.readUTFBytes(r);this._pAddDependency(this._cur_block_id.toString(),new dt(n),false,null,true)}else{r=this._newBlockBytes.readUnsignedInt();var s=new mt(r);this._newBlockBytes.readBytes(s,0,r);this._pAddDependency(this._cur_block_id.toString(),null,false,s,true)}this.parseProperties(null);this._blocks[t].extras=this.parseUserAttributes();this._pPauseAndRetrieveDependencies();if(this._debug)console.log("Start parsing a "+["external","embed"][i]+" Audio file")};i.prototype.parseMovieClip=function(t,e){var r;var n;var s;var a=new Gs;var o=e.createMovieClip(a);var h=this.parseVarStr();var u=this._newBlockBytes.readUnsignedShort();for(r=0;r<u;r++){s=this._blocks[this._newBlockBytes.readUnsignedInt()].data;if(s!=null){a.registerPotentialChild(s)}else{console.log("ERROR when collecting objects for timeline")}}var l=u;var p=this._newBlockBytes.readUnsignedShort();for(r=0;r<p;r++){s=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var c=this._newBlockBytes.readUnsignedShort();l+=c;if(s!=null){for(n=0;n<c;n++)a.registerPotentialChild(s)}else{for(n=0;n<c;n++){console.log("ERROR when collecting objects for timeline")}}}if(this._debug)console.log("Parsed "+(u+p)+" potential childs. They will be used by "+l+" instances.");var _=this._newBlockBytes.readUnsignedShort();var f=this._newBlockBytes.readUnsignedByte();var d=0;var g=0;var m=0;var y=0;for(r=0;r<f;r++){if(y<6)m=y;else m=this._newBlockBytes.readUnsignedByte();g=this._newBlockBytes.readUnsignedByte();d=this._newBlockBytes.readUnsignedInt();if(d>0){var v=new mt(d);this._newBlockBytes.readBytes(v,0,d);var x;switch(g){case 1:x=new Uint8Array(v.arraybytes);break;case 2:x=new Uint16Array(v.arraybytes);break;case 4:x=new Uint32Array(v.arraybytes);break}switch(m){case 0:a.keyframe_durations=x;a.numKeyFrames=d/g;break;case 1:a.frame_command_indices=x;break;case 2:a.frame_recipe=x;break;case 3:a.command_length_stream=x;break;case 4:a.command_index_stream=x;break;case 5:a.add_child_stream=x;break;case 6:a.remove_child_stream=x;break;case 7:a.update_child_stream=x;break;case 8:a.update_child_props_indices_stream=x;break;case 9:a.update_child_props_length_stream=x;break;case 10:a.property_type_stream=x;break;case 11:a.property_index_stream=x;break;case 12:a.properties_stream_int=x;break}}y++}var b=0;var w;f=this._newBlockBytes.readUnsignedByte();for(r=0;r<f;r++){m=this._newBlockBytes.readUnsignedByte();d=this._newBlockBytes.readUnsignedInt();switch(m){case 0:w=new mt(d);this._newBlockBytes.readBytes(w,0,d);a.properties_stream_f32_mtx_scale_rot=new Float32Array(w.arraybytes);break;case 1:w=new mt(d);this._newBlockBytes.readBytes(w,0,d);a.properties_stream_f32_mtx_pos=new Float32Array(w.arraybytes);break;case 2:w=new mt(d);this._newBlockBytes.readBytes(w,0,d);a.properties_stream_f32_mtx_all=new Float32Array(w.arraybytes);break;case 3:w=new mt(d);this._newBlockBytes.readBytes(w,0,d);a.properties_stream_f32_ct=new Float32Array(w.arraybytes);break;case 4:d=this._newBlockBytes.readUnsignedShort();for(b=0;b<d;b++){a._labels[this.parseVarStr()]=this._newBlockBytes.readUnsignedShort()}break;case 5:d=this._newBlockBytes.readUnsignedShort();var D=[];for(b=0;b<d;b++){D.push(this._newBlockBytes.readUTFBytes(this._newBlockBytes.readUnsignedShort()))}a.properties_stream_strings=D;break;case 6:d=this._newBlockBytes.readUnsignedShort();for(b=0;b<d;b++){var C=this._newBlockBytes.readUnsignedShort();var A=this._newBlockBytes.readUnsignedInt();a.add_framescript(this._newBlockBytes.readUTFBytes(A),C)}break}}a.init();var T=0;var P=25;this.parseProperties(i.movieClipProperties);this.parseUserAttributes();this._pFinalizeAsset(o,h);this._blocks[t].data=o;if(this._debug)console.log("Parsed a TIMELINE: Name = "+h+"| sceneID = "+T+"| numFrames = "+o.timeline.numFrames)};i.prototype.parseGraphics=function(t){var e=new qe;var r=this.parseVarStr();var n=this._newBlockBytes.readUnsignedShort();var s=this.parseProperties(i.graphicsProperties);var a=s.get(1,1);var o=s.get(2,1);var h=0;var l=0;var p=mh.STANDART_STREAMS;var _=null;_=null;for(var g=0;g<n;g++){var y=0;var v,x;var b;var w;h=0;l=0;p=mh.STANDART_STREAMS;v=this._newBlockBytes.readUnsignedInt();x=this._newBlockBytes.position+v;var D=this.parseProperties(i.elementsProperties);while(this._newBlockBytes.position<x){var C=0;var A,T,P,S;T=this._newBlockBytes.readUnsignedByte();A=this._newBlockBytes.readUnsignedByte();P=this._newBlockBytes.readUnsignedInt();S=this._newBlockBytes.position+P;var E,M,O;if(T==1){var I=[];while(this._newBlockBytes.position<S){E=this.readNumber(this._accuracyGeo);M=this.readNumber(this._accuracyGeo);O=this.readNumber(this._accuracyGeo);I[C++]=E;I[C++]=M;I[C++]=O}}else if(T==2){var R=[];while(this._newBlockBytes.position<S)R[C++]=this._newBlockBytes.readUnsignedShort()}else if(T==3){var L=[];while(this._newBlockBytes.position<S)L[C++]=this.readNumber(this._accuracyGeo)}else if(T==4){var N=[];while(this._newBlockBytes.position<S)N[C++]=this.readNumber(this._accuracyGeo)}else if(T==6){b=Array();while(this._newBlockBytes.position<S)b[C++]=this._newBlockBytes.readUnsignedShort()*3}else if(T==7){w=[];while(this._newBlockBytes.position<S)w[C++]=this.readNumber(this._accuracyGeo)}else if(T==8){this._newBlockBytes.position=S}else if(T==9){this._newBlockBytes.position=S}else if(T==10){p=mh.CONCENATED_STREAMS;y=28;var F=new mt(P);this._newBlockBytes.readBytes(F,0,P)}else if(T==11){p=mh.CONCENATED_STREAMS;y=20;var F=new mt(P);this._newBlockBytes.readBytes(F,0,P)}else if(T==12){p=mh.CONCENATED_STREAMS;y=12;var F=new mt(P);this._newBlockBytes.readBytes(F,0,P)}else if(T==13){p=mh.SHARED_BUFFER;var B=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var V=this._newBlockBytes.readUnsignedByte();_=B.getShapeAt(V).elements;h=this._newBlockBytes.readUnsignedInt();l=this._newBlockBytes.readUnsignedInt()}else if(T==14){p=mh.CONCATENATED_SUBGEO;y=8;var U=new mt(P);this._newBlockBytes.readBytes(U,0,P)}else if(T==15){p=mh.SHARED_INDEXBUFFER;h=this._newBlockBytes.readUnsignedInt();l=this._newBlockBytes.readUnsignedInt()}else if(T==16){p=mh.CONCENATED_STREAMS;y=8;var F=new mt(P);this._newBlockBytes.readBytes(F,0,P)}else if(T==17){p=mh.CONCENATED_STREAMS_UINT16;y=4;var F=new mt(P);this._newBlockBytes.readBytes(F,0,P)}else if(T==18){p=mh.CONCENATED_STREAMS_UINT16;y=8;var F=new mt(P);this._newBlockBytes.readBytes(F,0,P)}else{console.log("skipping unknown subgeom stream");this._newBlockBytes.position=S}}this.parseUserAttributes();if(p==mh.CONCENATED_STREAMS){var k=new u(y,P/y);k.bufferView=new Uint8Array(F.arraybytes);var z=new $t(k);z.setPositions(new f(k));if(y==20){z.setCustomAttributes("curves",new d(k))}else if(y==12){z.setCustomAttributes("curves",new c(k,false))}if(y==28)z.setUVs(new f(k));e.addShape(new jt(z));if(this._debug)console.log("Parsed a TriangleElements with curves")}else if(p==mh.CONCENATED_STREAMS_UINT16){var k=new u(y,P/y);k.bufferView=new Uint8Array(F.arraybytes);var z=new $t(k);z.setPositions(new m(k,true));if(y==8){z.setCustomAttributes("curves",new c(k,false))}e.addShape(new jt(z));if(this._debug)console.log("Parsed a TriangleElements uint16")}else if(p==mh.STANDART_STREAMS){var j=new $t(new u);if(w)j.jointsPerVertex=w.length/(I.length/3);if(N)j.autoDeriveNormals=false;j.autoDeriveTangents=true;j.setIndices(R);j.setPositions(I);j.setNormals(N);j.setUVs(L);j.setJointWeights(w);j.setJointIndices(b);var G=D.get(1,1);var H=D.get(2,1);var X=false;if(a!=G||o!=H){X=true;G=a/G;H=o/H}if(X)j.scaleUV(G,H);e.addShape(new jt(j));if(this._debug)console.log("Parsed a TriangleElements")}else if(p==mh.CONCATENATED_SUBGEO){var k=new u(y,P/y);k.bufferView=new Uint8Array(U.arraybytes);var j=new $t(k);j.setPositions(new f(k));j.setIndices(R);var G=D.get(1,1);var H=D.get(2,1);var X=false;if(a!=G||o!=H){X=true;G=a/G;H=o/H}if(X)j.scaleUV(G,H);_=j}else if(p==mh.SHARED_INDEXBUFFER){var W=e.addShape(new jt(_));W.offset=h/3;W.count=l/3}else if(p==mh.SHARED_BUFFER){var W=e.addShape(new jt(_));W.offset=h;W.count=l;if(this._debug)console.log("Parsed a TriangleElements that shares index buffer from target geom")}}if(a!=1||o!=1)e.scaleUV(a,o);this.parseUserAttributes();this._pFinalizeAsset(e,r);this._blocks[t].data=e;if(this._debug)console.log("Parsed Graphics: Name = "+r)};i.prototype.parsePrimitves=function(t){var e;var r;var n;var s;var a;var o;e=this.parseVarStr();n=this._newBlockBytes.readUnsignedByte();a=this.parseProperties(i.primitiveProperties);switch(n){case 1:r=new ja(null,Ne.TRIANGLE,a.get(101,100),a.get(102,100),a.get(301,1),a.get(302,1),a.get(701,true),a.get(702,false));break;case 2:r=new Ks(null,Ne.TRIANGLE,a.get(101,100),a.get(102,100),a.get(103,100),a.get(301,1),a.get(302,1),a.get(303,1),a.get(701,true));break;case 3:r=new $s(null,Ne.TRIANGLE,a.get(101,50),a.get(301,16),a.get(302,12),a.get(701,true));break;case 4:r=new ka(null,Ne.TRIANGLE,a.get(101,50),a.get(102,50),a.get(103,100),a.get(301,16),a.get(302,1),true,true,true);if(!a.get(701,true))r.topClosed=false;if(!a.get(702,true))r.bottomClosed=false;

if(!a.get(703,true))r.yUp=false;break;case 5:r=new za(null,Ne.TRIANGLE,a.get(101,50),a.get(102,100),a.get(301,16),a.get(302,1),a.get(701,true),a.get(702,true));break;case 6:r=new Ua(null,Ne.TRIANGLE,a.get(101,50),a.get(102,100),a.get(301,16),a.get(302,15),a.get(701,true));break;case 7:r=new Ha(null,Ne.TRIANGLE,a.get(101,50),a.get(102,50),a.get(301,16),a.get(302,8),a.get(701,true));break;default:r=new Ys;console.log("ERROR: UNSUPPORTED PREFAB_TYPE");break}if(a.get(110,1)!=1||a.get(111,1)!=1){}this.parseUserAttributes();r.name=e;this._pFinalizeAsset(r,e);this._blocks[t].data=r;if(this._debug){if(n<0||n>7)n=0;console.log("Parsed a Primivite: Name = "+e+"| type = "+i.primitiveTypes[n])}};i.prototype.parseContainer=function(t){var e;var r;var n;var s=this._blocks[this._newBlockBytes.readUnsignedInt()].data;r=this.parseMatrix3D();e=this.parseVarStr();var a="Root (TopLevel)";n=new Xs;n.transform.matrix3D=r;if(s){s.addChild(n);a=s.name}else{this._pContent.addChild(n)}if(this._version[0]==2&&this._version[1]==1){var o=this.parseProperties(i.containerProperties);n.registrationPoint=new A(o.get(1,0),o.get(2,0),o.get(3,0))}else{this.parseProperties(null)}n.extra=this.parseUserAttributes();this._pFinalizeAsset(n,e);this._blocks[t].data=n;if(this._debug)console.log("Parsed a Container: Name = '"+e+"' | Parent-Name = "+a)};i.prototype.parseSpriteInstance=function(t){var e=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var r=this.parseMatrix3D();var n=this.parseVarStr();var s=this._newBlockBytes.readUnsignedInt();var a=this._blocks[s].data;var o;var h;var u=false;if(a.isAsset(qe)){o=a}else{u=true;h=a}this._blocks[t].geoID=s;var l=this._newBlockBytes.readUnsignedShort();var p=new Array;var c=new Array;var _;for(var f=0;f<l;f++){_=this._blocks[this._newBlockBytes.readUnsignedInt()].data||we.getDefaultMaterial();p[f]=_;c[f]=_.name}var d;if(u){d=h.getNewObject()}else{d=new Ws;o.copyTo(d.graphics)}d.transform.matrix3D=r;var g="Root (TopLevel)";if(e){e.addChild(d);g=e.name}else{this._pContent.addChild(d)}if(p.length>=1&&d.graphics.count==1){d.material=p[0]}else if(p.length>1){for(var m=0;m<d.graphics.count;m++)d.graphics.getShapeAt(m).material=p[Math.min(p.length-1,m)]}if(this._version[0]==2&&this._version[1]==1){var y=this.parseProperties(i.spriteInstanceProperties);d.registrationPoint=new A(y.get(1,0),y.get(2,0),y.get(3,0));d.castsShadows=y.get(5,true)}else{this.parseProperties(null)}d.extra=this.parseUserAttributes();this._pFinalizeAsset(d,n);this._blocks[t].data=d;if(this._debug){if(u)console.log("Parsed a Sprite for Prefab: Name = '"+n+"' | Parent-Name = "+g+"| Prefab-Name = "+h.name+" | Graphics-Count = "+d.graphics.count+" | Mat-Names = "+c);else console.log("Parsed a Sprite for Graphics: Name = '"+n+"' | Parent-Name = "+g+"| Graphics-Name = "+o.name+" | Graphics-Count = "+d.graphics.count+" | Mat-Names = "+c)}};i.prototype.parseSkyboxInstance=function(t){var e=this.parseVarStr();var i=new Sa;var r=new be(this._blocks[this._newBlockBytes.readUnsignedInt()].data||we.getDefaultImageCube());i.texture=r;this.parseProperties(null);i.extra=this.parseUserAttributes();this._pFinalizeAsset(i,e);this._blocks[t].data=i;if(this._debug)console.log("Parsed a Skybox: Name = '"+e+"' | CubeTexture-Name = "+r.name)};i.prototype.parseLight=function(t){var e;var r;var n=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var s=this.parseMatrix3D();var a=this.parseVarStr();var o=this._newBlockBytes.readUnsignedByte();var h=this.parseProperties(i.lightProperties);var u=h.get(9,0);var l=["Unsupported LightType","PointLight","DirectionalLight"];var p=["No ShadowMapper","DirectionalShadowMapper","NearDirectionalShadowMapper","CascadeShadowMapper","CubeMapShadowMapper"];if(o==1){e=new Pa;e.radius=h.get(1,9e4);e.fallOff=h.get(2,1e5);if(u>0){if(u==4){r=new Ta}}e.transform.matrix3D=s}if(o==2){e=new fa(h.get(21,0),h.get(22,-1),h.get(23,1));if(u>0){if(u==1){r=new pa}}}e.color=h.get(3,16777215);e.specular=h.get(4,1);e.diffuse=h.get(5,1);e.ambientColor=h.get(7,16777215);e.ambient=h.get(8,0);if(r){if(r instanceof Ta){if(h.get(10,1)!=1)r.depthMapSize=this._depthSizeDic[h.get(10,1)]}else{if(h.get(10,2)!=2)r.depthMapSize=this._depthSizeDic[h.get(10,2)]}e.shadowMapper=r;e.castsShadows=true}var c="Root (TopLevel)";if(n){n.addChild(e);c=n.name}else{this._pContent.addChild(e)}this.parseUserAttributes();this._pFinalizeAsset(e,a);this._blocks[t].data=e;if(this._debug)console.log("Parsed a Light: Name = '"+a+"' | Type = "+l[o]+" | Parent-Name = "+c+" | ShadowMapper-Type = "+p[u])};i.prototype.parseCamera=function(t){var e=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var r=this.parseMatrix3D();var n=this.parseVarStr();var s;this._newBlockBytes.readUnsignedByte();this._newBlockBytes.readShort();var a=this._newBlockBytes.readShort();var o=this.parseProperties(i.cameraProperties);switch(a){case 5001:s=new St(o.get(101,60));break;case 5002:s=new Pt(o.get(101,500));break;case 5003:s=new Tt(o.get(101,-400),o.get(102,400),o.get(103,-300),o.get(104,300));break;default:console.log("unsupportedLenstype");return}var h=new ua(s);h.transform.matrix3D=r;var u="Root (TopLevel)";if(e){e.addChild(h);u=e.name}else{this._pContent.addChild(h)}h.name=n;o=this.parseProperties(i.cameraPivotProperties);h.registrationPoint=new A(o.get(1,0),o.get(2,0),o.get(3,0));h.extra=this.parseUserAttributes();this._pFinalizeAsset(h,n);this._blocks[t].data=h;if(this._debug)console.log("Parsed a Camera: Name = '"+n+"' | Projectiontype = "+s+" | Parent-Name = "+u)};i.prototype.parseLightPicker=function(t){var e=this.parseVarStr();var i=this._newBlockBytes.readUnsignedShort();var r=new Array;var n=new Array;for(var s=0;s<i;s++){var a=this._blocks[this._newBlockBytes.readUnsignedInt()].data;r.push(a);n.push(a.name)}if(r.length==0){this._blocks[t].addError("Could not create this LightPicker, cause no Light was found.");this.parseUserAttributes();return}var o=new Fa(r);o.name=e;this.parseUserAttributes();this._pFinalizeAsset(o,e);this._blocks[t].data=o;if(this._debug)console.log("Parsed a StaticLightPicker: Name = '"+e+"' | Texture-Name = "+n)};i.prototype.parseMaterial=function(t){var e;var r;var n;var s;var a;var o;var h;var u;e=this.parseVarStr();r=this._newBlockBytes.readUnsignedByte();o=this._newBlockBytes.readUnsignedByte();n=this.parseProperties(i.materialProperties);h=0;while(h<o){var l;l=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);this.parseUserAttributes();h+=1}var p="";if(r===1){p+="Parsed a ColorMaterial(SinglePass): Name = '"+e+"' | ";var c=n.get(1,16777215);if(this.materialMode<2){s=new go(c,n.get(10,1))}else{s=new go(c);s.mode=fo.MULTI_PASS}}else if(r===2){var _=new ve(this._blocks[n.get(2,0)].data);s=new go;s.ambientMethod.texture=_;if(this.materialMode<2){s.alphaBlending=n.get(11,false);s.alpha=n.get(10,1);p+="Parsed a MethodMaterial(SinglePass): Name = '"+e+"'"+(_?" | Texture-Name = "+_.name:"")}else{s.mode=fo.MULTI_PASS;p+="Parsed a MethodMaterial(MultiPass): Name = '"+e+"'"+(_?" | Texture-Name = "+_.name:"")}}s.extra=this.parseUserAttributes();s.alphaThreshold=n.get(12,0);s.style.sampler=new re(n.get(13,false));this._pFinalizeAsset(s,e);this._blocks[t].data=s;if(this._debug)console.log(p)};i.prototype.parseMaterial_v1=function(t){var e;var r;var n;var s;var a=this.parseVarStr();var o=this._newBlockBytes.readUnsignedByte();var h=this._newBlockBytes.readUnsignedByte();var u=this.parseProperties(i.material_v1Properties);var l=u.get(4,0);var p="Parsed Material ";if(l>=2){this._blocks[t].addError("Material-spezialType '"+l+"' is not supported, can only be 0:singlePass, 1:MultiPass !");return}if(o<=2){if(this.materialMode==1)l=0;else if(this.materialMode==2)l=1;if(l<2){if(o==1){var c=u.get(1,13421772);if(l==1){e=new go(c);e.mode=fo.MULTI_PASS;p+="Parsed a ColorMaterial(MultiPass): Name = '"+a+"' | "}else{e=new go(c,u.get(10,1));e.alphaBlending=u.get(11,false);p+="Parsed a ColorMaterial(SinglePass): Name = '"+a+"' | "}}else if(o==2){var _=new ve(this._blocks[u.get(2,0)].data);e=new go;e.ambientMethod.texture=_;if(l==1){e.mode=fo.MULTI_PASS;p+="Parsed a MethodMaterial(MultiPass): Name = '"+a+"'"+(_?" | Texture-Name = "+_.name:"")}else{e.alpha=u.get(10,1);e.alphaBlending=u.get(11,false);p+="Parsed a MethodMaterial(SinglePass): Name = '"+a+"'"+(_?" | Texture-Name = "+_.name:"")}}r=this._blocks[u.get(17,0)].data;n=this._blocks[u.get(3,0)].data;s=this._blocks[u.get(21,0)].data;e.lightPicker=this._blocks[u.get(22,0)].data;e.style.sampler=new re(u.get(13,false),u.get(5,true),u.get(6,true));e.bothSides=u.get(7,false);e.alphaPremultiplied=u.get(8,false);e.blendMode=this.blendModeDic[u.get(9,0)];if(r){e.diffuseTexture=new ve(r);p+=" | DiffuseTexture-Name = "+r.name}if(n){e.normalMethod.texture=new ve(n);p+=" | NormalTexture-Name = "+n.name}if(s){e.specularMethod.texture=new ve(s);p+=" | SpecularTexture-Name = "+s.name}e.alphaThreshold=u.get(12,0);e.ambientMethod.strength=u.get(15,1);e.diffuseMethod.color=u.get(16,16777215);e.specularMethod.strength=u.get(18,1);e.specularMethod.gloss=u.get(19,50);e.specularMethod.color=u.get(20,16777215);for(var f=0;f<h;f++){var d;d=this._newBlockBytes.readUnsignedShort();u=this.parseProperties(i.method_v1Properties);switch(d){case 999:var g=this._blocks[u.get(1,0)].data;e.addEffectMethod(g);p+=" | EffectMethod-Name = "+g.name;break;case 998:var m=this._blocks[u.get(1,0)].data;e.shadowMethod=m;p+=" | ShadowMethod-Name = "+m.name;break;case 1:var y=new be(this._blocks[u.get(1,0)].data);e.ambientMethod=new mo;e.ambientMethod.texture=y;p+=" | AmbientEnvMapMethod | EnvMap-Name ="+y.name;break;case 51:e.diffuseMethod=new xo;p+=" | DiffuseDepthMethod";break;case 52:var _=new ve(this._blocks[u.get(1,0)].data);e.diffuseMethod=new bo(_);p+=" | DiffuseGradientMethod | GradientDiffuseTexture-Name ="+_.name;break;case 53:e.diffuseMethod=new Co(u.get(101,5));p+=" | DiffuseWrapMethod";break;case 54:var _=new ve(this._blocks[u.get(1,0)].data);e.diffuseMethod=new wo(_,this.blendModeDic[u.get(401,10)],false,e.diffuseMethod);p+=" | DiffuseLightMapMethod | LightMapTexture-Name ="+_.name;break;case 55:e.diffuseMethod=new vo(u.get(401,3),e.diffuseMethod);e.diffuseMethod.smoothness=u.get(101,.1);p+=" | DiffuseCelMethod";break;case 56:break;case 101:e.specularMethod=new Wo;p+=" | SpecularAnisotropicMethod";break;case 102:e.specularMethod=new Zo;p+=" | SpecularPhongMethod";break;case 103:e.specularMethod=new qo(u.get(101,.5),e.specularMethod);e.specularMethod.smoothness=u.get(102,.1);p+=" | SpecularCelMethod";break;case 104:e.specularMethod=new Ko(u.get(701,true),e.specularMethod);e.specularMethod.fresnelPower=u.get(101,5);e.specularMethod.normalReflectance=u.get(102,.1);p+=" | SpecularFresnelMethod";break;case 151:break;case 152:var _=new ve(this._blocks[u.get(1,0)].data);e.normalMethod=new Bo(e.normalMethod.texture||_,_);p+=" | NormalSimpleWaterMethod | Second-NormalTexture-Name = "+_.name;break}this.parseUserAttributes()}}}else if(o>=3&&o<=7){var c=u.get(1,13421772);p+=c;var v=new ve(this._blocks[u.get(2,0)].data);if(o==5){v.mappingMode=me.LINEAR_GRADIENT}else if(o==6){v.mappingMode=me.RADIAL_GRADIENT}var x=new go;x.ambientMethod.texture=v;x.bothSides=true;x.alphaBlending=u.get(11,false);x.extra=this.parseUserAttributes();this._pFinalizeAsset(x,a);this._blocks[t].data=x;if(this._debug)console.log(p);return}e.extra=this.parseUserAttributes();this._pFinalizeAsset(e,a);this._blocks[t].data=e;if(this._debug)console.log(p)};i.prototype.parseTexture=function(t){this._blocks[t].name=this.parseVarStr();var e=this._newBlockBytes.readUnsignedByte();this._texture_users[this._cur_block_id]=[];if(e==0){var i=this._newBlockBytes.readUTFBytes(this._newBlockBytes.readUnsignedInt());this._pAddDependency(this._cur_block_id.toString(),new dt(i),false,null,true)}else{var r=this._newBlockBytes.readUnsignedInt();var n=new mt(r);this._newBlockBytes.readBytes(n,0,r);this._pAddDependency(this._cur_block_id.toString(),null,false,n,true)}this.parseProperties(null);this._blocks[t].extras=this.parseUserAttributes();this._pPauseAndRetrieveDependencies();if(this._debug)console.log("Start parsing a "+["external","embed"][e]+" Bitmap for Texture")};i.prototype.parseCubeTexture=function(t){var e;var i;this._texture_users[this._cur_block_id]=[];var r=this._newBlockBytes.readUnsignedByte();this._blocks[t].name=this.parseVarStr();for(i=0;i<6;i++){this._texture_users[this._cur_block_id]=[];if(r==0){e=this._newBlockBytes.readUnsignedInt();var n;n=this._newBlockBytes.readUTFBytes(e);this._pAddDependency(this._cur_block_id.toString(),new dt(n),false,null,true,i)}else{e=this._newBlockBytes.readUnsignedInt();var s=new mt(e);this._newBlockBytes.readBytes(s,0,e);this._pAddDependency(this._cur_block_id.toString(),null,false,yt.byteArrayToImage(s),true,i)}}this.parseProperties(null);this._blocks[t].extras=this.parseUserAttributes();this._pPauseAndRetrieveDependencies();if(this._debug)console.log("Start parsing 6 "+["external","embed"][r]+" Bitmaps for CubeTexture")};i.prototype.parseSharedMethodBlock=function(t){var e;this._blocks[t].name=this.parseVarStr();e=this.parseSharedMethodList(t);this.parseUserAttributes();this._blocks[t].data=e;this._pFinalizeAsset(e,this._blocks[t].name);this._blocks[t].data=e;if(this._debug)console.log("Parsed a EffectMethod: Name = "+e.name+" Type = "+e)};i.prototype.parseShadowMethodBlock=function(t){this._blocks[t].name=this.parseVarStr();var e=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var i=this.parseShadowMethodList(e,t);if(!i)return;this.parseUserAttributes();this._pFinalizeAsset(i,this._blocks[t].name);this._blocks[t].data=i;if(this._debug)console.log("Parsed a ShadowMapMethodMethod: Name = "+i.name+" | Type = "+i+" | Light-Name = ",e.name)};i.prototype.parseCommand=function(t){var e=this._newBlockBytes.readUnsignedByte()==1;var r=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var n;var s=this.parseMatrix3D();var a=this.parseVarStr();var o=this._newBlockBytes.readShort();var h=this._newBlockBytes.readShort();var u=this.parseProperties(i.commandProperties);switch(h){case 1:n=this._blocks[u.get(1,0)].data;n.transform.matrix3D=s;if(r)r.addChild(n);break}if(n){u=this.parseProperties(i.targetProperties);n.registrationPoint=new A(u.get(1,0),u.get(2,0),u.get(3,0));n.extra=this.parseUserAttributes()}this._blocks[t].data=n;if(this._debug)console.log("Parsed a CommandBlock: Name = '"+a)};i.prototype.parseMetaData=function(t){var e=this.parseProperties(i.metaDataProperties);if(this._debug){console.log("Parsed a MetaDataBlock: TimeStamp         = "+e.get(1,0));console.log("                        EncoderName       = "+e.get(2,"unknown"));console.log("                        EncoderVersion    = "+e.get(3,"unknown"));console.log("                        GeneratorName     = "+e.get(4,"unknown"));console.log("                        GeneratorVersion  = "+e.get(5,"unknown"))}};i.prototype.parseNameSpace=function(t){var e=this._newBlockBytes.readUnsignedByte();var i=this.parseVarStr();if(this._debug)console.log("Parsed a NameSpaceBlock: ID = "+e+" | String = "+i)};i.prototype.parseShadowMethodList=function(t,e){var i=this._newBlockBytes.readUnsignedShort();var r;var n=this.parseProperties(this.shadowMethodListProperties);var s;var a;switch(i){case 1002:r=new Ho(this._blocks[n.get(1,0)].data);break;case 1101:r=new jo(t);r.alpha=n.get(101,1);r.epsilon=n.get(102,.002);break;case 1102:r=new zo(t,n.get(201,5));r.alpha=n.get(101,1);r.epsilon=n.get(102,.002);r.range=n.get(103,1);break;case 1103:r=new Xo(t,n.get(201,5));r.alpha=n.get(101,1);r.epsilon=n.get(102,.002);r.range=n.get(103,1);break;case 1104:r=new Go(t);r.alpha=n.get(101,1);r.epsilon=n.get(102,.002);break}this.parseUserAttributes();return r};i.prototype.parseSkeleton=function(t){var e=this.parseVarStr();var i=this._newBlockBytes.readUnsignedShort();var r=new Wr;this.parseProperties(null);for(var n=0;n<i;n++){var s;var a;this._newBlockBytes.readUnsignedShort();s=new Yr;s.parentIndex=this._newBlockBytes.readUnsignedShort()-1;s.name=this.parseVarStr();a=this.parseMatrix3D();s.inverseBindPose=a._rawData;this.parseProperties(null);this.parseUserAttributes();r.joints.push(s)}this.parseUserAttributes();this._pFinalizeAsset(r,e);this._blocks[t].data=r;if(this._debug)console.log("Parsed a Skeleton: Name = "+r.name+" | Number of Joints = "+n)};i.prototype.parseSkeletonPose=function(t){var e=this.parseVarStr();var i=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);var r=new qr;for(var n=0;n<i;n++){var s;var a;s=new jr;a=this._newBlockBytes.readUnsignedByte();if(a==1){var o=this.parseMatrix43RawData();var h=new M(o);s.orientation.fromMatrix(h);s.translation.copyFrom(h.position);r.jointPoses[n]=s}}this.parseUserAttributes();this._pFinalizeAsset(r,e);this._blocks[t].data=r;if(this._debug)console.log("Parsed a SkeletonPose: Name = "+r.name+" | Number of Joints = "+n)};i.prototype.parseSkeletonAnimation=function(t){var e;var i;var r=this.parseVarStr();var n=new Gn;var s=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);for(var a=0;a<s;a++){i=this._newBlockBytes.readUnsignedInt();e=this._newBlockBytes.readUnsignedShort();n.addFrame(this._blocks[i].data,e)}if(n.frames.length==0){this._blocks[t].addError("Could not this SkeletonClipNode, because no Frames where set.");return}this.parseUserAttributes();this._pFinalizeAsset(n,r);this._blocks[t].data=n;if(this._debug)console.log("Parsed a SkeletonClipNode: Name = "+n.name+" | Number of Frames = "+n.frames.length)};i.prototype.parseSpritePoseAnimation=function(t,e){if(e===void 0){e=false}var i;var r;var n;var s;var a;var o;var h;var l=0;var p=new Qn;var c;var _;var f=new Array;var d;var g=this.parseVarStr();var m=this._newBlockBytes.readUnsignedInt();var y=this._blocks[m].data;var v=this.getUVForVertexAnimation(m);var x=!e?this._newBlockBytes.readUnsignedShort():1;var b=this._newBlockBytes.readUnsignedShort();var w=this._newBlockBytes.readUnsignedShort();for(var D=0;D<w;D++)f.push(this._newBlockBytes.readUnsignedShort());d=this.parseProperties(this.spritePoseAnimationProperties);p.looping=d.get(1,true);p.stitchFinalFrame=d.get(2,false);var C;for(var A=0;A<x;A++){C=this._newBlockBytes.readUnsignedShort();y=new qe;i=0;while(i<b){D=0;a=this._newBlockBytes.readUnsignedInt();o=this._newBlockBytes.position+a;while(D<w){if(f[D]==1){c=y.getShapeAt(i).elements.indices;_=new Array;l=0;while(this._newBlockBytes.position<o){r=this.readNumber(this._accuracyGeo);n=this.readNumber(this._accuracyGeo);s=this.readNumber(this._accuracyGeo);_[l++]=r;_[l++]=n;_[l++]=s}h=new $t(new u);h.setIndices(c);h.setPositions(_);h.setUVs(v[i]);h.setNormals(null);h.setTangents(null);h.autoDeriveNormals=false;h.autoDeriveTangents=false;i++;y.addShape(new jt(h))}else this._newBlockBytes.position=o;D++}}p.addFrame(y,C)}this.parseUserAttributes();this._pFinalizeAsset(p,g);this._blocks[t].data=p;if(this._debug)console.log("Parsed a VertexClipNode: Name = "+p.name+" | Target-Graphics-Name = "+y.name+" | Number of Frames = "+p.frames.length)};i.prototype.parseVertexAnimationSet=function(t){var e=this.parseVarStr();var r=this._newBlockBytes.readUnsignedShort();var n=this.parseProperties(i.vertexAnimationSetProperties);var s=new Array;var a=new Array;var o;for(var h=0;h<r;h++){o=this._blocks[this._newBlockBytes.readUnsignedInt()].data;if(o instanceof Qn)a.push(o);else if(o instanceof Gn)s.push(o)}if(a.length==0&&s.length==0){this._blocks[t].addError("Could not create this AnimationSet, because it contains no animations");return}this.parseUserAttributes();if(a.length>0){var u=new ns;for(var l=0;l<a.length;l++)u.addAnimation(a[l]);this._pFinalizeAsset(u,e);this._blocks[t].data=u;if(this._debug)console.log("Parsed a VertexAnimationSet: Name = "+e+" | Animations = "+u.animations.length+" | Animation-Names = "+u.animationNames)}else if(s.length>0){var p=new is(n.get(1,4));for(var l=0;l<s.length;l++)p.addAnimation(s[l]);this._pFinalizeAsset(p,e);this._blocks[t].data=p;if(this._debug)console.log("Parsed a SkeletonAnimationSet: Name = "+e+" | Animations = "+p.animations.length+" | Animation-Names = "+p.animationNames)}};i.prototype.parseAnimatorSet=function(t){var e=this.parseVarStr();var r=this._newBlockBytes.readUnsignedShort();var n=this.parseProperties(i.animatorSetProperties);var s=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var a=new Array;var o=this._newBlockBytes.readUnsignedShort();for(var h=0;h<o;h++)a.push(this._blocks[this._newBlockBytes.readUnsignedInt()].data);var u=this._newBlockBytes.readUnsignedShort();var l=this._newBlockBytes.readUnsignedByte()==1;this.parseUserAttributes();this.parseUserAttributes();var p;if(r==1)p=new rs(s,this._blocks[n.get(1,0)].data);else if(r==2)p=new ss(s);this._pFinalizeAsset(p,e);this._blocks[t].data=p;for(h=0;h<a.length;h++){if(r==1)a[h].animator=p;else if(r==2)a[h].animator=p}if(this._debug)console.log("Parsed a Animator: Name = "+e)};i.prototype.parseSharedMethodList=function(t){var e=this._newBlockBytes.readUnsignedShort();var i;var r=this.parseProperties(this.sharedMethodListProperties);switch(e){case 401:i=new Po(r.get(101,new Array(0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)));break;case 402:i=new So;var n=r.get(601,0);i.colorTransform=new C(r.get(102,1),r.get(103,1),r.get(104,1),r.get(101,1),n>>16&255,n>>8&255,n&255,n>>24&255);break;case 403:i=new Eo(new be(this._blocks[r.get(1,0)].data),r.get(101,1));var s=r.get(2,0);if(s>0){}break;case 404:i=new Io(this._blocks[r.get(1,0)].data,this.blendModeDic[r.get(401,10)]);break;case 406:i=new No(r.get(601,16777215),r.get(101,.4),r.get(101,2));break;case 407:i=new To(this._blocks[r.get(1,0)].data,r.get(701,false));break;case 410:i=new Oo(this._blocks[r.get(1,0)].data,r.get(101,1));break;case 411:i=new Mo(r.get(101,0),r.get(102,1e3),r.get(601,8421504));break}this.parseUserAttributes();return i};i.prototype.parseUserAttributes=function(){var t=this._newBlockBytes.readUnsignedInt();if(t>0){var e=this._newBlockBytes.position+t;var r={};for(var n=0;this._newBlockBytes.position<e;n++){var s;var a;var o;var h;var u;s=this._newBlockBytes.readUnsignedByte();a=this.parseVarStr();o=this._newBlockBytes.readUnsignedByte();h=this._newBlockBytes.readUnsignedInt();if(this._newBlockBytes.position+h>e){console.log("           Error in reading attribute # "+n+" = skipped to end of attribute-list");this._newBlockBytes.position=e;return r}switch(o){case i.AWDSTRING:u=this._newBlockBytes.readUTFBytes(h);break;case i.INT8:u=this._newBlockBytes.readByte();break;case i.INT16:u=this._newBlockBytes.readShort();break;case i.INT32:u=this._newBlockBytes.readInt();break;case i.BOOL:case i.UINT8:u=this._newBlockBytes.readUnsignedByte();break;case i.UINT16:u=this._newBlockBytes.readUnsignedShort();break;case i.UINT32:case i.BADDR:u=this._newBlockBytes.readUnsignedInt();break;case i.FLOAT32:u=this._newBlockBytes.readFloat();break;case i.FLOAT64:u=this._newBlockBytes.readDouble();break;default:u="unimplemented attribute type "+o;this._newBlockBytes.position+=h;break}r[a]=u;if(this._debug)console.log("attribute = name: "+a+"  / value = "+u)}}return r};i.prototype.parseProperties=function(t){var e=this._newBlockBytes.readUnsignedInt();var i=new yh;var r=this._newBlockBytes.position+e;if(t){var n;var s;var a;for(var o=0;this._newBlockBytes.position<r;o++){s=this._newBlockBytes.readUnsignedShort();n=this._newBlockBytes.readUnsignedInt();if(this._newBlockBytes.position+n>r){console.log("           Error in reading property # "+o+" = skipped to end of propertie-list");this._newBlockBytes.position=r;return i}if(t[s]){a=t[s];i.set(s,this.parseAttrValue(a,n))}else{this._newBlockBytes.position+=n}}}else{this._newBlockBytes.position=r}return i};i.prototype.parseAttrValue=function(t,e){var r;var n;var s;switch(t){case i.BOOL:case i.INT8:r=1;n=this._newBlockBytes.readByte;break;case i.INT16:r=2;n=this._newBlockBytes.readShort;break;case i.INT32:r=4;n=this._newBlockBytes.readInt;break;case i.UINT8:r=1;n=this._newBlockBytes.readUnsignedByte;break;case i.UINT16:r=2;n=this._newBlockBytes.readUnsignedShort;break;case i.UINT32:case i.COLOR:case i.BADDR:r=4;n=this._newBlockBytes.readUnsignedInt;break;case i.FLOAT32:r=4;n=this._newBlockBytes.readFloat;break;case i.FLOAT64:r=8;n=this._newBlockBytes.readDouble;break;case i.AWDSTRING:return this._newBlockBytes.readUTFBytes(e);case i.VECTOR2x1:case i.VECTOR3x1:case i.VECTOR4x1:case i.MTX3x2:case i.MTX3x3:case i.MTX4x3:case i.MTX4x4:r=8;n=this._newBlockBytes.readDouble;break;case i.GEO_NUMBER:s=this._accuracyGeo;case i.MATRIX_NUMBER:s=this._accuracyMatrix;case i.PROPERTY_NUMBER:s=this._accuracyProps;default:if(s){r=8;n=this._newBlockBytes.readDouble}else{r=4;n=this._newBlockBytes.readFloat}}if(r<e){var a=[];var o=e/r;for(var h=0;h<o;h++)a[h]=n.call(this._newBlockBytes);return a}else{return n.call(this._newBlockBytes)}};i.prototype.parseHeader=function(){this._byteData.position=3;this._version[0]=this._byteData.readUnsignedByte();this._version[1]=this._byteData.readUnsignedByte();var t=this._byteData.readUnsignedShort();this._streaming=vh.test(t,vh.FLAG1);if(this._version[0]==2&&this._version[1]==1){this._accuracyMatrix=vh.test(t,vh.FLAG2);this._accuracyGeo=vh.test(t,vh.FLAG3);this._accuracyProps=vh.test(t,vh.FLAG4)}this._compression=this._byteData.readUnsignedByte();if(this._debug){console.log("Import AWDFile of version = "+this._version[0]+" - "+this._version[1]);console.log("Global Settings = Compression = "+this._compression+" | Streaming = "+this._streaming+" | Matrix-Precision = "+this._accuracyMatrix+" | Graphics-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps)}var e=this._byteData.readUnsignedInt();if(!this._streaming&&e!=this._byteData.getBytesAvailable())this._pDieWithError("AWD2 body length does not match header integrity field")};i.prototype.getUVForVertexAnimation=function(t){if(this._blocks[t].data instanceof Ws)t=this._blocks[t].geoID;if(this._blocks[t].uvsForVertexAnimation)return this._blocks[t].uvsForVertexAnimation;var e=this._blocks[t].data;var i;var r=this._blocks[t].uvsForVertexAnimation=new Array;var n=e.count;for(var s=0;s<n;s++){i=e.getShapeAt(s).elements;r[s]=i.uvs.get(i.numVertices)}return this._blocks[t].uvsForVertexAnimation};i.prototype.parseVarStr=function(){return this._newBlockBytes.readUTFBytes(this._newBlockBytes.readUnsignedShort())};i.prototype.readNumber=function(t){if(t===void 0){t=false}if(t)return this._newBlockBytes.readDouble();return this._newBlockBytes.readFloat()};i.prototype.parseMatrix3D=function(){return new M(this.parseMatrix43RawData())};i.prototype.parseMatrix32RawData=function(){var t=new Float32Array(6);for(var e=0;e<6;e++)t[e]=this._newBlockBytes.readFloat();return t};i.prototype.parseMatrix43RawData=function(){var t=new Float32Array(16);t[0]=this.readNumber(this._accuracyMatrix);t[1]=this.readNumber(this._accuracyMatrix);t[2]=this.readNumber(this._accuracyMatrix);t[3]=0;t[4]=this.readNumber(this._accuracyMatrix);t[5]=this.readNumber(this._accuracyMatrix);t[6]=this.readNumber(this._accuracyMatrix);t[7]=0;t[8]=this.readNumber(this._accuracyMatrix);t[9]=this.readNumber(this._accuracyMatrix);t[10]=this.readNumber(this._accuracyMatrix);t[11]=0;t[12]=this.readNumber(this._accuracyMatrix);t[13]=this.readNumber(this._accuracyMatrix);t[14]=this.readNumber(this._accuracyMatrix);t[15]=1;if(isNaN(t[0])){t[0]=1;t[1]=0;t[2]=0;t[4]=0;t[5]=1;t[6]=0;t[8]=0;t[9]=0;t[10]=1;t[12]=0;t[13]=0;t[14]=0}return t};return i}(bt);gh.COMPRESSIONMODE_LZMA="lzma";gh.UNCOMPRESSED=0;gh.DEFLATE=1;gh.LZMA=2;gh.INT8=1;gh.INT16=2;gh.INT32=3;gh.UINT8=4;gh.UINT16=5;gh.UINT32=6;gh.FLOAT32=7;gh.FLOAT64=8;gh.BOOL=21;gh.COLOR=22;gh.BADDR=23;gh.AWDSTRING=31;gh.AWDBYTEARRAY=32;gh.VECTOR2x1=41;gh.VECTOR3x1=42;gh.VECTOR4x1=43;gh.MTX3x2=44;gh.MTX3x3=45;gh.MTX4x3=46;gh.MTX4x4=47;gh.GEO_NUMBER=48;gh.MATRIX_NUMBER=49;gh.PROPERTY_NUMBER=50;gh.textFormatProperties={1:gh.UINT16,2:gh.FLOAT32,3:gh.UINT8,4:gh.UINT8,5:gh.UINT8,6:gh.UINT8,7:gh.FLOAT32,8:gh.FLOAT32,9:gh.FLOAT32,10:gh.FLOAT32,11:gh.COLOR};gh.textFieldProperties={1:gh.BOOL,3:gh.BOOL,4:gh.BOOL,5:gh.BOOL,7:gh.UINT8,8:gh.UINT8,9:gh.UINT8};gh.textFieldTypes=["static","dynamic","input","input"];gh.spriteLibraryProperties={1:gh.FLOAT32,2:gh.FLOAT32,3:gh.FLOAT32,4:gh.FLOAT32};gh.movieClipProperties={1:gh.FLOAT32,2:gh.UINT16,3:gh.UINT8};gh.graphicsProperties={1:gh.GEO_NUMBER,2:gh.GEO_NUMBER};gh.elementsProperties={1:gh.GEO_NUMBER,2:gh.GEO_NUMBER};gh.primitiveProperties={101:gh.GEO_NUMBER,102:gh.GEO_NUMBER,103:gh.GEO_NUMBER,110:gh.GEO_NUMBER,111:gh.GEO_NUMBER,301:gh.UINT16,302:gh.UINT16,303:gh.UINT16,701:gh.BOOL,702:gh.BOOL,703:gh.BOOL,704:gh.BOOL};gh.primitiveTypes=["Unsupported Type-ID","PrimitivePlanePrefab","PrimitiveCubePrefab","PrimitiveSpherePrefab","PrimitiveCylinderPrefab","PrimitivesConePrefab","PrimitivesCapsulePrefab","PrimitivesTorusPrefab"];gh.containerProperties={1:gh.MATRIX_NUMBER,2:gh.MATRIX_NUMBER,3:gh.MATRIX_NUMBER,4:gh.UINT8};gh.spriteInstanceProperties={1:gh.MATRIX_NUMBER,2:gh.MATRIX_NUMBER,3:gh.MATRIX_NUMBER,4:gh.UINT8,5:gh.BOOL};gh.lightProperties={1:gh.PROPERTY_NUMBER,2:gh.PROPERTY_NUMBER,3:gh.COLOR,4:gh.PROPERTY_NUMBER,5:gh.PROPERTY_NUMBER,6:gh.BOOL,7:gh.COLOR,8:gh.PROPERTY_NUMBER,9:gh.UINT8,10:gh.UINT8,11:gh.PROPERTY_NUMBER,12:gh.UINT16,21:gh.MATRIX_NUMBER,22:gh.MATRIX_NUMBER,23:gh.MATRIX_NUMBER};gh.cameraProperties={101:gh.PROPERTY_NUMBER,102:gh.PROPERTY_NUMBER,103:gh.PROPERTY_NUMBER,104:gh.PROPERTY_NUMBER};gh.cameraPivotProperties={1:gh.MATRIX_NUMBER,2:gh.MATRIX_NUMBER,3:gh.MATRIX_NUMBER,4:gh.UINT8};gh.materialProperties={1:gh.INT32,2:gh.BADDR,10:gh.PROPERTY_NUMBER,11:gh.BOOL,12:gh.PROPERTY_NUMBER,13:gh.BOOL};gh.material_v1Properties={1:gh.UINT32,2:gh.BADDR,3:gh.BADDR,4:gh.UINT8,5:gh.BOOL,6:gh.BOOL,7:gh.BOOL,8:gh.BOOL,9:gh.UINT8,10:gh.PROPERTY_NUMBER,11:gh.BOOL,12:gh.PROPERTY_NUMBER,13:gh.BOOL,15:gh.PROPERTY_NUMBER,16:gh.UINT32,17:gh.BADDR,18:gh.PROPERTY_NUMBER,19:gh.PROPERTY_NUMBER,20:gh.UINT32,21:gh.BADDR,22:gh.BADDR};gh.method_v1Properties={1:gh.BADDR,2:gh.BADDR,3:gh.BADDR,101:gh.PROPERTY_NUMBER,102:gh.PROPERTY_NUMBER,103:gh.PROPERTY_NUMBER,201:gh.UINT32,202:gh.UINT32,301:gh.UINT16,302:gh.UINT16,401:gh.UINT8,402:gh.UINT8,601:gh.COLOR,602:gh.COLOR,701:gh.BOOL,702:gh.BOOL,801:gh.MTX4x4};gh.commandProperties={1:gh.BADDR};gh.targetProperties={1:gh.MATRIX_NUMBER,2:gh.MATRIX_NUMBER,3:gh.MATRIX_NUMBER,4:gh.UINT8};gh.metaDataProperties={1:gh.UINT32,2:gh.AWDSTRING,3:gh.AWDSTRING,4:gh.AWDSTRING,5:gh.AWDSTRING};gh.vertexAnimationSetProperties={1:gh.UINT16};gh.animatorSetProperties={1:gh.BADDR};var mh=function(){function t(){}return t}();mh.STANDART_STREAMS=0;mh.CONCENATED_STREAMS=1;mh.SHARED_BUFFER=2;mh.CONCATENATED_SUBGEO=3;mh.SHARED_INDEXBUFFER=4;mh.CONCENATED_STREAMS_UINT16=5;var yh=function(){function t(){}t.prototype.set=function(t,e){this[t]=e};t.prototype.get=function(t,e){return this[t]||e};return t}();var vh=function(){function t(){}t.test=function(t,e){return(t&e)==e};return t}();vh.FLAG1=1;vh.FLAG2=2;vh.FLAG3=4;vh.FLAG4=8;vh.FLAG5=16;vh.FLAG6=32;vh.FLAG7=64;vh.FLAG8=128;vh.FLAG9=256;vh.FLAG10=512;vh.FLAG11=1024;vh.FLAG12=2048;vh.FLAG13=4096;vh.FLAG14=8192;vh.FLAG15=16384;vh.FLAG16=32768;var xh=function(t){e(i,t);function i(e){if(e===void 0){e=true}var i=t.call(this,J.ARRAY_BUFFER)||this;i._useSmoothingGroups=e;return i}i.supportsType=function(t){t=t.toLowerCase();return t=="3ds"};i.supportsData=function(t){var e;try{e=yt.toByteArray(t);if(e){e.position=0;if(e.readShort()==19789)return true}}catch(i){return false}return false};i.prototype._iResolveDependency=function(t){if(t.assets.length==1){var e;e=t.assets[0];if(e.isAsset(pe)){var i;i=this._textures[t.id];i.texture=new ve(e)}}};i.prototype._iResolveDependencyFailure=function(t){};i.prototype._pProceedParsing=function(){if(!this._byteData){this._byteData=this._pGetByteData();this._byteData.position=0;this._textures={};this._materials={};this._unfinalized_objects={}}while(this._pHasTime()){if(this._cur_mat&&this._byteData.position>=this._cur_mat_end)this.finalizeCurrentMaterial();else if(this._cur_obj&&this._byteData.position>=this._cur_obj_end){this._unfinalized_objects[this._cur_obj.name]=this._cur_obj;

this._cur_obj_end=Number.MAX_VALUE;this._cur_obj=null}if(this._byteData.getBytesAvailable()>0){var t;var e;var i;t=this._byteData.readUnsignedShort();e=this._byteData.readUnsignedInt();i=this._byteData.position+(e-6);switch(t){case 19789:case 15677:case 45056:continue;case 45055:this._cur_mat_end=i;this._cur_mat=this.parseMaterial();break;case 16384:this._cur_obj_end=i;this._cur_obj=new Dh;this._cur_obj.name=this.readNulTermstring();this._cur_obj.materials=new Array;this._cur_obj.materialFaces={};break;case 16640:this._cur_obj.type=Ws.assetType;break;case 16656:this.parseVertexList();break;case 16672:this.parseFaceList();break;case 16704:this.parseUVList();break;case 16688:this.parseFaceMaterialList();break;case 16736:this._cur_obj.transform=this.readTransform();break;case 45058:this.parseObjectAnimation(i);break;case 16720:this.parseSmoothingGroups();break;default:this._byteData.position+=e-6;break}if(this.dependencies.length){this._pPauseAndRetrieveDependencies();break}}}if(this._byteData.getBytesAvailable()||this._cur_obj||this._cur_mat){return bt.MORE_TO_PARSE}else{var r;for(r in this._unfinalized_objects){var n;n=this.constructObject(this._unfinalized_objects[r]);if(n){this._pContent.addChild(n);this._pFinalizeAsset(n,r)}}return bt.PARSING_DONE}};i.prototype._pStartParsing=function(e){this._pContent=new Xs;t.prototype._pStartParsing.call(this,e)};i.prototype.parseMaterial=function(){var t;t=new wh;while(this._byteData.position<this._cur_mat_end){var e;var i;var r;e=this._byteData.readUnsignedShort();i=this._byteData.readUnsignedInt();r=this._byteData.position+(i-6);switch(e){case 40960:t.name=this.readNulTermstring();break;case 40976:t.ambientColor=this.readColor();break;case 40992:t.diffuseColor=this.readColor();break;case 41008:t.specularColor=this.readColor();break;case 41089:t.twoSided=true;break;case 41472:t.colorMap=this.parseTexture(r);break;case 41476:t.specularMap=this.parseTexture(r);break;default:this._byteData.position=r;break}}return t};i.prototype.parseTexture=function(t){var e;e=new Ch;while(this._byteData.position<t){var i;var r;i=this._byteData.readUnsignedShort();r=this._byteData.readUnsignedInt();switch(i){case 41728:e.url=this.readNulTermstring();break;default:this._byteData.position+=r-6;break}}this._textures[e.url]=e;this._pAddDependency(e.url,new dt(e.url));return e};i.prototype.parseVertexList=function(){var t;var e;var i;i=this._byteData.readUnsignedShort();this._cur_obj.verts=new Array(i*3);t=0;e=this._cur_obj.verts.length;while(t<e){var r,n,s;r=this._byteData.readFloat();n=this._byteData.readFloat();s=this._byteData.readFloat();this._cur_obj.verts[t++]=r;this._cur_obj.verts[t++]=s;this._cur_obj.verts[t++]=n}};i.prototype.parseFaceList=function(){var t;var e;var i;i=this._byteData.readUnsignedShort();this._cur_obj.indices=new Array(i*3);t=0;e=this._cur_obj.indices.length;while(t<e){var r,n,s;r=this._byteData.readUnsignedShort();n=this._byteData.readUnsignedShort();s=this._byteData.readUnsignedShort();this._cur_obj.indices[t++]=r;this._cur_obj.indices[t++]=s;this._cur_obj.indices[t++]=n;this._byteData.position+=2}this._cur_obj.smoothingGroups=new Array(i)};i.prototype.parseSmoothingGroups=function(){var t=this._cur_obj.indices.length/3;var e=0;while(e<t){this._cur_obj.smoothingGroups[e]=this._byteData.readUnsignedInt();e++}};i.prototype.parseUVList=function(){var t;var e;var i;i=this._byteData.readUnsignedShort();this._cur_obj.uvs=new Array(i*2);t=0;e=this._cur_obj.uvs.length;while(t<e){this._cur_obj.uvs[t++]=this._byteData.readFloat();this._cur_obj.uvs[t++]=1-this._byteData.readFloat()}};i.prototype.parseFaceMaterialList=function(){var t;var e;var i;var r;t=this.readNulTermstring();e=this._byteData.readUnsignedShort();r=new Array(e);i=0;while(i<r.length)r[i++]=this._byteData.readUnsignedShort();this._cur_obj.materials.push(t);this._cur_obj.materialFaces[t]=r};i.prototype.parseObjectAnimation=function(t){var e;var i;var r;var n;var s;r=new A;while(this._byteData.position<t){var a;var o;a=this._byteData.readUnsignedShort();o=this._byteData.readUnsignedInt();switch(a){case 45072:n=this.readNulTermstring();this._byteData.position+=4;s=this._byteData.readShort();break;case 45075:r.x=this._byteData.readFloat();r.z=this._byteData.readFloat();r.y=this._byteData.readFloat();break;default:this._byteData.position+=o-6;break}}if(n!="$$$DUMMY"&&this._unfinalized_objects.hasOwnProperty(n)){e=this._unfinalized_objects[n];i=this.constructObject(e,r);if(i){this._pContent.addChild(i);this._pFinalizeAsset(i,e.name)}delete this._unfinalized_objects[n]}};i.prototype.constructObject=function(t,e){if(e===void 0){e=null}if(t.type==Ws.assetType){var i;var r;var n;var s;var a;var o;var h;var l;if(t.materials.length>1)console.log("The Away3D 3DS parser does not support multiple materials per sprite at this point.");if(!t.indices||t.indices.length==0)return null;h=new Array(t.verts.length/3);l=new Array(t.indices.length/3);this.prepareData(h,l,t);if(this._useSmoothingGroups)this.applySmoothGroups(h,l);t.verts=new Array(h.length*3);for(i=0;i<h.length;i++){t.verts[i*3]=h[i].x;t.verts[i*3+1]=h[i].y;t.verts[i*3+2]=h[i].z}t.indices=new Array(l.length*3);for(i=0;i<l.length;i++){t.indices[i*3]=l[i].a;t.indices[i*3+1]=l[i].b;t.indices[i*3+2]=l[i].c}if(t.uvs){t.uvs=new Array(h.length*2);for(i=0;i<h.length;i++){t.uvs[i*2]=h[i].u;t.uvs[i*2+1]=h[i].v}}if(t.materials.length>0){var p;p=t.materials[0];s=this._materials[p].material}a=new Ws(s);a.transform.matrix3D=new M(t.transform);n=a.graphics;r=new $t(new u);r.setIndices(t.indices);r.setPositions(t.verts);r.setUVs(t.uvs);n.addShape(new jt(r));if(e){if(t.transform){o=new M;o.copyRawDataFrom(t.transform);o._rawData[12]=0;o._rawData[13]=0;o._rawData[14]=0;e=o.transformVector(e)}e.scaleBy(-1);o=new M;o.appendTranslation(e.x,e.y,e.z);n.applyTransformation(o)}if(t.transform){o=new M;o.copyRawDataFrom(t.transform);o.invert();n.applyTransformation(o)}this._pFinalizeAsset(n,t.name.concat("_graphics"));return a}return null};i.prototype.prepareData=function(t,e,i){var r;var n;var s;var a=i.verts.length;for(r=0,n=0,s=0;r<a;){var o=new Ah;o.x=i.verts[r++];o.y=i.verts[r++];o.z=i.verts[r++];if(i.uvs){o.u=i.uvs[n++];o.v=i.uvs[n++]}t[s++]=o}a=i.indices.length;for(r=0,s=0;r<a;){var h=new bh;h.a=i.indices[r++];h.b=i.indices[r++];h.c=i.indices[r++];h.smoothGroup=i.smoothingGroups[s]||0;e[s++]=h}};i.prototype.applySmoothGroups=function(t,e){var i;var r;var n;var s;var a;var o=t.length;var h=e.length;var u=new Array(o);for(i=0;i<o;i++)u[i]=new Array;for(i=0;i<h;i++){var l=e[i];for(r=0;r<3;r++){var p=u[r==0?l.a:r==1?l.b:l.c];var c=l.smoothGroup;for(n=p.length-1;n>=0;n--){if((c&p[n])>0){c|=p[n];p.splice(n,1);n=p.length-1}}p.push(c)}}var _=new Array(o);for(i=0;i<o;i++){if((a=u[i].length)<1)continue;var f=new Array(a);_[i]=f;f[0]=i;var d=t[i];for(r=1;r<a;r++){var g=new Ah;g.x=d.x;g.y=d.y;g.z=d.z;g.u=d.u;g.v=d.v;f[r]=t.length;t.push(g)}}o=t.length;for(i=0;i<h;i++){l=e[i];c=l.smoothGroup;for(r=0;r<3;r++){n=r==0?l.a:r==1?l.b:l.c;p=u[n];a=p.length;f=_[n];for(s=0;s<a;s++){if(c==0&&p[s]==0||(c&p[s])>0){var m=f[s];if(c==0){p.splice(s,1);f.splice(s,1)}if(r==0)l.a=m;else if(r==1)l.b=m;else l.c=m;s=a}}}}};i.prototype.finalizeCurrentMaterial=function(){var t;t=new go(this._cur_mat.ambientColor);if(this._cur_mat.colorMap)t.ambientMethod.texture=this._cur_mat.colorMap.texture||we.getDefaultTexture();t.diffuseMethod.color=this._cur_mat.diffuseColor;t.specularMethod.color=this._cur_mat.specularColor;if(this.materialMode>=2)t.mode=fo.MULTI_PASS;t.bothSides=this._cur_mat.twoSided;this._pFinalizeAsset(t,this._cur_mat.name);this._materials[this._cur_mat.name]=this._cur_mat;this._cur_mat.material=t;this._cur_mat=null};i.prototype.readNulTermstring=function(){var t;var e="";while((t=this._byteData.readUnsignedByte())>0)e+=String.fromCharCode(t);return e};i.prototype.readTransform=function(){var t=new Float32Array(16);t[0]=this._byteData.readFloat();t[2]=this._byteData.readFloat();t[1]=this._byteData.readFloat();t[3]=0;t[8]=this._byteData.readFloat();t[10]=this._byteData.readFloat();t[9]=this._byteData.readFloat();t[11]=0;t[4]=this._byteData.readFloat();t[6]=this._byteData.readFloat();t[5]=this._byteData.readFloat();t[7]=0;t[12]=this._byteData.readFloat();t[14]=this._byteData.readFloat();t[13]=this._byteData.readFloat();t[15]=1;return t};i.prototype.readColor=function(){var t;var e;var i,r,n;t=this._byteData.readUnsignedShort();e=this._byteData.readUnsignedInt();switch(t){case 16:i=this._byteData.readFloat()*255;r=this._byteData.readFloat()*255;n=this._byteData.readFloat()*255;break;case 17:i=this._byteData.readUnsignedByte();r=this._byteData.readUnsignedByte();n=this._byteData.readUnsignedByte();break;default:this._byteData.position+=e-6;break}return i<<16|r<<8|n};return i}(bt);var bh=function(){function t(){}return t}();var wh=function(){function t(){}return t}();var Dh=function(){function t(){}return t}();var Ch=function(){function t(){}return t}();var Ah=function(){function t(){}return t}();var Th=function(t){e(i,t);function i(){var e=t.call(this,J.TEXT)||this;e._parseState=0;return e}i.supportsType=function(t){t=t.toLowerCase();return t=="fnt"};i.supportsData=function(t){try{var e=yt.toString(t);if(e.indexOf("font")!=-1||e.indexOf("Font")!=-1){return true}return false}catch(i){return false}};i.prototype._iResolveDependency=function(t){if(t.assets.length){var e=t.assets[0];e.width=this._bitmapFontTable.texture_width;e.height=this._bitmapFontTable.texture_height;var i=new go(e);i.bothSides=true;i.alphaBlending=true;i.useColorTransform=true;i.style.sampler=new re(false,true,true);this._bitmapFontTable.addMaterial(i);this._pFinalizeAsset(t.assets[0]);this._pFinalizeAsset(i);this._parseState=Ph.PARSE_CHARS}else{this._parseState=Ph.PARSE_COMPLETE}};i.prototype._iResolveDependencyFailure=function(t){this._parseState=Ph.PARSE_COMPLETE};i.prototype._pProceedParsing=function(){var t;switch(this._parseState){case Ph.PARSE_XML:try{this._doc=Ft.getChildrenWithTag(Ft.strToXml(this._pGetTextData()),"font")[0];var e=Ft.getChildrenWithTag(this._doc,"pages")[0];var i=Ft.getChildrenWithTag(e,"page");var r=i.length;for(var n=0;n<r;n++){this._imagePath=Ft.readAttributeValue(i[n],"file")}var s=Ft.getChildrenWithTag(this._doc,"chars")[0];this._chars=Ft.getChildrenWithTag(s,"char");this._parseState=Ph.PARSE_IMAGE;var a=Ft.getChildrenWithTag(this._doc,"info")[0];var o=Ft.getChildrenWithTag(this._doc,"common")[0];var h=Ft.readAttributeValue(a,"face");this._font=new Wa;this._font.name=h;var u=Ft.readAttributeValue(a,"bold");if(u!="0")h+="_bold";var l=Ft.readAttributeValue(a,"italic");if(l!="0")h+="_italic";this._bitmapFontTable=this._font.get_font_table(h,wa.assetType);var p=Ft.readAttributeValue(a,"size");this._bitmapFontTable._init_size=parseInt(p);var c=Ft.readAttributeValue(o,"scaleH");this._bitmapFontTable.texture_height=parseInt(c);var _=Ft.readAttributeValue(o,"scaleW");this._bitmapFontTable.texture_width=parseInt(_);var f=Ft.readAttributeValue(o,"adjustSize");if(f!="")this._bitmapFontTable._adjust_size=parseFloat(f)}catch(d){return bt.PARSING_DONE}break;case Ph.PARSE_IMAGE:if(this._imagePath){this._pAddDependency(this._imagePath,new dt(this._imagePath));this._pPauseAndRetrieveDependencies()}else{return bt.PARSING_DONE}break;case Ph.PARSE_CHARS:var g;var m,y,v,x,b,w,D,C,A;var T;var r=this._chars.length;for(var n=0;n<r;n++){g=this._chars[n];m=parseInt(Ft.readAttributeValue(g,"x"));y=parseInt(Ft.readAttributeValue(g,"y"));v=parseInt(Ft.readAttributeValue(g,"width"));x=parseInt(Ft.readAttributeValue(g,"height"));b=parseInt(Ft.readAttributeValue(g,"xoffset"));w=parseInt(Ft.readAttributeValue(g,"yoffset"));D=parseInt(Ft.readAttributeValue(g,"xadvance"));C=parseInt(Ft.readAttributeValue(g,"page"));A=parseInt(Ft.readAttributeValue(g,"chnl"));T=Ft.readAttributeValue(g,"id");this._bitmapFontTable.setChar(T,m,y,v,x,b,w,D,C,A)}this._pFinalizeAsset(this._font,this._font.name);this._parseState=Ph.PARSE_COMPLETE;break;case Ph.PARSE_COMPLETE:return bt.PARSING_DONE}return bt.MORE_TO_PARSE};return i}(bt);var Ph=function(){function t(){}return t}();Ph.PARSE_XML=0;Ph.PARSE_IMAGE=1;Ph.PARSE_CHARS=2;Ph.PARSE_COMPLETE=3;var Sh;var Eh=function(t){e(i,t);function i(e){if(e===void 0){e=true}var i=t.call(this,J.ARRAY_BUFFER)||this;i._useWebGL=false;i._useWebGL=e;return i}i.supportsType=function(t){t=t.toLowerCase();var e=t=="ttf"||t=="otf";if(e){console.log("FontParse encountered file with supported extension: = "+t)}return t=="ttf"||t=="otf"};i.supportsData=function(t){console.log("ParserFont = "+yt.toString(t,20));try{return true}catch(e){return false}};i.prototype._iResolveDependency=function(t){};i.prototype._iResolveDependencyFailure=function(t){};i.prototype.sortKeys=function(t){var e=[];for(var i in t){e.push(i)}e.sort();return e};i.prototype._pProceedParsing=function(){Sh=window["opentype"];if(Sh){var t="";var e="";var i=Sh.parse(this.data);var r,n,s,a,o;var h=i.tables.head;for(r in i.tables){n=i.tables[r];if(r=="name"){var u=this.sortKeys(n);for(var l=0;l<u.length;l++){var s=u[l];var p=n[s];var c=this.sortKeys(p);for(var _=0;_<c.length;_++){var f=c[_];if(s=="fontFamily"){t=p[f]}else if(s=="fontSubfamily"){e=p[f]}console.log("    "+s+": "+f+" : "+p[f])}}}}if(t==""){console.log("FontParser.ts '"+this._iFileName+"': Could not read fontname !!!")}if(e==""){console.log("FontParser.ts '"+this._iFileName+"': Could not read font_style_name !!!")}var d=pt.getAsset(t);var g=false;if(d==undefined){d=new Wa;g=true}d.name=t;var m=d.get_font_table(e,xa.assetType,i)}if(document){var y=document.createElement("style");y.type="text/css";document.getElementsByTagName("head")[0].appendChild(y);y.style.cssText="@font-face {					font-family: ''"+this._iFileName+"';					src: url('"+this._iFileName+"');					};"}this._pFinalizeAsset(d,d.name);return bt.PARSING_DONE};return i}(bt);var Mh=function(t){e(i,t);function i(e,i){if(e===void 0){e="jpg"}if(i===void 0){i=true}var r=t.call(this,J.ARRAY_BUFFER)||this;r._clipNodes=new Object;r._animationSet=new ns;r.materialFinal=false;r.graphicsCreated=false;r._textureType=e;r._ignoreTexturePath=i;return r}i.supportsType=function(t){t=t.toLowerCase();return t=="md2"};i.supportsData=function(t){return yt.toString(t,4)=="IDP2"};i.prototype._iResolveDependency=function(t){if(t.assets.length!=1)return;var e=new go(t.assets[0]);if(this.materialMode>=2)e.mode=fo.MULTI_PASS;this._pContent.addChild(this._sprite);e.name=this._sprite.material.name;this._sprite.material=e;this._pFinalizeAsset(e);this._pFinalizeAsset(this._sprite.graphics);this._pFinalizeAsset(this._sprite);this.materialFinal=true};i.prototype._iResolveDependencyFailure=function(t){if(this.materialMode<2){this._sprite.material=we.getDefaultMaterial()}else{this._sprite.material=new go(we.getDefaultImage2D());this._sprite.material.mode=fo.MULTI_PASS}this._pContent.addChild(this._sprite);this._pFinalizeAsset(this._sprite.graphics);this._pFinalizeAsset(this._sprite);this.materialFinal=true};i.prototype._pProceedParsing=function(){if(!this._startedParsing){this._byteData=this._pGetByteData();this._startedParsing=true;this._byteData.position=0}while(this._pHasTime()){if(!this._parsedHeader){this._sprite=new Ws;this._graphics=this._sprite.graphics;if(this.materialMode<2){this._sprite.material=we.getDefaultMaterial()}else{this._sprite.material=new go(we.getDefaultImage2D());this._sprite.material.mode=fo.MULTI_PASS}this.parseHeader();this.parseMaterialNames()}else if(!this._parsedUV){this.parseUV()}else if(!this._parsedFaces){this.parseFaces()}else if(!this._parsedFrames){this.parseFrames()}else if(this.graphicsCreated&&this.materialFinal){return bt.PARSING_DONE}else if(!this.graphicsCreated){this.graphicsCreated=true;this._graphics.addShape(new jt(this._firstElements.clone()));this._sprite.name="";if(this.materialFinal){this._pContent.addChild(this._sprite);this._pFinalizeAsset(this._sprite.graphics);this._pFinalizeAsset(this._sprite)}this._pPauseAndRetrieveDependencies()}}return bt.MORE_TO_PARSE};i.prototype._pStartParsing=function(e){this._pContent=new Xs;t.prototype._pStartParsing.call(this,e)};i.prototype.parseHeader=function(){this._ident=this._byteData.readInt();this._version=this._byteData.readInt();this._skinWidth=this._byteData.readInt();this._skinHeight=this._byteData.readInt();this._byteData.readInt();this._numSkins=this._byteData.readInt();this._numVertices=this._byteData.readInt();this._numST=this._byteData.readInt();this._numTris=this._byteData.readInt();this._byteData.readInt();this._numFrames=this._byteData.readInt();this._offsetSkins=this._byteData.readInt();this._offsetST=this._byteData.readInt();this._offsetTris=this._byteData.readInt();this._offsetFrames=this._byteData.readInt();this._byteData.readInt();this._offsetEnd=this._byteData.readInt();this._parsedHeader=true};i.prototype.parseMaterialNames=function(){var t;var e;var i;var r;this._materialNames=new Array;this._byteData.position=this._offsetSkins;var n=new RegExp("[^a-zA-Z0-9\\_/.]","g");for(var s=0;s<this._numSkins;++s){e=this._byteData.readUTFBytes(64);e=e.replace(n,"");i=e.lastIndexOf(".");if(this._ignoreTexturePath)r=e.lastIndexOf("/");if(e.toLowerCase().indexOf(".jpg")==-1&&e.toLowerCase().indexOf(".png")==-1){e=e.substring(r+1,i);t=e+"."+this._textureType}else{t=e}this._materialNames[s]=e;if(this.dependencies.length==0)this._pAddDependency(e,new dt(t))}if(this._materialNames.length>0)this._sprite.material.name=this._materialNames[0];else this.materialFinal=true};i.prototype.parseUV=function(){var t=0;this._uvs=new Array(this._numST*2);this._byteData.position=this._offsetST;for(var e=0;e<this._numST;e++){this._uvs[t++]=this._byteData.readShort()/this._skinWidth;this._uvs[t++]=this._byteData.readShort()/this._skinHeight}this._parsedUV=true};i.prototype.parseFaces=function(){var t,e,i,r,n,s;var a;this._vertIndices=new Array;this._uvIndices=new Array;this._indices=new Array;this._byteData.position=this._offsetTris;for(a=0;a<this._numTris;a++){t=this._byteData.readUnsignedShort();e=this._byteData.readUnsignedShort();i=this._byteData.readUnsignedShort();r=this._byteData.readUnsignedShort();n=this._byteData.readUnsignedShort();s=this._byteData.readUnsignedShort();this.addIndex(t,r);this.addIndex(e,n);this.addIndex(i,s)}var o=this._uvIndices.length;this._finalUV=new Array(o*2);for(a=0;a<o;++a){this._finalUV[a<<1]=this._uvs[this._uvIndices[a]<<1];this._finalUV[(a<<1)+1]=this._uvs[(this._uvIndices[a]<<1)+1]}this._parsedFaces=true};i.prototype.addIndex=function(t,e){var i=this.findIndex(t,e);if(i==-1){this._indices.push(this._vertIndices.length);this._vertIndices.push(t);this._uvIndices.push(e)}else this._indices.push(i)};i.prototype.findIndex=function(t,e){var i=this._vertIndices.length;for(var r=0;r<i;++r){if(this._vertIndices[r]==t&&this._uvIndices[r]==e)return r}return-1};i.prototype.parseFrames=function(){var t,e,r;var n,s,a;var o;var h;var l=this._vertIndices.length;var p;var c;var _,f,d;var g="";var m=null;this._byteData.position=this._offsetFrames;for(_=0;_<this._numFrames;_++){c=new Array;p=new Array(l*3);t=this._byteData.readFloat();e=this._byteData.readFloat();r=this._byteData.readFloat();n=this._byteData.readFloat();s=this._byteData.readFloat();a=this._byteData.readFloat();g=this.readFrameName();for(f=0;f<this._numVertices;f++,this._byteData.position++)c.push(t*this._byteData.readUnsignedByte()+n,e*this._byteData.readUnsignedByte()+s,r*this._byteData.readUnsignedByte()+a);d=0;for(f=0;f<l;f++){p[d++]=c[this._vertIndices[f]*3];p[d++]=c[this._vertIndices[f]*3+2];p[d++]=c[this._vertIndices[f]*3+1]}h=new $t(new u);h.setIndices(this._indices);h.setPositions(p);h.setUVs(this._finalUV);h.setNormals(null);h.setTangents(null);h.autoDeriveNormals=false;h.autoDeriveTangents=false;if(this._firstElements==null)this._firstElements=h;o=new qe;o.addShape(new jt(h));var y=this._clipNodes[g];if(!y){if(m){this._pFinalizeAsset(m);this._animationSet.addAnimation(m)}y=new Qn;y.name=g;y.stitchFinalFrame=true;this._clipNodes[g]=y;m=y}y.addFrame(o,1e3/i.FPS)}if(m){this._pFinalizeAsset(m);this._animationSet.addAnimation(m)}this._pFinalizeAsset(this._animationSet);this._parsedFrames=true};i.prototype.readFrameName=function(){var t="";var e=0;for(var i=0;i<16;i++){var r=this._byteData.readUnsignedByte();if(Math.floor(r)>57&&Math.floor(r)<=122&&e==0)t+=String.fromCharCode(r);if(Math.floor(r)>=48&&Math.floor(r)<=57)e++}return t};return i}(bt);Mh.FPS=6;var Oh=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i=0}var r=t.call(this,J.TEXT)||this;r._parseIndex=0;r._line=0;r._charLineIndex=0;r._rotationQuat=new W;var n=new W;var s=new W;n.fromAxisAngle(A.X_AXIS,-Math.PI*.5);s.fromAxisAngle(A.Y_AXIS,-Math.PI*.5);r._rotationQuat.multiply(s,n);if(e){r._rotationQuat.multiply(s,n);n.fromAxisAngle(e,i);r._rotationQuat.multiply(n,r._rotationQuat)}return r}i.supportsType=function(t){t=t.toLowerCase();return t=="md5anim"};i.supportsData=function(t){return false};i.prototype._pProceedParsing=function(){var t;if(!this._startedParsing){this._textData=this._pGetTextData();this._startedParsing=true}while(this._pHasTime()){t=this.getNextToken();switch(t){case i.COMMENT_TOKEN:this.ignoreLine();break;case"":break;case i.VERSION_TOKEN:this._version=this.getNextInt();if(this._version!=10)throw new Error("Unknown version number encountered!");break;case i.COMMAND_LINE_TOKEN:this.parseCMD();break;case i.NUM_FRAMES_TOKEN:this._numFrames=this.getNextInt();this._bounds=new Array;this._frameData=new Array;break;case i.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt();this._hierarchy=new Array(this._numJoints);this._baseFrameData=new Array(this._numJoints);break;case i.FRAME_RATE_TOKEN:this._frameRate=this.getNextInt();break;case i.NUM_ANIMATED_COMPONENTS_TOKEN:this._numAnimatedComponents=this.getNextInt();break;case i.HIERARCHY_TOKEN:this.parseHierarchy();break;case i.BOUNDS_TOKEN:this.parseBounds();break;case i.BASE_FRAME_TOKEN:this.parseBaseFrame();break;case i.FRAME_TOKEN:this.parseFrame();break;default:if(!this._reachedEOF)this.sendUnknownKeywordError()}if(this._reachedEOF){this._clip=new Gn;this.translateClip();this._pFinalizeAsset(this._clip);return bt.PARSING_DONE}}return bt.MORE_TO_PARSE};i.prototype.translateClip=function(){for(var t=0;t<this._numFrames;++t)this._clip.addFrame(this.translatePose(this._frameData[t]),1e3/this._frameRate)};i.prototype.translatePose=function(t){var e;var i;var r;var n;var s;var a=new A;var o=new W;var h=t.components;var u=new qr;var l=u.jointPoses;for(var p=0;p<this._numJoints;++p){s=0;i=new jr;e=this._hierarchy[p];r=this._baseFrameData[p];n=e.flags;a.x=r.position.x;a.y=r.position.y;a.z=r.position.z;o.x=r.orientation.x;o.y=r.orientation.y;o.z=r.orientation.z;if(n&1)a.x=h[e.startIndex+s++];if(n&2)a.y=h[e.startIndex+s++];if(n&4)a.z=h[e.startIndex+s++];if(n&8)o.x=h[e.startIndex+s++];if(n&16)o.y=h[e.startIndex+s++];if(n&32)o.z=h[e.startIndex+s++];var c=1-o.x*o.x-o.y*o.y-o.z*o.z;o.w=c<0?0:-Math.sqrt(c);if(e.parentIndex<0){i.orientation.multiply(this._rotationQuat,o);i.translation=this._rotationQuat.rotatePoint(a)}else{i.orientation.copyFrom(o);i.translation.x=a.x;i.translation.y=a.y;i.translation.z=a.z}i.orientation.y=-i.orientation.y;i.orientation.z=-i.orientation.z;i.translation.x=-i.translation.x;l[p]=i}return u};i.prototype.parseHierarchy=function(){var t;var e;var r=this.getNextToken();var n=0;if(r!="{")this.sendUnknownKeywordError();do{if(this._reachedEOF)this.sendEOFError();e=new Nh;e.name=this.parseLiteralstring();e.parentIndex=this.getNextInt();e.flags=this.getNextInt();e.startIndex=this.getNextInt();this._hierarchy[n++]=e;t=this.getNextChar();if(t=="/"){this.putBack();t=this.getNextToken();if(t==i.COMMENT_TOKEN)this.ignoreLine();t=this.getNextChar()}if(t!="}")this.putBack()}while(t!="}")};i.prototype.parseBounds=function(){var t;var e;var r=this.getNextToken();var n=0;if(r!="{")this.sendUnknownKeywordError();do{if(this._reachedEOF)this.sendEOFError();e=new Rh;e.min=this.parseVector3D();e.max=this.parseVector3D();this._bounds[n++]=e;t=this.getNextChar();if(t=="/"){this.putBack();t=this.getNextToken();if(t==i.COMMENT_TOKEN)this.ignoreLine();t=this.getNextChar()}if(t!="}")this.putBack()}while(t!="}")};i.prototype.parseBaseFrame=function(){var t;var e;var r=this.getNextToken();var n=0;if(r!="{")this.sendUnknownKeywordError();do{if(this._reachedEOF)this.sendEOFError();e=new Ih;e.position=this.parseVector3D();e.orientation=this.parseQuaternion();this._baseFrameData[n++]=e;t=this.getNextChar();if(t=="/"){this.putBack();t=this.getNextToken();if(t==i.COMMENT_TOKEN)this.ignoreLine();t=this.getNextChar()}if(t!="}")this.putBack()}while(t!="}")};i.prototype.parseFrame=function(){var t;var e;var r;var n;n=this.getNextInt();r=this.getNextToken();if(r!="{")this.sendUnknownKeywordError();do{if(this._reachedEOF)this.sendEOFError();e=new Lh;e.components=new Array(this._numAnimatedComponents);for(var s=0;s<this._numAnimatedComponents;++s)e.components[s]=this.getNextNumber();this._frameData[n]=e;t=this.getNextChar();if(t=="/"){this.putBack();t=this.getNextToken();if(t==i.COMMENT_TOKEN)this.ignoreLine();t=this.getNextChar()}if(t!="}")this.putBack()}while(t!="}")};i.prototype.putBack=function(){this._parseIndex--;this._charLineIndex--;this._reachedEOF=this._parseIndex>=this._textData.length};i.prototype.getNextToken=function(){var t;var e="";while(!this._reachedEOF){t=this.getNextChar();if(t==" "||t=="\r"||t=="\n"||t=="	"){if(e!=i.COMMENT_TOKEN)this.skipWhiteSpace();if(e!="")return e}else e+=t;if(e==i.COMMENT_TOKEN)return e}return e};i.prototype.skipWhiteSpace=function(){var t;do t=this.getNextChar();while(t=="\n"||t==" "||t=="\r"||t=="	");this.putBack()};i.prototype.ignoreLine=function(){var t;while(!this._reachedEOF&&t!="\n")t=this.getNextChar()};i.prototype.getNextChar=function(){var t=this._textData.charAt(this._parseIndex++);if(t=="\n"){++this._line;this._charLineIndex=0}else if(t!="\r")++this._charLineIndex;if(this._parseIndex==this._textData.length)this._reachedEOF=true;return t};i.prototype.getNextInt=function(){var t=parseInt(this.getNextToken());if(isNaN(t))this.sendParseError("int type");return t};i.prototype.getNextNumber=function(){var t=parseFloat(this.getNextToken());if(isNaN(t))this.sendParseError("float type");return t};i.prototype.parseVector3D=function(){var t=new A;var e=this.getNextToken();if(e!="(")this.sendParseError("(");t.x=this.getNextNumber();t.y=this.getNextNumber();t.z=this.getNextNumber();if(this.getNextToken()!=")")this.sendParseError(")");return t};i.prototype.parseQuaternion=function(){var t=new W;var e=this.getNextToken();if(e!="(")this.sendParseError("(");t.x=this.getNextNumber();t.y=this.getNextNumber();t.z=this.getNextNumber();var i=1-t.x*t.x-t.y*t.y-t.z*t.z;t.w=i<0?0:-Math.sqrt(i);if(this.getNextToken()!=")")this.sendParseError(")");return t};i.prototype.parseCMD=function(){this.parseLiteralstring()};i.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var t=this.getNextChar();var e="";if(t!='"')this.sendParseError('"');do{if(this._reachedEOF)this.sendEOFError();t=this.getNextChar();if(t!='"')e+=t}while(t!='"');return e};i.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")};i.prototype.sendParseError=function(t){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+t+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")};i.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")};return i}(bt);Oh.VERSION_TOKEN="MD5Version";Oh.COMMAND_LINE_TOKEN="commandline";Oh.NUM_FRAMES_TOKEN="numFrames";Oh.NUM_JOINTS_TOKEN="numJoints";Oh.FRAME_RATE_TOKEN="frameRate";Oh.NUM_ANIMATED_COMPONENTS_TOKEN="numAnimatedComponents";Oh.HIERARCHY_TOKEN="hierarchy";Oh.BOUNDS_TOKEN="bounds";Oh.BASE_FRAME_TOKEN="baseframe";Oh.FRAME_TOKEN="frame";Oh.COMMENT_TOKEN="//";var Ih=function(){function t(){}return t}();var Rh=function(){function t(){}return t}();var Lh=function(){function t(){}return t}();var Nh=function(){function t(){}return t}();var Fh=function(t){e(i,t);function i(e,i){if(e===void 0){e=null}if(i===void 0){i=0}var r=t.call(this,J.TEXT)||this;r._parseIndex=0;r._line=0;r._charLineIndex=0;r._rotationQuat=new W;r._rotationQuat.fromAxisAngle(A.X_AXIS,-Math.PI*.5);if(e){var n=new W;n.fromAxisAngle(e,i);r._rotationQuat.multiply(r._rotationQuat,n)}return r}i.supportsType=function(t){t=t.toLowerCase();return t=="md5sprite"};i.supportsData=function(t){return false};i.prototype._pProceedParsing=function(){var t;if(!this._startedParsing){this._textData=this._pGetTextData();this._startedParsing=true}while(this._pHasTime()){t=this.getNextToken();switch(t){case i.COMMENT_TOKEN:this.ignoreLine();break;case i.VERSION_TOKEN:this._version=this.getNextInt();if(this._version!=10)throw new Error("Unknown version number encountered!");break;case i.COMMAND_LINE_TOKEN:this.parseCMD();break;case i.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt();this._bindPoses=new Array(this._numJoints);break;case i.NUM_MESHES_TOKEN:this._numMeshes=this.getNextInt();break;case i.JOINTS_TOKEN:this.parseJoints();break;case i.MESH_TOKEN:this.parseMesh();break;default:if(!this._reachedEOF)this.sendUnknownKeywordError()}if(this._reachedEOF){this.calculateMaxJointCount();this._animationSet=new is(this._maxJointCount);this._sprite=new Ws;this._graphics=this._sprite.graphics;for(var e=0;e<this._elementsData.length;++e)this._graphics.addShape(new jt(this.translateElements(this._elementsData[e].positionData,this._elementsData[e].weightData,this._elementsData[e].indices)));this._pContent.addChild(this._sprite);this._pFinalizeAsset(this._graphics);this._pFinalizeAsset(this._sprite);this._pFinalizeAsset(this._skeleton);this._pFinalizeAsset(this._animationSet);return bt.PARSING_DONE}}return bt.MORE_TO_PARSE};i.prototype._pStartParsing=function(e){this._pContent=new Xs;t.prototype._pStartParsing.call(this,e)};i.prototype.calculateMaxJointCount=function(){this._maxJointCount=0;var t=this._elementsData.length;for(var e=0;e<t;++e){var i=this._elementsData[e];var r=i.positionData;var n=r.length;for(var s=0;s<n;++s){var a=this.countZeroWeightJoints(r[s],i.weightData);var o=r[s].countWeight-a;if(o>this._maxJointCount)this._maxJointCount=o}}};i.prototype.countZeroWeightJoints=function(t,e){var i=t.startWeight;var r=t.startWeight+t.countWeight;var n=0;var s;for(var a=i;a<r;++a){s=e[a].bias;if(s==0)++n}return n};i.prototype.parseJoints=function(){var t;var e;var r;var n;var s=0;var a=this.getNextToken();if(a!="{")this.sendUnknownKeywordError();this._skeleton=new Wr;do{if(this._reachedEOF)this.sendEOFError();e=new Yr;e.name=this.parseLiteralstring();e.parentIndex=this.getNextInt();r=this.parseVector3D();r=this._rotationQuat.rotatePoint(r);n=this.parseQuaternion();this._bindPoses[s]=n.toMatrix3D();this._bindPoses[s].appendTranslation(r.x,r.y,r.z);var o=this._bindPoses[s].clone();o.invert();e.inverseBindPose=o._rawData;this._skeleton.joints[s++]=e;t=this.getNextChar();if(t=="/"){this.putBack();t=this.getNextToken();if(t==i.COMMENT_TOKEN)this.ignoreLine();t=this.getNextChar()}if(t!="}")this.putBack()}while(t!="}")};i.prototype.putBack=function(){this._parseIndex--;this._charLineIndex--;this._reachedEOF=this._parseIndex>=this._textData.length};i.prototype.parseMesh=function(){var t=this.getNextToken();var e;var r;var n;var s;if(t!="{")this.sendUnknownKeywordError();if(this._shaders==null)this._shaders=new Array;while(e!="}"){e=this.getNextToken();switch(e){case i.COMMENT_TOKEN:this.ignoreLine();break;case i.MESH_SHADER_TOKEN:this._shaders.push(this.parseLiteralstring());break;case i.MESH_NUM_VERTS_TOKEN:r=new Array(this.getNextInt());break;case i.MESH_NUM_TRIS_TOKEN:s=new Array(this.getNextInt()*3);break;case i.MESH_NUM_WEIGHTS_TOKEN:n=new Array(this.getNextInt());break;case i.MESH_VERT_TOKEN:this.parseVertex(r);break;case i.MESH_TRI_TOKEN:this.parseTri(s);break;case i.MESH_WEIGHT_TOKEN:this.parseJoint(n);break}}if(this._elementsData==null)this._elementsData=new Array;var a=this._elementsData.length;this._elementsData[a]=new Uh;this._elementsData[a].positionData=r;

this._elementsData[a].weightData=n;this._elementsData[a].indices=s};i.prototype.translateElements=function(t,e,i){var r=t.length;var n,s,a;var o;var h;var l;var p;var c=new $t(new u);var _=new Array(r*2);var f=new Array(r*3);var d=new Array(r*this._maxJointCount);var g=new Array(r*this._maxJointCount);var m=0;var y;for(var v=0;v<r;++v){o=t[v];n=o.index*3;s=n+1;a=n+2;f[n]=f[s]=f[a]=0;y=0;for(var x=0;x<o.countWeight;++x){h=e[o.startWeight+x];if(h.bias>0){l=this._bindPoses[h.joint];p=l.transformVector(h.pos);f[n]+=p.x*h.bias;f[s]+=p.y*h.bias;f[a]+=p.z*h.bias;d[m]=h.joint*3;g[m++]=h.bias;++y}}for(x=y;x<this._maxJointCount;++x){d[m]=0;g[m++]=0}n=o.index<<1;_[n++]=o.s;_[n]=o.t}c.jointsPerVertex=this._maxJointCount;c.setIndices(i);c.setPositions(f);c.setUVs(_);c.setJointIndices(d);c.setJointWeights(g);c.setNormals(null);c.setTangents(null);c.autoDeriveTangents=false;c.autoDeriveNormals=false;return c};i.prototype.parseTri=function(t){var e=this.getNextInt()*3;t[e]=this.getNextInt();t[e+1]=this.getNextInt();t[e+2]=this.getNextInt()};i.prototype.parseJoint=function(t){var e=new Vh;e.index=this.getNextInt();e.joint=this.getNextInt();e.bias=this.getNextNumber();e.pos=this.parseVector3D();t[e.index]=e};i.prototype.parseVertex=function(t){var e=new Bh;e.index=this.getNextInt();this.parseUV(e);e.startWeight=this.getNextInt();e.countWeight=this.getNextInt();t[e.index]=e};i.prototype.parseUV=function(t){var e=this.getNextToken();if(e!="(")this.sendParseError("(");t.s=this.getNextNumber();t.t=this.getNextNumber();if(this.getNextToken()!=")")this.sendParseError(")")};i.prototype.getNextToken=function(){var t;var e="";while(!this._reachedEOF){t=this.getNextChar();if(t==" "||t=="\r"||t=="\n"||t=="	"){if(e!=i.COMMENT_TOKEN)this.skipWhiteSpace();if(e!="")return e}else e+=t;if(e==i.COMMENT_TOKEN)return e}return e};i.prototype.skipWhiteSpace=function(){var t;do t=this.getNextChar();while(t=="\n"||t==" "||t=="\r"||t=="	");this.putBack()};i.prototype.ignoreLine=function(){var t;while(!this._reachedEOF&&t!="\n")t=this.getNextChar()};i.prototype.getNextChar=function(){var t=this._textData.charAt(this._parseIndex++);if(t=="\n"){++this._line;this._charLineIndex=0}else if(t!="\r")++this._charLineIndex;if(this._parseIndex>=this._textData.length)this._reachedEOF=true;return t};i.prototype.getNextInt=function(){var t=parseInt(this.getNextToken());if(isNaN(t))this.sendParseError("int type");return t};i.prototype.getNextNumber=function(){var t=parseFloat(this.getNextToken());if(isNaN(t))this.sendParseError("float type");return t};i.prototype.parseVector3D=function(){var t=new A;var e=this.getNextToken();if(e!="(")this.sendParseError("(");t.x=-this.getNextNumber();t.y=this.getNextNumber();t.z=this.getNextNumber();if(this.getNextToken()!=")")this.sendParseError(")");return t};i.prototype.parseQuaternion=function(){var t=new W;var e=this.getNextToken();if(e!="(")this.sendParseError("(");t.x=this.getNextNumber();t.y=-this.getNextNumber();t.z=-this.getNextNumber();var i=1-t.x*t.x-t.y*t.y-t.z*t.z;t.w=i<0?0:-Math.sqrt(i);if(this.getNextToken()!=")")this.sendParseError(")");var r=new W;r.multiply(this._rotationQuat,t);return r};i.prototype.parseCMD=function(){this.parseLiteralstring()};i.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var t=this.getNextChar();var e="";if(t!='"')this.sendParseError('"');do{if(this._reachedEOF)this.sendEOFError();t=this.getNextChar();if(t!='"')e+=t}while(t!='"');return e};i.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")};i.prototype.sendParseError=function(t){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+t+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")};i.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")};return i}(bt);Fh.VERSION_TOKEN="MD5Version";Fh.COMMAND_LINE_TOKEN="commandline";Fh.NUM_JOINTS_TOKEN="numJoints";Fh.NUM_MESHES_TOKEN="numMeshes";Fh.COMMENT_TOKEN="//";Fh.JOINTS_TOKEN="joints";Fh.MESH_TOKEN="mesh";Fh.MESH_SHADER_TOKEN="shader";Fh.MESH_NUM_VERTS_TOKEN="numverts";Fh.MESH_VERT_TOKEN="vert";Fh.MESH_NUM_TRIS_TOKEN="numtris";Fh.MESH_TRI_TOKEN="tri";Fh.MESH_NUM_WEIGHTS_TOKEN="numweights";Fh.MESH_WEIGHT_TOKEN="weight";var Bh=function(){function t(){}return t}();var Vh=function(){function t(){}return t}();var Uh=function(){function t(){}return t}();var kh=function(t){e(i,t);function i(e){if(e===void 0){e=1}var i=t.call(this,J.TEXT)||this;i._mtlLibLoaded=true;i._activeMaterialID="";i._scale=e;return i}Object.defineProperty(i.prototype,"scale",{set:function(t){this._scale=t},enumerable:true,configurable:true});i.supportsType=function(t){t=t.toLowerCase();return t=="obj"};i.supportsData=function(t){var e=yt.toString(t);var i=false;var r=false;if(e){i=e.indexOf("\nv ")!=-1;r=e.indexOf("\nf ")!=-1}return i&&r};i.prototype._iResolveDependency=function(t){if(t.id=="mtl"){var e=yt.toString(t.data);this.parseMtl(e)}else{var i;if(t.assets.length!=1){return}i=t.assets[0];if(i.isAsset(pe)){var r=new Xh;r.materialID=t.id;r.texture=new ve(i);this._materialLoaded.push(r);if(this._sprites.length>0){this.applyMaterial(r)}}}};i.prototype._iResolveDependencyFailure=function(t){if(t.id=="mtl"){this._mtlLib=false;this._mtlLibLoaded=false}else{var e=new Xh;e.materialID=t.id;this._materialLoaded.push(e)}if(this._sprites.length>0)this.applyMaterial(e)};i.prototype._pProceedParsing=function(){var t;var e=String.fromCharCode(10);var i;if(!this._startedParsing){this._textData=this._pGetTextData();this._textData=this._textData.replace(/\\[\r\n]+\s*/gm," ")}if(this._textData.indexOf(e)==-1)e=String.fromCharCode(13);if(!this._startedParsing){this._startedParsing=true;this._vertices=new Array;this._vertexNormals=new Array;this._materialIDs=new Array;this._materialLoaded=new Array;this._sprites=new Array;this._uvs=new Array;this._stringLength=this._textData.length;this._charIndex=this._textData.indexOf(e,0);this._oldIndex=0;this._objects=new Array;this._objectIndex=0}while(this._charIndex<this._stringLength&&this._pHasTime()){this._charIndex=this._textData.indexOf(e,this._oldIndex);if(this._charIndex==-1)this._charIndex=this._stringLength;t=this._textData.substring(this._oldIndex,this._charIndex);t=t.split("\r").join("");t=t.replace("  "," ");i=t.split(" ");this._oldIndex=this._charIndex+1;this.parseLine(i);if(this.parsingPaused){return bt.MORE_TO_PARSE}}if(this._charIndex>=this._stringLength){if(this._mtlLib&&!this._mtlLibLoaded){return bt.MORE_TO_PARSE}this.translate();this.applyMaterials();return bt.PARSING_DONE}return bt.MORE_TO_PARSE};i.prototype._pStartParsing=function(e){this._pContent=new Xs;t.prototype._pStartParsing.call(this,e)};i.prototype.parseLine=function(t){switch(t[0]){case"mtllib":this._mtlLib=true;this._mtlLibLoaded=false;this.loadMtl(t[1]);break;case"g":this.createGroup(t);break;case"o":this.createObject(t);break;case"usemtl":if(this._mtlLib){if(!t[1])t[1]="def000";this._materialIDs.push(t[1]);this._activeMaterialID=t[1];if(this._currentGroup)this._currentGroup.materialID=this._activeMaterialID}break;case"v":this.parseVertex(t);break;case"vt":this.parseUV(t);break;case"vn":this.parseVertexNormal(t);break;case"f":this.parseFace(t)}};i.prototype.translate=function(){for(var t=0;t<this._objects.length;++t){var e=this._objects[t].groups;var i=e.length;var r;var n;var s;var a;var o;var h;var u;for(var l=0;l<i;++l){u=new go(we.getDefaultImage2D());if(this.materialMode>=2)u.mode=fo.MULTI_PASS;a=new Ws(u);s=a.graphics;r=e[l].materialGroups;n=r.length;for(o=0;o<n;++o)this.translateMaterialGroup(r[o],s);if(s.count==0)continue;this._pFinalizeAsset(s);if(this._objects[t].name){a.name=this._objects[t].name}else if(e[l].name){a.name=e[l].name}else{a.name=""}this._sprites.push(a);if(e[l].materialID!="")u.name=e[l].materialID+"~"+a.name;else u.name=this._lastMtlID+"~"+a.name;if(a.graphics.count>1){for(h=1;h<a.graphics.count;++h)a.graphics.getShapeAt(h).material=u}this._pContent.addChild(a);this._pFinalizeAsset(a)}}};i.prototype.translateMaterialGroup=function(t,e){var i=t.faces;var r;var n=i.length;var s;var a;var o=new Array;var h=new Array;var l=new Array;var p=new Array;this._realIndices=[];this._vertexIndex=0;var c;for(var _=0;_<n;++_){r=i[_];s=r.indexIds.length-1;for(c=1;c<s;++c){this.translateVertexData(r,c,o,h,p,l);this.translateVertexData(r,0,o,h,p,l);this.translateVertexData(r,c+1,o,h,p,l)}}if(o.length>0){a=new $t(new u);a.autoDeriveNormals=l.length?false:true;a.setIndices(p);a.setPositions(o);a.setNormals(l);a.setUVs(h);e.addShape(new jt(a))}};i.prototype.translateVertexData=function(t,e,i,r,n,s){var a;var o;var h;var u;if(!this._realIndices[t.indexIds[e]]){a=this._vertexIndex;this._realIndices[t.indexIds[e]]=++this._vertexIndex;o=this._vertices[t.vertexIndices[e]-1];i.push(o.x*this._scale,o.y*this._scale,o.z*this._scale);if(t.normalIndices.length>0){h=this._vertexNormals[t.normalIndices[e]-1];s.push(h.x,h.y,h.z)}if(t.uvIndices.length>0){try{u=this._uvs[t.uvIndices[e]-1];r.push(u.u,u.v)}catch(l){switch(e){case 0:r.push(0,1);break;case 1:r.push(.5,0);break;case 2:r.push(1,1)}}}}else{a=this._realIndices[t.indexIds[e]]-1}n.push(a)};i.prototype.createObject=function(t){this._currentGroup=null;this._currentMaterialGroup=null;this._objects.push(this._currentObject=new zh);if(t)this._currentObject.name=t[1]};i.prototype.createGroup=function(t){if(!this._currentObject)this.createObject(null);this._currentGroup=new jh;this._currentGroup.materialID=this._activeMaterialID;if(t)this._currentGroup.name=t[1];this._currentObject.groups.push(this._currentGroup);this.createMaterialGroup(null)};i.prototype.createMaterialGroup=function(t){this._currentMaterialGroup=new Gh;if(t)this._currentMaterialGroup.url=t[1];this._currentGroup.materialGroups.push(this._currentMaterialGroup)};i.prototype.parseVertex=function(t){var e,i,r;if(t.length>4){var n=[];var s;for(var a=1;a<t.length;++a){s=parseFloat(t[a]);if(!isNaN(s))n.push(s)}e=n[0];i=n[1];r=-n[2];this._vertices.push(new qh(e,i,r))}else{e=parseFloat(t[1]);i=parseFloat(t[2]);r=-parseFloat(t[3]);this._vertices.push(new qh(e,i,r))}};i.prototype.parseUV=function(t){if(t.length>3){var e=[];var i;for(var r=1;r<t.length;++r){i=parseFloat(t[r]);if(!isNaN(i))e.push(i)}this._uvs.push(new Yh(e[0],1-e[1]))}else{this._uvs.push(new Yh(parseFloat(t[1]),1-parseFloat(t[2])))}};i.prototype.parseVertexNormal=function(t){if(t.length>4){var e=[];var i;for(var r=1;r<t.length;++r){i=parseFloat(t[r]);if(!isNaN(i))e.push(i)}this._vertexNormals.push(new qh(e[0],e[1],-e[2]))}else{this._vertexNormals.push(new qh(parseFloat(t[1]),parseFloat(t[2]),-parseFloat(t[3])))}};i.prototype.parseFace=function(t){var e=t.length;var i=new Wh;if(!this._currentGroup){this.createGroup(null)}var r;for(var n=1;n<e;++n){if(t[n]==""){continue}r=t[n].split("/");i.vertexIndices.push(this.parseIndex(parseInt(r[0]),this._vertices.length));if(r[1]&&String(r[1]).length>0)i.uvIndices.push(this.parseIndex(parseInt(r[1]),this._uvs.length));if(r[2]&&String(r[2]).length>0)i.normalIndices.push(this.parseIndex(parseInt(r[2]),this._vertexNormals.length));i.indexIds.push(t[n])}this._currentMaterialGroup.faces.push(i)};i.prototype.parseIndex=function(t,e){if(t<0)return t+e+1;else return t};i.prototype.parseMtl=function(t){var e=t.split("newmtl");var i;var r;var n;var s;var a;var o;var h;var u;var l;var p;var c;var _;for(var f=0;f<e.length;++f){i=e[f].split("\r").join("").split("\n");if(i.length==1)i=e[f].split(String.fromCharCode(13));h=u=l=16777215;p=0;a=false;o=false;c=1;_="";for(n=0;n<i.length;++n){i[n]=i[n].replace(/\s+$/,"");if(i[n].substring(0,1)!="#"&&(n==0||i[n]!="")){r=i[n].split(" ");if(String(r[0]).charCodeAt(0)==9||String(r[0]).charCodeAt(0)==32)r[0]=r[0].substring(1,r[0].length);if(n==0){this._lastMtlID=r.join("");this._lastMtlID=this._lastMtlID==""?"def000":this._lastMtlID}else{switch(r[0]){case"Ka":if(r[1]&&!isNaN(Number(r[1]))&&r[2]&&!isNaN(Number(r[2]))&&r[3]&&!isNaN(Number(r[3])))u=r[1]*255<<16|r[2]*255<<8|r[3]*255;break;case"Ks":if(r[1]&&!isNaN(Number(r[1]))&&r[2]&&!isNaN(Number(r[2]))&&r[3]&&!isNaN(Number(r[3]))){l=r[1]*255<<16|r[2]*255<<8|r[3]*255;a=true}break;case"Ns":if(r[1]&&!isNaN(Number(r[1])))p=Number(r[1])*.001;if(p==0)a=false;break;case"Kd":if(r[1]&&!isNaN(Number(r[1]))&&r[2]&&!isNaN(Number(r[2]))&&r[3]&&!isNaN(Number(r[3]))){h=r[1]*255<<16|r[2]*255<<8|r[3]*255;o=true}break;case"tr":case"d":if(r[1]&&!isNaN(Number(r[1])))c=Number(r[1]);break;case"map_Kd":_=this.parseMapKdString(r);_=_.replace(/\\/g,"/")}}}}if(_!=""){if(a){s=new _o;s.color=l;s.strength=p;var d=new Hh;d.alpha=c;d.basicSpecularMethod=s;d.materialID=this._lastMtlID;if(!this._materialSpecularData)this._materialSpecularData=new Array;this._materialSpecularData.push(d)}this._pAddDependency(this._lastMtlID,new dt(_))}else if(o&&!isNaN(u)){var g=new Xh;g.materialID=this._lastMtlID;if(c==0)console.log("Warning: an alpha value of 0 was found in mtl color tag (Tr or d) ref:"+this._lastMtlID+", sprite(es) using it will be invisible!");var m=new go(u);if(this.materialMode<2){m.alpha=c}else{m.mode=fo.MULTI_PASS}m.diffuseMethod.color=h;if(a){m.specularMethod.color=l;m.specularMethod.strength=p}g.cm=m;this._materialLoaded.push(g);if(this._sprites.length>0)this.applyMaterial(g)}}this._mtlLibLoaded=true};i.prototype.parseMapKdString=function(t){var e="";var i;var r;for(i=1;i<t.length;){switch(t[i]){case"-blendu":case"-blendv":case"-cc":case"-clamp":case"-texres":i+=2;break;case"-mm":i+=3;break;case"-o":case"-s":case"-t":i+=4;continue;default:r=true;break}if(r)break}for(i;i<t.length;i++){e+=t[i];e+=" "}e=e.replace(/\s+$/,"");return e};i.prototype.loadMtl=function(t){this._pAddDependency("mtl",new dt(t),true);this._pPauseAndRetrieveDependencies()};i.prototype.applyMaterial=function(t){var e;var i;var r;var n;var s;for(var a=0;a<this._sprites.length;++a){i=this._sprites[a];e=i.material.name.split("~");if(e[0]==t.materialID){if(t.cm){if(i.material)i.material=null;i.material=t.cm}else if(t.texture){r=i.material;r.ambientMethod.texture=t.texture;r.style.color=t.color;r.alpha=t.alpha;r.style.sampler=new re(true);if(this.materialMode<2)r.alpha=t.alpha;else r.mode=fo.MULTI_PASS;if(t.specularMethod){r.specularMethod=null;r.specularMethod=t.specularMethod}else if(this._materialSpecularData){for(n=0;n<this._materialSpecularData.length;++n){s=this._materialSpecularData[n];if(s.materialID==t.materialID){r.specularMethod=null;r.specularMethod=s.basicSpecularMethod;r.specularMethod.color=s.color;r.specularMethod.strength=s.alpha;break}}}}i.material.name=e[1]?e[1]:e[0];this._sprites.splice(a,1);--a}}if(t.cm||r)this._pFinalizeAsset(t.cm||r)};i.prototype.applyMaterials=function(){if(this._materialLoaded.length==0)return;for(var t=0;t<this._materialLoaded.length;++t)this.applyMaterial(this._materialLoaded[t])};return i}(bt);var zh=function(){function t(){this.groups=new Array}return t}();var jh=function(){function t(){this.materialGroups=new Array}return t}();var Gh=function(){function t(){this.faces=new Array}return t}();var Hh=function(){function t(){this.color=16777215;this.alpha=1}return t}();var Xh=function(){function t(){this.color=16777215;this.alpha=1}return t}();var Wh=function(){function t(){this.vertexIndices=new Array;this.uvIndices=new Array;this.normalIndices=new Array;this.indexIds=new Array}return t}();var Yh=function(){function t(t,e){if(t===void 0){t=0}if(e===void 0){e=0}this._u=t;this._v=e}Object.defineProperty(t.prototype,"v",{get:function(){return this._v},set:function(t){this._v=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"u",{get:function(){return this._u},set:function(t){this._u=t},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this._u,this._v)};t.prototype.toString=function(){return this._u+","+this._v};return t}();var qh=function(){function t(t,e,i,r){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}this._x=t;this._y=e;this._z=i;this._index=r}Object.defineProperty(t.prototype,"index",{get:function(){return this._index},set:function(t){this._index=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this._x,this._y,this._z)};return t}();var Kh=function(){function t(){}t.enableAllBundled=function(){rt.enableParsers(t.ALL_BUNDLED)};return t}();Kh.ALL_BUNDLED=Array(gh,xh,Mh,kh,Th);var Zh=function(){function t(){var t=this;this._viewLookup=new Array;this._nullVector=new A;this._queuedEvents=new Array;this._mouseUp=new ya(ya.MOUSE_UP);this._mouseClick=new ya(ya.CLICK);this._mouseOut=new ya(ya.MOUSE_OUT);this._mouseDown=new ya(ya.MOUSE_DOWN);this._mouseMove=new ya(ya.MOUSE_MOVE);this._mouseOver=new ya(ya.MOUSE_OVER);this._mouseWheel=new ya(ya.MOUSE_WHEEL);this._mouseDoubleClick=new ya(ya.DOUBLE_CLICK);this.onClickDelegate=function(e){return t.onClick(e)};this.onDoubleClickDelegate=function(e){return t.onDoubleClick(e)};this.onMouseDownDelegate=function(e){return t.onMouseDown(e)};this.onMouseMoveDelegate=function(e){return t.onMouseMove(e)};this.onMouseUpDelegate=function(e){return t.onMouseUp(e)};this.onMouseWheelDelegate=function(e){return t.onMouseWheel(e)};this.onMouseOverDelegate=function(e){return t.onMouseOver(e)};this.onMouseOutDelegate=function(e){return t.onMouseOut(e)}}t.getInstance=function(){if(this._instance)return this._instance;return this._instance=new t};t.prototype.fireMouseEvents=function(t){if(this._iCollision!=this._previousCollidingObject){if(this._previousCollidingObject)this.queueDispatch(this._mouseOut,this._mouseMoveEvent,this._previousCollidingObject);if(this._iCollision)this.queueDispatch(this._mouseOver,this._mouseMoveEvent)}if(t&&this._iCollision)this.queueDispatch(this._mouseMove,this._mouseMoveEvent);var e;var i;var r=this._queuedEvents.length;for(var n=0;n<r;++n){e=this._queuedEvents[n];i=e.entity;while(i){if(i._iIsMouseEnabled())i.dispatchEvent(e);i=i.parent}js.execute_queue()}this._queuedEvents.length=0;this._previousCollidingObject=this._iCollision;this._iUpdateDirty=false};t.prototype.registerView=function(t){if(t&&t.htmlElement){t.htmlElement.addEventListener("click",this.onClickDelegate);t.htmlElement.addEventListener("dblclick",this.onDoubleClickDelegate);t.htmlElement.addEventListener("touchstart",this.onMouseDownDelegate);t.htmlElement.addEventListener("mousedown",this.onMouseDownDelegate);t.htmlElement.addEventListener("touchmove",this.onMouseMoveDelegate);t.htmlElement.addEventListener("mousemove",this.onMouseMoveDelegate);t.htmlElement.addEventListener("mouseup",this.onMouseUpDelegate);t.htmlElement.addEventListener("touchend",this.onMouseUpDelegate);t.htmlElement.addEventListener("mousewheel",this.onMouseWheelDelegate);t.htmlElement.addEventListener("mouseover",this.onMouseOverDelegate);t.htmlElement.addEventListener("mouseout",this.onMouseOutDelegate);this._viewLookup.push(t)}};t.prototype.unregisterView=function(t){if(t&&t.htmlElement){t.htmlElement.removeEventListener("click",this.onClickDelegate);t.htmlElement.removeEventListener("dblclick",this.onDoubleClickDelegate);t.htmlElement.removeEventListener("touchstart",this.onMouseDownDelegate);t.htmlElement.removeEventListener("mousedown",this.onMouseDownDelegate);t.htmlElement.removeEventListener("touchmove",this.onMouseMoveDelegate);t.htmlElement.removeEventListener("mousemove",this.onMouseMoveDelegate);t.htmlElement.removeEventListener("touchend",this.onMouseUpDelegate);t.htmlElement.removeEventListener("mouseup",this.onMouseUpDelegate);t.htmlElement.removeEventListener("mousewheel",this.onMouseWheelDelegate);t.htmlElement.removeEventListener("mouseover",this.onMouseOverDelegate);t.htmlElement.removeEventListener("mouseout",this.onMouseOutDelegate);this._viewLookup.slice(this._viewLookup.indexOf(t),1)}};t.prototype.addEventsForViewBinary=function(t,e){if(e===void 0){e=0}var i={};i.clientX=null;i.clientY=null;i.touches=[];i.changedTouches=[];i.preventDefault=function(){};var r=new Float32Array(t);var n=0;var s=0;var a=0;s++;var o=r[s++];var h=r[s++];var u=r[s++];var l=0;var p=0;if(h!=1&&h!=6&&h!=12&&h!=262&&h!=518){for(n=0;n<o;n++){var c={};c.identifier=r[s++];c.clientX=r[s++];c.clientY=r[s++];i.touches[n]=c}i.changedTouches[0]=i.touches[u];l=i.changedTouches[0].clientX;p=i.changedTouches[0].clientY}else{if(o==1){var c={};c.identifier=r[s++];c.clientX=r[s++];c.clientY=r[s++];i.clientX=c.clientX;i.clientY=c.clientY;l=i.clientX;p=i.clientY}else{for(n=0;n<o;n++){var c={};c.identifier=r[s++];c.clientX=r[s++];c.clientY=r[s++];if(n!=u){i.touches[a]=c}else{i.clientX=c.clientX;i.clientY=c.clientY;l=i.clientX;p=i.clientY}}}}i.target=this._viewLookup[e].htmlElement;if(h==0||h==5||h==11||h==261||h==517){this.onMouseDown(i)}else if(h==1||h==6||h==12||h==262||h==518){this.onMouseUp(i)}else if(h==2){this.onMouseMove(i)}else{console.log("recieved unknown touch event-type: "+h)}};t.prototype.fireEventsForViewFromString=function(t,e){if(e===void 0){e=0}var i={};i.clientX=null;i.clientY=null;i.preventDefault=function(){};var r=t.split(",");var n=0;var s=0;var a=parseInt(r[s++]);var o=parseInt(r[s++]);var h=parseInt(r[s++]);i.touches=[];i.changedTouches=[];if(o!=1&&o!=6){for(n=0;n<a;n++){var u={};u.identifier=r[s++];u.clientX=r[s++];u.clientY=r[s++];i.touches[n]=u;i.changedTouches[n]=u}i.changedTouches[n]=i.touches[h]}else{for(n=0;n<a;n++){if(n!=h){var u={};u.identifier=r[s++];u.clientX=r[s++];u.clientY=r[s++];i.touches[n]=u;i.changedTouches[n]=u}else{i.clientX=r[s++];i.clientY=r[s++];s++}}}i.target=this._viewLookup[e].htmlElement;if(o==0){this.onMouseDown(i)}else if(o==1){this.onMouseUp(i)}else if(o==2){this.onMouseMove(i)}else if(o==261){this.onMouseDown(i)}else if(o==6){this.onMouseUp(i)}};t.prototype.queueDispatch=function(t,e,i){if(i===void 0){i=null}if(e){t.ctrlKey=e.ctrlKey;t.altKey=e.altKey;t.shiftKey=e.shiftKey;t.screenX=e.clientX!=null?e.clientX:e.changedTouches[0].clientX;t.screenY=e.clientY!=null?e.clientY:e.changedTouches[0].clientY}if(i==null)i=this._iCollision;if(i){t.entity=i.entity;t.renderable=i.renderable;t.uv=i.uv;t.position=i.position?i.position.clone():null;t.normal=i.normal?i.normal.clone():null;t.elementIndex=i.elementIndex}else{t.uv=null;t.entity=null;t.position=this._nullVector;t.normal=this._nullVector;t.elementIndex=0}this._queuedEvents.push(t)};t.prototype.onMouseMove=function(t){t.preventDefault();this.updateColliders(t);if(this._iCollision)this.queueDispatch(this._mouseMove,this._mouseMoveEvent=t)};t.prototype.onMouseOut=function(t){this._iActiveDiv=null;this.updateColliders(t);if(this._iCollision)this.queueDispatch(this._mouseOut,t)};t.prototype.onMouseOver=function(t){this._iActiveDiv=t.target;this.updateColliders(t);if(this._iCollision)this.queueDispatch(this._mouseOver,t)};t.prototype.onClick=function(t){this.updateColliders(t);if(this._iCollision)this.queueDispatch(this._mouseClick,t)};t.prototype.onDoubleClick=function(t){this.updateColliders(t);if(this._iCollision)this.queueDispatch(this._mouseDoubleClick,t)};t.prototype.onMouseDown=function(t){t.preventDefault();this._iActiveDiv=t.target;this.updateColliders(t);if(this._iCollision)this.queueDispatch(this._mouseDown,t)};t.prototype.onMouseUp=function(t){t.preventDefault();this.updateColliders(t);if(this._iCollision)this.queueDispatch(this._mouseUp,t)};t.prototype.onMouseWheel=function(t){this.updateColliders(t);if(this._iCollision)this.queueDispatch(this._mouseWheel,t)};t.prototype.updateColliders=function(t){var e;var i;var r=t.clientX!=null?t.clientX:t.changedTouches[0].clientX;var n=t.clientY!=null?t.clientY:t.changedTouches[0].clientY;var s=this._viewLookup.length;for(var a=0;a<s;a++){e=this._viewLookup[a];e._pTouchPoints.length=0;i=e.htmlElement.getBoundingClientRect();if(t.touches){var o;var s=t.touches.length;for(var a=0;a<s;a++){o=t.touches[a];e._pTouchPoints.push(new Hs(o.clientX+i.left,o.clientY+i.top,o.identifier))}}if(this._iUpdateDirty)continue;if(r<i.left||r>i.right||n<i.top||n>i.bottom){e._pMouseX=null;e._pMouseY=null}else{e._pMouseX=r+i.left;e._pMouseY=n+i.top;e.updateCollider();if(e.layeredView&&this._iCollision)break}}this._iUpdateDirty=true};return t}();var Qh=function(){function t(){var e=this;this._updateDirty=true;this._nullVector=new A;this._queuedEvents=new Array;this._touchOut=new Ra(Ra.TOUCH_OUT);this._touchBegin=new Ra(Ra.TOUCH_BEGIN);this._touchMove=new Ra(Ra.TOUCH_MOVE);this._touchEnd=new Ra(Ra.TOUCH_END);this._touchOver=new Ra(Ra.TOUCH_OVER);this._touchPoints=new Array;this._touchPointFromId=new Object;t._iCollisionFromTouchId=new Object;t._previousCollidingObjectFromTouchId=new Object;this.onTouchBeginDelegate=function(t){return e.onTouchBegin(t)};this.onTouchMoveDelegate=function(t){return e.onTouchMove(t)};this.onTouchEndDelegate=function(t){return e.onTouchEnd(t)}}t.getInstance=function(){if(this._instance)return this._instance;return this._instance=new t};t.prototype.updateCollider=function(t){};t.prototype.fireTouchEvents=function(e){var i;for(i=0;i<this._numTouchPoints;++i){this._touchPoint=this._touchPoints[i];this._iCollision=t._iCollisionFromTouchId[this._touchPoint.id];this._previousCollidingObject=t._previousCollidingObjectFromTouchId[this._touchPoint.id];if(this._iCollision!=this._previousCollidingObject){if(this._previousCollidingObject)this.queueDispatch(this._touchOut,this._touchMoveEvent,this._previousCollidingObject,this._touchPoint);if(this._iCollision)this.queueDispatch(this._touchOver,this._touchMoveEvent,this._iCollision,this._touchPoint)}if(e&&this._iCollision)this.queueDispatch(this._touchMove,this._touchMoveEvent,this._iCollision,this._touchPoint)}var r;var n;var s=this._queuedEvents.length;for(i=0;i<s;++i){r=this._queuedEvents[i];n=r.entity;while(n&&!n._iIsMouseEnabled())n=n.parent;if(n)n.dispatchEvent(r)}this._queuedEvents.length=0;this._updateDirty=false;for(i=0;i<this._numTouchPoints;++i){this._touchPoint=this._touchPoints[i];t._previousCollidingObjectFromTouchId[this._touchPoint.id]=t._iCollisionFromTouchId[this._touchPoint.id]}};t.prototype.registerView=function(t){t.htmlElement.addEventListener("touchstart",this.onTouchBeginDelegate);t.htmlElement.addEventListener("touchmove",this.onTouchMoveDelegate);t.htmlElement.addEventListener("touchend",this.onTouchEndDelegate)};t.prototype.unregisterView=function(t){t.htmlElement.removeEventListener("touchstart",this.onTouchBeginDelegate);t.htmlElement.removeEventListener("touchmove",this.onTouchMoveDelegate);t.htmlElement.removeEventListener("touchend",this.onTouchEndDelegate)};t.prototype.queueDispatch=function(t,e,i,r){t.ctrlKey=e.ctrlKey;t.altKey=e.altKey;t.shiftKey=e.shiftKey;t.screenX=r.x;t.screenY=r.y;t.touchPointID=r.id;if(i){t.entity=i.entity;t.renderable=i.renderable;t.uv=i.uv;t.position=i.position?i.position.clone():null;t.normal=i.normal?i.normal.clone():null;t.elementIndex=i.elementIndex}else{t.uv=null;t.entity=null;t.position=this._nullVector;t.normal=this._nullVector;t.elementIndex=0}this._queuedEvents.push(t)};t.prototype.onTouchBegin=function(e){var i=new Jh;this._numTouchPoints++;this._touchPoints.push(i);this._touchPointFromId[i.id]=i;this._iCollision=t._iCollisionFromTouchId[i.id];if(this._iCollision)this.queueDispatch(this._touchBegin,e,this._iCollision,i);this._updateDirty=true};t.prototype.onTouchMove=function(t){};t.prototype.onTouchEnd=function(t){};return t}();var Jh=function(){function t(){}return t}();var $h=function(){function t(){this._bounds=new ea;this._pChildNodes=new Array;this._pNumChildNodes=0;this.numEntities=0}Object.defineProperty(t.prototype,"debugVisible",{get:function(){return false},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"bounds",{get:function(){return this._bounds},enumerable:true,configurable:true});t.prototype.isInFrustum=function(t,e){return true};t.prototype.isIntersectingRay=function(t,e){return true};t.prototype.isRenderable=function(){return true};t.prototype.isCastingShadow=function(){return true};t.prototype.renderBounds=function(t){};t.prototype.isMask=function(){return false};t.prototype.dispose=function(){this.parent=null;this._pChildNodes=null};t.prototype.acceptTraverser=function(t){if(this.numEntities==0)return;if(t.enterNode(this)){for(var e=0;e<this._pNumChildNodes;e++)this._pChildNodes[e].acceptTraverser(t)}};t.prototype.iAddNode=function(t){t.parent=this;this.numEntities+=t.numEntities;this._pChildNodes[this._pNumChildNodes++]=t;var e=t.numEntities;t=this;do{t.numEntities+=e}while((t=t.parent)!=null)};t.prototype.iRemoveNode=function(t){var e=this._pChildNodes.indexOf(t);this._pChildNodes[e]=this._pChildNodes[--this._pNumChildNodes];this._pChildNodes.pop();var i=t.numEntities;t=this;do{t.numEntities-=i}while((t=t.parent)!=null)};return t}();var tu=function(){function t(t){this._abstractionPool=new Object;this._updatesMade=false;this._root=t}Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:true,configurable:true});t.prototype.getAbstraction=function(e){return this._abstractionPool[e.id]||(this._abstractionPool[e.id]=new t._abstractionClassPool[e.assetType](e,this))};t.prototype.clearAbstraction=function(t){this._abstractionPool[t.id]=null};t.prototype.traverse=function(t){if(this._updatesMade)this.updateEntities();if(this._rootNode)this._rootNode.acceptTraverser(t)};t.prototype.iMarkForUpdate=function(t){var e=this._updateQueue;while(e){if(t==e)return;e=e._iUpdateQueueNext}t._iUpdateQueueNext=this._updateQueue;this._updateQueue=t;this._updatesMade=true};t.prototype.iRemoveEntity=function(t){var e;if(t.parent){t.parent.iRemoveNode(t);t.parent=null}if(t==this._updateQueue){this._updateQueue=t._iUpdateQueueNext}else{e=this._updateQueue;while(e&&e._iUpdateQueueNext!=t)e=e._iUpdateQueueNext;if(e)e._iUpdateQueueNext=t._iUpdateQueueNext}t._iUpdateQueueNext=null;if(!this._updateQueue)this._updatesMade=false};t.prototype.findParentForNode=function(t){return this._rootNode};t.prototype.updateEntities=function(){var t=this._updateQueue;while(t){t._entity._iInternalUpdate();t=t._iUpdateQueueNext}t=this._updateQueue;var e;var i;this._updateQueue=null;this._updatesMade=false;do{e=this.findParentForNode(t);if(t.parent!=e){if(t.parent)t.parent.iRemoveNode(t);e.iAddNode(t)}i=t._iUpdateQueueNext;t._iUpdateQueueNext=null}while((t=i)!=null)};t.prototype._iRegisterEntity=function(t){if(t.isEntity)this.iMarkForUpdate(this.getAbstraction(t))};t.prototype._iUnregisterEntity=function(t){if(t.isEntity)this.iRemoveEntity(this.getAbstraction(t))};t.prototype.dispose=function(){};t.registerAbstraction=function(e,i){t._abstractionClassPool[i.assetType]=e};return t}();tu._abstractionClassPool=new Object;var eu=function(t){e(i,t);function i(e){var i=t.call(this,e)||this;i._rootNode=new $h;return i}return i}(tu);var iu=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.numEntities=0;r.isSceneGraphNode=false;r._boundsDirty=true;r._onInvalidatePartitionBoundsDelegate=function(t){return r._onInvalidatePartitionBounds(t)};r._entity=e;r._entity.addEventListener(Us.INVALIDATE_PARTITION_BOUNDS,r._onInvalidatePartitionBoundsDelegate);r._boundsType=r._entity.boundsType;return r}Object.defineProperty(i.prototype,"debugVisible",{get:function(){return this._entity.debugVisible},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"bounds",{get:function(){if(this._boundsDirty)this._updateBounds();return this._bounds},enumerable:true,configurable:true});i.prototype.isCastingShadow=function(){return this._entity.castsShadows};i.prototype.isMask=function(){return this._entity.maskMode};i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this._entity.removeEventListener(Us.INVALIDATE_PARTITION_BOUNDS,this._onInvalidatePartitionBoundsDelegate);this._entity=null;

if(this._bounds)this._bounds.dispose();this._bounds=null};i.prototype.onInvalidate=function(e){t.prototype.onInvalidate.call(this,e);if(this._boundsType!=this._entity.boundsType){this._boundsType=this._entity.boundsType;this._boundsDirty=true}};i.prototype.isInFrustum=function(t,e){return true};i.prototype.isIntersectingRay=function(t,e){return true};i.prototype.isRenderable=function(){return true};i.prototype.renderBounds=function(t){t.applyEntity(this.bounds.boundsPrimitive)};i.prototype.acceptTraverser=function(t){};i.prototype._onInvalidatePartitionBounds=function(t){};i.prototype._updateBounds=function(){if(this._bounds)this._bounds.dispose();if(this._boundsType==Vs.AXIS_ALIGNED_BOX)this._bounds=new Qs(this._entity);else if(this._boundsType==Vs.SPHERE)this._bounds=new ta(this._entity);else if(this._boundsType==Vs.NULL)this._bounds=new ea;this._boundsDirty=false};return i}(K);var ru=function(t){e(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.numEntities=1;r._maskPosition=new A;r._partition=i;return r}i.prototype.onClear=function(e){t.prototype.onClear.call(this,e);this._partition=null};i.prototype.isInFrustum=function(t,e){if(!this._entity._iIsVisible())return false;return true};i.prototype.isIntersectingRay=function(t,e){if(!this._entity._iIsVisible()||!this.isIntersectingMasks(t,e,this._entity._iAssignedMasks()))return false;var i=this._entity._iPickingCollision;i.rayPosition=this._entity.transform.inverseConcatenatedMatrix3D.transformVector(t);i.rayDirection=this._entity.transform.inverseConcatenatedMatrix3D.deltaTransformVector(e);if(!i.normal)i.normal=new A;var r=this.bounds.rayIntersection(i.rayPosition,i.rayDirection,i.normal);if(r<0)return false;i.rayEntryDistance=r;i.globalRayPosition=t;i.globalRayDirection=e;i.rayOriginIsInsideBounds=r==0;return true};i.prototype.isRenderable=function(){return this._entity._iAssignedColorTransform()._isRenderable()};i.prototype.acceptTraverser=function(t){if(t.enterNode(this))t[this._entity.traverseName](this._entity)};i.prototype._onInvalidatePartitionBounds=function(t){this.bounds.invalidate();this._partition.iMarkForUpdate(this)};i.prototype.isIntersectingMasks=function(t,e,i){if(i!=null){this._maskPosition.x=t.x+e.x*1e3;this._maskPosition.y=t.y+e.y*1e3;var r=i.length;var n;var s;var a;for(var o=0;o<r;o++){n=i[o];s=n.length;a=false;for(var h=0;h<s;h++){if(n[h].hitTestPoint(this._maskPosition.x,this._maskPosition.y,true,true)){a=true;break}}if(!a)return false}}return true};return i}(iu);var nu=function(t){e(i,t);function i(){return t.apply(this,arguments)||this}i.prototype.acceptTraverser=function(t){};return i}(ru);var su=function(t){e(i,t);function i(){var e=t.apply(this,arguments)||this;e.isSceneGraphNode=true;e._numNodes=0;e._pChildNodes=new Array;e._childDepths=new Array;e._numMasks=0;e._childMasks=new Array;return e}i.prototype.acceptTraverser=function(t){if(this.numEntities==0)return;var e;for(e=this._numNodes-1;e>=0;e--)this._pChildNodes[e].acceptTraverser(t);for(e=this._numMasks-1;e>=0;e--)this._childMasks[e].acceptTraverser(t)};i.prototype.iAddNode=function(t){t.parent=this;if(t._entity.maskMode){this._childMasks.push(t);this._numMasks++}else{var e=t._entity._depthID;var i=this._childDepths.length;var r=i;while(r--)if(this._childDepths[r]<e)break;r++;if(r<i){this._pChildNodes.splice(r,0,t);this._childDepths.splice(r,0,e)}else{this._pChildNodes.push(t);this._childDepths.push(e)}this._numNodes++}var n=t.isSceneGraphNode?t.numEntities:1;t=this;do{t.numEntities+=n}while((t=t.parent)!=null)};i.prototype.iRemoveNode=function(t){if(t._entity.maskMode){this._childMasks.splice(this._childMasks.indexOf(t),1);this._numMasks--}else{var e=this._pChildNodes.indexOf(t);this._pChildNodes.splice(e,1);this._childDepths.splice(e,1);this._numNodes--}var i=t.numEntities;t=this;do{t.numEntities-=i}while((t=t.parent)!=null)};return i}(iu);var au=function(t){e(i,t);function i(e){var i=t.call(this,e)||this;i._sceneGraphNodePool=new ou;return i}i.prototype.traverse=function(e){t.prototype.traverse.call(this,e)};i.prototype.findParentForNode=function(t){if(this._root==t._entity){this._rootNode=t;return null}if(!t.isSceneGraphNode&&t._entity.isContainer)return this._sceneGraphNodePool.getAbstraction(t._entity);return this._sceneGraphNodePool.getAbstraction(t._entity.parent)};i.prototype._iRegisterEntity=function(e){t.prototype._iRegisterEntity.call(this,e);if(e.isContainer)this.iMarkForUpdate(this._sceneGraphNodePool.getAbstraction(e))};i.prototype._iUnregisterEntity=function(e){t.prototype._iUnregisterEntity.call(this,e);if(e.isContainer)this.iRemoveEntity(this._sceneGraphNodePool.getAbstraction(e))};return i}(tu);var ou=function(){function t(){this._abstractionPool=new Object}t.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new su(t,this))};t.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]};return t}();var hu=function(t){e(i,t);function i(){return t.apply(this,arguments)||this}i.prototype.isInFrustum=function(t,e){if(!this._entity._iIsVisible)return false;return true};i.prototype.isCastingShadow=function(){return false};return i}(ru);var uu=function(){function t(t){if(t===void 0){t=false}this._findClosestCollision=t}t.prototype.testBillboardCollision=function(t,e,i){i.renderable=null;return false};t.prototype.testTriangleCollision=function(t,e,i,r,n){if(n===void 0){n=0}var s=i.rayPosition;var a=i.rayDirection;var o;var h,u,l;var p,c,_;var f,d,g;var m,y,v;var x,b,w,D;var C,T,P;var S,E,M;var O,I,R;var L,N,F;var B,V,U;var k,j,G,H;var X,W,Y,q,K;var Z=-1;var Q=e.bothSides;var J=t.positions.get(r,n);var $=t.positions.dimensions;var tt=t.positions.stride;var et;if(t.indices){et=t.indices.get(t.numElements);r=et.length}for(var it=0;it<r;it+=3){if(et){h=et[it]*tt;u=et[it+1]*tt;l=et[it+2]*tt}else{h=it*tt;u=(it+1)*tt;l=(it+2)*tt}C=J[h];S=J[u];O=J[l];L=S-C;B=O-C;T=J[h+1];E=J[u+1];I=J[l+1];N=E-T;V=I-T;if($==3){P=J[h+2];M=J[u+2];R=J[l+2];F=M-P;U=R-P;f=N*U-F*V;d=F*B-L*U;g=L*V-N*B;k=1/Math.sqrt(f*f+d*d+g*g);f*=k;d*=k;g*=k}else{f=0;d=0;g=1}j=f*a.x+d*+a.y+g*a.z;if(!Q&&j<0||Q&&j!=0){G=-(f*C+d*T+g*P);H=-(f*s.x+d*s.y+g*s.z+G);o=H/j;m=s.x+o*a.x;y=s.y+o*a.y;v=s.z+o*a.z;X=L*B+N*V+F*U;W=L*L+N*N+F*F;Y=B*B+V*V+U*U;p=m-C;c=y-T;_=v-P;q=p*L+c*N+_*F;K=p*B+c*V+_*U;x=1/(W*Y-X*X);w=x*(Y*q-X*K);D=x*(-X*q+W*K);if(w<0)continue;if(D<0)continue;b=1-w-D;if(!(b<0)&&o>0&&o<i.rayEntryDistance){Z=it/3;i.rayEntryDistance=o;i.position=new A(m,y,v);i.normal=new A(f,d,g);if(t.uvs){var rt=t.uvs.get(t.numVertices);var nt=t.uvs.stride;var st=et[it]*nt;var at=new A(rt[st],rt[st+1]);st=et[it+1]*nt;var ot=new A(rt[st],rt[st+1]);st=et[it+2]*nt;var ht=new A(rt[st],rt[st+1]);i.uv=new z(b*at.x+w*ot.x+D*ht.x,b*at.y+w*ot.y+D*ht.y)}i.elementIndex=Z;if(!this._findClosestCollision)return true}}}if(Z>=0)return true;return false};t.prototype.testLineCollision=function(t,e,i,r,n){if(n===void 0){n=0}return false};return t}();var lu=function(t){e(i,t);function i(e){if(e===void 0){e=false}var i=t.call(this)||this;i._entities=new Array;i.onlyMouseEnabled=true;i._findClosestCollision=e;return i}i.prototype.enterNode=function(t){return t.isIntersectingRay(this._rayPosition,this._rayDirection)&&!t.isMask()};i.prototype.getCollision=function(t,e,i){this._rayPosition=t;this._rayDirection=e;i.traversePartitions(this);if(!this._entities.length)return null;var r=this.getPickingCollision(i);this._entities.length=0;return r};i.prototype.setIgnoreList=function(t){this._ignoredEntities=t};i.prototype.isIgnored=function(t){if(this.onlyMouseEnabled&&!t._iIsMouseEnabled())return true;if(this._ignoredEntities){var e=this._ignoredEntities.length;for(var i=0;i<e;i++)if(this._ignoredEntities[i]==t)return true}return false};i.prototype.sortOnNearT=function(t,e){return t._iPickingCollision.rayEntryDistance>e._iPickingCollision.rayEntryDistance?1:-1};i.prototype.getPickingCollision=function(t){this._entities=this._entities.sort(this.sortOnNearT);this._bestCollision=null;var e=this._entities.length;for(var i=0;i<e;i++){this._entity=this._entities[i];this._testCollision=this._entity._iPickingCollision;if(this._bestCollision==null||this._testCollision.rayEntryDistance<this._bestCollision.rayEntryDistance){this._testCollider=t.getPartition(this._entity).getAbstraction(this._entity).pickingCollider;if(this._testCollider){this._testCollision.rayEntryDistance=Number.MAX_VALUE;this._entity._acceptTraverser(this);if(this._bestCollision&&!this._findClosestCollision)break}else if(!this._testCollision.rayOriginIsInsideBounds){this._bestCollision=this._testCollision;break}}}if(this._bestCollision)this.updatePosition(this._bestCollision);return this._bestCollision};i.prototype.updatePosition=function(t){var e=t.position||(t.position=new A);var i=t.rayDirection;var r=t.rayPosition;var n=t.rayEntryDistance;e.x=r.x+n*i.x;e.y=r.y+n*i.y;e.z=r.z+n*i.z};i.prototype.dispose=function(){};i.prototype.applyEntity=function(t){if(!this.isIgnored(t))this._entities.push(t)};i.prototype.applyBillboard=function(t){if(this._testCollider.testBillboardCollision(t,t.material,this._testCollision))this._bestCollision=this._testCollision};i.prototype.applyLineShape=function(t){if(this._testCollider.testLineCollision(t.elements,t.material||this._entity.material,this._testCollision,t.count||t.elements.numVertices,t.offset))this._bestCollision=this._testCollision};i.prototype.applyTriangleShape=function(t){if(this._testCollider.testTriangleCollision(t.elements,t.material||this._entity.material,this._testCollision,t.count||t.elements.numVertices,t.offset))this._bestCollision=this._testCollision};i.prototype.applyDirectionalLight=function(t){};i.prototype.applyLightProbe=function(t){};i.prototype.applyPointLight=function(t){};i.prototype.applySkybox=function(t){};return i}(Ht);var pu=function(){function t(t,e,i){if(t===void 0){t=null}if(e===void 0){e=null}if(i===void 0){i=null}var r=this;this._width=0;this._height=0;this._time=0;this._deltaTime=0;this._backgroundColor=0;this._backgroundAlpha=1;this._viewportDirty=true;this._scissorDirty=true;this._mousePicker=new lu;this._partitions=new Object;this._pTouchPoints=new Array;this._onProjectionChangedDelegate=function(t){return r._onProjectionChanged(t)};this._onViewportUpdatedDelegate=function(t){return r._onViewportUpdated(t)};this._onScissorUpdatedDelegate=function(t){return r._onScissorUpdated(t)};this.scene=e||new io;this.camera=i||new ua;this.renderer=t||new ys;if(typeof document!=="undefined"){document.body.style.margin="0px";this._htmlElement=document.createElement("div");this._htmlElement.style.position="absolute";this._htmlElement.style.left="0px";this._htmlElement.style.top="0px";document.body.appendChild(this._htmlElement)}this._mouseManager=Zh.getInstance();this._mouseManager.registerView(this)}t.prototype.getPartition=function(t){return this._partitions[t.partition.id]||this._partitions[this._pScene.id]};t.prototype.setPartition=function(t,e){var i=this._partitions[t.id];if(i==e)return;t.isPartition=false;if(i){i.dispose();delete this._partitions[t.id]}if(e){this._partitions[t.id]=e;t.isPartition=true}};t.prototype.getCollider=function(t){return this.getPartition(t).getAbstraction(t).pickingCollider};t.prototype.setCollider=function(t,e){this.getPartition(t).getAbstraction(t).pickingCollider=e};Object.defineProperty(t.prototype,"mouseX",{get:function(){return this._pMouseX},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"mouseY",{get:function(){return this._pMouseY},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"touchPoints",{get:function(){return this._pTouchPoints},enumerable:true,configurable:true});t.prototype.getLocalMouseX=function(t){return t.transform.inverseConcatenatedMatrix3D.transformVector(this.unproject(this._pMouseX,this._pMouseY,1e3)).x};t.prototype.getLocalMouseY=function(t){return t.transform.inverseConcatenatedMatrix3D.transformVector(this.unproject(this._pMouseX,this._pMouseY,1e3)).y};t.prototype.getLocalTouchPoints=function(t){var e;var i=new Array;var r=this._pTouchPoints.length;for(var n=0;n<r;n++){e=t.transform.inverseConcatenatedMatrix3D.transformVector(this.unproject(this._pTouchPoints[n].x,this._pTouchPoints[n].y,1e3));i.push(new Hs(e.x,e.y,this._pTouchPoints[n].id))}return i};Object.defineProperty(t.prototype,"htmlElement",{get:function(){return this._htmlElement},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderer",{get:function(){return this._pRenderer},set:function(t){if(this._pRenderer==t)return;if(this._pRenderer){this._pRenderer.dispose();this._pRenderer.removeEventListener(ps.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate);this._pRenderer.removeEventListener(ps.SCISSOR_UPDATED,this._onScissorUpdatedDelegate)}this._pRenderer=t;this._pRenderer.addEventListener(ps.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate);this._pRenderer.addEventListener(ps.SCISSOR_UPDATED,this._onScissorUpdatedDelegate);this._pRenderer._iBackgroundR=(this._backgroundColor>>16&255)/255;this._pRenderer._iBackgroundG=(this._backgroundColor>>8&255)/255;this._pRenderer._iBackgroundB=(this._backgroundColor&255)/255;this._pRenderer._iBackgroundAlpha=this._backgroundAlpha;this._pRenderer.width=this._width;this._pRenderer.height=this._height;this._pRenderer.shareContext=this._shareContext},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"shareContext",{get:function(){return this._shareContext},set:function(t){if(this._shareContext==t)return;this._shareContext=t;if(this._pRenderer)this._pRenderer.shareContext=this._shareContext},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){if(this._backgroundColor==t)return;this._backgroundColor=t;this._pRenderer._iBackgroundR=(t>>16&255)/255;this._pRenderer._iBackgroundG=(t>>8&255)/255;this._pRenderer._iBackgroundB=(t&255)/255},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"backgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(t){if(t>1)t=1;else if(t<0)t=0;if(this._backgroundAlpha==t)return;this._pRenderer._iBackgroundAlpha=this._backgroundAlpha=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"camera",{get:function(){return this._pCamera},set:function(t){if(this._pCamera==t)return;if(this._pCamera)this._pCamera.removeEventListener(ha.PROJECTION_CHANGED,this._onProjectionChangedDelegate);this._pCamera=t;if(this._pScene)this._partitions[this._pScene.id]._iRegisterEntity(this._pCamera);this._pCamera.addEventListener(ha.PROJECTION_CHANGED,this._onProjectionChangedDelegate);this._scissorDirty=true;this._viewportDirty=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scene",{get:function(){return this._pScene},set:function(t){if(this._pScene==t)return;if(this._pScene){this._pScene._iUnregisterView(this);this._partitions[this._pScene.id].dispose()}this._pScene=t;this._partitions[this._pScene.id]=new eu(this._pScene);this._pScene._iRegisterView(this);if(this._pCamera)this._partitions[this._pScene.id]._iRegisterEntity(this._pCamera)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"deltaTime",{get:function(){return this._deltaTime},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(t){if(this._width==t)return;this._width=t;this._pRenderer.width=t;if(this._htmlElement){this._htmlElement.style.width=t+"px"}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(t){if(this._height==t)return;this._height=t;this._pRenderer.height=t;if(this._htmlElement){this._htmlElement.style.height=t+"px"}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"mousePicker",{get:function(){return this._mousePicker},set:function(t){if(this._mousePicker==t)return;if(t==null)this._mousePicker=new lu;else this._mousePicker=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this._pRenderer.x},set:function(t){if(this._pRenderer.x==t)return;this._pRenderer.x=t;if(this._htmlElement){this._htmlElement.style.left=t+"px"}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this._pRenderer.y},set:function(t){if(this._pRenderer.y==t)return;this._pRenderer.y=t;if(this._htmlElement){this._htmlElement.style.top=t+"px"}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"visible",{get:function(){return this._htmlElement&&this._htmlElement.style.visibility=="visible"},set:function(t){if(this._htmlElement){this._htmlElement.style.visibility=t?"visible":"hidden"}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderedFacesCount",{get:function(){return 0},enumerable:true,configurable:true});t.prototype.render=function(){this.pUpdateTime();if(this._scissorDirty){this._scissorDirty=false;this._pCamera.projection.setViewRect(this._pRenderer.scissorRect.x,this._pRenderer.scissorRect.y,this._pRenderer.scissorRect.width,this._pRenderer.scissorRect.height)}if(this._viewportDirty){this._viewportDirty=false;this._pCamera.projection.setStageRect(this._pRenderer.viewPort.x,this._pRenderer.viewPort.y,this._pRenderer.viewPort.width,this._pRenderer.viewPort.height)}if(!this._shareContext){if(this.forceMouseMove&&this._htmlElement==this._mouseManager._iActiveDiv&&!this._mouseManager._iUpdateDirty)this._mouseManager._iCollision=this.getViewCollision(this._pMouseX,this._pMouseY,this);this._mouseManager.fireMouseEvents(this.forceMouseMove)}this._pRenderer.render(this)};t.prototype.pUpdateTime=function(){var t=xt();if(this._time==0)this._time=t;this._deltaTime=t-this._time;this._time=t};t.prototype.dispose=function(){this._pRenderer.dispose();this._mouseManager.unregisterView(this);this._mouseManager=null;this._pRenderer=null};t.prototype._onProjectionChanged=function(t){this._scissorDirty=true;this._viewportDirty=true};t.prototype._onViewportUpdated=function(t){this._viewportDirty=true};t.prototype._onScissorUpdated=function(t){this._scissorDirty=true};t.prototype.project=function(t){var e=this._pCamera.project(t);e.x=e.x*this._pRenderer.viewPort.width/2+this._width*this._pCamera.projection.originX;e.y=e.y*this._pRenderer.viewPort.height/2+this._height*this._pCamera.projection.originY;return e};t.prototype.unproject=function(t,e,i){return this._pCamera.unproject((2*t-this._width)/this._pRenderer.viewPort.width,(2*e-this._height)/this._pRenderer.viewPort.height,i)};t.prototype.updateCollider=function(){if(!this._shareContext){if(this._htmlElement==this._mouseManager._iActiveDiv)this._mouseManager._iCollision=this.getViewCollision(this._pMouseX,this._pMouseY,this)}else{var t=this.getViewCollision(this._pMouseX,this._pMouseY,this);if(this.layeredView||this._mouseManager._iCollision==null||t.rayEntryDistance<this._mouseManager._iCollision.rayEntryDistance)this._mouseManager._iCollision=t}};t.prototype.getViewCollision=function(t,e,i){var r=i.unproject(t,e,0);var n=i.unproject(t,e,1).subtract(r);return this._mousePicker.getCollision(r,n,this)};t.prototype.traversePartitions=function(t){for(var e in this._partitions)this._partitions[e].traverse(t)};t.prototype.registerObject=function(t){this.getPartition(t)._iRegisterEntity(t)};t.prototype.unRegisterObject=function(t){this.getPartition(t)._iUnregisterEntity(t)};return t}();rt.enableParser(Dt);rt.enableParser(ke);rt.enableParser(ze);rt.enableParser(je);xr.registerAbstraction(xi,u);gs.registerAbstraction(so,Sa);Ir.registerAbstraction(Os,zs);Ir.registerAbstraction(Is,ga);Ir.registerAbstraction(Fr,jt);Ir.registerAbstraction(Rs,Sa);xr.registerAbstraction(Ki,ae);xr.registerAbstraction(Zi,ce);xr.registerAbstraction(Xi,pe);xr.registerAbstraction(Wi,Be);xr.registerAbstraction(qi,_e);xr.registerAbstraction(Xi,Ue);xr.registerAbstraction(Ji,re);xr.registerAbstraction($i,Ve);xr.registerAbstraction(vs,ee);xr.registerAbstraction(Di,$t);Tr.registerAbstraction(Vr,ve);Tr.registerAbstraction(Ur,be);gs.registerAbstraction(Mr,xe);gs.registerAbstraction(th,go);tu.registerAbstraction(nu,ua);tu.registerAbstraction(ru,fa);tu.registerAbstraction(ru,Ws);tu.registerAbstraction(ru,Aa);tu.registerAbstraction(ru,zs);tu.registerAbstraction(ru,ga);tu.registerAbstraction(ru,Ca);tu.registerAbstraction(ru,da);tu.registerAbstraction(ru,Pa);tu.registerAbstraction(hu,Sa);t.AttributesView=p;t.AttributesBuffer=u;t.Byte4Attributes=c;t.Float1Attributes=_;t.Float2Attributes=f;t.Float3Attributes=d;t.Float4Attributes=g;t.Short2Attributes=m;t.Short3Attributes=y;t.WaveAudio=w;t.ColorTransform=C;t.Transform=I;t.AbstractMethodError=r;t.ArgumentError=E;t.DocumentError=R;t.ErrorBase=i;t.PartialImplementationError=L;t.RangeError=N;t.AssetEvent=s;t.EventBase=n;t.EventDispatcher=a;t.LoaderEvent=F;t.ParserEvent=B;t.ProjectionEvent=V;t.TimerEvent=U;t.TransformEvent=O;t.URLLoaderEvent=k;t.Box=T;t.MathConsts=P;t.Matrix=j;t.Matrix3D=M;t.Orientation3D=S;t.Plane3D=H;t.PlaneClassification=G;t.Point=z;t.PoissonLookup=X;t.Quaternion=W;t.Rectangle=Y;t.Sphere=q;t.Vector3D=A;t.AbstractionBase=K;t.AssetBase=h;t.AssetLibrary=pt;t.AssetLibraryBundle=lt;t.AssetLibraryIterator=Z;t.ConflictPrecedence=nt;t.ConflictStrategy=ut;t.ConflictStrategyBase=st;t.ErrorConflictStrategy=at;t.IDUtil=ct;t.IgnoreConflictStrategy=ot;t.Loader=rt;t.LoaderContext=Q;t.LoaderInfo=_t;t.NumSuffixConflictStrategy=ht;t.AudioManager=b;t.StreamingAudioChannel=v;t.WebAudioChannel=x;t.CrossDomainPolicy=ft;t.URLLoader=et;t.URLLoaderDataFormat=J;t.URLRequest=dt;t.URLRequestMethod=$;t.URLVariables=tt;t.ParserBase=bt;t.ParserDataFormat=wt;t.ParserUtils=yt;t.ResourceDependency=it;t.WaveAudioParser=Dt;t.ObliqueNearPlaneProjection=At;t.OrthographicOffCenterProjection=Tt;t.OrthographicProjection=Pt;t.PerspectiveProjection=St;t.ProjectionBase=Ct;t.Keyboard=Et;t.ByteArray=mt;t.Byte32Array=Mt;t.ByteArrayBase=gt;t.ByteArrayBuffer=Ot;t.ColorUtils=D;t.CSS=It;t.Debug=Rt;t.Extensions=Lt;t.getTimer=xt;t.RequestAnimationFrame=Nt;t.Timer=vt;t.XmlUtils=Ft;t.ParticleData=Bt;t.AnimationNodeBase=Vt;t.Shape=jt;t.Style=Gt;t.TraverserBase=Ht;t.CapsStyle=Xt;t.DrawMode=Wt;t.GradientType=Yt;t.GraphicsFactoryFills=De;t.GraphicsFactoryHelper=qt;t.GraphicsFactoryStrokes=Ae;t.GraphicsFillStyle=Te;t.GraphicsStrokeStyle=Pe;t.GraphicsPath=Ee;t.GraphicsPathCommand=te;t.GraphicsPathWinding=Se;t.InterpolationMethod=Me;t.JointStyle=Ce;t.LineScaleMode=Oe;t.PixelSnapping=Ie;t.SpreadMethod=Re;t.TriangleCulling=Le;t.ElementsEvent=Qt;t.MaterialEvent=de;t.RenderableEvent=Ut;t.ShapeEvent=zt;t.StyleEvent=kt;t.ElementsBase=Jt;t.ElementsType=Ne;t.LineElements=ee;t.TriangleElements=$t;t.BitmapImage2D=pe;t.BitmapImageChannel=Fe;t.BitmapImageCube=_e;t.BlendMode=fe;t.CPUCanvas=le;t.CPURenderingContext2D=he;t.ExternalImage2D=Be;t.Image2D=ae;t.ImageBase=ne;t.ImageCube=ce;t.ImageData=ue;t.Sampler2D=re;t.SamplerBase=ie;t.SamplerCube=Ve;t.SpecularImage2D=Ue;t.DefaultMaterialManager=we;t.BasicMaterial=xe;t.MaterialBase=ge;t.Image2DParser=ke;t.ImageCubeParser=ze;t.TextureAtlasParser=je;t.PickingCollision=He;t.MappingMode=me;t.Single2DTexture=ve;t.SingleCubeTexture=be;t.TextureBase=ye;t.BitmapImageUtils=oe;t.ElementsUtils=Zt;t.HitTestCache=Kt;t.ImageUtils=se;t.MipmapGenerator=Xe;t.Graphics=qe;t.MethodVO=Ke;t.MethodMaterial=go;t.MethodMaterialMode=fo;t.AmbientBasicMethod=uo;t.AmbientEnvMapMethod=mo;t.DiffuseBasicMethod=po;t.DiffuseCelMethod=vo;t.DiffuseCompositeMethod=yo;t.DiffuseDepthMethod=xo;t.DiffuseGradientMethod=bo;t.DiffuseLightMapMethod=wo;t.DiffuseSubSurfaceMethod=Do;t.DiffuseWrapMethod=Co;t.EffectAlphaMaskMethod=To;t.EffectColorMatrixMethod=Po;t.EffectColorTransformMethod=So;t.EffectEnvMapMethod=Eo;t.EffectFogMethod=Mo;t.EffectFresnelEnvMapMethod=Oo;t.EffectLightMapMethod=Io;t.EffectMethodBase=Ao;t.EffectProjectiveTextureMethod=Ro;t.EffectRefractionEnvMapMethod=Lo;t.EffectRimLightMethod=No;t.LightingMethodBase=lo;t.NormalBasicMethod=co;t.NormalHeightMapMethod=Fo;t.NormalSimpleWaterMethod=Bo;t.ShadingMethodBase=ho;t.ShadowCascadeMethod=Uo;t.ShadowDitheredMethod=zo;t.ShadowFilteredMethod=jo;t.ShadowHardMethod=Go;t.ShadowMapMethodBase=Vo;t.ShadowMethodBase=ko;t.ShadowNearMethod=Ho;t.ShadowSoftMethod=Xo;t.SpecularAnisotropicMethod=Wo;t.SpecularBasicMethod=_o;t.SpecularCelMethod=qo;t.SpecularCompositeMethod=Yo;t.SpecularFresnelMethod=Ko;t.SpecularPhongMethod=Zo;t.MethodPass=Jo;t.MethodPassMode=Qo;t.SingleObjectDepthPass=$o;t.GL_MethodMaterial=th;t.AWDParser=gh;t.Max3DSParser=xh;t.FNTParser=Th;t.FontParser=Eh;t.MD2Parser=Mh;t.MD5AnimParser=Oh;t.MD5MeshParser=Fh;t.OBJParser=kh;t.Parsers=Kh;t.AS2ColorAdapter=eh;t.AS2KeyAdapter=ih;t.AS2MCSoundProps=rh;t.AS2MouseAdapter=nh;t.AS2MovieClipAdapter=ph;t.AS2SharedObjectAdapter=uh;t.AS2SoundAdapter=oh;t.AS2StageAdapter=hh;t.AS2SymbolAdapter=sh;t.AS2SystemAdapter=ah;t.AS2TextFieldAdapter=ch;t.AS2SceneGraphFactory=_h;t.AnimationElements=kr;t.ColorSegmentPoint=zr;t.JointPose=jr;t.ParticleAnimationData=Gr;t.ParticleProperties=Hr;t.ParticlePropertiesMode=Xr;t.Skeleton=Wr;t.SkeletonJoint=Yr;t.SkeletonPose=qr;t.VertexAnimationMode=Kr;t.AnimationClipNodeBase=Zr;t.ParticleAccelerationNode=en;t.ParticleBezierCurveNode=nn;t.ParticleBillboardNode=an;t.ParticleColorNode=pn;t.ParticleFollowNode=_n;t.ParticleInitialColorNode=dn;t.ParticleNodeBase=tn;t.ParticleOrbitNode=mn;t.ParticleOscillatorNode=vn;t.ParticlePositionNode=bn;t.ParticleRotateToHeadingNode=Dn;t.ParticleRotateToPositionNode=An;t.ParticleRotationalVelocityNode=Pn;t.ParticleScaleNode=En;t.ParticleSegmentedColorNode=On;t.ParticleSpriteSheetNode=Rn;t.ParticleTimeNode=un;t.ParticleUVNode=Nn;t.ParticleVelocityNode=Bn;t.SkeletonBinaryLERPNode=Un;t.SkeletonClipNode=Gn;t.SkeletonDifferenceNode=Xn;t.SkeletonDirectionalNode=Yn;t.SkeletonNaryLERPNode=Kn;t.VertexClipNode=Qn;t.AnimationClipState=zn;t.AnimationStateBase=Qr;t.ParticleAccelerationState=$r;t.ParticleBezierCurveState=rn;t.ParticleBillboardState=sn;t.ParticleColorState=on;t.ParticleFollowState=cn;t.ParticleInitialColorState=fn;t.ParticleStateBase=Jr;t.ParticleOrbitState=gn;t.ParticleOscillatorState=yn;t.ParticlePositionState=xn;t.ParticleRotateToHeadingState=wn;t.ParticleRotateToPositionState=Cn;t.ParticleRotationalVelocityState=Tn;t.ParticleScaleState=Sn;t.ParticleSegmentedColorState=Mn;t.ParticleSpriteSheetState=In;t.ParticleTimeState=hn;t.ParticleUVState=Ln;t.ParticleVelocityState=Fn;t.SkeletonBinaryLERPState=Vn;t.SkeletonClipState=jn;t.SkeletonDifferenceState=Hn;t.SkeletonDirectionalState=Wn;t.SkeletonNaryLERPState=qn;t.VertexClipState=Zn;t.CrossfadeTransition=ts;t.CrossfadeTransitionNode=$n;t.CrossfadeTransitionState=Jn;t.ParticleAnimationSet=ln;t.ParticleAnimator=es;t.SkeletonAnimationSet=is;t.SkeletonAnimator=rs;t.VertexAnimationSet=ns;t.VertexAnimator=ss;t.DefaultRenderer=ys;t.DepthRenderer=fs;t.DistanceRenderer=ds;t.GL_LineElements=vs;t.GL_SkyboxElements=xs;t.AnimationStateEvent=kn;t.RendererEvent=ps;t.RTTEvent=as;t.ShadingMethodEvent=bs;t.Filter3DRenderer=ms;t.Filter3DCompositeTask=Ds;t.Filter3DFXAATask=Cs;t.Filter3DHBlurTask=As;t.Filter3DTaskBase=ws;t.Filter3DVBlurTask=Ts;t.BlurFilter3D=Ss;t.CompositeFilter3D=Es;t.Filter3DBase=Ps;t.FXAAFilter3D=Ms;t.RTTBufferManager=os;t.GL_BillboardRenderable=Os;t.GL_LineSegmentRenderable=Is;t.GL_SkyboxRenderable=Rs;t.RendererBase=_s;t.LightingCompiler=Ls;t.LightingShader=ro;t.RenderableMergeSort=cs;t.RenderableNullSort=no;t.DefaultMaterialGroup=gs;t.GL_DepthMaterial=us;t.GL_DistanceMaterial=ls;t.GL_SkyboxMaterial=so;t.ParticleGraphicsHelper=ao;t.ParticleGraphicsTransform=oo;t.AlignmentMode=Ns;t.HierarchicalProperties=Fs;t.OrientationMode=Bs;t.Timeline=Gs;t.TouchPoint=Hs;t.AxisAlignedBoundingBox=Qs;t.AxisAlignedBoundingBox2D=Js;t.BoundingSphere=ta;t.BoundingVolumeBase=Zs;t.BoundsType=Vs;t.NullBounds=ea;t.ControllerBase=ia;t.FirstPersonController=ra;t.FollowController=aa;t.HoverController=sa;t.LookAtController=na;t.SpringController=oa;t.Billboard=zs;t.Camera=ua;t.DirectionalLight=fa;t.DisplayObject=ks;t.DisplayObjectContainer=Xs;t.LightBase=_a;t.LightProbe=da;t.LineSegment=ga;t.LoaderContainer=ma;t.MovieClip=Aa;t.PointLight=Pa;t.Skybox=Sa;t.Sprite=Ws;t.TextField=Ca;t.TextureProjector=Ma;t.CastError=Oa;t.CameraEvent=ha;t.DisplayObjectEvent=Us;t.LightEvent=ca;t.MouseEvent=ya;t.ResizeEvent=Ia;t.TextureProjectorEvent=Ea;t.TouchEvent=Ra;t.FrameScriptManager=js;t.LightPickerBase=La;t.LightSources=Na;t.StaticLightPicker=Fa;t.CascadeShadowMapper=Ba;t.CubeMapShadowMapper=Ta;t.DirectionalShadowMapper=pa;t.NearDirectionalShadowMapper=Va;t.ShadowMapperBase=la;t.PrefabBase=Ys;t.PrimitiveCapsulePrefab=Ua;t.PrimitiveConePrefab=za;t.PrimitiveCubePrefab=Ks;t.PrimitiveCylinderPrefab=ka;t.PrimitivePlanePrefab=ja;t.PrimitivePolygonPrefab=Ga;t.PrimitivePrefabBase=qs;t.PrimitiveSpherePrefab=$s;t.PrimitiveTorusPrefab=Ha;t.AntiAliasType=Xa;t.Font=Wa;t.GridFitType=Ya;t.TesselatedFontTable=xa;t.BitmapFontTable=wa;t.TesselatedFontChar=va;t.BitmapFontChar=ba;t.TextFieldAutoSize=qa;t.TextFieldType=Da;t.TextFormat=Ka;t.TextFormatAlign=Za;t.TextInteractionMode=Qa;t.TextLineMetrics=Ja;t.Merge=$a;t.Cast=eo;t.Scene=io;t.AGALMiniAssembler=si;t.Flags=Ze;t.FS=Qe;t.Opcode=Je;t.OpcodeMap=$e;t.Part=ti;t.RegMap=ii;t.Sampler=ri;t.SamplerMap=ni;t.AGALTokenizer=ci;t.AGLSLParser=_i;t.Description=oi;t.Destination=li;t.Header=ai;t.Mapping=ui;t.OpLUT=hi;t.Token=pi;t.AnimationRegisterData=di;t.AnimationSetBase=mi;t.AnimatorBase=vi;t.GL_AttributesBuffer=xi;t.SamplerState=bi;t.GL_ElementsBase=wi;t.GL_TriangleElements=Di;t.AnimationSetError=gi;t.StageEvent=Ci;t.AnimatorEvent=yi;t.PassEvent=Ai;t.ContextFlash=Ri;t.CubeTextureFlash=Si;t.IndexBufferFlash=Ei;t.OpCodes=Ti;t.ProgramFlash=Mi;t.ResourceBaseFlash=Pi;t.TextureFlash=Oi;t.VertexBufferFlash=Ii;t.ContextGLES=ji;t.GLESConnector=Vi;t.GLESAssetBase=Li;t.CubeTextureGLES=Fi;t.IndexBufferGLES=Bi;t.ProgramGLES=Ui;t.TextureBaseGLES=Ni;t.TextureGLES=ki;t.VertexBufferGLES=zi;t.GL_BitmapImage2D=Xi;t.GL_ExternalImage2D=Wi;t.GL_BitmapImageCube=qi;t.GL_Image2D=Hi;t.GL_ImageBase=Gi;t.GL_ImageCube=Yi;t.GL_RenderImage2D=Ki;t.GL_RenderImageCube=Zi;t.GL_Sampler2D=Ji;t.GL_SamplerBase=Qi;t.GL_SamplerCube=$i;t.ProgramData=tr;t.ProgramDataPool=er;t.StageManager=br;t.BasicMaterialPass=Sr;t.PassBase=Pr;t.GL_BasicMaterial=Mr;t.GL_MaterialBase=Er;t.GL_MaterialPassBase=Or;t.MaterialGroupBase=Lr;t.MaterialPool=Rr;t.GL_ShapeRenderable=Fr;t.GL_RenderableBase=Nr;t.RenderablePool=Ir;t.CompilerBase=Ar;t.RegisterPool=wr;t.ShaderBase=Tr;t.ShaderRegisterCache=Dr;t.ShaderRegisterData=Cr;t.ShaderRegisterElement=fi;t.ContextSoftware=pr;t.IndexBufferSoftware=ir;t.ProgramSoftware=hr;t.ProgramVOSoftware=ar;t.SoftwareSamplerState=or;t.TextureSoftware=nr;t.VertexBufferSoftware=rr;t.GL_Single2DTexture=Vr;t.GL_SingleCubeTexture=Ur;t.GL_TextureBase=Br;t.ContextWebGL=yr;t.CubeTextureWebGL=_r;t.IndexBufferWebGL=fr;t.ProgramWebGL=dr;t.TextureBaseWebGL=cr;t.TextureWebGL=gr;t.VertexBufferWebGL=mr;t.Stage=xr;t.MouseManager=Zh;t.TouchManager=Qh;t.BasicPartition=eu;t.CameraNode=nu;t.DisplayObjectNode=iu;t.EntityNode=ru;t.NodeBase=$h;t.PartitionBase=tu;t.SceneGraphNode=su;t.SceneGraphPartition=au;t.SkyboxNode=hu;t.JSPickingCollider=uu;t.RaycastPicker=lu;t.View=pu;Object.defineProperty(t,"__esModule",{value:true})});
//# sourceMappingURL=./bundle/awayjs-full.umd.min.js.map