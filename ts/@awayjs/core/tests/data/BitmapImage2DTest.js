"use strict";
var BitmapImage2D_1 = require("@awayjs/core/lib/image/BitmapImage2D");
var Matrix_1 = require("@awayjs/core/lib/geom/Matrix");
var Rectangle_1 = require("@awayjs/core/lib/geom/Rectangle");
var URLLoader_1 = require("@awayjs/core/lib/net/URLLoader");
var URLLoaderDataFormat_1 = require("@awayjs/core/lib/net/URLLoaderDataFormat");
var URLRequest_1 = require("@awayjs/core/lib/net/URLRequest");
var URLLoaderEvent_1 = require("@awayjs/core/lib/events/URLLoaderEvent");
var ParserUtils_1 = require("@awayjs/core/lib/parsers/ParserUtils");
var ColorUtils_1 = require("@awayjs/core/lib/utils/ColorUtils");
var BitmapImage2DTest = (function () {
    function BitmapImage2DTest() {
        var _this = this;
        var transparent = true;
        var initcolour = 0xffffffff;
        //---------------------------------------
        // Load a PNG
        this.urlRequest = new URLRequest_1.default('assets/256x256.png');
        this.urlLoader = new URLLoader_1.default();
        this.urlLoader.dataFormat = URLLoaderDataFormat_1.default.BLOB;
        this.urlLoader.load(this.urlRequest);
        this.urlLoader.addEventListener(URLLoaderEvent_1.default.LOAD_COMPLETE, function (event) { return _this.imgLoaded(event); });
        this.urlLoader.addEventListener(URLLoaderEvent_1.default.LOAD_ERROR, function (event) { return _this.imgLoadedError(event); });
        //---------------------------------------
        // BitmapImage2D Object - 1
        this.bitmapData = new BitmapImage2D_1.default(256, 256, transparent, initcolour);
        document.body.appendChild(this.bitmapData.getCanvas());
        //---------------------------------------
        // BitmapImage2D Object - 2
        this.bitmapDataB = new BitmapImage2D_1.default(256, 256, transparent, initcolour);
        this.bitmapDataB.getCanvas().style.position = 'absolute';
        this.bitmapDataB.getCanvas().style.left = '540px';
        document.body.appendChild(this.bitmapDataB.getCanvas());
        //---------------------------------------
        // BitmapImage2D - setPixel test
        console['time']("bitmapdata"); // start setPixel operation benchmark ( TypeScript does not support console.time - so hacking it in ) .
        this.bitmapDataB.lock();
        for (var i = 0; i < 10000; i++) {
            var x = Math.random() * this.bitmapDataB.width | 0; // |0 to truncate to Int32
            var y = Math.random() * this.bitmapDataB.height | 0;
            this.bitmapDataB.setPixel(x, y, Math.random() * 0xffFFFFFF); // 255 opaque
        }
        this.bitmapDataB.unlock();
        console['timeEnd']("bitmapdata"); // benchmark the setPixel operation
        document.onmousedown = function (event) { return _this.onMouseDown(event); };
    }
    BitmapImage2DTest.prototype.onMouseDown = function (event) {
        if (this.bitmapData.width === 512) {
            if (this.image.complete) {
                this.bitmapDataB.lock(); // Lock bitmap - speeds up setPixelOperations
                //---------------------------------------
                // Resize BitmapImage2D
                this.bitmapData.width = 256;
                this.bitmapData.height = 256;
                //---------------------------------------
                // copy loaded image to first BitmapImage2D
                var rect = new Rectangle_1.default(0, 0, this.image.width, this.image.height);
                this.bitmapData.draw(this.image);
                //---------------------------------------
                // copy image into second bitmap data ( and scale it up 2X )
                rect.width = rect.width * 2;
                rect.height = rect.height * 2;
                this.bitmapDataB.copyPixels(this.bitmapData, this.bitmapData.rect, rect);
                //---------------------------------------
                // draw random pixels
                for (var d = 0; d < 1000; d++) {
                    var x = Math.random() * this.bitmapDataB.width | 0; // |0 to truncate to Int32
                    var y = Math.random() * this.bitmapDataB.height | 0;
                    this.bitmapDataB.setPixel(x, y, Math.random() * 0xFFFFFFFF); // 255 opaque
                }
                this.bitmapDataB.unlock(); // Unlock bitmapdata
            }
            else {
                //---------------------------------------
                // image is not loaded - fill bitmapdata with red
                this.bitmapData.width = 256;
                this.bitmapData.height = 256;
                this.bitmapData.fillRect(this.bitmapData.rect, 0xffff0000);
            }
        }
        else {
            //---------------------------------------
            // resize bitmapdata;
            this.bitmapData.lock();
            this.bitmapData.width = 512;
            this.bitmapData.height = 512;
            this.bitmapData.fillRect(this.bitmapData.rect, 0xffff0000); // fill it RED
            for (var d = 0; d < 1000; d++) {
                var x = Math.random() * this.bitmapData.width | 0; // |0 to truncate to Int32
                var y = Math.random() * this.bitmapData.height | 0;
                this.bitmapData.setPixel(x, y, Math.random() * 0xFFFFFFFF);
            }
            this.bitmapData.unlock();
            //---------------------------------------
            // copy bitmapdata
            var targetRect = this.bitmapDataB.rect.clone();
            targetRect.width = targetRect.width / 2;
            targetRect.height = targetRect.height / 2;
            this.bitmapDataB.copyPixels(this.bitmapData, this.bitmapDataB.rect, targetRect); // copy first bitmapdata object into the second one
        }
        var m = new Matrix_1.default(.5, .08, .08, .5, this.image.width / 2, this.image.height / 2);
        this.bitmapData.draw(this.bitmapData, m);
        this.bitmapData.setPixel32(0, 0, 0xccff0000);
        this.bitmapData.setPixel32(1, 0, 0xcc00ff00);
        this.bitmapData.setPixel32(2, 0, 0xcc0000ff);
        this.bitmapDataB.draw(this.bitmapData, m);
        console.log('GetPixel 0,0: ', ColorUtils_1.default.ARGBToHexString(ColorUtils_1.default.float32ColorToARGB(this.bitmapData.getPixel(0, 0))));
        console.log('GetPixel 1,0: ', ColorUtils_1.default.ARGBToHexString(ColorUtils_1.default.float32ColorToARGB(this.bitmapData.getPixel(1, 0))));
        console.log('GetPixel 2,0: ', ColorUtils_1.default.ARGBToHexString(ColorUtils_1.default.float32ColorToARGB(this.bitmapData.getPixel(2, 0))));
    };
    BitmapImage2DTest.prototype.imgLoadedError = function (event) {
        console.log('error');
    };
    BitmapImage2DTest.prototype.imgLoaded = function (event) {
        var _this = this;
        var loader = event.target;
        this.image = ParserUtils_1.default.blobToImage(loader.data);
        this.image.onload = function (event) { return _this.onImageLoad(event); };
    };
    BitmapImage2DTest.prototype.onImageLoad = function (event) {
        this.bitmapData.draw(this.image, null, null, null, new Rectangle_1.default(0, 0, this.image.width / 2, this.image.height / 2));
        this.bitmapData.draw(this.bitmapData, new Matrix_1.default(.5, .08, .08, .5, this.image.width / 2, this.image.height / 2));
    };
    return BitmapImage2DTest;
}());

//# sourceMappingURL=data:application/json;base64,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Q0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxnQkFBTSxDQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM5RyxDQUFDO0lBQ0Ysd0JBQUM7QUFBRCxDQTlKQSxBQThKQyxJQUFBIiwiZmlsZSI6ImRhdGEvQml0bWFwSW1hZ2UyRFRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQml0bWFwSW1hZ2UyRFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvaW1hZ2UvQml0bWFwSW1hZ2UyRFwiO1xuaW1wb3J0IE1hdHJpeFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4XCI7XG5pbXBvcnQgUmVjdGFuZ2xlXHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL2dlb20vUmVjdGFuZ2xlXCI7XG5pbXBvcnQgVVJMTG9hZGVyXHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL25ldC9VUkxMb2FkZXJcIjtcbmltcG9ydCBVUkxMb2FkZXJEYXRhRm9ybWF0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTExvYWRlckRhdGFGb3JtYXRcIjtcbmltcG9ydCBVUkxSZXF1ZXN0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL25ldC9VUkxSZXF1ZXN0XCI7XG5pbXBvcnQgVVJMTG9hZGVyRXZlbnRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9VUkxMb2FkZXJFdmVudFwiO1xuaW1wb3J0IFBhcnNlclV0aWxzXHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL3BhcnNlcnMvUGFyc2VyVXRpbHNcIjtcbmltcG9ydCBDb2xvclV0aWxzXHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL3V0aWxzL0NvbG9yVXRpbHNcIjtcblxuY2xhc3MgQml0bWFwSW1hZ2UyRFRlc3Rcbntcblx0cHJpdmF0ZSBiaXRtYXBEYXRhOkJpdG1hcEltYWdlMkQ7XG5cdHByaXZhdGUgYml0bWFwRGF0YUI6Qml0bWFwSW1hZ2UyRDtcblx0cHJpdmF0ZSB1cmxMb2FkZXI6VVJMTG9hZGVyO1xuXHRwcml2YXRlIHVybFJlcXVlc3Q6VVJMUmVxdWVzdDtcblx0cHJpdmF0ZSBpbWFnZTpIVE1MSW1hZ2VFbGVtZW50O1xuXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdHZhciB0cmFuc3BhcmVudDpib29sZWFuID0gdHJ1ZTtcblx0XHR2YXIgaW5pdGNvbG91cjpudW1iZXIgPSAweGZmZmZmZmZmO1xuXG5cdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvLyBMb2FkIGEgUE5HXG5cblx0XHR0aGlzLnVybFJlcXVlc3QgPSBuZXcgVVJMUmVxdWVzdCgnYXNzZXRzLzI1NngyNTYucG5nJyk7XG5cdFx0dGhpcy51cmxMb2FkZXIgPSBuZXcgVVJMTG9hZGVyKCk7XG5cdFx0dGhpcy51cmxMb2FkZXIuZGF0YUZvcm1hdCA9IFVSTExvYWRlckRhdGFGb3JtYXQuQkxPQjtcblxuXHRcdHRoaXMudXJsTG9hZGVyLmxvYWQodGhpcy51cmxSZXF1ZXN0KTtcblx0XHR0aGlzLnVybExvYWRlci5hZGRFdmVudExpc3RlbmVyKFVSTExvYWRlckV2ZW50LkxPQURfQ09NUExFVEUsIChldmVudDpVUkxMb2FkZXJFdmVudCkgPT4gdGhpcy5pbWdMb2FkZWQoZXZlbnQpKTtcblx0XHR0aGlzLnVybExvYWRlci5hZGRFdmVudExpc3RlbmVyKFVSTExvYWRlckV2ZW50LkxPQURfRVJST1IsIChldmVudDpVUkxMb2FkZXJFdmVudCkgPT4gdGhpcy5pbWdMb2FkZWRFcnJvcihldmVudCkpO1xuXG5cdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvLyBCaXRtYXBJbWFnZTJEIE9iamVjdCAtIDFcblx0XHR0aGlzLmJpdG1hcERhdGEgPSBuZXcgQml0bWFwSW1hZ2UyRCgyNTYsICAyNTYsIHRyYW5zcGFyZW50LCBpbml0Y29sb3VyKTtcblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuYml0bWFwRGF0YS5nZXRDYW52YXMoKSk7XG5cblx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8vIEJpdG1hcEltYWdlMkQgT2JqZWN0IC0gMlxuXHRcdHRoaXMuYml0bWFwRGF0YUIgPSBuZXcgQml0bWFwSW1hZ2UyRCgyNTYsIDI1NiwgdHJhbnNwYXJlbnQsIGluaXRjb2xvdXIpO1xuXHRcdHRoaXMuYml0bWFwRGF0YUIuZ2V0Q2FudmFzKCkuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuXHRcdHRoaXMuYml0bWFwRGF0YUIuZ2V0Q2FudmFzKCkuc3R5bGUubGVmdCA9ICc1NDBweCc7XG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmJpdG1hcERhdGFCLmdldENhbnZhcygpKTtcblxuXHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0Ly8gQml0bWFwSW1hZ2UyRCAtIHNldFBpeGVsIHRlc3Rcblx0XHRjb25zb2xlWyd0aW1lJ10oXCJiaXRtYXBkYXRhXCIpOyAvLyBzdGFydCBzZXRQaXhlbCBvcGVyYXRpb24gYmVuY2htYXJrICggVHlwZVNjcmlwdCBkb2VzIG5vdCBzdXBwb3J0IGNvbnNvbGUudGltZSAtIHNvIGhhY2tpbmcgaXQgaW4gKSAuXG5cblx0XHR0aGlzLmJpdG1hcERhdGFCLmxvY2soKTtcblxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgMTAwMDA7IGkrKykge1xuXHRcdFx0dmFyIHggPSBNYXRoLnJhbmRvbSgpICogdGhpcy5iaXRtYXBEYXRhQi53aWR0aCB8IDA7IC8vIHwwIHRvIHRydW5jYXRlIHRvIEludDMyXG5cdFx0XHR2YXIgeSA9IE1hdGgucmFuZG9tKCkgKiB0aGlzLmJpdG1hcERhdGFCLmhlaWdodCB8IDA7XG5cdFx0XHR0aGlzLmJpdG1hcERhdGFCLnNldFBpeGVsKHgsIHksIE1hdGgucmFuZG9tKCkgKiAweGZmRkZGRkZGICk7IC8vIDI1NSBvcGFxdWVcblx0XHR9XG5cblx0XHR0aGlzLmJpdG1hcERhdGFCLnVubG9jaygpO1xuXHRcdGNvbnNvbGVbJ3RpbWVFbmQnXShcImJpdG1hcGRhdGFcIik7IC8vIGJlbmNobWFyayB0aGUgc2V0UGl4ZWwgb3BlcmF0aW9uXG5cblx0XHRkb2N1bWVudC5vbm1vdXNlZG93biA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uTW91c2VEb3duKGV2ZW50KTtcblx0fVxuXG5cdHByaXZhdGUgb25Nb3VzZURvd24oZXZlbnQ6TW91c2VFdmVudClcblx0e1xuXHRcdGlmICggdGhpcy5iaXRtYXBEYXRhLndpZHRoID09PSA1MTIgKSB7Ly8gVGVzdCB0byB0b2dnbGUgcmVzaXplIG9mIGJpdG1hcERhdGFcblx0XHRcdGlmICggdGhpcy5pbWFnZS5jb21wbGV0ZSApIHsvLyBJZiBpbWFnZSBpcyBsb2FkZWQgY29weSB0aGF0IHRvIHRoZSBCaXRtYXBJbWFnZTJEIG9iamVjdFxuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGFCLmxvY2soKTsgLy8gTG9jayBiaXRtYXAgLSBzcGVlZHMgdXAgc2V0UGl4ZWxPcGVyYXRpb25zXG5cdFx0XHRcdFxuXHRcdFx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdFx0XHQvLyBSZXNpemUgQml0bWFwSW1hZ2UyRFxuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGEud2lkdGggID0gMjU2O1xuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGEuaGVpZ2h0ID0gMjU2O1xuXG5cdFx0XHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0XHRcdC8vIGNvcHkgbG9hZGVkIGltYWdlIHRvIGZpcnN0IEJpdG1hcEltYWdlMkRcblxuXHRcdFx0XHR2YXIgcmVjdDpSZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKDAsIDAsIHRoaXMuaW1hZ2Uud2lkdGgsIHRoaXMuaW1hZ2UuaGVpZ2h0KTtcblx0XHRcdFx0dGhpcy5iaXRtYXBEYXRhLmRyYXcodGhpcy5pbWFnZSk7XG5cblx0XHRcdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHRcdFx0Ly8gY29weSBpbWFnZSBpbnRvIHNlY29uZCBiaXRtYXAgZGF0YSAoIGFuZCBzY2FsZSBpdCB1cCAyWCApXG5cdFx0XHRcdHJlY3Qud2lkdGggPSByZWN0LndpZHRoICogMjtcblx0XHRcdFx0cmVjdC5oZWlnaHQgPSByZWN0LmhlaWdodCAqIDI7XG5cblx0XHRcdFx0dGhpcy5iaXRtYXBEYXRhQi5jb3B5UGl4ZWxzKHRoaXMuYml0bWFwRGF0YSwgdGhpcy5iaXRtYXBEYXRhLnJlY3QsIHJlY3QpO1xuXG5cdFx0XHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0XHRcdC8vIGRyYXcgcmFuZG9tIHBpeGVsc1xuXG5cdFx0XHRcdGZvciAodmFyIGQgPSAwOyBkIDwgMTAwMDsgZCsrKSB7XG5cdFx0XHRcdFx0dmFyIHggPSBNYXRoLnJhbmRvbSgpKnRoaXMuYml0bWFwRGF0YUIud2lkdGggfCAwOyAvLyB8MCB0byB0cnVuY2F0ZSB0byBJbnQzMlxuXHRcdFx0XHRcdHZhciB5ID0gTWF0aC5yYW5kb20oKSp0aGlzLmJpdG1hcERhdGFCLmhlaWdodCB8IDA7XG5cdFx0XHRcdFx0dGhpcy5iaXRtYXBEYXRhQi5zZXRQaXhlbCh4LCB5LCBNYXRoLnJhbmRvbSgpKjB4RkZGRkZGRkYpOyAvLyAyNTUgb3BhcXVlXG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGFCLnVubG9jaygpOyAvLyBVbmxvY2sgYml0bWFwZGF0YVxuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdFx0XHQvLyBpbWFnZSBpcyBub3QgbG9hZGVkIC0gZmlsbCBiaXRtYXBkYXRhIHdpdGggcmVkXG5cdFx0XHRcdHRoaXMuYml0bWFwRGF0YS53aWR0aCAgPSAyNTY7XG5cdFx0XHRcdHRoaXMuYml0bWFwRGF0YS5oZWlnaHQgPSAyNTY7XG5cdFx0XHRcdHRoaXMuYml0bWFwRGF0YS5maWxsUmVjdCh0aGlzLmJpdG1hcERhdGEucmVjdCwgMHhmZmZmMDAwMCk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0XHQvLyByZXNpemUgYml0bWFwZGF0YTtcblxuXHRcdFx0dGhpcy5iaXRtYXBEYXRhLmxvY2soKTtcblxuXHRcdFx0dGhpcy5iaXRtYXBEYXRhLndpZHRoICA9IDUxMjtcblx0XHRcdHRoaXMuYml0bWFwRGF0YS5oZWlnaHQgPSA1MTI7XG5cdFx0XHR0aGlzLmJpdG1hcERhdGEuZmlsbFJlY3QodGhpcy5iaXRtYXBEYXRhLnJlY3QsIDB4ZmZmZjAwMDApOyAvLyBmaWxsIGl0IFJFRFxuXG5cdFx0XHRmb3IgKHZhciBkID0gMDsgZCA8IDEwMDA7IGQrKykge1xuXHRcdFx0XHR2YXIgeCA9IE1hdGgucmFuZG9tKCkqdGhpcy5iaXRtYXBEYXRhLndpZHRoIHwgMDsgLy8gfDAgdG8gdHJ1bmNhdGUgdG8gSW50MzJcblx0XHRcdFx0dmFyIHkgPSBNYXRoLnJhbmRvbSgpKnRoaXMuYml0bWFwRGF0YS5oZWlnaHQgfCAwO1xuXHRcdFx0XHR0aGlzLmJpdG1hcERhdGEuc2V0UGl4ZWwoeCwgeSwgTWF0aC5yYW5kb20oKSoweEZGRkZGRkZGKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5iaXRtYXBEYXRhLnVubG9jaygpO1xuXHRcdFx0Ly8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHRcdC8vIGNvcHkgYml0bWFwZGF0YVxuXG5cdFx0XHR2YXIgdGFyZ2V0UmVjdCA9IHRoaXMuYml0bWFwRGF0YUIucmVjdC5jbG9uZSgpO1xuXHRcdFx0XHR0YXJnZXRSZWN0LndpZHRoID0gdGFyZ2V0UmVjdC53aWR0aC8yO1xuXHRcdFx0XHR0YXJnZXRSZWN0LmhlaWdodCA9IHRhcmdldFJlY3QuaGVpZ2h0LzI7XG5cblx0XHRcdHRoaXMuYml0bWFwRGF0YUIuY29weVBpeGVscyh0aGlzLmJpdG1hcERhdGEsIHRoaXMuYml0bWFwRGF0YUIucmVjdCwgdGFyZ2V0UmVjdCk7IC8vIGNvcHkgZmlyc3QgYml0bWFwZGF0YSBvYmplY3QgaW50byB0aGUgc2Vjb25kIG9uZVxuXHRcdH1cblxuXHRcdHZhciBtIDogTWF0cml4ID0gbmV3IE1hdHJpeCguNSwgLjA4LCAuMDgsIC41LCB0aGlzLmltYWdlLndpZHRoLzIsIHRoaXMuaW1hZ2UuaGVpZ2h0LzIpO1xuXHRcdHRoaXMuYml0bWFwRGF0YS5kcmF3KHRoaXMuYml0bWFwRGF0YSwgbSk7XG5cblx0XHR0aGlzLmJpdG1hcERhdGEuc2V0UGl4ZWwzMigwLCAwLCAweGNjZmYwMDAwKSA7XG5cdFx0dGhpcy5iaXRtYXBEYXRhLnNldFBpeGVsMzIoMSwgMCwgMHhjYzAwZmYwMCkgO1xuXHRcdHRoaXMuYml0bWFwRGF0YS5zZXRQaXhlbDMyKDIsIDAsIDB4Y2MwMDAwZmYpIDtcblxuXHRcdHRoaXMuYml0bWFwRGF0YUIuZHJhdyh0aGlzLmJpdG1hcERhdGEsIG0pO1xuXG5cdFx0Y29uc29sZS5sb2coJ0dldFBpeGVsIDAsMDogJywgQ29sb3JVdGlscy5BUkdCVG9IZXhTdHJpbmcoQ29sb3JVdGlscy5mbG9hdDMyQ29sb3JUb0FSR0IodGhpcy5iaXRtYXBEYXRhLmdldFBpeGVsKDAsIDApKSkpO1xuXHRcdGNvbnNvbGUubG9nKCdHZXRQaXhlbCAxLDA6ICcsIENvbG9yVXRpbHMuQVJHQlRvSGV4U3RyaW5nKENvbG9yVXRpbHMuZmxvYXQzMkNvbG9yVG9BUkdCKHRoaXMuYml0bWFwRGF0YS5nZXRQaXhlbCgxLCAwKSkpKTtcblx0XHRjb25zb2xlLmxvZygnR2V0UGl4ZWwgMiwwOiAnLCBDb2xvclV0aWxzLkFSR0JUb0hleFN0cmluZyhDb2xvclV0aWxzLmZsb2F0MzJDb2xvclRvQVJHQih0aGlzLmJpdG1hcERhdGEuZ2V0UGl4ZWwoMiwgMCkpKSk7XG5cblxuXG5cdH1cblxuXHRwcml2YXRlIGltZ0xvYWRlZEVycm9yKGV2ZW50OlVSTExvYWRlckV2ZW50KVxuXHR7XG5cdFx0Y29uc29sZS5sb2coJ2Vycm9yJyk7XG5cdH1cblxuXHRwcml2YXRlIGltZ0xvYWRlZChldmVudDpVUkxMb2FkZXJFdmVudClcblx0e1xuXHRcdHZhciBsb2FkZXIgOlVSTExvYWRlciA9IDxVUkxMb2FkZXI+IGV2ZW50LnRhcmdldDtcblx0XHR0aGlzLmltYWdlID0gUGFyc2VyVXRpbHMuYmxvYlRvSW1hZ2UobG9hZGVyLmRhdGEpO1xuXHRcdHRoaXMuaW1hZ2Uub25sb2FkID0gKGV2ZW50OkV2ZW50KSA9PiB0aGlzLm9uSW1hZ2VMb2FkKGV2ZW50KTtcblx0fVxuXG5cdHByaXZhdGUgb25JbWFnZUxvYWQoZXZlbnQ6RXZlbnQpXG5cdHtcblx0XHR0aGlzLmJpdG1hcERhdGEuZHJhdyh0aGlzLmltYWdlLCBudWxsLCBudWxsLCBudWxsLCBuZXcgUmVjdGFuZ2xlKDAsIDAsIHRoaXMuaW1hZ2Uud2lkdGgvMiwgdGhpcy5pbWFnZS5oZWlnaHQvMikpO1xuXG5cdFx0dGhpcy5iaXRtYXBEYXRhLmRyYXcodGhpcy5iaXRtYXBEYXRhLCBuZXcgTWF0cml4KC41LCAuMDgsIC4wOCwgLjUsIHRoaXMuaW1hZ2Uud2lkdGgvMiwgdGhpcy5pbWFnZS5oZWlnaHQvMikpO1xuXHR9XG59Il0sInNvdXJjZVJvb3QiOiIuL3Rlc3RzIn0=
